<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Book a Free Estimate | Surprise Granite</title>
  <meta name="description" content="Schedule your free in-home estimate for countertops, tile, and flooring. Pick a date and time that works for you."/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="canonical" href="https://surprisegranite.com/book/"/>
  <link href="https://cdn.prod.website-files.com/6456ce4476abb25581fbad0c/6456ce4476abb269c6fbb176_Surprise-Granite-favicon-32x32px.png" rel="shortcut icon" type="image/x-icon"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>

  <!-- Unified Navigation -->
  <link rel="stylesheet" href="/css/unified-nav.css?v=20260111c">
  <script defer src="/js/unified-nav.js?v=20260111c"></script>

  <style>
    :root {
      --gold: #f9cb00;
      --gold-dark: #cca600;
      --dark: #0a0a0a;
      --surface: #1a1a1a;
      --surface-elevated: #242424;
      --border: rgba(255,255,255,0.1);
      --text: #ffffff;
      --text-secondary: rgba(255,255,255,0.7);
      --text-muted: rgba(255,255,255,0.5);
      --success: #22c55e;
      --error: #ef4444;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      background: var(--dark);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.5;
    }

    /* Header */
    .book-header {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      padding: 16px 24px;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .book-header-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .book-logo {
      display: flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
      color: var(--text);
    }

    .book-logo-icon {
      width: 40px;
      height: 40px;
    }

    .book-logo-text {
      font-weight: 700;
      font-size: 18px;
    }

    .book-back {
      display: flex;
      align-items: center;
      gap: 6px;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 14px;
      font-weight: 500;
      padding: 8px 16px;
      border-radius: 8px;
      transition: all 0.2s;
    }

    .book-back:hover {
      background: var(--surface-elevated);
      color: var(--text);
    }

    /* Main Content */
    .book-main {
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 24px 80px;
    }

    .book-title {
      text-align: center;
      margin-bottom: 40px;
    }

    .book-title h1 {
      font-size: 32px;
      font-weight: 800;
      margin-bottom: 12px;
    }

    .book-title p {
      font-size: 16px;
      color: var(--text-secondary);
      max-width: 500px;
      margin: 0 auto;
    }

    /* Progress Steps */
    .book-progress {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 40px;
    }

    .progress-step {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      background: var(--surface);
      color: var(--text-muted);
    }

    .progress-step.active {
      background: var(--gold);
      color: #000;
    }

    .progress-step.completed {
      background: var(--success);
      color: #fff;
    }

    .progress-step .step-num {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
    }

    .progress-step.active .step-num {
      background: rgba(0,0,0,0.2);
    }

    /* Form Sections */
    .book-section {
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .book-section.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Calendar */
    .calendar-container {
      background: var(--surface);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .calendar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
    }

    .calendar-month {
      font-size: 20px;
      font-weight: 700;
    }

    .calendar-nav {
      display: flex;
      gap: 8px;
    }

    .calendar-nav button {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .calendar-nav button:hover {
      background: var(--surface-elevated);
      border-color: var(--gold);
    }

    .calendar-nav button:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .calendar-weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
      margin-bottom: 8px;
    }

    .calendar-weekday {
      text-align: center;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-muted);
      padding: 8px;
    }

    .calendar-days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
    }

    .calendar-day {
      aspect-ratio: 1;
      border-radius: 12px;
      border: none;
      background: transparent;
      color: var(--text);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .calendar-day:hover:not(:disabled):not(.selected) {
      background: var(--surface-elevated);
    }

    .calendar-day.today {
      border: 2px solid var(--gold);
    }

    .calendar-day.selected {
      background: var(--gold);
      color: #000;
      font-weight: 700;
    }

    .calendar-day:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .calendar-day.other-month {
      opacity: 0.3;
    }

    /* Time Slots */
    .time-slots-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 16px;
      color: var(--text-secondary);
    }

    .time-slots {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 10px;
    }

    .time-slot {
      padding: 14px 16px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }

    .time-slot:hover:not(.selected):not(:disabled) {
      border-color: var(--gold);
      background: rgba(249, 203, 0, 0.1);
    }

    .time-slot.selected {
      background: var(--gold);
      color: #000;
      border-color: var(--gold);
      font-weight: 600;
    }

    .time-slot:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    /* Form Fields */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }

    @media (max-width: 600px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    .form-label {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-secondary);
    }

    .form-label .required {
      color: var(--error);
    }

    .form-input,
    .form-select,
    .form-textarea {
      padding: 14px 16px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--surface);
      color: var(--text);
      font-size: 15px;
      font-family: inherit;
      transition: all 0.2s;
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      outline: none;
      border-color: var(--gold);
      box-shadow: 0 0 0 3px rgba(249, 203, 0, 0.2);
    }

    .form-textarea {
      min-height: 120px;
      resize: vertical;
    }

    .form-select {
      cursor: pointer;
    }

    /* Buttons */
    .book-buttons {
      display: flex;
      gap: 12px;
      margin-top: 32px;
    }

    .book-btn {
      flex: 1;
      padding: 16px 24px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      border: none;
    }

    .book-btn.primary {
      background: var(--gold);
      color: #000;
    }

    .book-btn.primary:hover {
      background: var(--gold-dark);
      transform: translateY(-2px);
    }

    .book-btn.primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .book-btn.secondary {
      background: var(--surface);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .book-btn.secondary:hover {
      background: var(--surface-elevated);
    }

    /* Summary Card */
    .summary-card {
      background: var(--surface);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .summary-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .summary-title svg {
      color: var(--gold);
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
    }

    .summary-row:last-child {
      border-bottom: none;
    }

    .summary-label {
      color: var(--text-muted);
      font-size: 14px;
    }

    .summary-value {
      font-weight: 600;
      font-size: 14px;
    }

    /* Success Screen */
    .success-container {
      text-align: center;
      padding: 60px 24px;
    }

    .success-icon {
      width: 80px;
      height: 80px;
      background: var(--success);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 24px;
    }

    .success-icon svg {
      width: 40px;
      height: 40px;
      color: #fff;
    }

    .success-title {
      font-size: 28px;
      font-weight: 800;
      margin-bottom: 12px;
    }

    .success-message {
      font-size: 16px;
      color: var(--text-secondary);
      max-width: 400px;
      margin: 0 auto 32px;
    }

    .success-details {
      background: var(--surface);
      border-radius: 16px;
      padding: 24px;
      max-width: 400px;
      margin: 0 auto 32px;
      text-align: left;
    }

    .success-detail {
      display: flex;
      gap: 12px;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
    }

    .success-detail:last-child {
      border-bottom: none;
    }

    .success-detail-icon {
      width: 40px;
      height: 40px;
      background: rgba(249, 203, 0, 0.1);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .success-detail-icon svg {
      width: 20px;
      height: 20px;
      color: var(--gold);
    }

    .success-detail-text {
      flex: 1;
    }

    .success-detail-label {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 2px;
    }

    .success-detail-value {
      font-weight: 600;
    }

    /* Loading Spinner */
    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid transparent;
      border-top-color: currentColor;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Mobile */
    @media (max-width: 600px) {
      .book-main {
        padding: 24px 16px 60px;
      }

      .book-title h1 {
        font-size: 24px;
      }

      .progress-step span {
        display: none;
      }

      .calendar-day {
        font-size: 13px;
      }

      .time-slots {
        grid-template-columns: repeat(3, 1fr);
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="book-header">
    <div class="book-header-inner">
      <a href="/" class="book-logo">
        <svg class="book-logo-icon" viewBox="0 0 390 402" fill="var(--gold)">
          <g transform="translate(0.269 0.052)">
            <path d="M194.6,32.106l166.79,96.3V373.463H27.807V128.406l166.79-96.3M194.6,0,0,112.353V401.271H389.213V112.353L194.6,0Z"/>
            <path d="M257.77,133.82,87.52,34.06,61.3,51.7l168.663,98.173V374.579H257.77Z" transform="translate(48.039 26.692)"/>
            <path d="M212.1,353.7H184.292V177.137L13.15,78.323,41.207,60.7,212.1,161.085Z" transform="translate(10.305 47.568)"/>
            <path d="M129.182,173.571,12.53,106.22v32.106l88.862,51.3V318.03h27.789Z" transform="translate(9.819 83.241)"/>
          </g>
        </svg>
        <span class="book-logo-text">Surprise Granite</span>
      </a>
      <a href="/" class="book-back">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Back to Home
      </a>
    </div>
  </header>

  <!-- Main Content -->
  <main class="book-main">
    <div class="book-title">
      <h1>Schedule Your Free Estimate</h1>
      <p>Pick a date and time that works for you. We'll come to your home and provide a detailed quote.</p>
    </div>

    <!-- Progress Steps -->
    <div class="book-progress">
      <div class="progress-step active" data-step="1">
        <span class="step-num">1</span>
        <span>Date & Time</span>
      </div>
      <div class="progress-step" data-step="2">
        <span class="step-num">2</span>
        <span>Your Info</span>
      </div>
      <div class="progress-step" data-step="3">
        <span class="step-num">3</span>
        <span>Confirm</span>
      </div>
    </div>

    <!-- Step 1: Date & Time -->
    <section class="book-section active" id="step1">
      <div class="calendar-container">
        <div class="calendar-header">
          <span class="calendar-month" id="calendarMonth"></span>
          <div class="calendar-nav">
            <button id="prevMonth" aria-label="Previous month">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M15 18l-6-6 6-6"/>
              </svg>
            </button>
            <button id="nextMonth" aria-label="Next month">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 18l6-6-6-6"/>
              </svg>
            </button>
          </div>
        </div>
        <div class="calendar-weekdays">
          <div class="calendar-weekday">Sun</div>
          <div class="calendar-weekday">Mon</div>
          <div class="calendar-weekday">Tue</div>
          <div class="calendar-weekday">Wed</div>
          <div class="calendar-weekday">Thu</div>
          <div class="calendar-weekday">Fri</div>
          <div class="calendar-weekday">Sat</div>
        </div>
        <div class="calendar-days" id="calendarDays"></div>
      </div>

      <div id="timeSlots" style="display:none;">
        <p class="time-slots-title">Available times for <span id="selectedDateText"></span></p>
        <div class="time-slots" id="timeSlotsGrid"></div>
      </div>

      <div class="book-buttons">
        <button class="book-btn primary" id="toStep2" disabled>
          Continue
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        </button>
      </div>
    </section>

    <!-- Step 2: Contact Info -->
    <section class="book-section" id="step2">
      <div class="summary-card">
        <div class="summary-title">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
          Selected Appointment
        </div>
        <div class="summary-row">
          <span class="summary-label">Date</span>
          <span class="summary-value" id="summaryDate">-</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Time</span>
          <span class="summary-value" id="summaryTime">-</span>
        </div>
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label class="form-label">Full Name <span class="required">*</span></label>
          <input type="text" class="form-input" id="inputName" placeholder="John Smith" required>
        </div>
        <div class="form-group">
          <label class="form-label">Phone <span class="required">*</span></label>
          <input type="tel" class="form-input" id="inputPhone" placeholder="(555) 123-4567" required>
        </div>
        <div class="form-group full-width">
          <label class="form-label">Email <span class="required">*</span></label>
          <input type="email" class="form-input" id="inputEmail" placeholder="john@example.com" required>
        </div>
        <div class="form-group full-width">
          <label class="form-label">Project Address <span class="required">*</span></label>
          <input type="text" class="form-input" id="inputAddress" placeholder="123 Main St, Surprise, AZ" required>
        </div>
        <div class="form-group">
          <label class="form-label">Project Type</label>
          <select class="form-select" id="inputProjectType">
            <option value="">Select...</option>
            <option value="kitchen">Kitchen Countertops</option>
            <option value="bathroom">Bathroom Vanity</option>
            <option value="outdoor">Outdoor Kitchen</option>
            <option value="flooring">Flooring</option>
            <option value="tile">Tile/Backsplash</option>
            <option value="other">Other</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Estimated Square Feet</label>
          <input type="text" class="form-input" id="inputSqft" placeholder="e.g., 40">
        </div>
        <div class="form-group full-width">
          <label class="form-label">Additional Notes</label>
          <textarea class="form-textarea" id="inputNotes" placeholder="Tell us about your project, material preferences, or any questions..."></textarea>
        </div>
      </div>

      <div class="book-buttons">
        <button class="book-btn secondary" id="backToStep1">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          Back
        </button>
        <button class="book-btn primary" id="toStep3">
          Review & Confirm
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        </button>
      </div>
    </section>

    <!-- Step 3: Confirmation -->
    <section class="book-section" id="step3">
      <div class="summary-card">
        <div class="summary-title">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 11l3 3L22 4"/>
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
          </svg>
          Appointment Summary
        </div>
        <div class="summary-row">
          <span class="summary-label">Date</span>
          <span class="summary-value" id="confirmDate">-</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Time</span>
          <span class="summary-value" id="confirmTime">-</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Name</span>
          <span class="summary-value" id="confirmName">-</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Phone</span>
          <span class="summary-value" id="confirmPhone">-</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Email</span>
          <span class="summary-value" id="confirmEmail">-</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Address</span>
          <span class="summary-value" id="confirmAddress">-</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Project</span>
          <span class="summary-value" id="confirmProject">-</span>
        </div>
      </div>

      <div class="book-buttons">
        <button class="book-btn secondary" id="backToStep2">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          Back
        </button>
        <button class="book-btn primary" id="submitBooking">
          <span id="submitText">Confirm Booking</span>
          <div class="spinner" id="submitSpinner" style="display:none;"></div>
        </button>
      </div>
    </section>

    <!-- Success Screen -->
    <section class="book-section" id="stepSuccess">
      <div class="success-container">
        <div class="success-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
            <path d="M20 6L9 17l-5-5"/>
          </svg>
        </div>
        <h2 class="success-title">Appointment Requested!</h2>
        <p class="success-message">We've received your booking request. You'll receive a confirmation email shortly.</p>

        <div class="success-details">
          <div class="success-detail">
            <div class="success-detail-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
              </svg>
            </div>
            <div class="success-detail-text">
              <div class="success-detail-label">Date & Time</div>
              <div class="success-detail-value" id="successDateTime">-</div>
            </div>
          </div>
          <div class="success-detail">
            <div class="success-detail-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                <circle cx="12" cy="10" r="3"/>
              </svg>
            </div>
            <div class="success-detail-text">
              <div class="success-detail-label">Location</div>
              <div class="success-detail-value" id="successAddress">-</div>
            </div>
          </div>
        </div>

        <a href="/" class="book-btn primary" style="display:inline-flex; text-decoration:none;">
          Return to Home
        </a>
      </div>
    </section>
  </main>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // Supabase Config
    const SUPABASE_URL = 'https://ypeypgwsycxcagncgdur.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlwZXlwZ3dzeWN4Y2FnbmNnZHVyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3NTQ4MjMsImV4cCI6MjA4MzMzMDgyM30.R13pNv2FDtGhfeu7gUcttYNrQAbNYitqR4FIq3O2-ME';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // State
    let currentDate = new Date();
    let selectedDate = null;
    let selectedTime = null;

    // Available time slots
    const timeSlots = [
      '9:00 AM', '10:00 AM', '11:00 AM', '12:00 PM',
      '1:00 PM', '2:00 PM', '3:00 PM', '4:00 PM'
    ];

    // DOM Elements
    const calendarMonth = document.getElementById('calendarMonth');
    const calendarDays = document.getElementById('calendarDays');
    const prevMonth = document.getElementById('prevMonth');
    const nextMonth = document.getElementById('nextMonth');
    const timeSlotsContainer = document.getElementById('timeSlots');
    const timeSlotsGrid = document.getElementById('timeSlotsGrid');
    const selectedDateText = document.getElementById('selectedDateText');

    // Progress steps
    const progressSteps = document.querySelectorAll('.progress-step');

    // Render Calendar
    function renderCalendar() {
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();

      // Update month display
      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                          'July', 'August', 'September', 'October', 'November', 'December'];
      calendarMonth.textContent = `${monthNames[month]} ${year}`;

      // Get first day of month and total days
      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      const today = new Date();
      today.setHours(0, 0, 0, 0);

      // Clear previous
      calendarDays.innerHTML = '';

      // Add empty days for first week
      for (let i = 0; i < firstDay; i++) {
        const emptyDay = document.createElement('button');
        emptyDay.className = 'calendar-day other-month';
        emptyDay.disabled = true;
        calendarDays.appendChild(emptyDay);
      }

      // Add days
      for (let day = 1; day <= daysInMonth; day++) {
        const dateBtn = document.createElement('button');
        dateBtn.className = 'calendar-day';
        dateBtn.textContent = day;

        const thisDate = new Date(year, month, day);
        thisDate.setHours(0, 0, 0, 0);

        // Disable past dates and Sundays
        if (thisDate < today || thisDate.getDay() === 0) {
          dateBtn.disabled = true;
        }

        // Mark today
        if (thisDate.getTime() === today.getTime()) {
          dateBtn.classList.add('today');
        }

        // Mark selected
        if (selectedDate && thisDate.getTime() === selectedDate.getTime()) {
          dateBtn.classList.add('selected');
        }

        dateBtn.addEventListener('click', () => selectDate(thisDate));
        calendarDays.appendChild(dateBtn);
      }

      // Disable prev button if current month
      const thisMonth = new Date();
      thisMonth.setDate(1);
      thisMonth.setHours(0, 0, 0, 0);
      const currentMonth = new Date(year, month, 1);
      prevMonth.disabled = currentMonth <= thisMonth;
    }

    // Select Date
    function selectDate(date) {
      selectedDate = date;
      selectedTime = null;

      // Re-render calendar to show selection
      renderCalendar();

      // Show time slots
      const options = { weekday: 'long', month: 'long', day: 'numeric' };
      selectedDateText.textContent = date.toLocaleDateString('en-US', options);

      renderTimeSlots();
      timeSlotsContainer.style.display = 'block';

      // Update button state
      updateStep1Button();
    }

    // Render Time Slots
    function renderTimeSlots() {
      timeSlotsGrid.innerHTML = '';

      timeSlots.forEach(time => {
        const btn = document.createElement('button');
        btn.className = 'time-slot';
        btn.textContent = time;

        if (selectedTime === time) {
          btn.classList.add('selected');
        }

        btn.addEventListener('click', () => {
          selectedTime = time;
          renderTimeSlots();
          updateStep1Button();
        });

        timeSlotsGrid.appendChild(btn);
      });
    }

    // Update Step 1 Button
    function updateStep1Button() {
      const btn = document.getElementById('toStep2');
      btn.disabled = !selectedDate || !selectedTime;
    }

    // Navigation
    prevMonth.addEventListener('click', () => {
      currentDate.setMonth(currentDate.getMonth() - 1);
      renderCalendar();
    });

    nextMonth.addEventListener('click', () => {
      currentDate.setMonth(currentDate.getMonth() + 1);
      renderCalendar();
    });

    // Step Navigation
    function showStep(stepNum) {
      document.querySelectorAll('.book-section').forEach(s => s.classList.remove('active'));
      document.getElementById(`step${stepNum}`).classList.add('active');

      progressSteps.forEach((step, i) => {
        step.classList.remove('active', 'completed');
        if (i + 1 < stepNum) step.classList.add('completed');
        if (i + 1 === stepNum) step.classList.add('active');
      });
    }

    function showSuccess() {
      document.querySelectorAll('.book-section').forEach(s => s.classList.remove('active'));
      document.getElementById('stepSuccess').classList.add('active');
      progressSteps.forEach(step => step.classList.add('completed'));
    }

    // Format date for display
    function formatDate(date) {
      const options = { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' };
      return date.toLocaleDateString('en-US', options);
    }

    // Step 1 -> Step 2
    document.getElementById('toStep2').addEventListener('click', () => {
      document.getElementById('summaryDate').textContent = formatDate(selectedDate);
      document.getElementById('summaryTime').textContent = selectedTime;
      showStep(2);
    });

    // Step 2 -> Step 1
    document.getElementById('backToStep1').addEventListener('click', () => {
      showStep(1);
    });

    // Step 2 -> Step 3
    document.getElementById('toStep3').addEventListener('click', () => {
      // Validate required fields
      const name = document.getElementById('inputName').value.trim();
      const phone = document.getElementById('inputPhone').value.trim();
      const email = document.getElementById('inputEmail').value.trim();
      const address = document.getElementById('inputAddress').value.trim();

      if (!name || !phone || !email || !address) {
        alert('Please fill in all required fields.');
        return;
      }

      // Update confirmation
      document.getElementById('confirmDate').textContent = formatDate(selectedDate);
      document.getElementById('confirmTime').textContent = selectedTime;
      document.getElementById('confirmName').textContent = name;
      document.getElementById('confirmPhone').textContent = phone;
      document.getElementById('confirmEmail').textContent = email;
      document.getElementById('confirmAddress').textContent = address;

      const projectType = document.getElementById('inputProjectType').value;
      const projectMap = {
        'kitchen': 'Kitchen Countertops',
        'bathroom': 'Bathroom Vanity',
        'outdoor': 'Outdoor Kitchen',
        'flooring': 'Flooring',
        'tile': 'Tile/Backsplash',
        'other': 'Other'
      };
      document.getElementById('confirmProject').textContent = projectMap[projectType] || 'Not specified';

      showStep(3);
    });

    // Step 3 -> Step 2
    document.getElementById('backToStep2').addEventListener('click', () => {
      showStep(2);
    });

    // Submit Booking
    document.getElementById('submitBooking').addEventListener('click', async () => {
      const submitBtn = document.getElementById('submitBooking');
      const submitText = document.getElementById('submitText');
      const submitSpinner = document.getElementById('submitSpinner');

      // Show loading
      submitBtn.disabled = true;
      submitText.style.display = 'none';
      submitSpinner.style.display = 'block';

      try {
        // Prepare data - matching existing leads table schema
        const fullName = document.getElementById('inputName').value.trim();
        const nameParts = fullName.split(' ');
        const firstName = nameParts[0] || '';
        const lastName = nameParts.slice(1).join(' ') || '';

        const appointmentDetails = {
          preferred_date: selectedDate.toISOString().split('T')[0],
          preferred_time: selectedTime,
          formatted_date: formatDate(selectedDate),
          project_address: document.getElementById('inputAddress').value.trim(),
          estimated_sqft: document.getElementById('inputSqft').value.trim() || null,
          appointment_type: 'free_estimate'
        };

        const leadData = {
          first_name: firstName,
          last_name: lastName,
          full_name: fullName,
          email: document.getElementById('inputEmail').value.trim(),
          phone: document.getElementById('inputPhone').value.trim(),
          project_type: document.getElementById('inputProjectType').value || 'Not specified',
          message: `APPOINTMENT REQUEST\nDate: ${formatDate(selectedDate)}\nTime: ${selectedTime}\nAddress: ${document.getElementById('inputAddress').value.trim()}\n\n${document.getElementById('inputNotes').value.trim() || ''}`,
          source: 'Booking Calendar',
          form_name: 'appointment-booking',
          page_url: window.location.href,
          raw_data: appointmentDetails
        };

        // Insert into Supabase leads table using fetch (like estimate form)
        const response = await fetch(`${SUPABASE_URL}/rest/v1/leads`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'apikey': SUPABASE_ANON_KEY,
            'Prefer': 'return=minimal'
          },
          body: JSON.stringify(leadData)
        });

        if (!response.ok) {
          throw new Error('Failed to submit booking');
        }

        // Update success screen
        document.getElementById('successDateTime').textContent =
          `${formatDate(selectedDate)} at ${selectedTime}`;
        document.getElementById('successAddress').textContent =
          document.getElementById('inputAddress').value.trim();

        // Show success
        showSuccess();

        // Send notification email (via webhook or edge function)
        await sendNotificationEmail(leadData);

      } catch (error) {
        console.error('Booking error:', error);
        alert('Something went wrong. Please try again or call us at (602) 833-3189.');

        // Reset button
        submitBtn.disabled = false;
        submitText.style.display = 'inline';
        submitSpinner.style.display = 'none';
      }
    });

    // Send notification email via API
    async function sendNotificationEmail(data) {
      try {
        // Send to email notification API
        const response = await fetch('https://surprise-granite-email-api.onrender.com/api/leads', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            homeowner_name: data.full_name || data.name,
            homeowner_email: data.email,
            homeowner_phone: data.phone,
            project_type: data.project_type || 'Free Estimate',
            project_zip: '85374',
            project_timeline: 'ASAP',
            message: data.message,
            source: 'Booking Calendar',
            appointment_date: data.raw_data?.preferred_date,
            appointment_time: data.raw_data?.preferred_time,
            project_address: data.raw_data?.project_address
          })
        });

        if (response.ok) {
          console.log('Notification sent successfully');
        }
      } catch (e) {
        // Notification failed but appointment is saved to Supabase
        console.log('Could not send notification, appointment saved to database');
      }

      // Also send to CRM webhook
      try {
        await fetch('https://voiceflow-crm.onrender.com/api/webhooks/website-lead', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            name: data.full_name || data.name,
            email: data.email,
            phone: data.phone,
            project_type: data.project_type,
            source: 'Booking Calendar',
            message: data.message,
            appointment_date: data.raw_data?.preferred_date,
            appointment_time: data.raw_data?.preferred_time
          })
        });
      } catch (e) {
        console.log('CRM webhook failed');
      }
    }

    // Initialize
    renderCalendar();
  </script>
</body>
</html>
