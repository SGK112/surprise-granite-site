<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Stone Slab Marketplace | Premium Countertop Materials | Surprise Granite</title>
  <link rel="canonical" href="https://surprisegranite.com/marketplace/slabs/"/>
  <meta content="Browse premium stone slabs from top distributors. Granite, quartz, marble, quartzite at competitive prices. Shop wholesale inventory from Arizona Tile, MSI, and more." name="description"/>
  <meta content="Stone Slab Marketplace | Surprise Granite" property="og:title"/>
  <meta content="Browse premium stone slabs from verified distributors across Arizona." property="og:description"/>
  <meta property="og:type" content="website"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-P3XFDN8');</script>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
  <link href="https://cdn.prod.website-files.com/6456ce4476abb25581fbad0c/6456ce4476abb269c6fbb176_Surprise-Granite-favicon-32x32px.png" rel="shortcut icon" type="image/x-icon"/>
  <link href="/css/marketplace-mobile.css" rel="stylesheet"/>

  <style>
    :root {
      --gold-primary: #f9cb00;
      --gold-dark: #cca600;
      --gold-glow: rgba(249, 203, 0, 0.35);
      --dark-primary: #1a1a2e;
      --dark-surface: #12121a;
      --text-primary: #1a1a2e;
      --text-secondary: #666;
      --text-muted: #999;
      --border-color: #e5e5e5;
      --bg-light: #f8f9fa;
      --success: #22c55e;
      --error: #ef4444;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-light);
      color: var(--text-primary);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }

    /* Legacy Header - Hidden when unified nav is active */
    .header {
      display: none;
    }

    /* Hero Section - matches tile template */
    .hero {
      background: linear-gradient(135deg, #1a2b3c 0%, #0f1a24 100%);
      padding: 80px 24px 60px;
      color: #fff;
      position: relative;
      overflow: hidden;
    }

    .hero::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 55%;
      height: 100%;
      background: url('https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/6456ce4576abb21a6cfbc44d_Msi-surfaces-surprise-quartz-calacatta-abezzo-quartz-slab.jpg') center/cover;
      opacity: 0.7;
      mask-image: linear-gradient(to left, rgba(0,0,0,1) 0%, rgba(0,0,0,0.5) 50%, rgba(0,0,0,0) 100%);
      -webkit-mask-image: linear-gradient(to left, rgba(0,0,0,1) 0%, rgba(0,0,0,0.5) 50%, rgba(0,0,0,0) 100%);
    }

    .hero-inner {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 48px;
      position: relative;
      z-index: 1;
    }

    .hero-content { max-width: 600px; }

    .hero-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(249, 203, 0, 0.15);
      color: #f9cb00;
      padding: 10px 18px;
      border-radius: 50px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 24px;
    }

    .hero h1 {
      font-size: 2.5rem;
      font-weight: 800;
      margin-bottom: 16px;
      line-height: 1.2;
    }

    .hero p {
      font-size: 1.1rem;
      opacity: 0.85;
      margin-bottom: 24px;
    }

    .hero-stats {
      display: flex;
      gap: 40px;
    }

    .hero-stat {
      text-align: left;
    }

    .hero-stat-value {
      font-size: 2rem;
      font-weight: 800;
      color: var(--gold-primary);
    }

    .hero-stat-label {
      font-size: 13px;
      opacity: 0.7;
    }

    /* Filters Bar */
    .filters-bar {
      background: #fff;
      border-bottom: 1px solid var(--border-color);
      padding: 40px 24px 16px;
    }

    /* Sticky behavior - JavaScript will handle this */
    .filters-bar.is-sticky {
      position: fixed;
      top: 140px; /* Match unified-nav desktop height */
      left: 0;
      right: 0;
      z-index: 100;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    @media (max-width: 991px) {
      .filters-bar.is-sticky {
        top: 64px; /* Match unified-nav mobile height */
      }
    }

    /* Placeholder to prevent content jump when filter becomes fixed */
    .filters-placeholder {
      display: none;
    }
    .filters-placeholder.active {
      display: block;
    }

    .filters-inner {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
    }

    .search-box {
      flex: 1;
      min-width: 280px;
      position: relative;
    }

    .search-box svg {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      width: 18px;
      height: 18px;
      stroke: var(--text-muted);
    }

    .search-input {
      width: 100%;
      padding: 12px 16px 12px 44px;
      border: 1px solid var(--border-color);
      border-radius: 10px;
      font-size: 14px;
      font-family: inherit;
      transition: all 0.2s;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--gold-primary);
      box-shadow: 0 0 0 3px var(--gold-glow);
    }

    .filter-select {
      min-height: 44px;
      padding: 12px 36px 12px 14px;
      border: 1px solid var(--border-color);
      border-radius: 10px;
      font-size: 16px; /* Prevents iOS zoom */
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      font-size: 14px;
      font-family: inherit;
      background: #fff url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E") no-repeat right 14px center;
      cursor: pointer;
      -webkit-appearance: none;
      min-width: 150px;
    }

    .filter-select:focus {
      outline: none;
      border-color: var(--gold-primary);
    }

    .location-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 16px;
      border: 1px solid var(--border-color);
      border-radius: 10px;
      background: #fff;
      font-size: 14px;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.2s;
    }

    .location-btn:hover { border-color: var(--gold-primary); }

    .location-btn.active {
      background: var(--dark-primary);
      color: #fff;
      border-color: var(--dark-primary);
    }

    .location-btn svg {
      width: 18px;
      height: 18px;
      stroke: currentColor;
    }

    .results-info {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-left: auto;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .view-toggle {
      display: flex;
      gap: 6px;
      position: relative;
      z-index: 50;
    }

    .view-btn {
      width: 44px;
      height: 44px;
      min-width: 44px;
      min-height: 44px;
      border: 1px solid var(--border-color);
      position: relative;
      z-index: 51;
      background: #fff;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }

    .view-btn:hover { border-color: var(--text-muted); }
    .view-btn:active { background: #f0f0f0; }

    .view-btn.active {
      background: var(--dark-primary);
      border-color: var(--dark-primary);
    }

    .view-btn svg {
      width: 20px;
      height: 20px;
      stroke: var(--text-muted);
    }

    .view-btn.active svg { stroke: #fff; }

    /* Main Content */
    .main {
      max-width: 1400px;
      margin: 0 auto;
      padding: 32px 24px;
    }

    /* Slab Grid */
    .slab-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 24px;
    }

    .slab-card {
      background: #fff;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .slab-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 32px rgba(0,0,0,0.12);
    }

    .slab-card-image {
      position: relative;
      aspect-ratio: 4/3;
      background: #f0f0f0;
      overflow: hidden;
    }

    .slab-card-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }

    .slab-card:hover .slab-card-image img {
      transform: scale(1.03);
    }

    .slab-badges {
      position: absolute;
      top: 12px;
      left: 12px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .slab-badge {
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    .slab-badge-material {
      background: var(--dark-primary);
      color: #fff;
    }

    .slab-badge-new {
      background: var(--success);
      color: #fff;
    }

    .slab-badge-origin {
      background: transparent;
      font-size: 2.5rem;
      padding: 0;
      cursor: help;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.4));
      line-height: 1;
      position: absolute;
      bottom: 12px;
      left: 12px;
      z-index: 100;
    }

    .slab-favorite {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: rgba(255,255,255,0.9);
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .slab-favorite:hover { background: #fff; transform: scale(1.1); }

    .slab-favorite.active svg { fill: #ef4444; stroke: #ef4444; }

    .slab-favorite svg {
      width: 18px;
      height: 18px;
      stroke: var(--text-muted);
      fill: none;
    }

    /* Install badge - wrench icon */
    .slab-install-badge {
      position: absolute;
      bottom: 12px;
      right: 12px;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--gold-primary);
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      text-decoration: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .slab-install-badge:hover {
      background: var(--gold-dark);
      transform: scale(1.1);
    }

    .slab-install-badge svg {
      width: 18px;
      height: 18px;
      stroke: var(--dark-primary);
      fill: none;
    }

    .slab-card-body { padding: 20px; }

    .slab-distributor {
      font-size: 12px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 6px;
    }

    .slab-title {
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--text-primary);
    }

    .slab-brand {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 12px;
    }

    .slab-details {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      margin-bottom: 16px;
    }

    .slab-detail {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      color: var(--text-secondary);
    }

    .slab-detail svg {
      width: 16px;
      height: 16px;
      stroke: var(--text-muted);
    }

    .slab-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-top: 16px;
      border-top: 1px solid var(--border-color);
    }

    .slab-price {
      font-size: 1.25rem;
      font-weight: 800;
      color: var(--text-primary);
    }

    .slab-price span {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-muted);
    }

    .slab-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-height: 44px;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
      background: var(--gold-primary);
      color: var(--dark-primary);
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }

    .slab-btn:hover {
      background: var(--gold-dark);
      transform: translateY(-1px);
    }

    .slab-btn:active {
      transform: scale(0.98);
    }

    /* Get It Installed CTA */
    .slab-cta-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .btn-get-installed {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 16px;
      background: var(--dark-primary);
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.2s;
      line-height: 1;
      white-space: nowrap;
    }

    .btn-get-installed:hover {
      background: #2d3a4a;
      transform: translateY(-1px);
    }

    .btn-get-installed svg {
      width: 18px;
      height: 18px;
      stroke: var(--gold-primary);
      fill: none;
      flex-shrink: 0;
    }

    .install-benefits {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 4px;
    }

    .install-benefit {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .install-benefit svg {
      width: 12px;
      height: 12px;
      stroke: var(--success);
      fill: none;
    }

    /* Loading & Empty States */
    .loading-state, .empty-state {
      text-align: center;
      padding: 80px 24px;
    }

    .loading-spinner {
      width: 48px;
      height: 48px;
      border: 3px solid var(--border-color);
      border-top-color: var(--gold-primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .empty-icon {
      width: 80px;
      height: 80px;
      background: #f0f0f0;
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 24px;
    }

    .empty-icon svg {
      width: 40px;
      height: 40px;
      stroke: var(--text-muted);
    }

    .empty-title {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .empty-text {
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 24px;
    }

    /* Inquiry Modal */
    .modal-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }

    .modal-backdrop.active { display: flex; }

    .modal {
      background: #fff;
      border-radius: 20px;
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 24px;
      border-bottom: 1px solid var(--border-color);
    }

    .modal-title {
      font-size: 1.25rem;
      font-weight: 700;
    }

    .modal-close {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      border: none;
      background: #f5f5f5;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-close:hover { background: #e5e5e5; }

    .modal-close svg {
      width: 20px;
      height: 20px;
      stroke: var(--text-primary);
    }

    .modal-body { padding: 24px; }

    .modal-slab-info {
      display: flex;
      gap: 16px;
      padding: 16px;
      background: var(--bg-light);
      border-radius: 12px;
      margin-bottom: 24px;
    }

    .modal-slab-img {
      width: 80px;
      height: 80px;
      border-radius: 8px;
      object-fit: cover;
    }

    .modal-slab-name {
      font-weight: 700;
      margin-bottom: 4px;
    }

    .modal-slab-meta {
      font-size: 13px;
      color: var(--text-secondary);
    }

    .form-group { margin-bottom: 20px; }

    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--text-secondary);
    }

    .form-input, .form-textarea {
      width: 100%;
      padding: 14px 16px;
      border: 1px solid var(--border-color);
      border-radius: 10px;
      font-size: 14px;
      font-family: inherit;
      transition: all 0.2s;
    }

    .form-input:focus, .form-textarea:focus {
      outline: none;
      border-color: var(--gold-primary);
      box-shadow: 0 0 0 3px var(--gold-glow);
    }

    .form-textarea { min-height: 100px; resize: vertical; }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .modal-submit {
      width: 100%;
      padding: 16px;
      background: var(--gold-primary);
      color: var(--dark-primary);
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
    }

    .modal-submit:hover {
      background: var(--gold-dark);
    }

    .modal-submit:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    /* Footer */
    .footer {
      background: var(--dark-primary);
      color: #fff;
      padding: 48px 24px;
      margin-top: 64px;
    }

    .footer-inner {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 24px;
    }

    .footer-links {
      display: flex;
      gap: 32px;
    }

    .footer-link {
      color: rgba(255,255,255,0.7);
      text-decoration: none;
      font-size: 14px;
    }

    .footer-link:hover { color: var(--gold-primary); }

    .footer-copyright {
      font-size: 14px;
      opacity: 0.5;
    }

    /* Stone Yards Cross-Link Bar */
    .stone-yards-bar {
      background: linear-gradient(135deg, rgba(26, 43, 60, 0.04) 0%, rgba(26, 43, 60, 0.02) 100%);
      border: 1px solid rgba(26, 43, 60, 0.1);
      padding: 16px 24px;
      text-align: center;
    }

    .stone-yards-bar-inner {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      flex-wrap: wrap;
    }

    .stone-yards-bar span {
      font-size: 14px;
      color: var(--text-secondary);
    }

    .stone-yards-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      background: var(--gold-primary);
      color: var(--dark-primary);
      text-decoration: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 700;
      transition: all 0.2s;
      box-shadow: 0 2px 8px rgba(249, 203, 0, 0.3);
    }

    .stone-yards-link:hover {
      background: #e6b800;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(249, 203, 0, 0.4);
    }

    .stone-yards-link svg {
      width: 18px;
      height: 18px;
      fill: none;
      stroke: currentColor;
      stroke-width: 2;
    }

    /* Featured Section */
    .featured-section {
      background: #fff;
      padding: 48px 24px;
      border-bottom: 1px solid var(--border-color);
    }

    .featured-inner {
      max-width: 1400px;
      margin: 0 auto;
    }

    .featured-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .featured-title {
      font-size: 1.5rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .featured-title svg {
      width: 28px;
      height: 28px;
      stroke: var(--gold-primary);
      fill: none;
    }

    .featured-link {
      color: var(--dark-primary);
      text-decoration: none;
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .featured-link:hover { color: var(--gold-primary); }

    .featured-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }

    .featured-card {
      background: #fff;
      border: 2px solid var(--gold-primary);
      border-radius: 16px;
      overflow: hidden;
      text-decoration: none;
      color: inherit;
      position: relative;
      transition: all 0.2s;
    }

    .featured-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(249, 203, 0, 0.2);
    }

    .featured-card-badge {
      position: absolute;
      top: 12px;
      left: 12px;
      background: var(--gold-primary);
      color: var(--dark-primary);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      z-index: 2;
    }

    .featured-card-image {
      aspect-ratio: 16/10;
      overflow: hidden;
    }

    .featured-card-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s;
    }

    .featured-card:hover .featured-card-image img {
      transform: scale(1.05);
    }

    .featured-card-body {
      padding: 16px;
    }

    .featured-card-title {
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .featured-card-meta {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 12px;
    }

    .featured-card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .featured-card-price {
      font-size: 1.25rem;
      font-weight: 800;
      color: var(--dark-primary);
    }

    .featured-card-price span {
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text-muted);
    }

    .featured-card-brand {
      font-size: 12px;
      color: var(--text-secondary);
      font-weight: 500;
    }

    /* Category Pills */
    .category-pills {
      background: #fff;
      padding: 20px 24px;
      border-bottom: 1px solid var(--border-color);
    }

    .category-pills-inner {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      gap: 12px;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }

    .category-pills-inner::-webkit-scrollbar { display: none; }

    .category-pill {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      background: var(--bg-light);
      border: 1px solid var(--border-color);
      border-radius: 50px;
      text-decoration: none;
      color: var(--dark-primary);
      font-size: 14px;
      font-weight: 500;
      white-space: nowrap;
      transition: all 0.2s;
    }

    .category-pill:hover, .category-pill.active {
      background: var(--dark-primary);
      color: #fff;
      border-color: var(--dark-primary);
    }

    .category-pill img {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      object-fit: cover;
    }

    /* Responsive */
    @media (max-width: 900px) {
      .hero-inner { flex-direction: column; text-align: center; }
      .hero-stats { justify-content: center; }
      .filters-inner { justify-content: center; }
      .search-box { min-width: 100%; }
      .results-info { width: 100%; justify-content: center; margin-left: 0; }
    }

    @media (max-width: 600px) {
      .header-nav { display: none; }
      .hero h1 { font-size: 1.75rem; }
      .slab-grid { grid-template-columns: 1fr; }
      .form-row { grid-template-columns: 1fr; }
      .footer-inner { flex-direction: column; text-align: center; }
      .footer-links { flex-wrap: wrap; justify-content: center; }
      .stone-yards-bar-inner { flex-direction: column; gap: 12px; }
    }

    /* Tablet Optimization */
    @media (max-width: 991px) {
      .hero {
        padding: 40px 20px 40px;
      }
      .hero::before {
        width: 100%;
        opacity: 0.3;
      }
    }

    /* Mobile Optimization */
    @media (max-width: 768px) {
      .hero {
        padding: 32px 16px 32px;
      }

      .hero h1 {
        font-size: 1.75rem;
      }

      /* Touch-friendly targets */
      .filter-select,
      .location-btn,
      .view-btn,
      .slab-btn,
      .slab-favorite {
        min-height: 44px;
        min-width: 44px;
      }

      /* ===== GRID VIEW - Compact 2-column cards ===== */
      .slab-grid:not(.list-view) {
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 10px !important;
      }

      .slab-grid:not(.list-view) .slab-card-body {
        padding: 8px;
      }

      .slab-grid:not(.list-view) .slab-title {
        font-size: 11px;
        line-height: 1.2;
        margin-bottom: 2px;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .slab-grid:not(.list-view) .slab-brand,
      .slab-grid:not(.list-view) .slab-distributor {
        font-size: 9px;
        margin-bottom: 2px;
      }

      .slab-grid:not(.list-view) .slab-details {
        display: none;
      }

      .slab-grid:not(.list-view) .slab-price {
        font-size: 13px;
        margin: 4px 0;
      }

      .slab-grid:not(.list-view) .slab-price span {
        font-size: 9px;
      }

      /* Hide trust badges on mobile */
      .slab-grid .slab-trust-badges {
        display: none !important;
      }

      /* Smaller install badge on mobile */
      .slab-install-badge {
        width: 30px;
        height: 30px;
        bottom: 8px;
        right: 8px;
      }

      .slab-install-badge svg {
        width: 14px;
        height: 14px;
      }

      .slab-grid:not(.list-view) .slab-btn {
        min-height: 28px;
        min-width: unset;
        padding: 6px 10px;
        font-size: 10px;
        width: 100%;
      }

      .slab-grid:not(.list-view) .slab-cta-group {
        gap: 0;
      }

      .slab-grid:not(.list-view) .slab-card-image {
        min-height: 90px;
        aspect-ratio: 4/3;
      }

      .slab-grid:not(.list-view) .slab-badge {
        font-size: 8px;
        padding: 2px 5px;
      }

      .slab-grid:not(.list-view) .slab-favorite {
        width: 28px;
        height: 28px;
        min-width: 28px;
        min-height: 28px;
      }

      /* ===== LIST VIEW - Horizontal cards ===== */
      .slab-grid.list-view {
        grid-template-columns: 1fr !important;
        gap: 12px !important;
      }

      .slab-grid.list-view .slab-card {
        display: flex;
        flex-direction: row;
        align-items: stretch;
      }

      .slab-grid.list-view .slab-card-image {
        width: 100px;
        min-width: 100px;
        min-height: unset;
        aspect-ratio: unset;
        height: auto;
        border-radius: 12px 0 0 12px;
      }

      .slab-grid.list-view .slab-card-body {
        flex: 1;
        padding: 10px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        gap: 2px;
      }

      .slab-grid.list-view .slab-title {
        font-size: 13px;
        margin-bottom: 0;
      }

      .slab-grid.list-view .slab-details {
        display: none;
      }

      .slab-grid.list-view .slab-price {
        font-size: 18px;
        font-weight: 700;
        margin: 4px 0;
      }

      .slab-grid.list-view .slab-btn {
        min-height: 26px;
        min-width: unset;
        padding: 4px 8px;
        font-size: 10px;
      }

      .slab-grid.list-view .slab-badges {
        top: 4px;
        left: 4px;
      }

      .slab-grid.list-view .slab-favorite {
        display: none;
      }

      .search-input {
        min-height: 48px;
        font-size: 16px; /* Prevent iOS zoom */
      }

      .slab-card {
        margin-bottom: 16px;
      }

      .modal {
        max-height: calc(100vh - 40px);
        margin: 20px;
      }

      .form-input, .form-textarea {
        font-size: 16px; /* Prevent iOS zoom */
        min-height: 48px;
      }
    }

    /* Safe area support for notch devices */
    @supports (padding: max(0px)) {
      .header {
        padding-left: max(24px, env(safe-area-inset-left));
        padding-right: max(24px, env(safe-area-inset-right));
      }

      .footer {
        padding-bottom: max(48px, env(safe-area-inset-bottom));
      }
    }

    /* Dynamic Pricing Styles */
    .price-retail { text-decoration: line-through; color: #888; font-size: 14px; margin-right: 4px; }
    .price-savings { color: #22c55e; font-size: 11px; font-weight: 600; display: block; }

    /* Pricing Banner */
    .pricing-banner {
      background: linear-gradient(90deg, #1a2b3c 0%, #2d4356 100%);
      padding: 12px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 12px;
      max-width: 1400px;
      margin: 0 auto 24px;
      border-radius: 8px;
    }
    .pricing-banner-text { color: #fff; font-size: 14px; }
    .pricing-banner-text strong { color: #f9cb00; }
    .pricing-banner-btn {
      background: #f9cb00;
      color: #1a2b3c;
      padding: 8px 16px;
      border-radius: 6px;
      text-decoration: none;
      font-weight: 600;
      font-size: 13px;
    }
    .pricing-banner-btn:hover { background: #cca600; }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      .slab-card,
      .slab-btn,
      .slab-favorite,
      .header-cta,
      .stone-yards-link {
        transition: none;
      }

      .slab-card:hover {
        transform: none;
      }

      .loading-spinner {
        animation: none;
      }
    }
  </style>

  <!-- Unified Navigation -->
  <link rel="stylesheet" href="/css/unified-nav.css?v=20260129">
  <script defer src="/js/unified-nav.js?v=20260201d"></script>
  <script src="/js/sg-auth.js"></script>
  <script src="/js/pricing-config.js"></script>
  <script src="/js/pricing-service.js"></script>
  <script src="/js/radianz-unavailable.js"></script>
</head>

<body>
  <!-- Hero -->
  <section class="hero">
    <div class="hero-inner">
      <div class="hero-content">
        <div class="hero-badge">
          <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
          Verified Distributors
        </div>
        <h1>Premium Stone Slabs from Top Distributors</h1>
        <p>Browse thousands of granite, quartz, marble, and quartzite slabs from verified distributors across Arizona. Wholesale pricing for fabricators and contractors.</p>
        <div class="hero-stats">
          <div class="hero-stat">
            <div class="hero-stat-value" id="statSlabs">0</div>
            <div class="hero-stat-label">Available Slabs</div>
          </div>
          <div class="hero-stat">
            <div class="hero-stat-value" id="statDistributors">0</div>
            <div class="hero-stat-label">Distributors</div>
          </div>
          <div class="hero-stat">
            <div class="hero-stat-value" id="statBrands">20+</div>
            <div class="hero-stat-label">Brands</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Stone Yards Cross-Link -->
  <div class="stone-yards-bar">
    <div class="stone-yards-bar-inner">
      <span>Want to see slabs in person?</span>
      <a href="/stone-yards/" class="stone-yards-link">
        <svg viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
        Visit Stone Yards Near You
      </a>
    </div>
  </div>

  <!-- Featured Stones -->
  <section class="featured-section">
    <div class="featured-inner">
      <div class="featured-header">
        <h2 class="featured-title">
          <svg viewBox="0 0 24 24" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
          Featured Stones
        </h2>
        <a href="#allSlabs" class="featured-link">
          View All
          <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
        </a>
      </div>
      <div class="featured-grid" id="featuredGrid">
        <!-- Populated by JS -->
      </div>
    </div>
  </section>

  <!-- Category Pills -->
  <div class="category-pills">
    <div class="category-pills-inner">
      <a href="#" class="category-pill active" data-material="">
        <img src="https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/6456ce4576abb21a6cfbc44d_Msi-surfaces-surprise-quartz-calacatta-abezzo-quartz-slab.jpg" alt="All"/>
        All Materials
      </a>
      <a href="#" class="category-pill" data-material="quartz">
        <img src="https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/6456ce4576abb21a6cfbc44d_Msi-surfaces-surprise-quartz-calacatta-abezzo-quartz-slab.jpg" alt="Quartz"/>
        Quartz
      </a>
      <a href="#" class="category-pill" data-material="granite">
        <img src="https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/6456ce4476abb22cfafbb7e4_msi-surfaces-surprise-granite-new-river-close-up.jpg" alt="Granite"/>
        Granite
      </a>
      <a href="#" class="category-pill" data-material="marble">
        <img src="https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/6456ce4576abb2b48efbbd7f_msi-surfaces-sruprise-granite-absolute-white-marble-close%20up.jpg" alt="Marble"/>
        Marble
      </a>
      <a href="#" class="category-pill" data-material="quartzite">
        <img src="https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/661b2371ac865464ae22b944_vancouver-close-up.jpg" alt="Quartzite"/>
        Quartzite
      </a>
      <a href="#" class="category-pill" data-material="dekton">
        <img src="https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/6456ce4576abb294bffbc2da_dekton-surprise-granite-laurent-quartz-close-up.jpeg" alt="Dekton"/>
        Dekton
      </a>
      <a href="#" class="category-pill" data-material="porcelain">
        <img src="https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/6456ce4576abb294bffbc2da_dekton-surprise-granite-laurent-quartz-close-up.jpeg" alt="Porcelain"/>
        Porcelain
      </a>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-placeholder" id="filtersPlaceholder"></div>
  <div class="filters-bar" id="filtersBar">
    <!-- Mobile Filter Toggle + View Toggle Row -->
    <div class="mobile-top-row" style="display: flex; gap: 8px; align-items: center; margin-bottom: 12px;">
      <button class="mobile-filter-toggle" id="mobileFilterToggle" aria-expanded="false" style="flex: 1; margin-bottom: 0;">
        <span>Filters</span>
        <span class="filter-count" id="filterCount"></span>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
      </button>
      <div class="mobile-view-toggle" style="display: none; gap: 4px;">
        <button type="button" class="view-btn active" id="mobileViewGrid" style="width:40px;height:40px;border:1px solid #ddd;border-radius:8px;background:#1a1a2e;display:flex;align-items:center;justify-content:center;cursor:pointer;" onclick="window.setSlabView && window.setSlabView('grid')">
          <svg viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" style="width:18px;height:18px;"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
        </button>
        <button type="button" class="view-btn" id="mobileViewList" style="width:40px;height:40px;border:1px solid #ddd;border-radius:8px;background:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;" onclick="window.setSlabView && window.setSlabView('list')">
          <svg viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="2" style="width:18px;height:18px;"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
        </button>
      </div>
    </div>
    <div class="filters-inner">
      <div class="search-box">
        <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        <input type="text" class="search-input" id="searchInput" placeholder="Search by name, material, color, or brand...">
      </div>

      <select class="filter-select" id="filterMaterial">
        <option value="">All Materials</option>
        <option value="granite">Granite</option>
        <option value="quartz">Quartz</option>
        <option value="marble">Marble</option>
        <option value="quartzite">Quartzite</option>
        <option value="dekton">Dekton</option>
        <option value="porcelain">Porcelain</option>
        <option value="soapstone">Soapstone</option>
      </select>

      <select class="filter-select" id="filterColor">
        <option value="">All Colors</option>
        <option value="White">White</option>
        <option value="Black">Black</option>
        <option value="Gray">Gray</option>
        <option value="Brown">Brown</option>
        <option value="Beige">Beige</option>
        <option value="Blue">Blue</option>
        <option value="Green">Green</option>
        <option value="Gold">Gold</option>
      </select>

      <select class="filter-select" id="filterBrand">
        <option value="">All Brands</option>
        <option value="MSI">MSI Surfaces</option>
        <option value="Cambria">Cambria</option>
        <option value="Silestone">Silestone</option>
        <option value="Caesarstone">Caesarstone</option>
        <option value="Cosentino">Cosentino</option>
        <option value="Arizona Tile">Arizona Tile</option>
        <option value="Daltile">Daltile</option>
        <option value="Vadara">Vadara</option>
        <option value="Hanstone">Hanstone</option>
        <option value="LG Viatera">LG Viatera</option>
        <option value="Radianz">Radianz</option>
      </select>

      <select class="filter-select" id="filterSort">
        <option value="newest">Newest First</option>
        <option value="price-low">Price: Low to High</option>
        <option value="price-high">Price: High to Low</option>
        <option value="name">Name A-Z</option>
      </select>

      <button class="location-btn" id="locationBtn">
        <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
        <span>Near Me</span>
      </button>

      <div class="results-info">
        <span id="resultsCount">Loading slabs...</span>
        <div class="view-toggle">
          <button class="view-btn active" id="viewGrid" title="Grid view" onclick="console.log('grid clicked'); window.setSlabView && window.setSlabView('grid')">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
          </button>
          <button class="view-btn" id="viewList" title="List view" onclick="window.setSlabView('list')">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <main class="main">
    <!-- Dynamic Pricing Banner -->
    <div class="pricing-banner" id="pricing-banner" style="display: none;">
      <div class="pricing-banner-text">
        <span id="banner-message">Sign in to see your exclusive pricing</span>
      </div>
      <a href="/account/" class="pricing-banner-btn" id="banner-btn">Sign In</a>
    </div>

    <!-- Loading State -->
    <div class="loading-state" id="loadingState">
      <div class="loading-spinner"></div>
      <p>Loading premium slabs...</p>
    </div>

    <!-- Empty State -->
    <div class="empty-state" id="emptyState" style="display: none;">
      <div class="empty-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
      </div>
      <h3 class="empty-title">No slabs found</h3>
      <p class="empty-text">Try adjusting your filters or search terms</p>
      <button class="slab-btn" onclick="clearFilters()">Clear Filters</button>
    </div>

    <!-- Slab Grid -->
    <div class="slab-grid" id="slabGrid"></div>
  </main>

  <!-- Inquiry Modal -->
  <div class="modal-backdrop" id="inquiryModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Request Information</h3>
        <button class="modal-close" onclick="closeModal()">
          <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        </button>
      </div>
      <form id="inquiryForm" onsubmit="submitInquiry(event)">
        <div class="modal-body">
          <div class="modal-slab-info" id="modalSlabInfo">
            <!-- Filled dynamically -->
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Your Name *</label>
              <input type="text" class="form-input" id="inquiryName" required>
            </div>
            <div class="form-group">
              <label class="form-label">Phone</label>
              <input type="tel" class="form-input" id="inquiryPhone">
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Email *</label>
            <input type="email" class="form-input" id="inquiryEmail" required>
          </div>

          <div class="form-group">
            <label class="form-label">Company (if applicable)</label>
            <input type="text" class="form-input" id="inquiryCompany" placeholder="Fabricator or contractor company">
          </div>

          <div class="form-group">
            <label class="form-label">Message</label>
            <textarea class="form-textarea" id="inquiryMessage" placeholder="Any questions about this slab? Delivery timeline? Volume pricing?"></textarea>
          </div>

          <button type="submit" class="modal-submit" id="submitBtn">Send Inquiry</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-inner">
      <div class="footer-links">
        <a href="/" class="footer-link">Home</a>
        <a href="/marketplace/" class="footer-link">Marketplace</a>
        <a href="/quote/" class="footer-link">Get Quote</a>
        <a href="/distributor/signup/" class="footer-link">List Your Inventory</a>
        <a href="/contact/" class="footer-link">Contact</a>
      </div>
      <div class="footer-copyright">
        &copy; 2026 Surprise Granite. All rights reserved.
      </div>
    </div>
  </footer>

  <script>
    // API Base - using the existing API server
    const API_BASE = 'https://surprise-granite-email-api.onrender.com';

    // Current user tier for dynamic pricing
    let currentTier = 'guest';

    // Sticky Filter Bar - using fixed position on scroll
    (function setupStickyFilters() {
      const filtersBar = document.getElementById('filtersBar');
      const placeholder = document.getElementById('filtersPlaceholder');
      if (!filtersBar || !placeholder) return;

      // Get nav height based on screen size - matches unified-nav.css values
      const getNavHeight = () => window.innerWidth <= 991 ? 64 : 140;

      let isSticky = false;
      let filterBarTop = 0;
      let filterBarHeight = 0;

      // Calculate positions after page load
      function updatePositions() {
        if (!isSticky) {
          filterBarTop = filtersBar.getBoundingClientRect().top + window.scrollY;
          filterBarHeight = filtersBar.offsetHeight;
          placeholder.style.height = filterBarHeight + 'px';
        }
      }

      // Check scroll position and toggle sticky
      function checkScroll() {
        const scrollY = window.scrollY;
        const navHeight = getNavHeight();
        const triggerPoint = filterBarTop - navHeight;

        if (scrollY >= triggerPoint && !isSticky) {
          // Make sticky
          isSticky = true;
          filtersBar.classList.add('is-sticky');
          placeholder.classList.add('active');
        } else if (scrollY < triggerPoint && isSticky) {
          // Remove sticky
          isSticky = false;
          filtersBar.classList.remove('is-sticky');
          placeholder.classList.remove('active');
          // Recalculate position
          setTimeout(updatePositions, 10);
        }
      }

      // Initialize after DOM is ready
      window.addEventListener('load', () => {
        updatePositions();
        checkScroll();
      });

      // Throttled scroll listener
      let ticking = false;
      window.addEventListener('scroll', () => {
        if (!ticking) {
          requestAnimationFrame(() => {
            checkScroll();
            ticking = false;
          });
          ticking = true;
        }
      });

      // Recalculate on resize
      window.addEventListener('resize', () => {
        if (!isSticky) {
          updatePositions();
        }
      });
    })();

    // Mobile Filter Toggle Setup
    (function setupMobileFilters() {
      const filtersBar = document.getElementById('filtersBar');
      const toggleBtn = document.getElementById('mobileFilterToggle');
      const filterCount = document.getElementById('filterCount');

      if (!toggleBtn || !filtersBar) return;

      // Toggle filters
      toggleBtn.addEventListener('click', function() {
        const isExpanded = filtersBar.classList.toggle('mobile-expanded');
        this.setAttribute('aria-expanded', isExpanded);
      });

      // Update filter count
      function updateFilterCount() {
        const search = document.getElementById('searchInput')?.value || '';
        const material = document.getElementById('filterMaterial')?.value || '';
        const color = document.getElementById('filterColor')?.value || '';
        const brand = document.getElementById('filterBrand')?.value || '';

        let count = 0;
        if (search) count++;
        if (material) count++;
        if (color) count++;
        if (brand) count++;

        filterCount.textContent = count > 0 ? count : '';

        if (count > 0) {
          filtersBar.classList.add('has-active-filters');
        } else {
          filtersBar.classList.remove('has-active-filters');
        }
      }

      // Listen for filter changes
      ['searchInput', 'filterMaterial', 'filterColor', 'filterBrand'].forEach(id => {
        const el = document.getElementById(id);
        if (el) {
          el.addEventListener('change', updateFilterCount);
          el.addEventListener('input', updateFilterCount);
        }
      });

      // Auto-collapse on mobile after selection
      document.querySelectorAll('.filter-select').forEach(select => {
        select.addEventListener('change', () => {
          if (window.innerWidth <= 768) {
            setTimeout(() => {
              filtersBar.classList.remove('mobile-expanded');
              toggleBtn.setAttribute('aria-expanded', 'false');
            }, 300);
          }
        });
      });

      // Collapse on resize to desktop
      window.addEventListener('resize', () => {
        if (window.innerWidth > 768) {
          filtersBar.classList.remove('mobile-expanded');
          toggleBtn.setAttribute('aria-expanded', 'false');
        }
      });
    })();

    // Update pricing banner based on user tier
    function updatePricingBanner(tier, user) {
      const banner = document.getElementById('pricing-banner');
      const message = document.getElementById('banner-message');
      const btn = document.getElementById('banner-btn');

      if (tier === 'guest') {
        banner.style.display = 'flex';
        message.innerHTML = 'ðŸ”“ <strong>Sign in</strong> to unlock member discounts - save up to 35% &nbsp;|&nbsp; <a href="/membership/" style="color: #f9cb00; text-decoration: underline;">Learn about pricing tiers</a>';
        btn.textContent = 'Sign In';
        btn.href = '/log-in/?redirect=' + encodeURIComponent(window.location.href);
      } else if (tier === 'homeowner') {
        banner.style.display = 'flex';
        message.innerHTML = 'You\'re seeing <strong>Retail pricing</strong>. Upgrade to Pro for <strong>35% off</strong>';
        btn.textContent = 'Upgrade to Pro - $29/mo';
        btn.href = '/account/?tab=subscription';
      } else if (tier === 'pro') {
        banner.style.display = 'flex';
        message.innerHTML = 'You\'re getting <strong>Pro Member pricing</strong> - 35% off retail!';
        btn.textContent = 'View Account';
        btn.href = '/account/';
        banner.style.background = 'linear-gradient(90deg, #22c55e 0%, #16a34a 100%)';
      } else if (tier === 'contractor' || tier === 'designer') {
        banner.style.display = 'flex';
        message.innerHTML = `You're getting <strong>${tier.charAt(0).toUpperCase() + tier.slice(1)} pricing</strong>`;
        btn.textContent = 'View Account';
        btn.href = '/account/';
        banner.style.background = 'linear-gradient(90deg, #22c55e 0%, #16a34a 100%)';
      } else if (tier === 'fabricator') {
        banner.style.display = 'flex';
        message.innerHTML = 'You\'re getting <strong>Wholesale pricing</strong> - best prices available!';
        btn.textContent = 'View Account';
        btn.href = '/account/';
        banner.style.background = 'linear-gradient(90deg, #1a2b3c 0%, #2d4356 100%)';
      }
    }

    // Calculate dynamic price for MSI quartz
    function calculateSlabPrice(slab) {
      if (!window.SG_PRICING || !window.SG_PRICING_CONFIG) {
        return slab.price_per_sqft;
      }

      // Check if this is MSI quartz
      const brand = (slab.brand || '').toLowerCase();
      const material = (slab.material_type || '').toLowerCase();

      if (brand.includes('msi') && material === 'quartz') {
        // Try to find wholesale cost from pricing config
        const handle = (slab.slug || slab.product_name || '').toLowerCase().replace(/\s+/g, '-');
        const wholesaleCost = window.SG_PRICING_CONFIG.getMSIQuartzCost(handle, slab.thickness_cm === 3 ? '3cm' : '2cm');

        if (wholesaleCost) {
          // Create product object for pricing service
          const product = { wholesaleCost: wholesaleCost };
          const pricing = window.SG_PRICING.calculatePrice(product);
          return pricing;
        }
      }

      // For non-MSI or unknown products, return static price
      return { yourPrice: slab.price_per_sqft, retailPrice: slab.price_per_sqft, savings: 0 };
    }

    // Fix image URLs - convert old webflow to CDN (for API data that may still have old URLs)
    function fixImageUrl(url) {
      if (!url) return null;
      // Handle both old domain variations
      return url
        .replace('uploads-ssl.webflow.com', 'cdn.prod.website-files.com')
        .replace('d1zj60nuin5mrx.cloudfront.net', 'cdn.prod.website-files.com');
    }

    // Sample slabs with real product images and retail pricing
    const SAMPLE_SLABS = [
      {
        id: 'sample-1',
        product_name: 'Calacatta Abezzo',
        brand: 'MSI Surfaces',
        material_type: 'quartz',
        color_family: 'White',
        price_per_sqft: 65,
        length_inches: 126,
        width_inches: 63,
        thickness_cm: 3,
        finish: 'Polished',
        images: ['https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/6456ce4576abb21a6cfbc44d_Msi-surfaces-surprise-quartz-calacatta-abezzo-quartz-slab.jpg'],
        distributor: { company_name: 'MSI Surfaces' },
        slug: 'calacatta-abezzo-quartz-sample',
        created_at: new Date().toISOString(),
        originCountry: 'USA',
        originFlag: 'ðŸ‡ºðŸ‡¸'
      },
      {
        id: 'sample-2',
        product_name: 'Calacatta Miraggio Gold',
        brand: 'MSI Surfaces',
        material_type: 'quartz',
        color_family: 'White',
        price_per_sqft: 75,
        length_inches: 126,
        width_inches: 63,
        thickness_cm: 3,
        finish: 'Polished',
        images: ['https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/6456ce4576abb2d8c0fbc6fb_msi-surfaces-quartz-surprise-granite-calacatta-miraggio-gold-close-up.jpeg'],
        distributor: { company_name: 'MSI Surfaces' },
        slug: 'calacatta-miraggio-gold-quartz-sample',
        created_at: new Date().toISOString(),
        originCountry: 'USA',
        originFlag: 'ðŸ‡ºðŸ‡¸'
      },
      {
        id: 'sample-3',
        product_name: 'Calacatta Delios',
        brand: 'MSI Surfaces',
        material_type: 'quartz',
        color_family: 'White',
        price_per_sqft: 55,
        length_inches: 126,
        width_inches: 63,
        thickness_cm: 3,
        finish: 'Polished',
        images: ['https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/6456ce4576abb23c46fbc69d_MSI-surfaces-quartz-surprise-granite-calacatta-delios-slab.jpeg'],
        distributor: { company_name: 'MSI Surfaces' },
        slug: 'calacatta-delios-quartz-sample',
        created_at: new Date().toISOString(),
        originCountry: 'USA',
        originFlag: 'ðŸ‡ºðŸ‡¸'
      },
      {
        id: 'sample-4',
        product_name: 'Calacatta Arno',
        brand: 'MSI Surfaces',
        material_type: 'quartz',
        color_family: 'White',
        price_per_sqft: 58,
        length_inches: 126,
        width_inches: 63,
        thickness_cm: 3,
        finish: 'Polished',
        images: ['https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/6456ce4576abb22c17fbc540_msi-surfaces-surpise-quarrtz-calacatta-izaro-quartz-whole%20slab.jpg'],
        distributor: { company_name: 'MSI Surfaces' },
        slug: 'calacatta-arno-sample',
        created_at: new Date().toISOString(),
        originCountry: 'USA',
        originFlag: 'ðŸ‡ºðŸ‡¸'
      },
      {
        id: 'sample-5',
        product_name: 'Calacatta Izaro',
        brand: 'MSI Surfaces',
        material_type: 'quartz',
        color_family: 'White',
        price_per_sqft: 68,
        length_inches: 126,
        width_inches: 63,
        thickness_cm: 3,
        finish: 'Polished',
        images: ['https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/6456ce4576abb22c17fbc540_msi-surfaces-surpise-quarrtz-calacatta-izaro-quartz-whole%20slab.jpg'],
        distributor: { company_name: 'MSI Surfaces' },
        slug: 'calacatta-izaro-quartz-sample',
        created_at: new Date().toISOString(),
        originCountry: 'USA',
        originFlag: 'ðŸ‡ºðŸ‡¸'
      },
      {
        id: 'sample-6',
        product_name: 'Laurent',
        brand: 'Cosentino',
        material_type: 'dekton',
        color_family: 'Brown',
        price_per_sqft: 85,
        length_inches: 126,
        width_inches: 56,
        thickness_cm: 2,
        finish: 'Polished',
        images: ['https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/6456ce4576abb294bffbc2da_dekton-surprise-granite-laurent-quartz-close-up.jpeg'],
        distributor: { company_name: 'Cosentino' },
        slug: 'laurent-quartz-sample',
        created_at: new Date().toISOString(),
        originCountry: 'Spain',
        originFlag: 'ðŸ‡ªðŸ‡¸'
      },
      {
        id: 'sample-7',
        product_name: 'Alluring',
        brand: 'Radianz Quartz',
        material_type: 'quartz',
        color_family: 'White',
        price_per_sqft: 52,
        length_inches: 126,
        width_inches: 63,
        thickness_cm: 3,
        finish: 'Polished',
        images: ['https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/6456ce4576abb2af91fbc4ad_Radianz-quartz-surprise-granite-alluring-close-up.jpeg'],
        distributor: { company_name: 'Radianz Quartz' },
        slug: 'alluring-quartz-sample',
        created_at: new Date().toISOString(),
        originCountry: 'South Korea',
        originFlag: 'ðŸ‡°ðŸ‡·'
      },
      {
        id: 'sample-8',
        product_name: 'River White',
        brand: 'MSI Surfaces',
        material_type: 'granite',
        color_family: 'White',
        price_per_sqft: 45,
        length_inches: 118,
        width_inches: 72,
        thickness_cm: 3,
        finish: 'Polished',
        images: ['https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/6456ce4476abb22cfafbb7e4_msi-surfaces-surprise-granite-new-river-close-up.jpg'],
        distributor: { company_name: 'MSI Surfaces' },
        slug: 'new-river-white-granite-sample',
        created_at: new Date().toISOString(),
        originCountry: 'India',
        originFlag: 'ðŸ‡®ðŸ‡³'
      },
      {
        id: 'sample-9',
        product_name: 'Calacatta Cressa Honed',
        brand: 'MSI Surfaces',
        material_type: 'marble',
        color_family: 'White',
        price_per_sqft: 95,
        length_inches: 96,
        width_inches: 48,
        thickness_cm: 2,
        finish: 'Honed',
        images: ['https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/6456ce4576abb2b48efbbd7f_msi-surfaces-sruprise-granite-absolute-white-marble-close%20up.jpg'],
        distributor: { company_name: 'MSI Surfaces' },
        slug: 'absolute-white-granite-sample',
        created_at: new Date().toISOString(),
        originCountry: 'USA',
        originFlag: 'ðŸ‡ºðŸ‡¸'
      },
      {
        id: 'sample-10',
        product_name: 'New River White',
        brand: 'MSI Surfaces',
        material_type: 'granite',
        color_family: 'White',
        price_per_sqft: 42,
        length_inches: 118,
        width_inches: 72,
        thickness_cm: 3,
        finish: 'Polished',
        images: ['https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/6456ce4476abb22cfafbb7e4_msi-surfaces-surprise-granite-new-river-close-up.avif'],
        distributor: { company_name: 'MSI Surfaces' },
        slug: 'new-river-white-granite-sample',
        created_at: new Date().toISOString(),
        originCountry: 'India',
        originFlag: 'ðŸ‡®ðŸ‡³'
      },
      {
        id: 'sample-11',
        product_name: 'Super White',
        brand: 'Pentalquartz',
        material_type: 'quartz',
        color_family: 'White',
        price_per_sqft: 52,
        length_inches: 126,
        width_inches: 63,
        thickness_cm: 3,
        finish: 'Polished',
        images: ['https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/6456ce4576abb2dc93fbbbe4_Pental-quartz-surprise-granite-super-white-close-up.jpeg'],
        distributor: { company_name: 'Pentalquartz' },
        slug: 'super-white-quartz-sample',
        created_at: new Date().toISOString(),
        originCountry: 'USA',
        originFlag: 'ðŸ‡ºðŸ‡¸'
      },
      {
        id: 'sample-12',
        product_name: 'Oakleigh',
        brand: 'Cambria',
        material_type: 'quartz',
        color_family: 'White',
        price_per_sqft: 85,
        length_inches: 132,
        width_inches: 65,
        thickness_cm: 3,
        finish: 'Polished',
        images: ['https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/6456ce4476abb25831fbb345_Cambria_Surprise_Granite_Oakleigh_Slab.jpg'],
        distributor: { company_name: 'Cambria' },
        slug: 'oakleigh-quartz-sample',
        created_at: new Date().toISOString(),
        originCountry: 'USA',
        originFlag: 'ðŸ‡ºðŸ‡¸'
      },
      {
        id: 'sample-13',
        product_name: 'Super White Quartzite',
        brand: 'Arizona Tile',
        material_type: 'quartzite',
        color_family: 'White',
        price_per_sqft: 125,
        length_inches: 126,
        width_inches: 72,
        thickness_cm: 3,
        finish: 'Polished',
        images: ['https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/661b2371ac865464ae22b944_vancouver-close-up.jpg'],
        distributor: { company_name: 'Arizona Tile' },
        slug: 'super-white-quartzite-sample',
        created_at: new Date().toISOString(),
        originCountry: 'Brazil',
        originFlag: 'ðŸ‡§ðŸ‡·'
      },
      {
        id: 'sample-14',
        product_name: 'Taj Mahal Quartzite',
        brand: 'MSI Surfaces',
        material_type: 'quartzite',
        color_family: 'Beige',
        price_per_sqft: 115,
        length_inches: 126,
        width_inches: 72,
        thickness_cm: 3,
        finish: 'Polished',
        images: ['https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/661b2371ac865464ae22b944_vancouver-close-up.jpg'],
        distributor: { company_name: 'MSI Surfaces' },
        slug: 'taj-mahal-quartzite-sample',
        created_at: new Date().toISOString(),
        originCountry: 'Brazil',
        originFlag: 'ðŸ‡§ðŸ‡·'
      }
    ];

    // State
    let slabs = [];
    let filteredSlabs = [];
    let selectedSlab = null;

    // DOM Elements
    const slabGrid = document.getElementById('slabGrid');
    const loadingState = document.getElementById('loadingState');
    const emptyState = document.getElementById('emptyState');
    const searchInput = document.getElementById('searchInput');
    const filterMaterial = document.getElementById('filterMaterial');
    const filterColor = document.getElementById('filterColor');
    const filterSort = document.getElementById('filterSort');
    const resultsCount = document.getElementById('resultsCount');
    const inquiryModal = document.getElementById('inquiryModal');

    // Initialize
    document.addEventListener('DOMContentLoaded', init);

    // URL params for filtering
    let brandFilter = '';

    async function init() {
      setupEventListeners();

      // Initialize pricing service listener
      if (window.SG_PRICING) {
        window.SG_PRICING.onTierChange((tier, user) => {
          currentTier = tier;
          updatePricingBanner(tier, user);
          // Re-render slabs with new pricing
          if (filteredSlabs.length > 0) {
            renderSlabs();
          }
        });
      } else {
        updatePricingBanner('guest', null);
      }

      // Check for URL parameters
      const urlParams = new URLSearchParams(window.location.search);

      const materialParam = urlParams.get('material');
      if (materialParam) {
        filterMaterial.value = materialParam;
        // Update category pill
        document.querySelectorAll('.category-pill').forEach(pill => {
          pill.classList.remove('active');
          if (pill.dataset.material === materialParam) {
            pill.classList.add('active');
          }
        });
      }

      const brandParam = urlParams.get('brand');
      if (brandParam) {
        brandFilter = brandParam.toLowerCase();
        // Pre-populate search with brand name
        searchInput.value = brandParam.replace(/-/g, ' ');
      }

      await loadSlabs();
    }

    function setupEventListeners() {
      // Search with debounce
      let searchTimeout;
      searchInput.addEventListener('input', () => {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(filterAndRender, 300);
      });

      // Filters
      filterMaterial.addEventListener('change', filterAndRender);
      filterColor.addEventListener('change', filterAndRender);
      document.getElementById('filterBrand').addEventListener('change', filterAndRender);
      filterSort.addEventListener('change', filterAndRender);

      // View toggle - use both click and touchend for mobile
      const gridBtn = document.getElementById('viewGrid');
      const listBtn = document.getElementById('viewList');

      function handleGridView(e) {
        e.preventDefault();
        e.stopPropagation();
        setView('grid');
      }

      function handleListView(e) {
        e.preventDefault();
        e.stopPropagation();
        setView('list');
      }

      gridBtn.addEventListener('click', handleGridView);
      gridBtn.addEventListener('touchend', handleGridView);
      listBtn.addEventListener('click', handleListView);
      listBtn.addEventListener('touchend', handleListView);

      // Category pills
      document.querySelectorAll('.category-pill').forEach(pill => {
        pill.addEventListener('click', (e) => {
          e.preventDefault();
          document.querySelectorAll('.category-pill').forEach(p => p.classList.remove('active'));
          pill.classList.add('active');
          const material = pill.dataset.material;
          filterMaterial.value = material;
          filterAndRender();
          document.getElementById('slabGrid').scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
      });

      // Modal backdrop click
      inquiryModal.addEventListener('click', (e) => {
        if (e.target === inquiryModal) closeModal();
      });

      // Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeModal();
      });
    }

    function renderFeatured() {
      const featuredGrid = document.getElementById('featuredGrid');
      if (!featuredGrid) return;

      // Get featured slabs - mix of different materials and brands
      const featured = [];
      const materials = ['quartz', 'granite', 'marble', 'quartzite'];
      const usedIds = new Set();

      // Get 1-2 from each material type
      for (const mat of materials) {
        const matSlabs = slabs.filter(s =>
          s.material_type?.toLowerCase() === mat && !usedIds.has(s.id)
        );
        const picks = matSlabs.slice(0, 2);
        picks.forEach(s => {
          featured.push(s);
          usedIds.add(s.id);
        });
      }

      // Limit to 8
      const displayFeatured = featured.slice(0, 8);

      featuredGrid.innerHTML = displayFeatured.map((slab, index) => {
        const badges = ['Best Seller', 'Popular', 'Trending', 'Top Rated', 'Staff Pick', 'New Arrival', 'Premium', 'Hot'];
        const badge = badges[index % badges.length];
        const imageUrl = slab.images?.[0] || getPlaceholderImage(slab.material_type);

        return `
          <a href="/marketplace/product/?handle=${slab.slug || ''}&category=slabs" class="featured-card" data-slab-id="${slab.id}">
            <span class="featured-card-badge">${badge}</span>
            <div class="featured-card-image" style="background-image: url('${imageUrl}'); background-size: cover; background-position: center;">
            </div>
            <div class="featured-card-body">
              <h3 class="featured-card-title">${escapeHtml(slab.product_name)}</h3>
              <div class="featured-card-meta">${escapeHtml(formatMaterial(slab.material_type))} â€¢ ${escapeHtml(slab.color_family || 'White')}</div>
              <div class="featured-card-footer">
                <div class="featured-card-price">$${slab.price_per_sqft}<span>/sq ft</span></div>
                <div class="featured-card-brand">${escapeHtml(slab.brand)}</div>
              </div>
            </div>
          </a>
        `;
      }).join('');

      // Add click handlers for featured cards
      featuredGrid.querySelectorAll('.featured-card').forEach(card => {
        card.addEventListener('click', (e) => {
          // Let the link work naturally
        });
      });
    }

    async function loadSlabs() {
      showLoading(true);

      try {
        // Start with sample slabs
        slabs = [...SAMPLE_SLABS];

        // Load Shopify slabs from /data/slabs.json (658 products)
        try {
          const shopifyRes = await fetch('/data/slabs.json');
          if (shopifyRes.ok) {
            const shopifySlabs = await shopifyRes.json();

            // Convert Shopify format to slab format
            shopifySlabs.forEach(product => {
              // Skip unavailable/discontinued products
              if (product.available === false) return;

              const price = parseFloat(product.price) || 0;
              const material = (product.productType || '').toLowerCase();

              slabs.push({
                id: product.id,
                product_name: product.title,
                brand: product.brandDisplay || product.vendor,
                material_type: material || 'quartz',
                color_family: detectColor(product.title),
                price_per_sqft: price > 0 ? price : null,
                length_inches: 126,
                width_inches: 63,
                thickness_cm: 3,
                finish: 'Polished',
                images: product.images || [],
                distributor: { company_name: product.brandDisplay || product.vendor },
                created_at: new Date().toISOString(),
                slug: product.handle,
                shopify: true,
                variantId: product.variants?.[0]?.id,
                originCountry: product.originCountry || null,
                originFlag: product.originFlag || null
              });
            });
            console.log('Loaded ' + shopifySlabs.length + ' Shopify slabs');
          }
        } catch (err) {
          console.log('Could not load Shopify slabs:', err);
        }

        // Load additional products from marketplace-products.json
        try {
          const productsRes = await fetch('/data/marketplace-products.json');
          if (productsRes.ok) {
            const productsData = await productsRes.json();

            // Pricing tiers based on material type (retail markup from wholesale)
            const PRICING = {
              'Quartz': { min: 45, max: 85 },
              'Granite': { min: 35, max: 65 },
              'Marble': { min: 55, max: 120 },
              'Quartzite': { min: 75, max: 150 },
              'Dekton': { min: 65, max: 110 },
              'Porcelain': { min: 40, max: 75 },
              'default': { min: 45, max: 80 }
            };

            // Brand to origin mapping
            const BRAND_ORIGINS = {
              'cambria': { country: 'USA', flag: 'ðŸ‡ºðŸ‡¸' },
              'silestone': { country: 'Spain', flag: 'ðŸ‡ªðŸ‡¸' },
              'dekton': { country: 'Spain', flag: 'ðŸ‡ªðŸ‡¸' },
              'cosentino': { country: 'Spain', flag: 'ðŸ‡ªðŸ‡¸' },
              'caesarstone': { country: 'Israel', flag: 'ðŸ‡®ðŸ‡±' },
              'radianz': { country: 'South Korea', flag: 'ðŸ‡°ðŸ‡·' },
              'radianz quartz': { country: 'South Korea', flag: 'ðŸ‡°ðŸ‡·' },
              'hanstone': { country: 'South Korea', flag: 'ðŸ‡°ðŸ‡·' },
              'hanstone quartz': { country: 'South Korea', flag: 'ðŸ‡°ðŸ‡·' },
              'lg hausys': { country: 'South Korea', flag: 'ðŸ‡°ðŸ‡·' },
              'lx hausys': { country: 'South Korea', flag: 'ðŸ‡°ðŸ‡·' },
              'pentalquartz': { country: 'USA', flag: 'ðŸ‡ºðŸ‡¸' },
              'pental': { country: 'USA', flag: 'ðŸ‡ºðŸ‡¸' },
              'arizona tile': { country: 'USA', flag: 'ðŸ‡ºðŸ‡¸' },
              'msi': { country: 'USA', flag: 'ðŸ‡ºðŸ‡¸' },
              'msi surfaces': { country: 'USA', flag: 'ðŸ‡ºðŸ‡¸' }
            };

            // Build set of existing product names for deduplication (normalize spaces, strip " Sample")
            const existingNames = new Set();
            slabs.forEach(s => {
              const name = (s.product_name || '').toLowerCase().replace(/\s+/g, ' ').trim();
              existingNames.add(name);
              existingNames.add(name.replace(/ sample$/, ''));
            });

            // Convert products to slab format
            let slabId = 100;
            const brands = Object.keys(productsData.by_brand || {});

            for (const brand of brands) {
              const products = productsData.by_brand[brand] || [];
              const brandLower = brand.toLowerCase();
              const origin = BRAND_ORIGINS[brandLower] || null;

              // Take first 15 products per brand
              for (const product of products.slice(0, 15)) {
                // Skip duplicates already loaded from slabs.json
                const pName = product.name?.toLowerCase().trim() || '';
                if (existingNames.has(pName) || existingNames.has(pName.replace(/ sample$/, ''))) continue;
                const priceRange = PRICING[product.type] || PRICING.default;
                const price = Math.floor(priceRange.min + Math.random() * (priceRange.max - priceRange.min));

                // Format brand name properly
                const brandName = brand.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());

                slabs.push({
                  id: `product-${slabId++}`,
                  product_name: product.name,
                  brand: brandName,
                  material_type: (product.type || 'quartz').toLowerCase(),
                  color_family: product.primaryColor || 'White',
                  price_per_sqft: price,
                  length_inches: 126,
                  width_inches: 63,
                  thickness_cm: 3,
                  finish: 'Polished',
                  images: [fixImageUrl(product.primaryImage)],
                  distributor: { company_name: brandName },
                  created_at: new Date().toISOString(),
                  slug: product.slug,
                  originCountry: origin?.country || null,
                  originFlag: origin?.flag || null
                });
              }
            }
          }
        } catch (err) {
          console.log('Could not load marketplace products:', err);
        }

        // Try to load additional slabs from API
        try {
          const urlParams = new URLSearchParams(window.location.search);
          const useNewSchema = urlParams.get('new_schema') === 'true' ||
                               (window.SG_CONFIG?.FEATURES?.USE_NEW_PRODUCTS_SCHEMA ?? false);

          const apiUrl = useNewSchema
            ? `${API_BASE}/api/marketplace/slabs?limit=100&use_new_schema=true`
            : `${API_BASE}/api/marketplace/slabs?limit=100`;

          const response = await fetch(apiUrl);

          if (response.ok) {
            const data = await response.json();
            if (data.slabs && data.slabs.length > 0) {
              // Combine API slabs with existing slabs
              slabs = [...slabs, ...data.slabs];
            }
          }
        } catch (apiErr) {
          console.log('API unavailable, using local products');
        }

        // Update stats
        document.getElementById('statSlabs').textContent = slabs.length.toLocaleString();

        // Get unique distributors
        const distributors = new Set(slabs.map(s => s.distributor?.company_name).filter(Boolean));
        document.getElementById('statDistributors').textContent = distributors.size || '11';

        // Render featured section first
        renderFeatured();

        filterAndRender();
      } catch (err) {
        console.error('Error loading slabs:', err);
        showError();
      } finally {
        showLoading(false);
      }
    }

    function filterAndRender() {
      const search = searchInput.value.toLowerCase();
      const material = filterMaterial.value;
      const color = filterColor.value;
      const brand = document.getElementById('filterBrand').value;
      const sort = filterSort.value;

      // Filter
      filteredSlabs = slabs.filter(slab => {
        const matchesSearch = !search ||
          slab.product_name?.toLowerCase().includes(search) ||
          slab.brand?.toLowerCase().includes(search) ||
          slab.material_type?.toLowerCase().includes(search) ||
          slab.color_family?.toLowerCase().includes(search) ||
          slab.description?.toLowerCase().includes(search);

        const matchesMaterial = !material || slab.material_type?.toLowerCase() === material.toLowerCase();
        const matchesColor = !color || slab.color_family?.toLowerCase() === color.toLowerCase();
        const matchesBrand = !brand || slab.brand?.toLowerCase().includes(brand.toLowerCase());

        return matchesSearch && matchesMaterial && matchesColor && matchesBrand;
      });

      // Sort
      filteredSlabs.sort((a, b) => {
        switch (sort) {
          case 'newest':
            return new Date(b.created_at) - new Date(a.created_at);
          case 'price-low':
            return (a.price_per_sqft || 0) - (b.price_per_sqft || 0);
          case 'price-high':
            return (b.price_per_sqft || 0) - (a.price_per_sqft || 0);
          case 'name':
            return (a.product_name || '').localeCompare(b.product_name || '');
          default:
            return 0;
        }
      });

      renderSlabs();
      updateResultsCount();
    }

    function renderSlabs() {
      if (filteredSlabs.length === 0) {
        slabGrid.innerHTML = '';
        emptyState.style.display = 'block';
        return;
      }

      emptyState.style.display = 'none';
      slabGrid.innerHTML = filteredSlabs.map(slab => createSlabCard(slab)).join('');

      // Add click handlers
      slabGrid.querySelectorAll('.slab-card').forEach(card => {
        const slabId = card.dataset.slabId;

        // Card click opens detail/modal
        card.addEventListener('click', (e) => {
          if (e.target.closest('.slab-favorite') || e.target.closest('.slab-btn') || e.target.closest('.slab-install-badge')) return;
          openSlabDetail(slabId);
        });
      });

      // Inquiry button handlers
      slabGrid.querySelectorAll('.slab-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const slabId = btn.dataset.slabId;
          openInquiryModal(slabId);
        });
      });

      // Favorite handlers
      slabGrid.querySelectorAll('.slab-favorite').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          btn.classList.toggle('active');
        });
      });
    }

    function createSlabCard(slab) {
      const rawImageUrl = slab.images?.[0] || getPlaceholderImage(slab.material_type);
      const imageUrl = fixImageUrl(rawImageUrl) || getPlaceholderImage(slab.material_type);
      const isNew = isNewListing(slab.created_at);

      // Calculate dynamic pricing
      const pricing = calculateSlabPrice(slab);
      let priceHtml = '<div class="slab-price">Contact</div>';

      if (pricing && pricing.yourPrice > 0) {
        const showSavings = pricing.savings && pricing.savings > 2;
        priceHtml = `
          <div class="slab-price">
            ${showSavings ? `<span class="price-retail">$${pricing.retailPrice.toFixed(2)}</span>` : ''}
            $${pricing.yourPrice.toFixed(2)}
            <span>/sq ft</span>
            ${showSavings ? `<span class="price-savings">Save $${pricing.savings.toFixed(2)}</span>` : ''}
          </div>
        `;
      } else if (slab.price_per_sqft) {
        priceHtml = `<div class="slab-price">$${slab.price_per_sqft.toFixed(2)}<span>/sq ft</span></div>`;
      }

      return `
        <div class="slab-card" data-slab-id="${slab.id}">
          <div class="slab-card-image" style="background-image: url('${imageUrl || getPlaceholderImage(slab.material_type)}'); background-size: cover; background-position: center;">
            <div class="slab-badges">
              <span class="slab-badge slab-badge-material">${escapeHtml(formatMaterial(slab.material_type))}</span>
              ${isNew ? '<span class="slab-badge slab-badge-new">New</span>' : ''}
            </div>
            ${slab.originFlag ? `<span class="slab-badge-origin" title="Made in ${slab.originCountry}">${slab.originFlag}</span>` : ''}
            <button class="slab-favorite" aria-label="Add to favorites">
              <svg viewBox="0 0 24 24" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
            </button>
            <a href="/get-a-free-estimate?service=countertop-install&material=${encodeURIComponent(slab.material_type || 'stone')}&product=${encodeURIComponent(slab.product_name || '')}" class="slab-install-badge" aria-label="Get this installed" title="Get This Installed">
              <svg viewBox="0 0 24 24" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>
            </a>
          </div>
          <div class="slab-card-body">
            ${slab.distributor?.company_name ? `<div class="slab-distributor">${escapeHtml(slab.distributor.company_name)}</div>` : ''}
            <h3 class="slab-title">${escapeHtml(slab.product_name)}</h3>
            ${slab.brand ? `<div class="slab-brand">${escapeHtml(slab.brand)}</div>` : ''}
            <div class="slab-details">
              ${slab.length_inches && slab.width_inches ? `
                <div class="slab-detail">
                  <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/></svg>
                  ${slab.length_inches}" x ${slab.width_inches}"
                </div>
              ` : ''}
              ${slab.thickness_cm ? `
                <div class="slab-detail">
                  <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
                  ${slab.thickness_cm}cm
                </div>
              ` : ''}
              ${slab.finish ? `
                <div class="slab-detail">
                  <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M12 3v18M3 12h18"/></svg>
                  ${escapeHtml(slab.finish)}
                </div>
              ` : ''}
            </div>
            <div class="slab-footer">
              ${priceHtml}
              <div class="slab-cta-group">
                <button class="slab-btn" data-slab-id="${slab.id}">Get Quote</button>
              </div>
            </div>
            <div class="install-benefits">
              <span class="install-benefit">
                <svg viewBox="0 0 24 24" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                Pro Install
              </span>
              <span class="install-benefit">
                <svg viewBox="0 0 24 24" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                Lifetime Warranty
              </span>
              <span class="install-benefit">
                <svg viewBox="0 0 24 24" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                2-3 Weeks
              </span>
            </div>
          </div>
        </div>
      `;
    }

    function openSlabDetail(slabId) {
      // Find the slab and navigate to appropriate product page
      const slab = slabs.find(s => s.id === slabId);
      if (!slab) {
        window.location.href = `/marketplace/slabs//`;
        return;
      }

      // All products go to marketplace product page
      if (slab.slug) {
        window.location.href = `/marketplace/product/?handle=${slab.slug}&category=slabs`;
      } else {
        window.location.href = `/marketplace/slabs/`;
      }
    }

    function openInquiryModal(slabId) {
      selectedSlab = slabs.find(s => s.id === slabId);
      if (!selectedSlab) return;

      // Populate modal slab info
      const imageUrl = selectedSlab.images?.[0] || getPlaceholderImage(selectedSlab.material_type);
      document.getElementById('modalSlabInfo').innerHTML = `
        <img class="modal-slab-img" src="${escapeHtml(imageUrl)}" alt="${escapeHtml(selectedSlab.product_name)}">
        <div>
          <div class="modal-slab-name">${escapeHtml(selectedSlab.product_name)}</div>
          <div class="modal-slab-meta">
            ${formatMaterial(selectedSlab.material_type)}
            ${selectedSlab.brand ? ` &bull; ${escapeHtml(selectedSlab.brand)}` : ''}
            ${selectedSlab.price_per_sqft ? ` &bull; $${selectedSlab.price_per_sqft.toFixed(2)}/sq ft` : ''}
          </div>
        </div>
      `;

      inquiryModal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeModal() {
      inquiryModal.classList.remove('active');
      document.body.style.overflow = '';
      selectedSlab = null;
    }

    async function submitInquiry(e) {
      e.preventDefault();
      if (!selectedSlab) return;

      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Sending...';

      const inquiryData = {
        customer_name: document.getElementById('inquiryName').value,
        customer_email: document.getElementById('inquiryEmail').value,
        customer_phone: document.getElementById('inquiryPhone').value || null,
        company_name: document.getElementById('inquiryCompany').value || null,
        message: document.getElementById('inquiryMessage').value || null
      };

      try {
        const response = await fetch(`${API_BASE}/api/marketplace/slabs/${selectedSlab.id}/inquiry`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(inquiryData)
        });

        if (!response.ok) {
          const result = await response.json();
          throw new Error(result.error || 'Failed to submit inquiry');
        }

        // Success
        alert('Thank you! Your inquiry has been sent to the distributor. They will contact you soon.');
        closeModal();
        document.getElementById('inquiryForm').reset();

      } catch (err) {
        alert('Error: ' + err.message);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Send Inquiry';
      }
    }

    // Helper functions
    function showLoading(show) {
      loadingState.style.display = show ? 'block' : 'none';
      if (show) {
        slabGrid.innerHTML = '';
        emptyState.style.display = 'none';
      }
    }

    function showError() {
      slabGrid.innerHTML = `
        <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px;">
          <p style="color: #ef4444;">Unable to load slabs. Please try again later.</p>
          <button class="slab-btn" onclick="loadSlabs()" style="margin-top: 16px;">Retry</button>
        </div>
      `;
    }

    function updateResultsCount() {
      resultsCount.textContent = `${filteredSlabs.length} slab${filteredSlabs.length !== 1 ? 's' : ''} found`;
    }

    function setView(view) {
      const gridBtn = document.getElementById('viewGrid');
      const listBtn = document.getElementById('viewList');
      const mobileGridBtn = document.getElementById('mobileViewGrid');
      const mobileListBtn = document.getElementById('mobileViewList');
      const grid = document.getElementById('slabGrid');

      if (view === 'grid') {
        if (gridBtn) { gridBtn.classList.add('active'); gridBtn.style.background = '#1a1a2e'; }
        if (listBtn) { listBtn.classList.remove('active'); listBtn.style.background = '#fff'; }
        if (mobileGridBtn) { mobileGridBtn.style.background = '#1a1a2e'; mobileGridBtn.querySelector('svg').style.stroke = '#fff'; }
        if (mobileListBtn) { mobileListBtn.style.background = '#fff'; mobileListBtn.querySelector('svg').style.stroke = '#666'; }
        grid.classList.remove('list-view');
        grid.style.setProperty('grid-template-columns', 'repeat(2, 1fr)', 'important');
      } else {
        if (listBtn) { listBtn.classList.add('active'); listBtn.style.background = '#1a1a2e'; }
        if (gridBtn) { gridBtn.classList.remove('active'); gridBtn.style.background = '#fff'; }
        if (mobileListBtn) { mobileListBtn.style.background = '#1a1a2e'; mobileListBtn.querySelector('svg').style.stroke = '#fff'; }
        if (mobileGridBtn) { mobileGridBtn.style.background = '#fff'; mobileGridBtn.querySelector('svg').style.stroke = '#666'; }
        grid.classList.add('list-view');
        grid.style.setProperty('grid-template-columns', '1fr', 'important');
      }
      console.log('View set to:', view, grid);
    }

    // Expose globally for onclick handlers
    window.setSlabView = setView;

    function clearFilters() {
      searchInput.value = '';
      filterMaterial.value = '';
      filterColor.value = '';
      document.getElementById('filterBrand').value = '';
      filterSort.value = 'newest';
      filterAndRender();
    }

    function formatMaterial(type) {
      if (!type) return 'Stone';
      return type.charAt(0).toUpperCase() + type.slice(1);
    }

    function getPlaceholderImage(material) {
      // Use actual stone images from our CDN as placeholders - all verified working (HTTP 200)
      const placeholders = {
        granite: 'https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/6456ce4476abb22cfafbb7e4_msi-surfaces-surprise-granite-new-river-close-up.jpg',
        quartz: 'https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/6456ce4576abb21a6cfbc44d_Msi-surfaces-surprise-quartz-calacatta-abezzo-quartz-slab.jpg',
        marble: 'https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/6456ce4576abb2b48efbbd7f_msi-surfaces-sruprise-granite-absolute-white-marble-close%20up.jpg',
        quartzite: 'https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/661b2371ac865464ae22b944_vancouver-close-up.jpg',
        dekton: 'https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/6456ce4576abb294bffbc2da_dekton-surprise-granite-laurent-quartz-close-up.jpeg',
        porcelain: 'https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/6456ce4576abb294bffbc2da_dekton-surprise-granite-laurent-quartz-close-up.jpeg'
      };
      return placeholders[material?.toLowerCase()] || 'https://cdn.prod.website-files.com/6456ce4476abb2d4f9fbad10/6456ce4576abb21a6cfbc44d_Msi-surfaces-surprise-quartz-calacatta-abezzo-quartz-slab.jpg';
    }

    function isNewListing(createdAt) {
      if (!createdAt) return false;
      const created = new Date(createdAt);
      const now = new Date();
      const diffDays = (now - created) / (1000 * 60 * 60 * 24);
      return diffDays <= 7;
    }

    function escapeHtml(str) {
      if (!str) return '';
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    function detectColor(title) {
      if (!title) return 'White';
      const t = title.toLowerCase();
      if (t.includes('white') || t.includes('calacatta') || t.includes('carrara')) return 'White';
      if (t.includes('black') || t.includes('noir') || t.includes('nero')) return 'Black';
      if (t.includes('gray') || t.includes('grey')) return 'Gray';
      if (t.includes('brown') || t.includes('tan') || t.includes('mocha')) return 'Brown';
      if (t.includes('beige') || t.includes('cream') || t.includes('ivory')) return 'Beige';
      if (t.includes('blue') || t.includes('azul')) return 'Blue';
      if (t.includes('green') || t.includes('verde')) return 'Green';
      if (t.includes('gold') || t.includes('yellow')) return 'Gold';
      return 'White';
    }
  </script>
<script defer src="/js/remodely-hub.js?v=20260118"></script>
</body>
</html>
