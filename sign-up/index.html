<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Join Remodely | AI-Powered Home Remodeling</title>
  <meta name="description" content="Create your free Remodely account. Access AI-powered design tools, collaborate with pros, and transform your home."/>
  <meta name="robots" content="noindex, nofollow"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <link rel="canonical" href="https://remodely.ai/sign-up/"/>
  <link href="/remodely-platform/assets/remodely-icon.svg" rel="shortcut icon" type="image/svg+xml"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3"></script>
<script src="/js/config.js"></script>
<script src="/js/supabase-init.js"></script>

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-P3XFDN8');</script>

  <!-- Open Graph -->
  <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://remodely.ai/sign-up/"/>
  <meta property="og:title" content="Join Remodely | AI-Powered Home Remodeling"/>
  <meta property="og:description" content="Create your free Remodely account."/>
  <meta property="og:image" content="https://www.surprisegranite.com/remodely-platform/assets/remodely-logo.svg"/>

  <style>
    :root {
      --remodely-blue: #4285F4;
      --remodely-red: #EA4335;
      --remodely-yellow: #FBBC05;
      --remodely-green: #34A853;
      --dark-primary: #1a1a2e;
      --dark-deep: #0f0f1a;
      --dark-surface: #16161f;
      --dark-elevated: #1e1e2d;
      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.75);
      --text-muted: rgba(255, 255, 255, 0.5);
      --border-subtle: rgba(255, 255, 255, 0.1);
      --error: #ff6b6b;
      --success: #4dff82;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      background: var(--dark-deep);
      min-height: 100vh;
      min-height: 100dvh;
      display: flex;
      flex-direction: column;
      color: var(--text-primary);
      padding-bottom: env(safe-area-inset-bottom);
    }

    /* Header hidden - using unified nav */
    .header {
      display: none;
    }

    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 0 20px 40px;
      padding-top: 140px; /* Account for fixed nav */
      max-width: 440px;
      margin: 0 auto;
      width: 100%;
    }

    @media (max-width: 991px) {
      .main {
        padding-top: 100px;
      }
    }

    .auth-card {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .auth-header {
      text-align: center;
      padding: 8px 0 28px;
    }

    .auth-header h1 {
      font-size: 36px;
      font-weight: 800;
      margin-bottom: 10px;
      background: linear-gradient(135deg, var(--remodely-blue) 0%, var(--remodely-green) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.5px;
    }

    .auth-header p {
      font-size: 15px;
      color: var(--text-secondary);
    }

    @media (max-width: 480px) {
      .auth-header h1 {
        font-size: 30px;
      }
    }

    .auth-body {
      flex: 1;
    }

    /* Invite Banner */
    .invite-banner {
      display: none;
      background: linear-gradient(135deg, rgba(66, 133, 244, 0.1) 0%, rgba(52, 168, 83, 0.1) 100%);
      border: 1px solid rgba(66, 133, 244, 0.3);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 20px;
      text-align: center;
    }

    .invite-banner.show {
      display: block;
    }

    .invite-banner-icon {
      font-size: 28px;
      margin-bottom: 8px;
    }

    .invite-banner-title {
      font-size: 15px;
      font-weight: 600;
      color: var(--remodely-blue);
      margin-bottom: 4px;
    }

    .invite-banner-detail {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    /* Social Login - First */
    .social-login {
      margin-bottom: 20px;
    }

    .btn-google {
      width: 100%;
      padding: 14px 20px;
      background: #fff;
      border: none;
      border-radius: 12px;
      color: #1a1a2e;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: all 0.2s;
      min-height: 52px;
    }

    .btn-google:hover {
      background: #f5f5f5;
      transform: translateY(-1px);
    }

    .btn-google:active {
      transform: translateY(0);
    }

    .btn-google svg {
      width: 20px;
      height: 20px;
    }

    .divider {
      display: flex;
      align-items: center;
      gap: 16px;
      margin: 20px 0;
    }

    .divider::before,
    .divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border-subtle);
    }

    .divider span {
      font-size: 12px;
      color: var(--text-muted);
    }

    /* Form Styles */
    .form-group {
      margin-bottom: 16px;
    }

    .form-group label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: 6px;
    }

    .form-group input {
      width: 100%;
      padding: 14px 16px;
      background: var(--dark-elevated);
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 16px;
      transition: all 0.2s;
      min-height: 52px;
    }

    .form-group input:focus {
      outline: none;
      border-color: var(--remodely-blue);
      box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.2);
    }

    .form-group input::placeholder {
      color: var(--text-muted);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    /* Simplified Role Selection */
    .role-select {
      margin-bottom: 16px;
    }

    .role-pills {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .role-pill {
      flex: 1;
      min-width: calc(50% - 4px);
      padding: 12px 8px;
      background: var(--dark-elevated);
      border: 2px solid var(--border-subtle);
      border-radius: 12px;
      cursor: pointer;
      text-align: center;
      transition: all 0.2s;
    }

    .role-pill:hover {
      border-color: var(--remodely-blue);
    }

    .role-pill.selected {
      border-color: var(--remodely-blue);
      background: rgba(66, 133, 244, 0.1);
    }

    .role-pill input {
      display: none;
    }

    .role-pill-icon {
      margin-bottom: 6px;
      display: flex;
      justify-content: center;
    }

    .role-pill-icon svg {
      width: 24px;
      height: 24px;
      stroke: var(--text-secondary);
      stroke-width: 1.5;
      fill: none;
    }

    .role-pill.selected .role-pill-icon svg {
      stroke: var(--remodely-blue);
    }

    .role-pill-name {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
    }

    /* Terms */
    .terms-row {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      margin: 16px 0;
    }

    .terms-row input[type="checkbox"] {
      width: 20px;
      height: 20px;
      accent-color: var(--remodely-blue);
      margin-top: 1px;
      flex-shrink: 0;
    }

    .terms-row label {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.4;
    }

    .terms-row a {
      color: var(--remodely-blue);
      text-decoration: none;
    }

    .terms-row a:hover {
      text-decoration: underline;
    }

    /* Primary Button */
    .btn-primary {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, var(--remodely-blue) 0%, var(--remodely-green) 100%);
      border: none;
      border-radius: 12px;
      color: #fff;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      min-height: 56px;
    }

    .btn-primary:hover {
      opacity: 0.95;
      transform: translateY(-1px);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    /* Messages */
    .error-message {
      background: rgba(255, 107, 107, 0.1);
      border: 1px solid rgba(255, 107, 107, 0.3);
      border-radius: 12px;
      padding: 14px 16px;
      margin-bottom: 16px;
      display: none;
    }

    .error-message.show {
      display: block;
    }

    .error-message p {
      color: var(--error);
      font-size: 14px;
      margin: 0;
    }

    .success-message {
      background: rgba(77, 255, 130, 0.1);
      border: 1px solid rgba(77, 255, 130, 0.3);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      display: none;
    }

    .success-message.show {
      display: block;
    }

    .success-message h3 {
      color: var(--success);
      font-size: 18px;
      margin-bottom: 8px;
    }

    .success-message p {
      color: var(--text-secondary);
      font-size: 14px;
      margin: 0;
    }

    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid transparent;
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Footer */
    .auth-footer {
      padding: 20px 0;
      text-align: center;
      margin-top: auto;
    }

    .auth-footer p {
      font-size: 14px;
      color: var(--text-secondary);
    }

    .auth-footer a {
      color: var(--remodely-blue);
      text-decoration: none;
      font-weight: 600;
    }

    .auth-footer a:hover {
      text-decoration: underline;
    }

    /* Feature Pills */
    .features-row {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .feature-pill {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: var(--text-muted);
    }

    .feature-pill svg {
      width: 14px;
      height: 14px;
      color: var(--remodely-green);
    }

    /* Mobile Optimizations */
    @media (max-width: 480px) {
      .main {
        padding: 0 16px 24px;
        padding-top: 90px;
      }

      .auth-header {
        padding: 8px 0 20px;
      }

      .form-row {
        grid-template-columns: 1fr;
        gap: 0;
      }

      .role-pill {
        min-width: calc(50% - 4px);
      }
    }

    /* iOS safe area */
    @supports (padding-bottom: env(safe-area-inset-bottom)) {
      body {
        padding-bottom: calc(env(safe-area-inset-bottom) + 16px);
      }
    }
  </style>
<!-- Unified Navigation -->
<link rel="stylesheet" href="/css/unified-nav.css?v=20260129">
<script defer src="/js/unified-nav.js?v=20260201d"></script>

</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P3XFDN8" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

  <!-- Header hidden - using unified nav -->
  <div class="header" style="display: none;"></div>

  <main class="main">
    <div class="auth-card">
      <div class="auth-header">
        <h1>Create Your Account</h1>
        <p>Free access to AI design tools and pro network</p>
      </div>

      <div class="auth-body">
        <!-- Invite Banner -->
        <div id="invite-banner" class="invite-banner">
          <div class="invite-banner-icon">&#x1F91D;</div>
          <div class="invite-banner-title" id="invite-banner-title">You've been invited!</div>
          <div class="invite-banner-detail" id="invite-banner-detail">Loading invitation...</div>
        </div>

        <div class="error-message" id="error-message">
          <p id="error-text">Something went wrong.</p>
        </div>

        <div class="success-message" id="success-message">
          <h3>Check Your Email</h3>
          <p>We sent a link to <strong id="success-email"></strong>. Click it to get started.</p>
        </div>

        <!-- Google Sign Up First (Fastest Path) -->
        <div class="social-login">
          <button type="button" class="btn-google" onclick="signUpWithGoogle()">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
              <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
              <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
              <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
            </svg>
            Continue with Google
          </button>
        </div>

        <div class="divider"><span>or use email</span></div>

        <form id="signup-form" onsubmit="return handleSignup(event)">
          <div class="form-row">
            <div class="form-group">
              <label for="first_name">First Name</label>
              <input type="text" id="first_name" name="first_name" placeholder="John" required autocomplete="given-name"/>
            </div>
            <div class="form-group">
              <label for="last_name">Last Name</label>
              <input type="text" id="last_name" name="last_name" placeholder="Smith" required autocomplete="family-name"/>
            </div>
          </div>

          <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" placeholder="you@example.com" required autocomplete="email"/>
          </div>

          <div class="form-group">
            <label for="password">Password</label>
            <input type="password" id="password" name="password" placeholder="At least 8 characters" required minlength="8" autocomplete="new-password"/>
          </div>

          <!-- Simplified Role Selection -->
          <div class="role-select">
            <label style="font-size: 13px; font-weight: 500; color: var(--text-secondary); margin-bottom: 8px; display: block;">I am a...</label>
            <div class="role-pills">
              <label class="role-pill selected" id="type-homeowner">
                <input type="radio" name="account_type" value="homeowner" checked/>
                <div class="role-pill-icon">
                  <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" stroke-linecap="round" stroke-linejoin="round"/>
                    <polyline points="9 22 9 12 15 12 15 22" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
                <div class="role-pill-name">Homeowner</div>
              </label>
              <label class="role-pill" id="type-contractor">
                <input type="radio" name="account_type" value="contractor"/>
                <div class="role-pill-icon">
                  <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
                <div class="role-pill-name">Pro</div>
              </label>
            </div>
          </div>

          <!-- Hidden fields for invite data -->
          <input type="hidden" id="phone" name="phone" value=""/>
          <input type="hidden" id="business_name" name="business_name" value=""/>
          <input type="hidden" id="business_location" name="business_location" value=""/>

          <div class="terms-row">
            <input type="checkbox" id="terms" required/>
            <label for="terms">I agree to the <a href="/legal/terms-of-use/" target="_blank">Terms</a> & <a href="/legal/privacy-policy/" target="_blank">Privacy Policy</a></label>
          </div>

          <button type="submit" class="btn-primary" id="signup-btn">
            Create Free Account
          </button>
        </form>

        <div class="features-row">
          <div class="feature-pill">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
            AI Design Tools
          </div>
          <div class="feature-pill">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
            Pro Network
          </div>
          <div class="feature-pill">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
            Free Forever
          </div>
        </div>
      </div>

      <div class="auth-footer">
        <p>Already have an account? <a href="/log-in/">Log in</a></p>
      </div>
    </div>
  </main>

  <script>
    // Supabase config
    const SUPABASE_URL = window.SG_CONFIG?.SUPABASE_URL || 'https://ypeypgwsycxcagncgdur.supabase.co';
    const SUPABASE_ANON_KEY = window.SG_CONFIG?.SUPABASE_ANON_KEY || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlwZXlwZ3dzeWN4Y2FnbmNnZHVyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3NTQ4MjMsImV4cCI6MjA4MzMzMDgyM30.R13pNv2FDtGhfeu7gUcttYNrQAbNYitqR4FIq3O2-ME';

    let supabaseClient;

    // Initialize
    document.addEventListener('DOMContentLoaded', async () => {
      // Use global client (created by supabase-init.js)
      supabaseClient = window._sgSupabaseClient;
      if (!supabaseClient) {
        console.error('Supabase client not initialized');
        return;
      }

      // Check if already logged in
      const { data: { session } } = await supabaseClient.auth.getSession();
      if (session) {
        const redirect = new URLSearchParams(window.location.search).get('redirect') || '/account/';
        window.location.href = redirect;
        return;
      }

      // Store redirect for after signup
      const params = new URLSearchParams(window.location.search);
      const redirect = params.get('redirect');
      if (redirect) {
        sessionStorage.setItem('auth_redirect', redirect);
      }

      // Check for invite token (project-based or network)
      const inviteToken = params.get('invite');
      const networkInviteToken = params.get('network_invite');

      if (inviteToken) {
        await handleInviteToken(inviteToken);
      } else if (networkInviteToken) {
        await handleNetworkInvite(networkInviteToken);
      }

      // Simplified role selection
      document.querySelectorAll('.role-pill').forEach(pill => {
        pill.addEventListener('click', () => {
          document.querySelectorAll('.role-pill').forEach(p => p.classList.remove('selected'));
          pill.classList.add('selected');
        });
      });
    });

    function showError(message) {
      const errorEl = document.getElementById('error-message');
      document.getElementById('error-text').textContent = message;
      errorEl.classList.add('show');
      document.getElementById('success-message').classList.remove('show');
    }

    function showSuccess(email) {
      document.getElementById('success-email').textContent = email;
      document.getElementById('success-message').classList.add('show');
      document.getElementById('error-message').classList.remove('show');
      document.getElementById('signup-form').style.display = 'none';
    }

    function hideMessages() {
      document.getElementById('error-message').classList.remove('show');
      document.getElementById('success-message').classList.remove('show');
    }

    async function handleInviteToken(token) {
      const API_BASE = window.SG_CONFIG?.API_BASE || 'https://surprise-granite-email-api.onrender.com';
      const banner = document.getElementById('invite-banner');
      const bannerTitle = document.getElementById('invite-banner-title');
      const bannerDetail = document.getElementById('invite-banner-detail');

      banner.classList.add('show');

      try {
        const response = await fetch(API_BASE + '/api/collaboration/invite/verify/' + encodeURIComponent(token));
        const data = await response.json();

        if (!response.ok || !data.success) {
          bannerTitle.textContent = 'Invalid Invitation';
          bannerDetail.textContent = data.error || 'This invitation link is invalid or has expired.';
          bannerDetail.style.color = 'var(--error)';
          return;
        }

        const inv = data.invitation;
        bannerTitle.textContent = 'You\'re invited to collaborate!';
        bannerDetail.innerHTML =
          '<strong>' + escapeText(inv.inviterName || 'Someone') + '</strong> invited you to join a project.' +
          '<br><span style="font-size: 12px; color: var(--text-muted);">Sign up below to get started.</span>';

        // If user already has an account, show login link
        if (inv.hasAccount) {
          bannerDetail.innerHTML +=
            '<br><a href="/log-in/?redirect=' + encodeURIComponent('/account/?accept_invite=' + token) + '" style="color: var(--remodely-blue); font-weight: 600; margin-top: 8px; display: inline-block;">Already have an account? Log in</a>';
        }

        // Pre-fill and lock email
        if (inv.email) {
          var emailInput = document.getElementById('email');
          emailInput.value = inv.email;
          emailInput.readOnly = true;
          emailInput.style.opacity = '0.7';
        }

        // Auto-select Pro if invited as a professional
        var proRoles = ['fabricator', 'designer', 'contractor', 'installer'];
        if (proRoles.includes(inv.role)) {
          var proPill = document.getElementById('type-contractor');
          if (proPill) {
            document.querySelectorAll('.role-pill').forEach(p => p.classList.remove('selected'));
            proPill.classList.add('selected');
            proPill.querySelector('input').checked = true;
          }
        }

        // Store token for post-signup claim
        sessionStorage.setItem('sg_invite_token', token);
        localStorage.setItem('sg_invite_token', token);
        sessionStorage.setItem('auth_redirect', '/account/');

      } catch (err) {
        bannerTitle.textContent = 'Could not load invitation';
        bannerDetail.textContent = 'Please check your link and try again.';
        console.error('Invite verify error:', err);
      }
    }

    async function handleNetworkInvite(token) {
      const API_BASE = window.SG_CONFIG?.API_BASE || 'https://surprise-granite-email-api.onrender.com';
      const banner = document.getElementById('invite-banner');
      const bannerTitle = document.getElementById('invite-banner-title');
      const bannerDetail = document.getElementById('invite-banner-detail');

      banner.classList.add('show');

      try {
        const response = await fetch(API_BASE + '/api/collaboration/network/verify/' + encodeURIComponent(token));
        const data = await response.json();

        if (!response.ok || !data.success) {
          bannerTitle.textContent = 'Invalid Invitation';
          bannerDetail.textContent = data.error || 'This invitation link is invalid or has expired.';
          bannerDetail.style.color = 'var(--error)';
          return;
        }

        const inv = data.invitation;
        bannerTitle.textContent = 'You\'re invited to Remodely!';
        bannerDetail.innerHTML =
          '<strong>' + escapeText(inv.inviterName || 'A partner') + '</strong> wants to collaborate with you.' +
          '<br><span style="font-size: 12px; color: var(--text-muted);">Create your free account to connect.</span>';

        // If user already has an account, show login link
        if (inv.hasAccount) {
          bannerDetail.innerHTML +=
            '<br><a href="/log-in/?redirect=' + encodeURIComponent('/account/?accept_network=' + token) + '" style="color: var(--remodely-blue); font-weight: 600; margin-top: 8px; display: inline-block;">Already have an account? Log in</a>';
        }

        // Pre-fill and lock email
        if (inv.email) {
          var emailInput = document.getElementById('email');
          emailInput.value = inv.email;
          emailInput.readOnly = true;
          emailInput.style.opacity = '0.7';
        }

        // Auto-select Pro for network invites
        var proPill = document.getElementById('type-contractor');
        if (proPill) {
          document.querySelectorAll('.role-pill').forEach(p => p.classList.remove('selected'));
          proPill.classList.add('selected');
          proPill.querySelector('input').checked = true;
        }

        // Store token for post-signup claim
        sessionStorage.setItem('sg_network_invite_token', token);
        localStorage.setItem('sg_network_invite_token', token);
        sessionStorage.setItem('auth_redirect', '/account/');

      } catch (err) {
        bannerTitle.textContent = 'Could not load invitation';
        bannerDetail.textContent = 'Please check your link and try again.';
        console.error('Network invite verify error:', err);
      }
    }

    function escapeText(str) {
      if (!str) return '';
      var div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    async function handleSignup(event) {
      event.preventDefault();
      hideMessages();

      const firstName = document.getElementById('first_name').value.trim();
      const lastName = document.getElementById('last_name').value.trim();
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      const accountType = document.querySelector('input[name="account_type"]:checked').value;
      const signupBtn = document.getElementById('signup-btn');

      if (!document.getElementById('terms').checked) {
        showError('Please agree to the Terms and Privacy Policy.');
        return false;
      }

      signupBtn.disabled = true;
      signupBtn.innerHTML = '<div class="spinner"></div> Creating...';

      // Get redirect URL
      const redirect = sessionStorage.getItem('auth_redirect') || '/account/';

      try {
        // Sign up with Supabase
        const { data, error } = await supabaseClient.auth.signUp({
          email,
          password,
          options: {
            emailRedirectTo: window.location.origin + redirect,
            data: {
              first_name: firstName,
              last_name: lastName,
              full_name: `${firstName} ${lastName}`,
              account_type: accountType,
              is_pro: accountType === 'contractor'
            }
          }
        });

        if (error) {
          showError(error.message);
          signupBtn.disabled = false;
          signupBtn.innerHTML = 'Create Free Account';
          return false;
        }

        // If email confirmation is required
        if (data.user && !data.session) {
          showSuccess(email);
          document.getElementById('signup-form').style.display = 'none';
          document.querySelector('.social-login').style.display = 'none';
          document.querySelector('.divider').style.display = 'none';
        } else if (data.session) {
          // Direct login (no email confirmation)
          sessionStorage.removeItem('auth_redirect');
          window.location.href = redirect;
        }

      } catch (err) {
        showError('An unexpected error occurred. Please try again.');
        signupBtn.disabled = false;
        signupBtn.innerHTML = 'Create Free Account';
      }

      return false;
    }

    async function signUpWithGoogle() {
      hideMessages();

      try {
        const redirect = sessionStorage.getItem('auth_redirect') || '/account/';
        const { data, error } = await supabaseClient.auth.signInWithOAuth({
          provider: 'google',
          options: {
            redirectTo: window.location.origin + redirect
          }
        });

        if (error) {
          showError(error.message);
        }
      } catch (err) {
        showError('Failed to connect with Google. Please try again.');
      }
    }
  </script>
<script src="/js/sg-auth.js"></script>
<script src="/js/auth-state.js"></script>
<script src="/js/user-tracking.js"></script>
<script src="/js/site-search.js"></script>
<script defer src="/js/remodely-hub.js?v=20260118"></script>
</body>
</html>
