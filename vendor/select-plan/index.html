<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Choose Your Plan | Surprise Granite Pro Network</title>
  <meta name="description" content="Select a subscription plan to start receiving qualified leads and grow your fabrication or installation business."/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://cdn.prod.website-files.com/6456ce4476abb25581fbad0c/6456ce4476abb269c6fbb176_Surprise-Granite-favicon-32x32px.png" rel="shortcut icon" type="image/x-icon"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="https://js.stripe.com/v3/"></script>

  <!-- Unified Navigation -->
  <link rel="stylesheet" href="/css/unified-nav.css?v=20260129">
  <script defer src="/js/unified-nav.js?v=20260129"></script>

  <style>
    :root {
      --gold-primary: #f9cb00;
      --gold-dark: #cca600;
      --gold-glow: rgba(249, 203, 0, 0.35);
      --dark-primary: #1a1a2e;
      --dark-deep: #0a0a12;
      --dark-surface: #12121a;
      --dark-elevated: #1e1e2d;
      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.75);
      --text-muted: rgba(255, 255, 255, 0.5);
      --border-subtle: rgba(255, 255, 255, 0.1);
      --success: #22c55e;
      --error: #ef4444;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--dark-deep);
      min-height: 100vh;
      color: var(--text-primary);
      padding-top: 140px;
    }

    @media (max-width: 991px) {
      body { padding-top: 64px; }
    }

    .pricing-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 24px 80px;
    }

    .pricing-header {
      text-align: center;
      margin-bottom: 48px;
    }

    .pricing-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(249, 203, 0, 0.1);
      border: 1px solid rgba(249, 203, 0, 0.3);
      padding: 8px 16px;
      border-radius: 100px;
      font-size: 13px;
      font-weight: 600;
      color: var(--gold-primary);
      margin-bottom: 20px;
    }

    .pricing-title {
      font-size: 36px;
      font-weight: 800;
      margin-bottom: 12px;
      letter-spacing: -0.5px;
    }

    .pricing-subtitle {
      font-size: 18px;
      color: var(--text-secondary);
      max-width: 600px;
      margin: 0 auto;
      line-height: 1.6;
    }

    /* Billing Toggle */
    .billing-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      margin-top: 32px;
    }

    .billing-option {
      font-size: 15px;
      color: var(--text-muted);
      cursor: pointer;
      transition: color 0.2s;
    }

    .billing-option.active {
      color: var(--text-primary);
      font-weight: 600;
    }

    .toggle-switch {
      width: 56px;
      height: 28px;
      background: var(--dark-surface);
      border-radius: 14px;
      position: relative;
      cursor: pointer;
      border: 1px solid var(--border-subtle);
    }

    .toggle-switch::after {
      content: '';
      position: absolute;
      width: 22px;
      height: 22px;
      background: var(--gold-primary);
      border-radius: 50%;
      top: 2px;
      left: 3px;
      transition: transform 0.2s ease;
    }

    .toggle-switch.annual::after {
      transform: translateX(27px);
    }

    .save-badge {
      background: var(--success);
      color: white;
      padding: 4px 10px;
      border-radius: 100px;
      font-size: 12px;
      font-weight: 700;
    }

    /* Pricing Grid */
    .pricing-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-top: 48px;
    }

    @media (max-width: 1100px) {
      .pricing-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 600px) {
      .pricing-grid {
        grid-template-columns: 1fr;
      }
    }

    .pricing-card {
      background: var(--dark-surface);
      border: 1px solid var(--border-subtle);
      border-radius: 24px;
      padding: 32px 24px;
      position: relative;
      transition: all 0.3s ease;
    }

    .pricing-card:hover {
      border-color: rgba(255,255,255,0.2);
      transform: translateY(-4px);
    }

    .pricing-card.popular {
      border-color: var(--gold-primary);
      background: linear-gradient(180deg, rgba(249, 203, 0, 0.08) 0%, var(--dark-surface) 100%);
    }

    .popular-badge {
      position: absolute;
      top: -12px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-dark) 100%);
      color: var(--dark-primary);
      padding: 6px 16px;
      border-radius: 100px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .plan-name {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .plan-desc {
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 24px;
      min-height: 40px;
    }

    .plan-price {
      margin-bottom: 24px;
    }

    .price-amount {
      font-size: 48px;
      font-weight: 800;
      letter-spacing: -2px;
    }

    .price-currency {
      font-size: 20px;
      font-weight: 600;
      vertical-align: super;
      margin-right: 2px;
    }

    .price-period {
      font-size: 16px;
      color: var(--text-muted);
      font-weight: 500;
    }

    .annual-price {
      font-size: 14px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .plan-features {
      list-style: none;
      margin-bottom: 32px;
    }

    .plan-features li {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      margin-bottom: 14px;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .plan-features li:last-child {
      margin-bottom: 0;
    }

    .feature-check {
      width: 20px;
      height: 20px;
      background: rgba(34, 197, 94, 0.15);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      margin-top: 1px;
    }

    .feature-check svg {
      width: 12px;
      height: 12px;
      stroke: var(--success);
    }

    .feature-x {
      width: 20px;
      height: 20px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      margin-top: 1px;
    }

    .feature-x svg {
      width: 10px;
      height: 10px;
      stroke: var(--text-muted);
    }

    .feature-highlight {
      color: var(--gold-primary);
      font-weight: 600;
    }

    /* Buttons */
    .plan-btn {
      display: block;
      width: 100%;
      padding: 16px;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 700;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.2s ease;
      border: none;
      text-align: center;
      text-decoration: none;
    }

    .plan-btn-primary {
      background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-dark) 100%);
      color: var(--dark-primary);
      box-shadow: 0 4px 20px var(--gold-glow);
    }

    .plan-btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 28px var(--gold-glow);
    }

    .plan-btn-secondary {
      background: var(--dark-elevated);
      color: var(--text-primary);
      border: 1px solid var(--border-subtle);
    }

    .plan-btn-secondary:hover {
      background: rgba(255,255,255,0.1);
    }

    .plan-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Loading */
    .loading-spinner {
      width: 20px;
      height: 20px;
      border: 2px solid var(--dark-primary);
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      display: inline-block;
      margin-right: 8px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Features Comparison */
    .features-section {
      margin-top: 80px;
      text-align: center;
    }

    .features-title {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 16px;
    }

    .features-subtitle {
      font-size: 16px;
      color: var(--text-muted);
      margin-bottom: 40px;
    }

    .features-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 24px;
      text-align: left;
    }

    @media (max-width: 768px) {
      .features-grid {
        grid-template-columns: 1fr;
      }
    }

    .feature-card {
      background: var(--dark-surface);
      border: 1px solid var(--border-subtle);
      border-radius: 16px;
      padding: 24px;
    }

    .feature-card-icon {
      width: 48px;
      height: 48px;
      background: rgba(249, 203, 0, 0.1);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
    }

    .feature-card-icon svg {
      width: 24px;
      height: 24px;
      stroke: var(--gold-primary);
    }

    .feature-card h3 {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .feature-card p {
      font-size: 14px;
      color: var(--text-muted);
      line-height: 1.6;
    }

    /* FAQ */
    .faq-section {
      margin-top: 80px;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }

    .faq-title {
      font-size: 28px;
      font-weight: 700;
      text-align: center;
      margin-bottom: 32px;
    }

    .faq-item {
      background: var(--dark-surface);
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      margin-bottom: 12px;
      overflow: hidden;
    }

    .faq-question {
      padding: 20px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      font-weight: 600;
      font-size: 15px;
    }

    .faq-question svg {
      width: 20px;
      height: 20px;
      stroke: var(--text-muted);
      transition: transform 0.2s;
    }

    .faq-item.open .faq-question svg {
      transform: rotate(180deg);
    }

    .faq-answer {
      padding: 0 24px 20px;
      font-size: 14px;
      color: var(--text-muted);
      line-height: 1.7;
      display: none;
    }

    .faq-item.open .faq-answer {
      display: block;
    }
  </style>
</head>

<body>
  <div class="pricing-container">
    <header class="pricing-header">
      <div class="pricing-badge">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2L2 7l10 5 10-5-10-5z"/>
        </svg>
        Pro Network Plans
      </div>
      <h1 class="pricing-title">Choose Your Plan</h1>
      <p class="pricing-subtitle">Get qualified leads, grow your business, and only pay for what you need. Cancel anytime.</p>

      <div class="billing-toggle">
        <span class="billing-option active" data-billing="monthly">Monthly</span>
        <div class="toggle-switch" onclick="toggleBilling()"></div>
        <span class="billing-option" data-billing="annual">Annual</span>
        <span class="save-badge">Save 20%</span>
      </div>
    </header>

    <div class="pricing-grid">
      <!-- Starter - Free -->
      <div class="pricing-card">
        <h3 class="plan-name">Starter</h3>
        <p class="plan-desc">Get listed in our directory for free</p>
        <div class="plan-price">
          <span class="price-amount"><span class="price-currency">$</span>0</span>
          <span class="price-period">/month</span>
        </div>
        <ul class="plan-features">
          <li>
            <span class="feature-check"><svg viewBox="0 0 24 24" fill="none" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
            Basic directory listing
          </li>
          <li>
            <span class="feature-check"><svg viewBox="0 0 24 24" fill="none" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
            Business profile page
          </li>
          <li>
            <span class="feature-check"><svg viewBox="0 0 24 24" fill="none" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
            List unlimited remnants
          </li>
          <li>
            <span class="feature-x"><svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></span>
            <span style="color: var(--text-muted)">No leads included</span>
          </li>
          <li>
            <span class="feature-x"><svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></span>
            <span style="color: var(--text-muted)">10% marketplace commission</span>
          </li>
        </ul>
        <button class="plan-btn plan-btn-secondary" onclick="selectPlan('starter')">
          Get Started Free
        </button>
      </div>

      <!-- Basic -->
      <div class="pricing-card">
        <h3 class="plan-name">Basic</h3>
        <p class="plan-desc">Perfect for getting started with leads</p>
        <div class="plan-price">
          <span class="price-amount"><span class="price-currency">$</span><span class="price-value" data-monthly="79" data-annual="63">79</span></span>
          <span class="price-period">/month</span>
          <div class="annual-price" style="display: none;">Billed annually ($756/yr)</div>
        </div>
        <ul class="plan-features">
          <li>
            <span class="feature-check"><svg viewBox="0 0 24 24" fill="none" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
            <span class="feature-highlight">5 leads per month</span>
          </li>
          <li>
            <span class="feature-check"><svg viewBox="0 0 24 24" fill="none" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
            Verified Pro badge
          </li>
          <li>
            <span class="feature-check"><svg viewBox="0 0 24 24" fill="none" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
            2 featured reviews
          </li>
          <li>
            <span class="feature-check"><svg viewBox="0 0 24 24" fill="none" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
            8% marketplace commission
          </li>
        </ul>
        <button class="plan-btn plan-btn-secondary" onclick="selectPlan('basic')">
          Choose Basic
        </button>
      </div>

      <!-- Plus - Popular -->
      <div class="pricing-card popular">
        <div class="popular-badge">Most Popular</div>
        <h3 class="plan-name">Plus</h3>
        <p class="plan-desc">Best value for growing businesses</p>
        <div class="plan-price">
          <span class="price-amount"><span class="price-currency">$</span><span class="price-value" data-monthly="199" data-annual="159">199</span></span>
          <span class="price-period">/month</span>
          <div class="annual-price" style="display: none;">Billed annually ($1,908/yr)</div>
        </div>
        <ul class="plan-features">
          <li>
            <span class="feature-check"><svg viewBox="0 0 24 24" fill="none" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
            <span class="feature-highlight">15 leads per month</span>
          </li>
          <li>
            <span class="feature-check"><svg viewBox="0 0 24 24" fill="none" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
            Priority lead access
          </li>
          <li>
            <span class="feature-check"><svg viewBox="0 0 24 24" fill="none" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
            5 featured reviews
          </li>
          <li>
            <span class="feature-check"><svg viewBox="0 0 24 24" fill="none" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
            Video showcase section
          </li>
          <li>
            <span class="feature-check"><svg viewBox="0 0 24 24" fill="none" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
            5% marketplace commission
          </li>
        </ul>
        <button class="plan-btn plan-btn-primary" onclick="selectPlan('plus')">
          Choose Plus
        </button>
      </div>

      <!-- Pro -->
      <div class="pricing-card">
        <h3 class="plan-name">Pro</h3>
        <p class="plan-desc">For high-volume professionals</p>
        <div class="plan-price">
          <span class="price-amount"><span class="price-currency">$</span><span class="price-value" data-monthly="399" data-annual="319">399</span></span>
          <span class="price-period">/month</span>
          <div class="annual-price" style="display: none;">Billed annually ($3,828/yr)</div>
        </div>
        <ul class="plan-features">
          <li>
            <span class="feature-check"><svg viewBox="0 0 24 24" fill="none" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
            <span class="feature-highlight">40 leads per month</span>
          </li>
          <li>
            <span class="feature-check"><svg viewBox="0 0 24 24" fill="none" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
            First access to all leads
          </li>
          <li>
            <span class="feature-check"><svg viewBox="0 0 24 24" fill="none" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
            Unlimited featured reviews
          </li>
          <li>
            <span class="feature-check"><svg viewBox="0 0 24 24" fill="none" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
            Remove competitor ads
          </li>
          <li>
            <span class="feature-check"><svg viewBox="0 0 24 24" fill="none" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
            3% marketplace commission
          </li>
          <li>
            <span class="feature-check"><svg viewBox="0 0 24 24" fill="none" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></span>
            Dedicated account manager
          </li>
        </ul>
        <button class="plan-btn plan-btn-secondary" onclick="selectPlan('pro')">
          Choose Pro
        </button>
      </div>
    </div>

    <!-- Features Section -->
    <section class="features-section">
      <h2 class="features-title">Why Join the Pro Network?</h2>
      <p class="features-subtitle">Everything you need to grow your fabrication or installation business</p>

      <div class="features-grid">
        <div class="feature-card">
          <div class="feature-card-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
              <circle cx="9" cy="7" r="4"/>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
          </div>
          <h3>Qualified Leads</h3>
          <p>Receive pre-screened leads from homeowners actively looking for your services. No cold calling needed.</p>
        </div>

        <div class="feature-card">
          <div class="feature-card-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
              <line x1="3" y1="9" x2="21" y2="9"/>
              <line x1="9" y1="21" x2="9" y2="9"/>
            </svg>
          </div>
          <h3>Sell Remnants</h3>
          <p>List your leftover stone in our marketplace. Turn waste into profit with our built-in buyer network.</p>
        </div>

        <div class="feature-card">
          <div class="feature-card-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
              <path d="M12 20V10"/>
              <path d="M18 20V4"/>
              <path d="M6 20v-4"/>
            </svg>
          </div>
          <h3>Grow Your Brand</h3>
          <p>Get featured in our directory, collect reviews, and build your online presence to attract more customers.</p>
        </div>
      </div>
    </section>

    <!-- FAQ Section -->
    <section class="faq-section">
      <h2 class="faq-title">Frequently Asked Questions</h2>

      <div class="faq-item">
        <div class="faq-question" onclick="toggleFaq(this)">
          How do leads work?
          <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
        </div>
        <div class="faq-answer">
          When a homeowner submits a request for an estimate or quote on our website, we match them with pros in their area. You'll receive the lead directly to your dashboard and email with their contact info and project details.
        </div>
      </div>

      <div class="faq-item">
        <div class="faq-question" onclick="toggleFaq(this)">
          Can I cancel anytime?
          <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
        </div>
        <div class="faq-answer">
          Yes! You can cancel your subscription at any time from your dashboard. You'll continue to have access until the end of your billing period.
        </div>
      </div>

      <div class="faq-item">
        <div class="faq-question" onclick="toggleFaq(this)">
          What is the marketplace commission?
          <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
        </div>
        <div class="faq-answer">
          When you sell a remnant or slab through our marketplace, we charge a small commission on the sale. Higher tier plans have lower commission rates. The buyer pays, so you receive your full asking price minus the commission.
        </div>
      </div>

      <div class="faq-item">
        <div class="faq-question" onclick="toggleFaq(this)">
          Do I need a license to join?
          <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
        </div>
        <div class="faq-answer">
          For paid plans, we require a valid contractor's license (ROC in Arizona) and proof of insurance. This helps us maintain quality standards and build trust with homeowners. You can start with the free Starter plan without verification.
        </div>
      </div>
    </section>
  </div>

  <script>
    // Supabase Config
    const SUPABASE_URL = 'https://ypeypgwsycxcagncgdur.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlwZXlwZ3dzeWN4Y2FnbmNnZHVyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3NTQ4MjMsImV4cCI6MjA4MzMzMDgyM30.R13pNv2FDtGhfeu7gUcttYNrQAbNYitqR4FIq3O2-ME';
    const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Stripe Config
    const STRIPE_PUBLIC_KEY = 'pk_live_51Smr3E3qDbNyHFmdPLN9iXM3rMQv6hKNtXEP5yVpZVRHBFZ5xk0jKvPy4kQMQ6yHVzXSzVBBZlP8rMGKK9TyZ7qJ00q0Y3nKpN';
    const stripe = Stripe(STRIPE_PUBLIC_KEY);

    let billingCycle = 'monthly';

    let currentUser = null;
    let signupData = null;

    // Check if user is logged in
    async function checkAuth() {
      const { data: { user }, error } = await supabaseClient.auth.getUser();

      if (user) {
        currentUser = user;
        return user;
      }

      // Check for signup data in localStorage
      const storedData = localStorage.getItem('sg_vendor_signup');
      if (storedData) {
        signupData = JSON.parse(storedData);
        return null; // Return null but don't redirect - we have signup data
      }

      // No user and no signup data - redirect to signup
      window.location.href = '/vendor/signup/';
      return null;
    }

    checkAuth();

    // Toggle billing period
    function toggleBilling() {
      const toggle = document.querySelector('.toggle-switch');
      const monthlyOption = document.querySelector('[data-billing="monthly"]');
      const annualOption = document.querySelector('[data-billing="annual"]');
      const annualPrices = document.querySelectorAll('.annual-price');

      toggle.classList.toggle('annual');

      if (toggle.classList.contains('annual')) {
        billingCycle = 'annual';
        monthlyOption.classList.remove('active');
        annualOption.classList.add('active');
        annualPrices.forEach(el => el.style.display = 'block');

        // Update prices
        document.querySelectorAll('.price-value').forEach(el => {
          el.textContent = el.dataset.annual;
        });
      } else {
        billingCycle = 'monthly';
        monthlyOption.classList.add('active');
        annualOption.classList.remove('active');
        annualPrices.forEach(el => el.style.display = 'none');

        // Update prices
        document.querySelectorAll('.price-value').forEach(el => {
          el.textContent = el.dataset.monthly;
        });
      }
    }

    // Toggle FAQ
    function toggleFaq(element) {
      const faqItem = element.parentElement;
      faqItem.classList.toggle('open');
    }

    // Select plan and checkout
    async function selectPlan(planName) {
      const btn = event.target;
      btn.disabled = true;
      btn.innerHTML = '<span class="loading-spinner"></span> Processing...';

      try {
        // Refresh auth state
        const { data: { user } } = await supabaseClient.auth.getUser();
        let vendorId = user?.id;

        // If no authenticated user, try signup data
        if (!vendorId && signupData) {
          vendorId = signupData.vendor_id;
        }

        if (!vendorId) {
          throw new Error('Please sign up first');
        }

        // For free plan, create subscription and redirect
        if (planName === 'starter') {
          // First, verify the user session is valid for dashboard access
          if (!user) {
            // User signed up but may need to verify email or session expired
            // Try to check if vendor profile exists
            const { data: profile, error: profileError } = await supabaseClient
              .from('vendor_profiles')
              .select('id, email')
              .eq('id', vendorId)
              .single();

            if (profileError || !profile) {
              console.error('Profile check failed:', profileError);
              throw new Error('Account setup incomplete. Please sign up again.');
            }
          }

          // Get or create starter plan subscription
          const { data: plan, error: planError } = await supabaseClient
            .from('subscription_plans')
            .select('id')
            .eq('name', 'starter')
            .single();

          if (planError) {
            console.error('Plan lookup failed:', planError);
            // Continue without plan - dashboard will handle showing upgrade options
          }

          if (plan) {
            const { error: subError } = await supabaseClient.from('vendor_subscriptions').upsert({
              vendor_id: vendorId,
              plan_id: plan.id,
              status: 'active',
              billing_cycle: 'monthly',
              current_period_start: new Date().toISOString(),
              current_period_end: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString()
            }, {
              onConflict: 'vendor_id'
            });

            if (subError) {
              console.error('Subscription creation failed:', subError);
              // Continue anyway - subscription can be created later
            }
          }

          // Clear signup data
          localStorage.removeItem('sg_vendor_signup');

          // If user is authenticated, go to dashboard
          // If not, they'll need to log in
          if (user) {
            window.location.href = '/vendor/dashboard/';
          } else {
            // User needs to verify email or log in
            alert('Please check your email to verify your account, then log in to access your dashboard.');
            window.location.href = '/log-in/?redirect=/vendor/dashboard/';
          }
          return;
        }

        // For paid plans, create Stripe checkout
        const response = await fetch('https://surprise-granite-email-api.onrender.com/api/create-vendor-subscription', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            vendor_id: vendorId,
            plan_name: planName,
            billing_cycle: billingCycle,
            success_url: window.location.origin + '/vendor/dashboard/?subscription=success',
            cancel_url: window.location.origin + '/vendor/select-plan/?canceled=true'
          })
        });

        const data = await response.json();

        if (data.error) {
          throw new Error(data.error);
        }

        if (data.url) {
          // Redirect to Stripe Checkout
          window.location.href = data.url;
        } else if (data.sessionId) {
          // Use Stripe.js to redirect
          const { error } = await stripe.redirectToCheckout({
            sessionId: data.sessionId
          });
          if (error) throw error;
        }

      } catch (error) {
        console.error('Plan selection error:', error);
        alert(error.message || 'Something went wrong. Please try again.');
        btn.disabled = false;
        btn.textContent = planName === 'starter' ? 'Get Started Free' : `Choose ${planName.charAt(0).toUpperCase() + planName.slice(1)}`;
      }
    }
  </script>
<script defer src="/js/remodely-hub.js?v=20260118"></script>
</body>
</html>
