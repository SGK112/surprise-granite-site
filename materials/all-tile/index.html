<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>All Tile | Surprise Granite</title>
  <meta name="description" content="Browse our complete tile collection. Filter by brand, material, style, and color.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="/images/favicon.png" type="image/png">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Unified Navigation -->
  <link rel="stylesheet" href="/css/unified-nav.css?v=20260121">

  <style>
    /* ============================================
       CSS VARIABLES
       ============================================ */
    :root {
      --primary: #1a1a2e;
      --accent: #f9cb00;
      --accent-dark: #d9a800;
      --text: #333;
      --text-light: #666;
      --bg: #fff;
      --bg-light: #f8f9fa;
      --border: #e0e0e0;
      --shadow: 0 2px 8px rgba(0,0,0,0.1);
      --radius: 8px;
    }

    /* ============================================
       RESET & BASE
       ============================================ */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      font-size: 16px;
      -webkit-font-smoothing: antialiased;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      color: var(--text);
      background: var(--bg);
      line-height: 1.5;
      padding-top: 140px; /* Account for fixed nav (140px desktop) */
    }

    @media (max-width: 767px) {
      body {
        padding-top: 64px; /* Mobile nav is 64px */
      }
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    img {
      max-width: 100%;
      height: auto;
      display: block;
    }

    /* ============================================
       HERO SECTION
       ============================================ */
    .hero {
      background: linear-gradient(135deg, var(--primary) 0%, #2d2d4a 100%);
      color: #fff;
      padding: 40px 20px 30px;
      text-align: center;
    }

    .hero h1 {
      font-size: clamp(1.75rem, 5vw, 2.5rem);
      font-weight: 700;
      margin-bottom: 12px;
    }

    .hero p {
      font-size: 1rem;
      opacity: 0.9;
      max-width: 600px;
      margin: 0 auto;
    }

    /* ============================================
       MAIN LAYOUT
       ============================================ */
    .main-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    .content-layout {
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 24px;
    }

    /* ============================================
       FILTER SIDEBAR
       ============================================ */
    .filter-sidebar {
      position: sticky;
      top: 160px; /* Nav height (140px) + 20px gap */
      align-self: start;
      max-height: calc(100vh - 180px);
      overflow-y: auto;
      z-index: 100;
      scrollbar-width: thin;
    }

    .filter-sidebar::-webkit-scrollbar {
      width: 6px;
    }

    .filter-sidebar::-webkit-scrollbar-track {
      background: transparent;
    }

    .filter-sidebar::-webkit-scrollbar-thumb {
      background: #ccc;
      border-radius: 3px;
    }

    .filter-sidebar::-webkit-scrollbar-thumb:hover {
      background: #aaa;
    }

    .filter-card {
      background: var(--bg-light);
      border-radius: 12px;
      padding: 16px;
    }

    /* Results Bar */
    .results-bar {
      background: var(--primary);
      color: #fff;
      padding: 12px 14px;
      border-radius: var(--radius);
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .results-bar .count {
      font-size: 13px;
    }

    .results-bar strong {
      color: var(--accent);
    }

    .clear-all-btn {
      background: rgba(255,255,255,0.2);
      border: none;
      color: #fff;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      transition: background 0.2s;
    }

    .clear-all-btn:hover {
      background: rgba(255,255,255,0.3);
    }

    /* Search Box */
    .search-box {
      margin-bottom: 12px;
    }

    .search-input {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 14px;
      outline: none;
      transition: border-color 0.2s;
    }

    .search-input:focus {
      border-color: var(--accent);
    }

    /* Filter Groups */
    .filter-group {
      background: #fff;
      border-radius: var(--radius);
      margin-bottom: 8px;
      border: 1px solid var(--border);
      overflow: hidden;
    }

    .filter-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 14px;
      cursor: pointer;
      user-select: none;
    }

    .filter-header:hover {
      background: rgba(0,0,0,0.02);
    }

    .filter-header-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .filter-arrow {
      font-size: 10px;
      color: var(--text-light);
      transition: transform 0.2s;
    }

    .filter-group.expanded .filter-arrow {
      transform: rotate(180deg);
    }

    .filter-label {
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      color: var(--primary);
    }

    .filter-badge {
      background: var(--accent);
      color: var(--primary);
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 10px;
      font-weight: 700;
      display: none;
    }

    .filter-badge.visible {
      display: inline-block;
    }

    .filter-clear {
      font-size: 11px;
      color: var(--text-light);
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px 8px;
    }

    .filter-clear:hover {
      color: var(--text);
    }

    /* Filter Options */
    .filter-options {
      display: none;
      padding: 8px 10px;
      background: #fafafa;
      border-top: 2px solid var(--accent);
      max-height: 180px;
      overflow-y: auto;
    }

    .filter-group.expanded .filter-options {
      display: block;
    }

    .filter-option {
      display: flex;
      align-items: center;
      padding: 8px 10px;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.15s;
    }

    .filter-option:hover {
      background: rgba(249,203,0,0.1);
    }

    .filter-option.active {
      background: rgba(249,203,0,0.15);
    }

    .filter-checkbox {
      width: 16px;
      height: 16px;
      border: 2px solid #ccc;
      border-radius: 3px;
      margin-right: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      background: #fff;
      flex-shrink: 0;
      transition: all 0.15s;
    }

    .filter-option.active .filter-checkbox {
      background: var(--accent);
      border-color: var(--accent-dark);
      color: var(--primary);
    }

    .filter-option-text {
      font-size: 13px;
      color: var(--text);
    }

    /* ============================================
       TILE GRID
       ============================================ */
    .tile-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
    }

    .tile-card {
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .tile-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow);
    }

    .tile-card a {
      display: block;
    }

    .tile-image-wrapper {
      aspect-ratio: 1;
      background: #f5f5f5;
      overflow: hidden;
    }

    .tile-image-wrapper img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s;
    }

    .tile-card:hover .tile-image-wrapper img {
      transform: scale(1.05);
    }

    .tile-info {
      padding: 12px;
    }

    .tile-name {
      font-size: 14px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .tile-meta {
      font-size: 12px;
      color: var(--text-light);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Loading State */
    .loading-message {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-light);
      grid-column: 1 / -1;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      grid-column: 1 / -1;
    }

    .empty-state h3 {
      margin-bottom: 8px;
      color: var(--text);
    }

    .empty-state p {
      color: var(--text-light);
    }

    /* ============================================
       MOBILE SWIPE BUTTON
       ============================================ */
    .swipe-mode-btn {
      display: none;
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--accent);
      color: var(--primary);
      border: none;
      padding: 14px 20px;
      border-radius: 30px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      z-index: 100;
    }

    /* ============================================
       RESPONSIVE - TABLET
       ============================================ */
    @media (max-width: 991px) {
      .content-layout {
        grid-template-columns: 240px 1fr;
        gap: 20px;
      }

      .tile-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
      }
    }

    /* ============================================
       RESPONSIVE - MOBILE
       ============================================ */
    @media (max-width: 767px) {
      .hero {
        padding: 30px 16px 24px;
      }

      .main-container {
        padding: 12px;
      }

      .content-layout {
        grid-template-columns: 1fr;
      }

      /* Hide filter sidebar on mobile */
      .filter-sidebar {
        display: none;
      }

      /* Full width grid */
      .tile-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }

      .tile-card {
        border-radius: 8px;
      }

      .tile-image-wrapper {
        border-radius: 8px 8px 0 0;
      }

      .tile-info {
        padding: 10px;
      }

      .tile-name {
        font-size: 13px;
      }

      .tile-meta {
        font-size: 11px;
      }

      /* Show swipe mode button */
      .swipe-mode-btn {
        display: block;
      }
    }

    /* ============================================
       RESPONSIVE - SMALL MOBILE
       ============================================ */
    @media (max-width: 380px) {
      .tile-grid {
        gap: 8px;
      }

      .tile-info {
        padding: 8px;
      }

      .tile-name {
        font-size: 12px;
      }

      .tile-meta {
        font-size: 10px;
      }
    }
  </style>
</head>
<body>
  <!-- Unified Navigation Placeholder -->
  <div id="unified-nav-placeholder"></div>

  <!-- Hero Section -->
  <section class="hero">
    <h1>Tile Collection</h1>
    <p>Browse 460+ tiles from top brands. Filter by material, color, style, and more.</p>
  </section>

  <!-- Main Content -->
  <main class="main-container">
    <div class="content-layout">

      <!-- Filter Sidebar (Desktop Only) -->
      <aside class="filter-sidebar">
        <div class="filter-card">
          <!-- Results Bar -->
          <div class="results-bar">
            <span class="count">Showing <strong id="count-showing">0</strong> of <strong id="count-total">0</strong></span>
            <button class="clear-all-btn" onclick="clearAllFilters()">Clear All</button>
          </div>

          <!-- Search -->
          <div class="search-box">
            <input type="text" class="search-input" id="tile-search" placeholder="Search tiles..." oninput="handleSearch(this.value)">
          </div>

          <!-- Filter Groups Container -->
          <div id="filter-groups"></div>
        </div>
      </aside>

      <!-- Tile Grid -->
      <section class="tile-section">
        <div class="tile-grid" id="tile-grid">
          <div class="loading-message">Loading tiles...</div>
        </div>
      </section>
    </div>
  </main>

  <!-- Mobile Swipe Mode Button -->
  <button class="swipe-mode-btn" onclick="activateSwipeMode()">
    Swipe Mode
  </button>

  <!-- Unified Navigation Script -->
  <script src="/js/unified-nav.js?v=20260121"></script>

  <!-- Swipe Cards Script (Mobile) -->
  <script src="/js/swipe-cards-universal.js?v=20260121"></script>

  <script>
    /**
     * Tile Filter System - Clean Version
     * No Webflow dependencies
     */
    (function() {
      'use strict';

      const CONFIG = {
        jsonPath: '/data/tile.json',
        itemsPerPage: 48
      };

      const FILTER_DEFINITIONS = [
        { key: 'brand', label: 'Brand', dataKey: 'brands' },
        { key: 'material', label: 'Material', dataKey: 'materials' },
        { key: 'style', label: 'Style', dataKey: 'styles' },
        { key: 'color', label: 'Color', dataKey: 'colors' }
      ];

      let allTiles = [];
      let filteredTiles = [];
      let filters = {};
      let currentPage = 1;

      let activeFilters = {
        brand: [],
        material: [],
        color: [],
        style: [],
        search: ''
      };

      // Initialize
      async function init() {
        console.log('Tile Filter System initializing...');

        try {
          const response = await fetch(CONFIG.jsonPath);
          if (!response.ok) throw new Error('Failed to load tile data');

          const data = await response.json();
          allTiles = data.tiles || [];
          filters = data.filters || {};

          console.log('Loaded', allTiles.length, 'tiles');

          buildFilterUI();
          applyFilters();
          setupInfiniteScroll();

        } catch (error) {
          console.error('Failed to initialize:', error);
          document.getElementById('tile-grid').innerHTML =
            '<div class="empty-state"><h3>Error Loading Tiles</h3><p>Please refresh the page to try again.</p></div>';
        }
      }

      // Build Filter UI
      function buildFilterUI() {
        const container = document.getElementById('filter-groups');
        if (!container) return;

        container.innerHTML = '';

        FILTER_DEFINITIONS.forEach((def, index) => {
          const options = filters[def.dataKey] || [];
          if (options.length === 0) return;

          const group = createFilterGroup(def.label, def.key, options, index === 0);
          container.appendChild(group);
        });
      }

      // Create Filter Group
      function createFilterGroup(label, filterKey, options, startExpanded) {
        const group = document.createElement('div');
        group.className = 'filter-group' + (startExpanded ? ' expanded' : '');
        group.dataset.filterKey = filterKey;

        group.innerHTML = `
          <div class="filter-header">
            <div class="filter-header-left">
              <span class="filter-arrow">▼</span>
              <span class="filter-label">${label}</span>
              <span class="filter-badge">0</span>
            </div>
            <button class="filter-clear">Clear</button>
          </div>
          <div class="filter-options"></div>
        `;

        const optionsContainer = group.querySelector('.filter-options');

        options.forEach(value => {
          const option = document.createElement('div');
          option.className = 'filter-option';
          option.dataset.value = value;
          option.innerHTML = `
            <div class="filter-checkbox"></div>
            <span class="filter-option-text">${formatName(value)}</span>
          `;

          option.addEventListener('click', () => toggleOption(option, filterKey, value, group));
          optionsContainer.appendChild(option);
        });

        // Header click - toggle expand
        group.querySelector('.filter-header').addEventListener('click', (e) => {
          if (e.target.classList.contains('filter-clear')) return;
          group.classList.toggle('expanded');
        });

        // Clear button
        group.querySelector('.filter-clear').addEventListener('click', (e) => {
          e.stopPropagation();
          clearFilterGroup(filterKey, group);
        });

        return group;
      }

      // Toggle Option
      function toggleOption(option, filterKey, value, group) {
        const isActive = option.classList.contains('active');

        if (isActive) {
          option.classList.remove('active');
          option.querySelector('.filter-checkbox').textContent = '';
          activeFilters[filterKey] = activeFilters[filterKey].filter(v => v !== value);
        } else {
          option.classList.add('active');
          option.querySelector('.filter-checkbox').textContent = '✓';
          if (!activeFilters[filterKey].includes(value)) {
            activeFilters[filterKey].push(value);
          }
        }

        updateBadge(group, filterKey);
        currentPage = 1;
        applyFilters();
      }

      // Update Badge
      function updateBadge(group, filterKey) {
        const badge = group.querySelector('.filter-badge');
        const count = activeFilters[filterKey].length;
        badge.textContent = count;
        badge.classList.toggle('visible', count > 0);
      }

      // Clear Filter Group
      function clearFilterGroup(filterKey, group) {
        activeFilters[filterKey] = [];
        group.querySelectorAll('.filter-option.active').forEach(opt => {
          opt.classList.remove('active');
          opt.querySelector('.filter-checkbox').textContent = '';
        });
        updateBadge(group, filterKey);
        currentPage = 1;
        applyFilters();
      }

      // Clear All Filters (global function)
      window.clearAllFilters = function() {
        activeFilters = { brand: [], material: [], color: [], style: [], search: '' };

        document.querySelectorAll('.filter-option.active').forEach(opt => {
          opt.classList.remove('active');
          opt.querySelector('.filter-checkbox').textContent = '';
        });

        document.querySelectorAll('.filter-badge').forEach(badge => {
          badge.classList.remove('visible');
        });

        const searchInput = document.getElementById('tile-search');
        if (searchInput) searchInput.value = '';

        currentPage = 1;
        applyFilters();
      };

      // Handle Search (global function)
      window.handleSearch = function(value) {
        activeFilters.search = value.toLowerCase();
        currentPage = 1;
        applyFilters();
      };

      // Format Name
      function formatName(value) {
        if (!value) return '';
        if (value === 'msi') return 'MSI';
        if (value === 'bravo-tile') return 'Bravo Tile';
        return value.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
      }

      // Apply Filters
      function applyFilters() {
        filteredTiles = allTiles.filter(tile => {
          // Search filter
          if (activeFilters.search) {
            const s = activeFilters.search;
            const match = (tile.name || '').toLowerCase().includes(s) ||
                          (tile.material || '').toLowerCase().includes(s) ||
                          (tile.type || '').toLowerCase().includes(s) ||
                          (tile.brand || '').toLowerCase().includes(s);
            if (!match) return false;
          }

          // Category filters
          if (activeFilters.material.length > 0 && !activeFilters.material.includes(tile.material)) return false;
          if (activeFilters.color.length > 0 && !activeFilters.color.includes(tile.primaryColor)) return false;
          if (activeFilters.style.length > 0 && !activeFilters.style.includes(tile.type)) return false;
          if (activeFilters.brand.length > 0 && !activeFilters.brand.includes(tile.brand)) return false;

          return true;
        });

        renderTiles();
        updateCount();
      }

      // Render Tiles
      function renderTiles() {
        const grid = document.getElementById('tile-grid');
        if (!grid) return;

        const tilesToShow = filteredTiles.slice(0, currentPage * CONFIG.itemsPerPage);

        if (tilesToShow.length === 0) {
          grid.innerHTML = `
            <div class="empty-state">
              <h3>No tiles found</h3>
              <p>Try adjusting your filters or search term.</p>
            </div>
          `;
          return;
        }

        grid.innerHTML = tilesToShow.map(tile => {
          const brandLabel = tile.brand === 'bravo-tile' ? 'Bravo Tile' :
                            tile.brand === 'msi' ? 'MSI' : tile.brand;
          return `
            <div class="tile-card">
              <a href="/tiles/${tile.slug}/">
                <div class="tile-image-wrapper">
                  <img src="${tile.primaryImage || '/images/placeholder-tile.jpg'}"
                       alt="${tile.name}"
                       loading="lazy"
                       onerror="this.src='/images/placeholder-tile.jpg'">
                </div>
                <div class="tile-info">
                  <div class="tile-name">${tile.name}</div>
                  <div class="tile-meta">${brandLabel}${tile.material ? ' · ' + tile.material : ''}</div>
                </div>
              </a>
            </div>
          `;
        }).join('');
      }

      // Update Count
      function updateCount() {
        const showing = Math.min(currentPage * CONFIG.itemsPerPage, filteredTiles.length);
        const showingEl = document.getElementById('count-showing');
        const totalEl = document.getElementById('count-total');
        if (showingEl) showingEl.textContent = showing;
        if (totalEl) totalEl.textContent = filteredTiles.length;
      }

      // Setup Infinite Scroll
      function setupInfiniteScroll() {
        const grid = document.getElementById('tile-grid');
        if (!grid || !grid.parentElement) return;

        const sentinel = document.createElement('div');
        sentinel.style.height = '1px';
        grid.parentElement.appendChild(sentinel);

        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              const totalPages = Math.ceil(filteredTiles.length / CONFIG.itemsPerPage);
              if (currentPage < totalPages) {
                currentPage++;
                renderTiles();
                updateCount();
              }
            }
          });
        }, { rootMargin: '200px' });

        observer.observe(sentinel);
      }

      // Activate Swipe Mode (global function for mobile)
      window.activateSwipeMode = function() {
        if (typeof SwipeCardsUniversal !== 'undefined' && SwipeCardsUniversal.init) {
          SwipeCardsUniversal.init({
            items: filteredTiles.map(tile => ({
              name: tile.name,
              image: tile.primaryImage || '/images/placeholder-tile.jpg',
              url: '/tiles/' + tile.slug + '/',
              brand: tile.brand === 'bravo-tile' ? 'Bravo Tile' : tile.brand === 'msi' ? 'MSI' : tile.brand
            }))
          });
        } else {
          console.warn('SwipeCardsUniversal not available');
        }
      };

      // Start
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
</body>
</html>
