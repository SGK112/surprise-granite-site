<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>My Account | Surprise Granite</title>
  <meta name="description" content="Manage your Surprise Granite account, view leads, and access your dashboard."/>
  <meta name="robots" content="noindex, nofollow"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://cdn.prod.website-files.com/6456ce4476abb25581fbad0c/6456ce4476abb269c6fbb176_Surprise-Granite-favicon-32x32px.png" rel="shortcut icon" type="image/x-icon"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet"/>
  <link href="/css/account/mobile-nav.css?v=20260119" rel="stylesheet"/>
  <!-- Google Maps API with Places library for address autocomplete and maps -->
  <script>
    // Stub for Google Maps callback - will be replaced/enhanced by main script
    var googleMapsReady = false;
    var googleMapsError = false;
    function initGoogleMaps() {
      console.log('[GoogleMaps] API loaded via callback');
      googleMapsReady = true;
      document.dispatchEvent(new CustomEvent('googlemaps-ready'));
    }
    // Handle Google Maps API errors gracefully
    window.gm_authFailure = function() {
      console.warn('[GoogleMaps] API authentication failed - maps features disabled');
      googleMapsError = true;
      googleMapsReady = false;
    };
  </script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAxOFaHXjn5lKZ4DKueRWdH0W-Cb9TOJZE&libraries=places&callback=initGoogleMaps" async defer onerror="googleMapsError=true;console.warn('[GoogleMaps] Failed to load API');"></script>
  <script src="/js/config.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3"></script>
  <script src="/js/supabase-init.js"></script>
  <script src="/js/sg-auth.js"></script>
  <script src="/js/auth-state.js"></script>
  <script src="/js/state-manager.js"></script>
  <script src="/js/shopify-cart.js"></script>
  <!-- Shepherd.js Tour Library -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/shepherd.js@13.0.3/dist/css/shepherd.css"/>
  <script src="https://cdn.jsdelivr.net/npm/shepherd.js@13.0.3/dist/js/shepherd.min.js"></script>
  <link href="/css/account/main.css?v=20260208" rel="stylesheet"/>
<!-- Unified Navigation -->
<link rel="stylesheet" href="/css/unified-nav.css?v=20260129">
<link rel="stylesheet" href="/css/account/context-menu.css?v=20260119">
<link rel="stylesheet" href="/css/account/dashboard-modern.css?v=20260120">
<script defer src="/js/unified-nav.js?v=20260201d"></script>

</head>
<body>
  <!-- Loading Screen -->
  <div id="loading-screen" class="loading-screen">
    <div style="text-align: center; margin-bottom: 20px;">
      <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #f9cb00, #cca600); border-radius: 16px; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 24px; color: #1a1a2e; margin: 0 auto 16px;">SG</div>
      <h1 style="color: #f9cb00; font-size: 24px; font-weight: 700; margin: 0;">Surprise Granite</h1>
      <p style="color: rgba(255,255,255,0.75); font-size: 14px; margin: 4px 0 0;">Client Portal</p>
    </div>
    <div class="spinner"></div>
    <p style="color: rgba(255,255,255,0.75);">Loading your account...</p>
  </div>

  <!-- Auth Screen -->
  <div id="auth-screen" class="auth-screen" style="display: none;">
    <div class="auth-card">
      <div class="auth-header">
        <div class="auth-logo">SG</div>
        <h1 id="auth-title">Welcome Back</h1>
        <p id="auth-subtitle">Sign in to access your account</p>
      </div>

      <div class="auth-tabs">
        <button class="auth-tab active" onclick="showAuthTab('login')">Sign In</button>
        <button class="auth-tab" onclick="showAuthTab('signup')">Create Account</button>
      </div>

      <div id="auth-message" class="auth-message"></div>

      <!-- Login Form -->
      <form id="login-form" class="auth-form active" onsubmit="handleLogin(event)">
        <div class="form-group">
          <label for="login-email">Email</label>
          <input type="email" id="login-email" required placeholder="you@example.com" autocomplete="email"/>
        </div>
        <div class="form-group">
          <label for="login-password">Password</label>
          <input type="password" id="login-password" required placeholder="Enter your password" autocomplete="current-password"/>
        </div>
        <button type="submit" class="auth-submit" id="login-btn">Sign In</button>

        <div class="auth-divider">
          <span>or continue with</span>
        </div>

        <button type="button" class="btn-google" onclick="handleGoogleLogin()">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="20" height="20">
            <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
            <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
            <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
            <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
          </svg>
          Sign in with Google
        </button>
      </form>

      <!-- Signup Form -->
      <form id="signup-form" class="auth-form" onsubmit="handleSignup(event)">
        <!-- Step 1: Account Type Selection -->
        <div class="signup-step" id="signup-step-1">
          <div class="step-header">
            <h3 class="step-title">Choose Your Account Type</h3>
            <p class="step-subtitle">Select the option that best describes you</p>
          </div>

          <div class="account-type-grid">
            <div class="account-type-card" data-type="homeowner" onclick="selectAccountType('homeowner')">
              <div class="type-icon">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                </svg>
              </div>
              <div class="type-name">Homeowner</div>
              <div class="type-desc">Shopping for countertops, tile, or flooring for your home</div>
              <ul class="type-features">
                <li><svg class="check-icon" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg> Save favorite materials</li>
                <li><svg class="check-icon" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg> Get free estimates</li>
                <li><svg class="check-icon" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg> List up to 3 remnants</li>
              </ul>
              <div class="type-badge free">Free</div>
            </div>

            <div class="account-type-card" data-type="pro_fabricator" onclick="selectAccountType('pro_fabricator')">
              <div class="type-icon pro">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/>
                </svg>
              </div>
              <div class="type-name">Pro Fabricator</div>
              <div class="type-desc">Countertop fabricators, installers, and stone professionals</div>
              <ul class="type-features">
                <li><svg class="check-icon gold" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg> <strong>Unlimited</strong> remnant listings</li>
                <li><svg class="check-icon gold" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg> Pro verified badge</li>
                <li><svg class="check-icon gold" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg> Priority in marketplace</li>
                <li><svg class="check-icon gold" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg> Business profile page</li>
              </ul>
              <div class="type-badge pro">Pro</div>
            </div>

            <div class="account-type-card" data-type="pro_designer" onclick="selectAccountType('pro_designer')">
              <div class="type-icon pro">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4.098 19.902a3.75 3.75 0 005.304 0l6.401-6.402M6.75 21A3.75 3.75 0 013 17.25V4.125C3 3.504 3.504 3 4.125 3h5.25c.621 0 1.125.504 1.125 1.125v4.072M6.75 21a3.75 3.75 0 003.75-3.75V8.197M6.75 21h13.125c.621 0 1.125-.504 1.125-1.125v-5.25c0-.621-.504-1.125-1.125-1.125h-4.072M10.5 8.197l2.88-2.88c.438-.439 1.15-.439 1.59 0l3.712 3.713c.44.44.44 1.152 0 1.59l-2.879 2.88M6.75 17.25h.008v.008H6.75v-.008z"/>
                </svg>
              </div>
              <div class="type-name">Designer / Architect</div>
              <div class="type-desc">Interior designers, architects, and design professionals</div>
              <ul class="type-features">
                <li><svg class="check-icon gold" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg> Create client mood boards</li>
                <li><svg class="check-icon gold" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg> Trade pricing access</li>
                <li><svg class="check-icon gold" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg> Designer verified badge</li>
                <li><svg class="check-icon gold" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg> Project management tools</li>
              </ul>
              <div class="type-badge pro">Pro</div>
            </div>
          </div>

          <input type="hidden" id="signup-account-type" value="homeowner"/>
          <button type="button" class="auth-submit" id="continue-to-details" onclick="goToSignupStep(2)">Continue</button>
        </div>

        <!-- Step 2: Account Details -->
        <div class="signup-step" id="signup-step-2" style="display: none;">
          <div class="step-header">
            <button type="button" class="step-back" onclick="goToSignupStep(1)">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" width="20" height="20">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
              </svg>
              Back
            </button>
            <h3 class="step-title">Create Your Account</h3>
            <p class="step-subtitle" id="selected-type-label">Homeowner Account</p>
          </div>

          <div class="form-group">
            <label for="signup-name">Full Name</label>
            <input type="text" id="signup-name" required placeholder="John Smith" autocomplete="name"/>
          </div>
          <div class="form-group">
            <label for="signup-email">Email</label>
            <input type="email" id="signup-email" required placeholder="you@example.com" autocomplete="email"/>
          </div>
          <div class="form-group">
            <label for="signup-password">Password</label>
            <input type="password" id="signup-password" required minlength="6" placeholder="At least 6 characters" autocomplete="new-password"/>
          </div>
          <div class="form-group">
            <label for="signup-phone">Phone (Optional)</label>
            <input type="tel" id="signup-phone" placeholder="(555) 123-4567" autocomplete="tel"/>
          </div>

          <!-- Pro account fields -->
          <div id="pro-fields" style="display: none;">
            <div class="form-group">
              <label for="signup-business-name">Business Name</label>
              <input type="text" id="signup-business-name" placeholder="Your Company Name" autocomplete="organization"/>
            </div>
            <div class="form-group">
              <label for="signup-business-location">Business Location</label>
              <input type="text" id="signup-business-location" placeholder="City, State" autocomplete="address-level2"/>
            </div>
          </div>

          <div class="signup-terms">
            <label class="checkbox-label">
              <input type="checkbox" id="signup-terms" required/>
              <span>I agree to the <a href="/terms/" target="_blank">Terms of Service</a> and <a href="/privacy/" target="_blank">Privacy Policy</a></span>
            </label>
          </div>

          <button type="submit" class="auth-submit" id="signup-btn">Create Account</button>

          <div class="pro-note" id="pro-upgrade-note" style="display: none;">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" width="16" height="16">
              <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <span>Pro accounts require verification. You'll receive an email to complete your business verification.</span>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Main Dashboard -->
  <div id="dashboard-app" style="display: none;">
    <div class="sidebar-overlay" onclick="toggleSidebar()"></div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <a href="/" class="sidebar-logo">
          <div class="sidebar-logo-icon">SG</div>
          <div>
            <div class="sidebar-logo-text">Surprise Granite</div>
            <div class="sidebar-logo-sub"><span id="account-type-label">Account</span></div>
          </div>
        </a>
        <button class="sidebar-collapse-btn" onclick="toggleSidebarCollapse()" title="Collapse Sidebar">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"/>
          </svg>
        </button>
      </div>

      <nav class="sidebar-nav">
        <!-- Home Section -->
        <div class="nav-section">
          <a class="nav-item active" data-page="dashboard" onclick="showPage('dashboard')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
            <span class="nav-item-text">Dashboard</span>
          </a>
        </div>

        <!-- My Account Section -->
        <div class="nav-section">
          <div class="nav-section-title">My Account</div>
          <a class="nav-item" data-page="profile" onclick="showPage('profile')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
            <span class="nav-item-text">Profile</span>
          </a>
          <a class="nav-item" data-page="favorites" onclick="showPage('favorites')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>
            <span class="nav-item-text">Favorites</span>
            <span class="nav-badge" id="favorites-count" data-count="0">0</span>
          </a>
          <a class="nav-item" data-page="my-designs" onclick="showPage('my-designs')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
            <span class="nav-item-text">My Designs</span>
            <span class="nav-badge" id="designs-count" data-count="0">0</span>
          </a>
          <a class="nav-item" data-page="listings" onclick="showPage('listings')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>
            <span class="nav-item-text">My Listings</span>
            <span class="nav-badge" id="listings-count" data-count="0">0</span>
          </a>
          <a class="nav-item" href="/cart/">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
            <span class="nav-item-text">Shopping Cart</span>
            <span class="nav-badge" id="account-cart-count" data-count="0">0</span>
          </a>
        </div>

        <!-- Tools Section -->
        <div class="nav-section">
          <div class="nav-section-title">Tools</div>
          <a class="nav-item" data-page="tools" onclick="showPage('tools')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>
            <span class="nav-item-text">Design Tools</span>
          </a>
          <a class="nav-item" href="/tools/countertop-calculator/" target="_blank">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
            <span class="nav-item-text">Calculator</span>
          </a>
          <a class="nav-item" href="/tools/room-designer/" target="_blank">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/></svg>
            <span class="nav-item-text">Room Designer</span>
          </a>
        </div>

        <!-- Sales Section (Admin/Contractor) -->
        <div class="nav-section hidden" id="sales-nav">
          <div class="nav-section-title">Sales</div>
          <a class="nav-item" data-page="leads" onclick="showPage('leads')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>
            <span class="nav-item-text">Leads</span>
            <span class="nav-badge" id="leads-count" data-count="0">0</span>
          </a>
          <a class="nav-item" data-page="customers" onclick="showPage('customers')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
            <span class="nav-item-text">Customers</span>
            <span class="nav-badge" id="customers-count" data-count="0">0</span>
          </a>
          <a class="nav-item" data-page="estimates" onclick="showPage('estimates')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
            <span class="nav-item-text">Estimates</span>
            <span class="nav-badge" id="estimates-count" data-count="0">0</span>
          </a>
          <a class="nav-item" data-page="invoices" onclick="showPage('invoices')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
            <span class="nav-item-text">Invoices</span>
          </a>
        </div>

        <!-- Operations Section (Admin/Contractor) -->
        <div class="nav-section hidden" id="operations-nav">
          <div class="nav-section-title">Operations <span class="new-feature-badge">NEW</span></div>
          <a class="nav-item" data-page="projects" onclick="showPage('projects')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg>
            <span class="nav-item-text">Projects</span>
                        <span class="nav-badge" id="projects-count" data-count="0">0</span>
          </a>
          <a class="nav-item" data-page="jobs" onclick="showPage('jobs')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
            <span class="nav-item-text">Jobs</span>
                        <span class="nav-badge" id="jobs-count" data-count="0">0</span>
          </a>
          <a class="nav-item" data-page="calendar" onclick="showPage('calendar')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
            <span class="nav-item-text">Calendar</span>
                      </a>
          <a class="nav-item" data-page="collaborators" onclick="showPage('collaborators')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
            <span class="nav-item-text">Team</span>
                      </a>
        </div>

        <!-- Finance Section (Admin Only) -->
        <div class="nav-section hidden" id="finance-nav">
          <div class="nav-section-title">Finance</div>
          <a class="nav-item" data-page="wallet" onclick="showPage('wallet')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
            <span class="nav-item-text">Wallet</span>
          </a>
        </div>

        <!-- Admin Section (Super Admin Only) -->
        <div class="nav-section hidden" id="admin-nav">
          <div class="nav-section-title">Admin</div>
          <a class="nav-item" data-page="admin-users" onclick="showPage('admin-users')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
            <span class="nav-item-text">Manage Users</span>
          </a>
        </div>

        <!-- GOD MODE Section (GOD_MODE_EMAILS ONLY) -->
        <div class="nav-section hidden" id="god-mode-nav" style="display: none; background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(236, 72, 153, 0.1) 100%); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 8px; margin: 4px 0; padding: 6px 0; overflow: hidden;">
          <div class="nav-section-title" style="color: #a855f7; font-weight: bold;">
            <span style="margin-right: 6px;">âš¡</span> GOD MODE
          </div>
          <a class="nav-item" data-page="god-mode" onclick="showPage('god-mode')" style="background: rgba(139, 92, 246, 0.1);">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
            <span class="nav-item-text">Developer Tools</span>
          </a>
          <a class="nav-item" data-page="god-users" onclick="showPage('god-users')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
            <span class="nav-item-text">All Users</span>
          </a>
          <a class="nav-item" data-page="god-marketplace" onclick="showPage('god-marketplace')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
            <span class="nav-item-text">Marketplace</span>
          </a>
          <a class="nav-item" data-page="god-database" onclick="showPage('god-database')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"/></svg>
            <span class="nav-item-text">Database</span>
          </a>
          <a class="nav-item" data-page="god-api" onclick="showPage('god-api')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
            <span class="nav-item-text">API Tester</span>
          </a>
          <a class="nav-item" data-page="god-logs" onclick="showPage('god-logs')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
            <span class="nav-item-text">System Logs</span>
          </a>
          <a class="nav-item" data-page="god-designs" onclick="showPage('god-designs')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
            <span class="nav-item-text">Designs</span>
          </a>
          <div style="height: 1px; background: rgba(139, 92, 246, 0.2); margin: 8px 0;"></div>
          <a class="nav-item" data-page="god-analytics" onclick="showPage('god-analytics')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
            <span class="nav-item-text">Analytics</span>
          </a>
          <a class="nav-item" data-page="god-site" onclick="showPage('god-site')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/></svg>
            <span class="nav-item-text">Site Manager</span>
          </a>
          <a class="nav-item" data-page="god-config" onclick="showPage('god-config')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
            <span class="nav-item-text">Config</span>
          </a>
        </div>

        <!-- Store Section (Vendor) -->
        <div class="nav-section hidden" id="vendor-nav">
          <div class="nav-section-title">Store</div>
          <a class="nav-item" data-page="products" onclick="showPage('products')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/></svg>
            <span class="nav-item-text">Products</span>
          </a>
          <a class="nav-item" data-page="orders" onclick="showPage('orders')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/></svg>
            <span class="nav-item-text">Orders</span>
          </a>
          <a class="nav-item" data-page="messages" onclick="showPage('messages')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
            <span class="nav-item-text">Messages</span>
          </a>
        </div>
      </nav>

      <div class="sidebar-footer">
        <div class="user-menu">
          <div class="user-avatar" id="user-avatar">?</div>
          <div class="user-info">
            <div class="user-name" id="user-name">User</div>
            <div class="user-role" id="user-role">Member</div>
          </div>
          <button class="logout-btn" onclick="handleLogout()" title="Sign Out">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
          </button>
        </div>
      </div>
    </aside>

    <!-- Quick Actions Toolbar (Left Side) -->
    <div class="page-toolbar" id="page-toolbar">
      <div class="toolbar-section">
        <button class="toolbar-btn" onclick="openAddLeadModal()" title="Add Lead">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>
        </button>
        <button class="toolbar-btn" onclick="openNewProjectModal()" title="New Project">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
        </button>
        <button class="toolbar-btn" onclick="openCalendarEventModal()" title="Add Event">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
        </button>
        <button class="toolbar-btn" onclick="openInvoiceModal()" title="Create Invoice">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 14l6-6m-5.5.5h.01m4.99 5h.01M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16l3.5-2 3.5 2 3.5-2 3.5 2z"/></svg>
        </button>
      </div>
      <div class="toolbar-divider"></div>
      <div class="toolbar-section">
        <button class="toolbar-btn" data-page="leads" onclick="showPage('leads')" title="View Leads">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
        </button>
        <button class="toolbar-btn" data-page="projects" onclick="showPage('projects')" title="View Projects">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>
        </button>
        <button class="toolbar-btn" data-page="calendar" onclick="showPage('calendar')" title="View Calendar">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
        </button>
        <button class="toolbar-btn" data-page="finance" onclick="showPage('finance')" title="View Finance">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
        </button>
      </div>
      <div style="flex: 1;"></div>
      <div class="toolbar-section">
        <button class="toolbar-btn" onclick="showKeyboardShortcuts()" title="Keyboard Shortcuts (?)">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
        </button>
      </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
      <div class="topbar">
        <button class="mobile-menu-btn" onclick="toggleSidebar()">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/></svg>
        </button>
        <h1 class="topbar-title" id="page-title">Dashboard</h1>
        <div class="topbar-actions">
          <!-- Role Switcher (for demo/testing - remove in production) -->
          <div id="role-switcher" style="margin-right: 12px;">
            <select id="role-select" onchange="switchRole(this.value)" style="padding: 8px 12px; border-radius: 6px; background: var(--dark-elevated); border: 1px solid var(--border-subtle); color: var(--text-primary); font-size: 13px; cursor: pointer;" aria-label="Switch user role">
              <option value="homeowner">Homeowner View</option>
              <option value="customer">Customer View</option>
              <option value="pro">Pro View</option>
              <option value="contractor">Contractor View</option>
              <option value="fabricator">Fabricator View</option>
              <option value="vendor">Vendor View</option>
              <option value="distributor">Distributor/Stone Yard View</option>
              <option value="admin">Admin View (GOD)</option>
            </select>
          </div>
          <!-- Notification Bell -->
          <div class="notification-bell-wrapper" style="position: relative; margin-right: 8px;">
            <button class="btn-modern ghost" onclick="toggleNotificationPanel()" title="Notifications" style="position: relative; padding: 8px;">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
              </svg>
              <span id="notification-badge" class="notification-badge" style="display: none; position: absolute; top: 2px; right: 2px; background: #ef4444; color: white; font-size: 10px; font-weight: 600; min-width: 16px; height: 16px; border-radius: 8px; align-items: center; justify-content: center;">0</span>
            </button>
            <!-- Notification Dropdown Panel -->
            <div id="notification-panel" class="notification-panel" style="display: none; position: absolute; top: 100%; right: 0; margin-top: 8px; width: 360px; max-height: 480px; background: var(--dark-surface); border: 1px solid var(--border-subtle); border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.4); z-index: 1000; overflow: hidden;">
              <div style="padding: 16px; border-bottom: 1px solid var(--border-subtle); display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin: 0; font-size: 16px; font-weight: 600;">Notifications</h3>
                <div style="display: flex; gap: 12px; align-items: center;">
                  <button onclick="sendDailyDigest()" style="background: none; border: none; color: var(--text-muted); font-size: 12px; cursor: pointer; display: flex; align-items: center; gap: 4px;" title="Send daily summary to your email">
                    <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                    Digest
                  </button>
                  <button onclick="markAllNotificationsRead()" style="background: none; border: none; color: var(--accent); font-size: 13px; cursor: pointer;">Mark all read</button>
                </div>
              </div>
              <div id="notification-list" style="max-height: 380px; overflow-y: auto;">
                <div class="empty-state" style="padding: 40px 20px; text-align: center;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" style="color: var(--text-muted); margin-bottom: 12px;">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                  </svg>
                  <p style="color: var(--text-muted); margin: 0;">No new notifications</p>
                </div>
              </div>
            </div>
          </div>
          <button class="btn-modern primary" onclick="openAddLeadModal()" title="Add New Lead">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
            <span class="btn-text">Add New Lead</span>
          </button>
        </div>
      </div>

      <div class="content-area">
        <!-- Dashboard Page -->
        <section id="page-dashboard" class="page-section active">
          <div class="stats-grid" id="dashboard-stats">
            <!-- Filled by JS based on role -->
          </div>

          <div id="vendor-onboarding-banner" style="display: none;"></div>

          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Quick Actions</h3>
            </div>
            <div class="card-body">
              <div class="quick-actions" id="quick-actions">
                <!-- Filled by JS based on role -->
              </div>
            </div>
          </div>

          <!-- Needs Attention Widget (Admin only) -->
          <div class="card" id="needs-attention-card" style="display: none;">
            <div class="card-header">
              <h3 class="card-title">Needs Attention</h3>
              <button class="btn-modern ghost" onclick="refreshNeedsAttention()" style="padding: 6px 12px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
              </button>
            </div>
            <div class="card-body" id="needs-attention-content">
              <div style="text-align: center; padding: 20px; color: var(--text-muted);">
                <div class="spinner" style="margin: 0 auto 12px;"></div>
                Loading...
              </div>
            </div>
          </div>

          <!-- Field Status Widget (Admin only) - Shows en route and on site projects -->
          <div class="card" id="field-status-card" style="display: none;">
            <div class="card-header">
              <h3 class="card-title" style="display: flex; align-items: center; gap: 8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="#f59e0b" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                Field Status
              </h3>
              <button class="btn-modern ghost" onclick="refreshFieldStatus()" style="padding: 6px 12px; font-size: 12px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
                Refresh
              </button>
            </div>
            <div class="card-body" id="field-status-content" style="padding: 0;">
              <div style="text-align: center; padding: 20px; color: var(--text-muted);">Loading field status...</div>
            </div>
          </div>

          <!-- Today's Schedule Widget (Admin only) -->
          <div class="card" id="today-schedule-card" style="display: none;">
            <div class="card-header">
              <h3 class="card-title">Today's Schedule</h3>
              <button class="btn-modern primary" onclick="showPage('calendar'); setTimeout(() => openCalendarEventModal(), 200);" style="padding: 6px 12px; font-size: 12px;">
                + Add Event
              </button>
            </div>
            <div class="card-body" id="today-schedule-content">
              <div style="text-align: center; padding: 20px; color: var(--text-muted);">Loading...</div>
            </div>
          </div>
        </section>

        <!-- Profile Page -->
        <section id="page-profile" class="page-section">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Profile Information</h3>
              <button class="btn-modern primary" onclick="saveProfile()">Save Changes</button>
            </div>
            <div class="card-body">
              <form id="profile-form">
                <div class="form-row">
                  <div class="form-group">
                    <label for="profile-name">Full Name</label>
                    <input type="text" id="profile-name" placeholder="Your name" autocomplete="name"/>
                  </div>
                  <div class="form-group">
                    <label for="profile-email">Email</label>
                    <input type="email" id="profile-email" readonly style="opacity: 0.6;" autocomplete="email"/>
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label for="profile-phone">Phone</label>
                    <input type="tel" id="profile-phone" placeholder="(555) 123-4567" autocomplete="tel"/>
                  </div>
                  <div class="form-group">
                    <label for="profile-company">Company (Optional)</label>
                    <input type="text" id="profile-company" placeholder="Your company" autocomplete="organization"/>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </section>

        <!-- Favorites Page -->
        <section id="page-favorites" class="page-section">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Your Favorites</h3>
              <div style="display: flex; gap: 12px; align-items: center;">
                <button class="btn-modern secondary" onclick="clearAllFavoritesConfirm()" id="clear-all-btn" style="display: none; color: #f87171; border-color: rgba(248,113,113,0.3);">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px;"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                  Clear All
                </button>
                <button class="btn-modern primary" onclick="requestQuoteForFavorites()" id="request-quote-btn" style="display: none;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px;"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                  Request Quote
                </button>
              </div>
            </div>
            <div class="card-body">
              <p style="color: #666; margin-bottom: 20px;">Browse materials on your phone and swipe right to save your favorites. They'll appear here!</p>

              <div id="favorites-loading" style="display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 40px;">
                <div class="spinner"></div>
                <p style="color: var(--text-muted); margin-top: 12px;">Loading your favorites...</p>
              </div>

              <div id="favorites-empty" style="display: none; text-align: center; padding: 40px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#ccc" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>
                <h3 style="color: #666; margin: 16px 0 8px;">No Favorites Yet</h3>
                <p style="color: #999; margin-bottom: 20px;">Browse our collections on your phone and swipe right to save your favorites!</p>
                <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                  <a href="/materials/flooring/" class="btn-modern primary">Browse Flooring</a>
                  <a href="/marketplace/slabs//" class="btn-modern secondary">Browse Countertops</a>
                </div>
              </div>

              <!-- Countertops Section -->
              <div id="favorites-countertops" style="display: none; margin-bottom: 32px;">
                <h4 style="color: #1a1a2e; margin-bottom: 16px; font-size: 18px; display: flex; align-items: center; gap: 8px;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#f9cb00" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="3" y1="9" x2="21" y2="9"/></svg>
                  Countertops
                  <span id="countertops-section-count" style="background: #f9cb00; color: #1a1a2e; padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">0</span>
                </h4>
                <div id="favorites-countertops-grid" class="saved-floors-grid"></div>
              </div>

              <!-- Flooring Section -->
              <div id="favorites-flooring" style="display: none; margin-bottom: 32px;">
                <h4 style="color: #1a1a2e; margin-bottom: 16px; font-size: 18px; display: flex; align-items: center; gap: 8px;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#f9cb00" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                  Flooring
                  <span id="flooring-section-count" style="background: #f9cb00; color: #1a1a2e; padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">0</span>
                </h4>
                <div id="favorites-flooring-grid" class="saved-floors-grid"></div>
              </div>

              <!-- Tile Section -->
              <div id="favorites-tile" style="display: none; margin-bottom: 32px;">
                <h4 style="color: #1a1a2e; margin-bottom: 16px; font-size: 18px; display: flex; align-items: center; gap: 8px;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#f9cb00" stroke-width="2"><path d="M3 3h7v7H3z M14 3h7v7h-7z M3 14h7v7H3z M14 14h7v7h-7z"/></svg>
                  Tile
                  <span id="tile-section-count" style="background: #f9cb00; color: #1a1a2e; padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">0</span>
                </h4>
                <div id="favorites-tile-grid" class="saved-floors-grid"></div>
              </div>

              <!-- Shop Section -->
              <div id="favorites-shop" style="display: none;">
                <h4 style="color: #1a1a2e; margin-bottom: 16px; font-size: 18px; display: flex; align-items: center; gap: 8px;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#f9cb00" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/></svg>
                  Shop Products
                  <span id="shop-section-count" style="background: #f9cb00; color: #1a1a2e; padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">0</span>
                </h4>
                <div id="favorites-shop-grid" class="saved-floors-grid"></div>
              </div>
            </div>
          </div>
        </section>

        <!-- My Designs Page (Room Designer) -->
        <section id="page-my-designs" class="page-section">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">My Designs</h3>
              <div style="display: flex; gap: 12px; align-items: center;">
                <select id="designs-filter" onchange="filterDesigns()" style="padding: 8px 12px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-secondary);">
                  <option value="all">All Designs</option>
                  <option value="shared">Shared</option>
                  <option value="private">Private</option>
                  <option value="with-messages">With Messages</option>
                </select>
                <button class="btn-modern secondary" onclick="openInviteToProjectModal(null, '', 'designer')">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>
                  Invite Collaborator
                </button>
                <a href="/tools/room-designer/" class="btn-modern primary">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
                  New Design
                </a>
              </div>
            </div>
            <div class="card-body">
              <p style="color: var(--text-muted); margin-bottom: 20px;">
                Create kitchen and bathroom layouts with the Room Designer. Your saved designs appear here.
              </p>

              <div id="designs-loading" style="display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 40px;">
                <div class="spinner"></div>
                <p style="color: var(--text-muted); margin-top: 12px;">Loading your designs...</p>
              </div>

              <div id="designs-empty" style="display: none; text-align: center; padding: 40px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#ccc" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
                <h3 style="color: #666; margin: 16px 0 8px;">No Designs Yet</h3>
                <p style="color: #999; margin-bottom: 20px;">Create your first kitchen or bathroom design with our Room Designer tool!</p>
                <a href="/tools/room-designer/" class="btn-modern primary">Open Room Designer</a>
              </div>

              <div id="designs-grid" class="designs-grid" style="display: none;"></div>
            </div>
          </div>
        </section>

        <!-- My Listings Page (Remnants Marketplace) -->
        <section id="page-listings" class="page-section">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">My Listings</h3>
              <div style="display: flex; align-items: center; gap: 12px;">
                <span id="listing-limit-indicator" style="font-size: 13px; color: var(--text-muted);"></span>
                <button class="btn-modern primary" onclick="openCreateListingModal()" id="create-listing-btn">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
                  Create Listing
                </button>
              </div>
            </div>
            <div class="card-body">
              <p style="color: var(--text-muted); margin-bottom: 20px;">
                List your stone remnants here. Other users can find and contact you about materials you have available.
                <a href="/remnants/" style="color: var(--gold-primary);">Browse the marketplace â†’</a>
              </p>

              <div id="listings-loading" style="display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 40px;">
                <div class="spinner"></div>
                <p style="color: var(--text-muted); margin-top: 12px;">Loading your listings...</p>
              </div>

              <div id="listings-empty" style="display: none; text-align: center; padding: 40px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="var(--text-muted)" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>
                <h3 style="color: var(--text-secondary); margin: 16px 0 8px;">No Listings Yet</h3>
                <p style="color: var(--text-muted); margin-bottom: 20px;">Have materials to sell? List countertops, tile, flooring, cabinets, or supplies!</p>
                <button class="btn-modern primary" onclick="openCreateListingModal()">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
                  Create Your First Listing
                </button>
              </div>

              <div id="listings-grid" class="listings-grid" style="display: none;"></div>
            </div>
          </div>

          <!-- Inquiries Section -->
          <div class="card" style="margin-top: 24px;">
            <div class="card-header">
              <h3 class="card-title">Incoming Inquiries</h3>
              <span class="nav-badge" id="inquiries-badge" style="display: none;">0</span>
            </div>
            <div class="card-body">
              <div id="inquiries-loading" style="display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 40px;">
                <div class="spinner"></div>
                <p style="color: var(--text-muted); margin-top: 12px;">Loading inquiries...</p>
              </div>
              <div id="inquiries-empty" style="display: none; text-align: center; padding: 40px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="var(--text-muted)" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/></svg>
                <h3 style="color: var(--text-secondary); margin: 16px 0 8px;">No Inquiries Yet</h3>
                <p style="color: var(--text-muted); margin-bottom: 0;">When someone contacts you about a listing, it will appear here.</p>
              </div>
              <div id="inquiries-list" style="display: none;"></div>
            </div>
          </div>
        </section>

        <!-- Collaborations Page -->
        <section id="page-collaborations" class="page-section">
          <!-- Collaboration Tabs -->
          <div class="collab-tabs" style="display: flex; gap: 8px; margin-bottom: 20px;">
            <button class="collab-tab active" onclick="switchCollabTab('collaborations')" id="tab-collaborations" style="padding: 10px 20px; border: none; background: var(--gold-primary); color: #1a1a2e; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s;">
              Project Collaborations
            </button>
            <button class="collab-tab" onclick="switchCollabTab('network')" id="tab-network" style="padding: 10px 20px; border: 1px solid var(--border-subtle); background: var(--dark-surface); color: var(--text-secondary); border-radius: 8px; font-weight: 500; cursor: pointer; transition: all 0.2s;">
              My Network <span id="network-count-badge" style="display: none; margin-left: 6px; background: var(--gold-primary); color: #1a1a2e; padding: 2px 8px; border-radius: 10px; font-size: 11px;"></span>
            </button>
            <button class="collab-tab" onclick="switchCollabTab('invitations')" id="tab-invitations" style="padding: 10px 20px; border: 1px solid var(--border-subtle); background: var(--dark-surface); color: var(--text-secondary); border-radius: 8px; font-weight: 500; cursor: pointer; transition: all 0.2s;">
              Pending Invites <span id="invitations-count-badge" style="display: none; margin-left: 6px; background: var(--warning); color: #1a1a2e; padding: 2px 8px; border-radius: 10px; font-size: 11px;"></span>
            </button>
          </div>

          <!-- Project Collaborations Tab -->
          <div id="collab-tab-collaborations" class="collab-tab-content">
            <!-- Activity Feed -->
            <div class="card" style="margin-bottom: 20px;">
              <div class="card-header">
                <h3 class="card-title" style="display: flex; align-items: center; gap: 8px;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                  Recent Activity
                </h3>
                <button class="btn-modern ghost" onclick="loadCollaborationActivity()" style="padding: 6px 10px;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
                </button>
              </div>
              <div class="card-body" style="padding: 0;">
                <div id="collaboration-activity-feed" style="max-height: 200px; overflow-y: auto;">
                  <div style="padding: 24px; text-align: center; color: var(--text-muted); font-size: 13px;">
                    Activity from shared projects will appear here
                  </div>
                </div>
              </div>
            </div>

            <!-- Active Collaborations -->
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">Active Projects</h3>
                <button class="btn-modern primary" onclick="openInviteToProjectModal()">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>
                  Invite to Project
                </button>
              </div>
              <div class="card-body">
                <div id="collaborations-list">
                  <div class="empty-state">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" style="width: 48px; height: 48px; margin-bottom: 12px;"><path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                    <h3>No collaborations yet</h3>
                    <p>When you're invited to collaborate on projects, they'll appear here.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- My Network Tab (General Collaborators) -->
          <div id="collab-tab-network" class="collab-tab-content" style="display: none;">
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">My Network</h3>
                <button class="btn-modern primary" onclick="openInviteToNetworkModal()">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>
                  Invite to Network
                </button>
              </div>
              <div class="card-body">
                <p style="color: var(--text-muted); font-size: 13px; margin-bottom: 16px;">
                  Build your professional network. Invite designers, fabricators, collaborators, and partners - they can later be assigned to specific projects.
                </p>
                <div id="network-list">
                  <div class="empty-state">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" style="width: 48px; height: 48px; margin-bottom: 12px;"><path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/></svg>
                    <h3>No network contacts yet</h3>
                    <p>Invite colleagues, vendors, and partners to build your professional network.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Pending Invitations Tab -->
          <div id="collab-tab-invitations" class="collab-tab-content" style="display: none;">
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">Pending Invitations</h3>
              </div>
              <div class="card-body">
                <p style="color: var(--text-muted); font-size: 13px; margin-bottom: 16px;">
                  Invitations you've received to join projects or networks.
                </p>
                <div id="received-invitations-list">
                  <div class="empty-state">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" style="width: 48px; height: 48px; margin-bottom: 12px;"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                    <h3>No pending invitations</h3>
                    <p>When someone invites you to collaborate, it will appear here.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Design Tools Page -->
        <section id="page-tools" class="page-section">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Design Tools</h3>
              <p style="color: var(--text-muted); font-size: 14px; margin: 0;">Professional design tools for your projects</p>
            </div>
            <div class="card-body">
              <div class="tools-grid">
                <!-- Room Designer Pro -->
                <a href="/tools/room-designer/" class="tool-card featured">
                  <div class="tool-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                    </svg>
                  </div>
                  <div class="tool-info">
                    <h4>Room Designer Pro</h4>
                    <p>2D/3D kitchen & bath design with instant quotes</p>
                    <span class="tool-badge featured">Featured</span>
                  </div>
                </a>

                <!-- Visualizer -->
                <a href="/tools/visualizer/" class="tool-card">
                  <div class="tool-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                  </div>
                  <div class="tool-info">
                    <h4>Stone Visualizer</h4>
                    <p>See how materials look in your space</p>
                  </div>
                </a>

                <!-- Blueprint Takeoff -->
                <a href="/tools/blueprint-takeoff/" class="tool-card">
                  <div class="tool-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                  </div>
                  <div class="tool-info">
                    <h4>Blueprint Takeoff</h4>
                    <p>Extract measurements from blueprints</p>
                  </div>
                </a>

                <!-- Virtual Kitchen -->
                <a href="/tools/virtual-kitchen-design-tool/" class="tool-card">
                  <div class="tool-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                    </svg>
                  </div>
                  <div class="tool-info">
                    <h4>Virtual Kitchen</h4>
                    <p>Design your kitchen with drag & drop</p>
                  </div>
                </a>

                <!-- Virtual Bathroom -->
                <a href="/tools/virtual-bathroom-design-tool/" class="tool-card">
                  <div class="tool-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M8 14v3m4-3v3m4-3v3M3 21h18M3 10h18M3 7l9-4 9 4M4 10h16v11H4V10z"/>
                    </svg>
                  </div>
                  <div class="tool-info">
                    <h4>Virtual Bathroom</h4>
                    <p>Design your bathroom space</p>
                  </div>
                </a>

                <!-- Multi-Surface Visualizer -->
                <a href="/tools/multi-surface-room-visualizer/" class="tool-card">
                  <div class="tool-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"/>
                    </svg>
                  </div>
                  <div class="tool-info">
                    <h4>Multi-Surface Visualizer</h4>
                    <p>Visualize counters, floors, and backsplash</p>
                  </div>
                </a>

                <!-- Edge Profile Visualizer -->
                <a href="/tools/countertop-edge-visualizer/" class="tool-card">
                  <div class="tool-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"/>
                    </svg>
                  </div>
                  <div class="tool-info">
                    <h4>Edge Profile Visualizer</h4>
                    <p>Compare countertop edge profiles</p>
                  </div>
                </a>

                <!-- Interior Gallery -->
                <a href="/tools/interior-design-gallery/" class="tool-card">
                  <div class="tool-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                    </svg>
                  </div>
                  <div class="tool-info">
                    <h4>Design Gallery</h4>
                    <p>Browse interior design inspiration</p>
                  </div>
                </a>
              </div>

              <!-- Calculators Section -->
              <div style="margin-top: 40px; padding-top: 24px; border-top: 1px solid var(--border-subtle);">
                <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: var(--text-secondary);">Calculators</h3>
                <div class="tools-grid calculators-grid">
                  <a href="/tools/countertop-calculator/" class="tool-card calculator" target="_blank">
                    <div class="tool-icon small">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                      </svg>
                    </div>
                    <div class="tool-info">
                      <h4>Countertop Calculator</h4>
                      <p>Calculate material needs</p>
                    </div>
                  </a>
                  <a href="/tools/tile-calculator/" class="tool-card calculator" target="_blank">
                    <div class="tool-icon small">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>
                      </svg>
                    </div>
                    <div class="tool-info">
                      <h4>Tile Calculator</h4>
                      <p>Plan your tile project</p>
                    </div>
                  </a>
                  <a href="/tools/flooring-calculator/" class="tool-card calculator" target="_blank">
                    <div class="tool-icon small">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"/>
                      </svg>
                    </div>
                    <div class="tool-info">
                      <h4>Flooring Calculator</h4>
                      <p>Estimate flooring needs</p>
                    </div>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Leads Page (Admin Only) -->
        <section id="page-leads" class="page-section">
          <div class="table-container">
            <div class="table-header" style="flex-direction: column; align-items: stretch; gap: 16px;">
              <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;">
                <h2 class="table-title">All Leads</h2>
                <div style="display: flex; align-items: center; gap: 12px;">
                  <!-- View Toggle Buttons -->
                  <div class="view-toggle" style="display: flex; background: var(--dark-surface); border-radius: 8px; padding: 4px; gap: 2px;">
                    <button onclick="setLeadsView('grid')" id="leads-view-grid" class="view-btn active" title="Grid View" style="padding: 8px 12px; border: none; background: var(--gold-primary); color: var(--dark-primary); border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 6px; font-size: 13px; font-weight: 600; transition: all 0.2s;">
                      <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/></svg>
                      Grid
                    </button>
                    <button onclick="setLeadsView('list')" id="leads-view-list" class="view-btn" title="List View" style="padding: 8px 12px; border: none; background: transparent; color: var(--text-secondary); border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 6px; font-size: 13px; font-weight: 600; transition: all 0.2s;">
                      <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 10h16M4 14h16M4 18h16"/></svg>
                      List
                    </button>
                    <button onclick="setLeadsView('kanban')" id="leads-view-kanban" class="view-btn" title="Kanban View" style="padding: 8px 12px; border: none; background: transparent; color: var(--text-secondary); border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 6px; font-size: 13px; font-weight: 600; transition: all 0.2s;">
                      <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"/></svg>
                      Kanban
                    </button>
                  </div>
                  <div class="search-bar-modern" style="margin: 0; max-width: 300px; flex: 1;">
                    <span class="search-icon">
                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                    </span>
                    <input type="text" id="leads-search" placeholder="Search leads..." class="input-modern" aria-label="Search leads">
                  </div>
                </div>
              </div>
              <div class="filter-pills">
                <button class="filter-pill active" data-status="all">All</button>
                <button class="filter-pill" data-status="new">New</button>
                <button class="filter-pill" data-status="contacted">Contacted</button>
                <button class="filter-pill" data-status="qualified">Qualified</button>
                <button class="filter-pill" data-status="quoted">Quoted</button>
                <button class="filter-pill" data-status="won">Won</button>
                <button class="filter-pill" data-status="lost">Lost</button>
                <button class="filter-pill" data-status="archived" style="margin-left: 8px; border-left: 1px solid var(--border-subtle); padding-left: 16px;">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 4px;"><polyline points="21 8 21 21 3 21 3 8"/><rect x="1" y="3" width="22" height="5"/></svg>
                  Archived
                </button>
              </div>
            </div>
            <div id="leads-table">
              <div class="empty-state">
                <div class="spinner"></div>
                <p>Loading leads...</p>
              </div>
            </div>
          </div>
        </section>

        <!-- Customers Page - Unified Customer Management -->
        <section id="page-customers" class="page-section">
          <div class="page-header" style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 16px;">
            <div>
              <h1 class="page-title">Customer Management</h1>
              <p class="page-subtitle">Unified view of all customers across sources</p>
            </div>
            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
              <button class="btn-modern secondary" onclick="openCustomerImportModal()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                  <polyline points="17 8 12 3 7 8"/>
                  <line x1="12" y1="3" x2="12" y2="15"/>
                </svg>
                Import CSV
              </button>
              <button class="btn-modern secondary" onclick="exportCustomersCSV()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                  <polyline points="7 10 12 15 17 10"/>
                  <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                Export
              </button>
              <button class="btn-modern primary" onclick="openAddCustomerModal()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 4v16m8-8H4"/>
                </svg>
                Add Customer
              </button>
            </div>
          </div>

          <!-- Customer Stats by Source -->
          <div class="stats-row" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-top: 24px; margin-bottom: 24px;">
            <div class="stat-card-mini" style="cursor: pointer;" onclick="filterCustomers('all')">
              <div class="stat-card-value" id="stat-total-customers">-</div>
              <div class="stat-card-label">Total Customers</div>
            </div>
            <div class="stat-card-mini" style="cursor: pointer;" onclick="filterCustomers('subscribers')">
              <div class="stat-card-value" id="stat-subscribers" style="color: var(--gold-primary);">-</div>
              <div class="stat-card-label">Account Subscribers</div>
            </div>
            <div class="stat-card-mini" style="cursor: pointer;" onclick="filterCustomers('shopify')">
              <div class="stat-card-value" id="stat-shopify-customers" style="color: var(--info);">-</div>
              <div class="stat-card-label">Shopify Customers</div>
            </div>
            <div class="stat-card-mini" style="cursor: pointer;" onclick="filterCustomers('imported')">
              <div class="stat-card-value" id="stat-imported-customers" style="color: var(--success);">-</div>
              <div class="stat-card-label">Imported Clients</div>
            </div>
            <div class="stat-card-mini">
              <div class="stat-card-value" id="stat-customer-revenue" style="color: var(--gold-primary);">-</div>
              <div class="stat-card-label">Total Revenue</div>
            </div>
          </div>

          <!-- Search & Filters -->
          <div style="display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 200px; position: relative;">
              <svg style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-muted);" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
              </svg>
              <input type="text" id="customers-search" placeholder="Search by name, email, phone..."
                style="width: 100%; padding: 12px 12px 12px 40px; background: var(--dark-elevated); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary); font-size: 14px;"
                aria-label="Search customers">
            </div>
            <select id="customers-source-filter" onchange="filterCustomers(this.value)"
              style="padding: 12px 16px; background: var(--dark-elevated); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary); font-size: 14px; min-width: 150px;"
              aria-label="Filter by source">
              <option value="all">All Sources</option>
              <option value="subscribers">Account Subscribers</option>
              <option value="shopify">Shopify Customers</option>
              <option value="imported">Imported Clients</option>
              <option value="manual">Manually Added</option>
            </select>
            <select id="customers-sort" onchange="sortCustomers(this.value)"
              style="padding: 12px 16px; background: var(--dark-elevated); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary); font-size: 14px; min-width: 150px;"
              aria-label="Sort customers">
              <option value="recent">Most Recent</option>
              <option value="name">Name A-Z</option>
              <option value="spent">Highest Spent</option>
              <option value="orders">Most Orders</option>
            </select>
          </div>

          <!-- Quick Filters -->
          <div class="filter-pills" style="margin-bottom: 20px;">
            <button class="filter-pill active" data-customer-filter="all" onclick="filterCustomers('all')">All <span id="count-all-customers" style="opacity: 0.7; margin-left: 4px;">0</span></button>
            <button class="filter-pill" data-customer-filter="active" onclick="filterCustomers('active')">Has Orders <span id="count-active-customers" style="opacity: 0.7; margin-left: 4px;">0</span></button>
            <button class="filter-pill" data-customer-filter="recent" onclick="filterCustomers('recent')">Recent 30 Days <span id="count-recent-customers" style="opacity: 0.7; margin-left: 4px;">0</span></button>
            <button class="filter-pill" data-customer-filter="vip" onclick="filterCustomers('vip')">VIP ($1000+) <span id="count-vip-customers" style="opacity: 0.7; margin-left: 4px;">0</span></button>
          </div>

          <!-- Loading State -->
          <div id="customers-loading" class="loading-state">
            <div class="spinner"></div>
            <p>Loading customers...</p>
          </div>

          <!-- Empty State -->
          <div id="customers-empty" class="empty-state" style="display: none;">
            <div class="empty-icon">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/>
              </svg>
            </div>
            <h3>No Customers Yet</h3>
            <p>Import your existing clients or add new ones to get started.</p>
            <div style="display: flex; gap: 12px; margin-top: 16px;">
              <button class="btn-modern secondary" onclick="openCustomerImportModal()">Import CSV</button>
              <button class="btn-modern primary" onclick="openAddCustomerModal()">Add Customer</button>
            </div>
          </div>

          <!-- Customers Table -->
          <div id="customers-table" style="display: none;"></div>

          <!-- Pagination -->
          <div id="customers-pagination" style="display: none; justify-content: space-between; align-items: center; margin-top: 20px; padding: 16px; background: var(--dark-elevated); border-radius: 12px;">
            <div id="customers-page-info" style="color: var(--text-muted); font-size: 14px;">Showing 1-50 of 0</div>
            <div style="display: flex; gap: 8px;">
              <button id="customers-prev-btn" onclick="customersPagePrev()" class="btn-modern secondary" style="padding: 8px 16px;" disabled>Previous</button>
              <button id="customers-next-btn" onclick="customersPageNext()" class="btn-modern secondary" style="padding: 8px 16px;">Next</button>
            </div>
          </div>

          <!-- Powered by Remodely -->
          <div style="text-align: center; margin-top: 32px; padding-top: 20px; border-top: 1px solid var(--border-subtle);">
            <span style="font-size: 12px; color: var(--text-muted);">Powered by</span>
            <span style="font-size: 14px; font-weight: 700; color: var(--gold-primary); margin-left: 6px;">Remodely</span>
          </div>
        </section>

        <!-- Estimates Page -->
        <section id="page-estimates" class="page-section">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Estimates</h3>
              <div style="display: flex; gap: 12px;">
                <button class="btn-modern secondary" onclick="openBusinessSettings()">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                  Settings
                </button>
                <button class="btn-modern secondary" onclick="openServiceCatalog()">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>
                  Service Catalog
                </button>
                <button class="btn-modern secondary" onclick="openInviteToProjectModal()">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>
                  Invite Collaborator
                </button>
                <button class="btn-modern primary" onclick="openCreateEstimateModal()">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
                  New Estimate
                </button>
              </div>
            </div>
            <div class="card-body">
              <!-- Stats Row - Modern -->
              <div class="stat-grid">
                <div class="stat-card gold" onclick="filterEstimates('draft')">
                  <div class="stat-value" id="stat-draft-estimates">0</div>
                  <div class="stat-label">Draft</div>
                </div>
                <div class="stat-card" onclick="filterEstimates('sent')" style="--accent: #3b82f6;">
                  <div class="stat-value" style="color: #3b82f6;" id="stat-sent-estimates">0</div>
                  <div class="stat-label">Sent</div>
                </div>
                <div class="stat-card success" onclick="filterEstimates('approved')">
                  <div class="stat-value" id="stat-approved-estimates">0</div>
                  <div class="stat-label">Approved</div>
                </div>
                <div class="stat-card error" onclick="filterEstimates('rejected')">
                  <div class="stat-value" id="stat-rejected-estimates">0</div>
                  <div class="stat-label">Rejected</div>
                </div>
              </div>

              <!-- Filters - Modern Pills -->
              <div class="filter-pills">
                <button class="filter-pill active" data-estimate-status="all" onclick="filterEstimates('all')">All</button>
                <button class="filter-pill" data-estimate-status="draft" onclick="filterEstimates('draft')">Draft</button>
                <button class="filter-pill" data-estimate-status="sent" onclick="filterEstimates('sent')">Sent</button>
                <button class="filter-pill" data-estimate-status="approved" onclick="filterEstimates('approved')">Approved</button>
                <button class="filter-pill" data-estimate-status="rejected" onclick="filterEstimates('rejected')">Rejected</button>
                <button class="filter-pill" data-estimate-status="archived" onclick="filterEstimates('archived')">Archived</button>
              </div>

              <!-- Estimates List -->
              <div id="estimates-list">
                <div class="empty-state">
                  <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1" style="color: var(--text-muted); margin-bottom: 16px;"><path stroke-linecap="round" stroke-linejoin="round" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
                  <h3 style="margin-bottom: 8px;">No estimates yet</h3>
                  <p style="color: var(--text-muted); margin-bottom: 16px;">Create your first estimate to send to customers</p>
                  <button class="btn-modern primary" onclick="openCreateEstimateModal()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
                    Create First Estimate
                  </button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Invoices Page (Admin Only) -->
        <section id="page-invoices" class="page-section">
          <!-- Accounting Summary Dashboard -->
          <div class="stats-dashboard" style="margin-bottom: 24px;">
            <div class="stat-card-enhanced" style="border-left: 4px solid #3b82f6;">
              <div class="stat-header">
                <div class="stat-icon-wrapper blue">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                </div>
              </div>
              <div class="stat-value-large" id="stat-total-invoiced">$0</div>
              <div class="stat-label-enhanced">Total Invoiced</div>
            </div>
            <div class="stat-card-enhanced" style="border-left: 4px solid #22c55e;">
              <div class="stat-header">
                <div class="stat-icon-wrapper green">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </div>
              </div>
              <div class="stat-value-large" id="stat-total-paid">$0</div>
              <div class="stat-label-enhanced">Total Collected</div>
            </div>
            <div class="stat-card-enhanced" style="border-left: 4px solid #f59e0b;">
              <div class="stat-header">
                <div class="stat-icon-wrapper" style="background: rgba(245, 158, 11, 0.15);">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="#f59e0b" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </div>
              </div>
              <div class="stat-value-large" id="stat-outstanding">$0</div>
              <div class="stat-label-enhanced">Outstanding</div>
            </div>
            <div class="stat-card-enhanced" style="border-left: 4px solid #f9cb00;">
              <div class="stat-header">
                <div class="stat-icon-wrapper" style="background: rgba(249, 203, 0, 0.15);">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="#f9cb00" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
                </div>
              </div>
              <div class="stat-value-large" id="stat-deposits-collected">$0</div>
              <div class="stat-label-enhanced">Deposits Collected</div>
            </div>
          </div>

          <!-- Invoice Aging Report -->
          <div class="card" style="margin-bottom: 24px;">
            <div class="card-header" style="padding: 16px 20px;">
              <h3 class="card-title" style="font-size: 16px;">Invoice Aging</h3>
              <div style="display: flex; gap: 10px;">
                <button class="btn-modern" onclick="sendOverdueReminders()" style="background: #ef4444; padding: 8px 14px; font-size: 13px;" id="send-reminders-btn">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/></svg>
                  Send Overdue Reminders
                </button>
                <button class="btn-modern secondary" onclick="exportInvoicesCSV()" style="padding: 8px 14px; font-size: 13px;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                  Export CSV
                </button>
              </div>
            </div>
            <div class="card-body" style="padding: 0;">
              <div style="display: grid; grid-template-columns: repeat(4, 1fr); border-top: 1px solid var(--border-subtle);">
                <div style="padding: 20px; text-align: center; border-right: 1px solid var(--border-subtle);">
                  <div style="font-size: 12px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 8px;">Current</div>
                  <div style="font-size: 24px; font-weight: 700; color: #22c55e;" id="aging-current">$0</div>
                  <div style="font-size: 12px; color: var(--text-muted);" id="aging-current-count">0 invoices</div>
                </div>
                <div style="padding: 20px; text-align: center; border-right: 1px solid var(--border-subtle);">
                  <div style="font-size: 12px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 8px;">1-30 Days</div>
                  <div style="font-size: 24px; font-weight: 700; color: #f59e0b;" id="aging-30">$0</div>
                  <div style="font-size: 12px; color: var(--text-muted);" id="aging-30-count">0 invoices</div>
                </div>
                <div style="padding: 20px; text-align: center; border-right: 1px solid var(--border-subtle);">
                  <div style="font-size: 12px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 8px;">31-60 Days</div>
                  <div style="font-size: 24px; font-weight: 700; color: #f97316;" id="aging-60">$0</div>
                  <div style="font-size: 12px; color: var(--text-muted);" id="aging-60-count">0 invoices</div>
                </div>
                <div style="padding: 20px; text-align: center;">
                  <div style="font-size: 12px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 8px;">60+ Days</div>
                  <div style="font-size: 24px; font-weight: 700; color: #ef4444;" id="aging-90">$0</div>
                  <div style="font-size: 12px; color: var(--text-muted);" id="aging-90-count">0 invoices</div>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Invoices</h3>
              <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                <button class="btn-modern secondary" onclick="openPaymentHistoryModal()" title="View all payments">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/></svg>
                  Payment History
                </button>
                <button class="btn-modern secondary" onclick="syncFromStripe()" id="sync-stripe-btn" title="Import paid invoices and customers from Stripe">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
                  Sync Stripe
                </button>
                <button class="btn-modern secondary" onclick="openQuickPayModal()" style="background: linear-gradient(135deg, #8b5cf6, #6366f1); border: none;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"/></svg>
                  Quick Pay
                </button>
                <button class="btn-modern primary" onclick="openInvoiceModal()">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
                  Create Invoice
                </button>
              </div>
            </div>
            <div class="card-body">
              <div class="table-filters" style="margin-bottom: 20px;">
                <button class="filter-btn active" data-invoice-status="all" onclick="filterInvoices('all')">All</button>
                <button class="filter-btn" data-invoice-status="draft" onclick="filterInvoices('draft')">Draft</button>
                <button class="filter-btn" data-invoice-status="open" onclick="filterInvoices('open')">Open</button>
                <button class="filter-btn" data-invoice-status="viewed" onclick="filterInvoices('viewed')">Viewed</button>
                <button class="filter-btn" data-invoice-status="paid" onclick="filterInvoices('paid')">Paid</button>
                <button class="filter-btn" data-invoice-status="void" onclick="filterInvoices('void')">Voided</button>
              </div>
              <div id="invoices-list">
                <div class="spinner" style="margin: 40px auto;"></div>
              </div>
            </div>
          </div>
        </section>

        <!-- Jobs Page - Enhanced with Job Costing & Kanban -->
        <section id="page-jobs" class="page-section">
          <!-- Stats Row - Enhanced Modern Design -->
          <div class="stats-dashboard">
            <div class="stat-card-enhanced">
              <div class="stat-header">
                <div class="stat-icon-wrapper blue">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                </div>
              </div>
              <div class="stat-value-large" id="stat-active-jobs">0</div>
              <div class="stat-label-enhanced">Active Jobs</div>
            </div>
            <div class="stat-card-enhanced">
              <div class="stat-header">
                <div class="stat-icon-wrapper green">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </div>
              </div>
              <div class="stat-value-large" id="stat-jobs-revenue">$0</div>
              <div class="stat-label-enhanced">Total Revenue</div>
            </div>
            <div class="stat-card-enhanced">
              <div class="stat-header">
                <div class="stat-icon-wrapper red">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 14l6-6m-5.5.5h.01m4.99 5h.01M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16l3.5-2 3.5 2 3.5-2 3.5 2z"/></svg>
                </div>
              </div>
              <div class="stat-value-large" id="stat-total-costs">$0</div>
              <div class="stat-label-enhanced">Total Costs</div>
            </div>
            <div class="stat-card-enhanced">
              <div class="stat-header">
                <div class="stat-icon-wrapper gold">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/></svg>
                </div>
              </div>
              <div class="stat-value-large" id="stat-net-profit">$0</div>
              <div class="stat-label-enhanced">Net Profit</div>
            </div>
          </div>

          <div class="card">
            <div class="card-header" style="flex-wrap: wrap; gap: 12px;">
              <h3 class="card-title">Jobs & Projects</h3>
              <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
                <!-- View Toggle -->
                <div class="view-toggle" style="display: flex; background: var(--dark-elevated); border-radius: 8px; padding: 4px;">
                  <button class="view-btn active" onclick="setJobsView('list')" id="jobsListBtn" style="padding: 8px 12px; border: none; background: var(--gold-primary); color: var(--dark-primary); border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
                    List
                  </button>
                  <button class="view-btn" onclick="setJobsView('kanban')" id="jobsKanbanBtn" style="padding: 8px 12px; border: none; background: transparent; color: var(--text-secondary); border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                    Board
                  </button>
                </div>
                <button class="btn-modern secondary" onclick="openCustomersModal()">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                  Customers
                </button>
                <button class="btn-modern primary" onclick="openNewJobModal()">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
                  New Job
                </button>
              </div>
            </div>
            <div class="card-body">
              <!-- Filters - Modern Pills -->
              <div class="filter-pills">
                <button class="filter-pill active" data-job-status="all" onclick="filterJobs('all')">All</button>
                <button class="filter-pill" data-job-status="new" onclick="filterJobs('new')">New</button>
                <button class="filter-pill" data-job-status="approved" onclick="filterJobs('approved')">Approved</button>
                <button class="filter-pill" data-job-status="scheduled" onclick="filterJobs('scheduled')">Scheduled</button>
                <button class="filter-pill" data-job-status="in_progress" onclick="filterJobs('in_progress')">In Progress</button>
                <button class="filter-pill" data-job-status="completed" onclick="filterJobs('completed')">Completed</button>
              </div>

              <!-- List View -->
              <div id="jobs-list-view">
                <div id="jobs-list">
                  <div class="empty-state">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" style="width: 64px; height: 64px; color: var(--text-muted); margin-bottom: 16px;"><path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                    <h3>No jobs yet</h3>
                    <p>Jobs are created when estimates are approved, or create one manually.</p>
                    <button class="btn-modern primary" style="margin-top: 16px;" onclick="openNewJobModal()">Create First Job</button>
                  </div>
                </div>
              </div>

              <!-- Kanban Board View (Hidden by default) -->
              <div id="jobs-kanban-view" style="display: none;">
                <div class="kanban-board" style="display: flex; gap: 16px; overflow-x: auto; padding-bottom: 16px; min-height: 400px;">
                  <div class="kanban-column" data-status="lead" style="min-width: 280px; flex: 1; background: var(--dark-elevated); border-radius: 12px; padding: 16px;">
                    <div class="column-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 2px solid #f59e0b;">
                      <span style="font-weight: 600; color: #f59e0b;">Leads</span>
                      <span class="column-count" id="kanban-count-lead" style="background: rgba(245, 158, 11, 0.2); color: #f59e0b; padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">0</span>
                    </div>
                    <div class="column-cards" id="kanban-cards-lead" style="display: flex; flex-direction: column; gap: 12px;"></div>
                  </div>
                  <div class="kanban-column" data-status="approved" style="min-width: 280px; flex: 1; background: var(--dark-elevated); border-radius: 12px; padding: 16px;">
                    <div class="column-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 2px solid #3b82f6;">
                      <span style="font-weight: 600; color: #3b82f6;">Approved</span>
                      <span class="column-count" id="kanban-count-approved" style="background: rgba(59, 130, 246, 0.2); color: #3b82f6; padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">0</span>
                    </div>
                    <div class="column-cards" id="kanban-cards-approved" style="display: flex; flex-direction: column; gap: 12px;"></div>
                  </div>
                  <div class="kanban-column" data-status="scheduled" style="min-width: 280px; flex: 1; background: var(--dark-elevated); border-radius: 12px; padding: 16px;">
                    <div class="column-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 2px solid #8b5cf6;">
                      <span style="font-weight: 600; color: #8b5cf6;">Scheduled</span>
                      <span class="column-count" id="kanban-count-scheduled" style="background: rgba(139, 92, 246, 0.2); color: #8b5cf6; padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">0</span>
                    </div>
                    <div class="column-cards" id="kanban-cards-scheduled" style="display: flex; flex-direction: column; gap: 12px;"></div>
                  </div>
                  <div class="kanban-column" data-status="in_progress" style="min-width: 280px; flex: 1; background: var(--dark-elevated); border-radius: 12px; padding: 16px;">
                    <div class="column-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 2px solid #06b6d4;">
                      <span style="font-weight: 600; color: #06b6d4;">In Progress</span>
                      <span class="column-count" id="kanban-count-in_progress" style="background: rgba(6, 182, 212, 0.2); color: #06b6d4; padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">0</span>
                    </div>
                    <div class="column-cards" id="kanban-cards-in_progress" style="display: flex; flex-direction: column; gap: 12px;"></div>
                  </div>
                  <div class="kanban-column" data-status="completed" style="min-width: 280px; flex: 1; background: var(--dark-elevated); border-radius: 12px; padding: 16px;">
                    <div class="column-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 2px solid #22c55e;">
                      <span style="font-weight: 600; color: #22c55e;">Completed</span>
                      <span class="column-count" id="kanban-count-completed" style="background: rgba(34, 197, 94, 0.2); color: #22c55e; padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">0</span>
                    </div>
                    <div class="column-cards" id="kanban-cards-completed" style="display: flex; flex-direction: column; gap: 12px;"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Projects Page -->
        <section id="page-projects" class="page-section">
          <!-- Stats Row - Enhanced -->
          <div class="stats-dashboard">
            <div class="stat-card-enhanced">
              <div class="stat-header">
                <div class="stat-icon-wrapper blue">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/></svg>
                </div>
              </div>
              <div class="stat-value-large" id="stat-total-projects">0</div>
              <div class="stat-label-enhanced">Total Projects</div>
            </div>
            <div class="stat-card-enhanced">
              <div class="stat-header">
                <div class="stat-icon-wrapper purple">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </div>
              </div>
              <div class="stat-value-large" id="stat-active-projects">0</div>
              <div class="stat-label-enhanced">In Progress</div>
            </div>
            <div class="stat-card-enhanced">
              <div class="stat-header">
                <div class="stat-icon-wrapper green">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </div>
              </div>
              <div class="stat-value-large" id="stat-completed-projects">0</div>
              <div class="stat-label-enhanced">Completed</div>
            </div>
            <div class="stat-card-enhanced">
              <div class="stat-header">
                <div class="stat-icon-wrapper gold">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
                </div>
              </div>
              <div class="stat-value-large" id="stat-pipeline-value">$0</div>
              <div class="stat-label-enhanced">Pipeline Value</div>
            </div>
          </div>

          <div class="card">
            <div class="card-header" style="flex-wrap: wrap; gap: 12px;">
              <h3 class="card-title">Projects</h3>
              <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
                <input type="text" id="projects-search" placeholder="Search projects..." oninput="debounceProjectSearch()" style="padding: 8px 14px; border-radius: 8px; border: 1px solid var(--dark-border); background: var(--dark-elevated); color: var(--text-primary); font-size: 13px; width: 200px;" />
                <div class="view-toggle" style="display: flex; background: var(--dark-elevated); border-radius: 8px; padding: 4px;">
                  <button class="view-btn active" onclick="setProjectsView('list')" id="projectsListBtn" style="padding: 8px 12px; border: none; background: var(--gold-primary); color: var(--dark-primary); border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
                    List
                  </button>
                  <button class="view-btn" onclick="setProjectsView('board')" id="projectsBoardBtn" style="padding: 8px 12px; border: none; background: transparent; color: var(--text-secondary); border-radius: 6px; font-size: 13px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                    Board
                  </button>
                </div>
                <button class="btn-modern primary" onclick="openNewProjectModal()">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
                  New Project
                </button>
              </div>
            </div>
            <div class="card-body">
              <!-- Filter Pills -->
              <div class="filter-pills">
                <button class="filter-pill active" data-proj-status="all" onclick="filterProjects('all')">All</button>
                <button class="filter-pill" data-proj-status="lead" onclick="filterProjects('lead')">Lead</button>
                <button class="filter-pill" data-proj-status="approved" onclick="filterProjects('approved')">Approved</button>
                <button class="filter-pill" data-proj-status="scheduled" onclick="filterProjects('scheduled')">Scheduled</button>
                <button class="filter-pill" data-proj-status="in_progress" onclick="filterProjects('in_progress')">In Progress</button>
                <button class="filter-pill" data-proj-status="completed" onclick="filterProjects('completed')">Completed</button>
                <button class="filter-pill" data-proj-status="on_hold" onclick="filterProjects('on_hold')">On Hold</button>
              </div>

              <!-- List View -->
              <div id="projects-list-view">
                <div id="projects-list">
                  <div class="empty-state">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" style="width: 64px; height: 64px; color: var(--text-muted); margin-bottom: 16px;"><path stroke-linecap="round" stroke-linejoin="round" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/></svg>
                    <h3>No projects yet</h3>
                    <p>Create your first project to start tracking work, collaborators, and revenue.</p>
                    <button class="btn-modern primary" style="margin-top: 16px;" onclick="openNewProjectModal()">Create First Project</button>
                  </div>
                </div>
              </div>

              <!-- Kanban Board View (Hidden by default) -->
              <div id="projects-board-view" style="display: none;">
                <div class="kanban-board" style="display: flex; gap: 16px; overflow-x: auto; padding-bottom: 16px; min-height: 400px;">
                  <div class="kanban-column" data-status="lead" style="min-width: 280px; flex: 1; background: var(--dark-elevated); border-radius: 12px; padding: 16px;" ondragover="onProjectDragOver(event)" ondragleave="onProjectDragLeave(event)" ondrop="onProjectDrop(event, 'lead')">
                    <div class="column-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 2px solid #f59e0b;">
                      <span style="font-weight: 600; color: #f59e0b;">Lead</span>
                      <span id="proj-kanban-count-lead" style="background: rgba(245,158,11,0.2); color: #f59e0b; padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">0</span>
                    </div>
                    <div id="proj-kanban-cards-lead" style="display: flex; flex-direction: column; gap: 12px;"></div>
                  </div>
                  <div class="kanban-column" data-status="approved" style="min-width: 280px; flex: 1; background: var(--dark-elevated); border-radius: 12px; padding: 16px;" ondragover="onProjectDragOver(event)" ondragleave="onProjectDragLeave(event)" ondrop="onProjectDrop(event, 'approved')">
                    <div class="column-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 2px solid #3b82f6;">
                      <span style="font-weight: 600; color: #3b82f6;">Approved</span>
                      <span id="proj-kanban-count-approved" style="background: rgba(59,130,246,0.2); color: #3b82f6; padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">0</span>
                    </div>
                    <div id="proj-kanban-cards-approved" style="display: flex; flex-direction: column; gap: 12px;"></div>
                  </div>
                  <div class="kanban-column" data-status="scheduled" style="min-width: 280px; flex: 1; background: var(--dark-elevated); border-radius: 12px; padding: 16px;" ondragover="onProjectDragOver(event)" ondragleave="onProjectDragLeave(event)" ondrop="onProjectDrop(event, 'scheduled')">
                    <div class="column-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 2px solid #8b5cf6;">
                      <span style="font-weight: 600; color: #8b5cf6;">Scheduled</span>
                      <span id="proj-kanban-count-scheduled" style="background: rgba(139,92,246,0.2); color: #8b5cf6; padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">0</span>
                    </div>
                    <div id="proj-kanban-cards-scheduled" style="display: flex; flex-direction: column; gap: 12px;"></div>
                  </div>
                  <div class="kanban-column" data-status="in_progress" style="min-width: 280px; flex: 1; background: var(--dark-elevated); border-radius: 12px; padding: 16px;" ondragover="onProjectDragOver(event)" ondragleave="onProjectDragLeave(event)" ondrop="onProjectDrop(event, 'in_progress')">
                    <div class="column-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 2px solid #06b6d4;">
                      <span style="font-weight: 600; color: #06b6d4;">In Progress</span>
                      <span id="proj-kanban-count-in_progress" style="background: rgba(6,182,212,0.2); color: #06b6d4; padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">0</span>
                    </div>
                    <div id="proj-kanban-cards-in_progress" style="display: flex; flex-direction: column; gap: 12px;"></div>
                  </div>
                  <div class="kanban-column" data-status="completed" style="min-width: 280px; flex: 1; background: var(--dark-elevated); border-radius: 12px; padding: 16px;" ondragover="onProjectDragOver(event)" ondragleave="onProjectDragLeave(event)" ondrop="onProjectDrop(event, 'completed')">
                    <div class="column-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 2px solid #22c55e;">
                      <span style="font-weight: 600; color: #22c55e;">Completed</span>
                      <span id="proj-kanban-count-completed" style="background: rgba(34,197,94,0.2); color: #22c55e; padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">0</span>
                    </div>
                    <div id="proj-kanban-cards-completed" style="display: flex; flex-direction: column; gap: 12px;"></div>
                  </div>
                  <div class="kanban-column" data-status="on_hold" style="min-width: 280px; flex: 1; background: var(--dark-elevated); border-radius: 12px; padding: 16px;" ondragover="onProjectDragOver(event)" ondragleave="onProjectDragLeave(event)" ondrop="onProjectDrop(event, 'on_hold')">
                    <div class="column-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 2px solid #ef4444;">
                      <span style="font-weight: 600; color: #ef4444;">On Hold</span>
                      <span id="proj-kanban-count-on_hold" style="background: rgba(239,68,68,0.2); color: #ef4444; padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">0</span>
                    </div>
                    <div id="proj-kanban-cards-on_hold" style="display: flex; flex-direction: column; gap: 12px;"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Collaborators Page -->
        <section id="page-collaborators" class="page-section">
          <!-- Team Tabs -->
          <div style="display: flex; gap: 8px; margin-bottom: 20px;">
            <button class="filter-btn active" id="team-tab-my-team" onclick="switchTeamTab('my-team')" style="padding: 10px 20px; border-radius: 8px; font-weight: 600;">
              My Team
            </button>
            <button class="filter-btn" id="team-tab-invitations" onclick="switchTeamTab('invitations')" style="padding: 10px 20px; border-radius: 8px; font-weight: 500;">
              Invitations <span id="team-invites-badge" style="display: none; margin-left: 6px; background: var(--warning); color: #1a1a2e; padding: 2px 8px; border-radius: 10px; font-size: 11px;"></span>
            </button>
          </div>

          <!-- My Team Tab -->
          <div id="team-content-my-team">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Contractors & Team</h3>
              <div style="display: flex; gap: 8px;">
                <button class="btn-modern secondary" onclick="openInviteCollaboratorModal()">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                  Invite
                </button>
                <button class="btn-modern primary" onclick="openNewCollaboratorModal()">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
                  Add Contractor
                </button>
              </div>
            </div>
            <div class="card-body">
              <div class="table-filters" style="margin-bottom: 20px;">
                <button class="filter-btn active" data-collaborator-status="all" onclick="filterCollaborators('all')">All</button>
                <button class="filter-btn" data-collaborator-status="fabricator" onclick="filterCollaborators('fabricator')">Fabricators</button>
                <button class="filter-btn" data-collaborator-status="installer" onclick="filterCollaborators('installer')">Installers</button>
                <button class="filter-btn" data-collaborator-status="plumber" onclick="filterCollaborators('plumber')">Plumbers</button>
                <button class="filter-btn" data-collaborator-status="other" onclick="filterCollaborators('other')">Other</button>
              </div>
              <div id="collaborators-list">
                <div class="empty-state">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                  <h3>No collaborators yet</h3>
                  <p>Add your fabricators, installers, plumbers, and other team members.</p>
                  <div style="display: flex; gap: 12px; margin-top: 16px; justify-content: center;">
                    <button class="btn-modern secondary" onclick="openInviteCollaboratorModal()">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                      Invite Collaborator
                    </button>
                    <button class="btn-modern primary" onclick="openNewCollaboratorModal()">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
                      Add Collaborator
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          </div><!-- end team-content-my-team -->

          <!-- Invitations Tab -->
          <div id="team-content-invitations" style="display: none;">
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">Project Invitations</h3>
              </div>
              <div class="card-body">
                <div id="team-invitations-list">
                  <div class="empty-state">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" style="width: 48px; height: 48px; margin-bottom: 12px;"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                    <h3>No pending invitations</h3>
                    <p>When you're invited to collaborate on projects, they'll appear here.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Calendar Page -->
        <section id="page-calendar" class="page-section">
          <div class="card" style="overflow: visible;">
            <div class="card-header" style="flex-wrap: wrap; gap: 12px;">
              <h3 class="card-title">Calendar</h3>
              <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                <div style="display: flex; gap: 4px; align-items: center;">
                  <button class="btn-modern ghost" id="calendar-prev" onclick="changeCalendarMonth(-1)" style="padding: 8px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>
                  </button>
                  <span id="calendar-month-year" style="font-weight: 600; min-width: 140px; text-align: center;">January 2026</span>
                  <button class="btn-modern ghost" id="calendar-next" onclick="changeCalendarMonth(1)" style="padding: 8px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>
                  </button>
                </div>
                <button class="btn-modern secondary" onclick="goToToday()">Today</button>
                <button class="btn-modern primary" onclick="openCalendarEventModal()">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
                  New Event
                </button>
                <button class="btn-modern secondary" onclick="openQuickScheduleModal()" title="Quick job scheduling">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                  Quick Job
                </button>
              </div>
            </div>
            <div class="card-body" style="padding: 0; overflow: visible;">
              <div class="calendar-container" style="overflow: visible;">
                <div class="calendar-header-row">
                  <div class="calendar-header-cell">Sun</div>
                  <div class="calendar-header-cell">Mon</div>
                  <div class="calendar-header-cell">Tue</div>
                  <div class="calendar-header-cell">Wed</div>
                  <div class="calendar-header-cell">Thu</div>
                  <div class="calendar-header-cell">Fri</div>
                  <div class="calendar-header-cell">Sat</div>
                </div>
                <div class="calendar-grid" id="calendar-grid">
                  <!-- Calendar days will be rendered here -->
                </div>
              </div>
            </div>
          </div>

          <!-- Quick Add Toolbar - Drag & Drop Event Types -->
          <div class="card" id="quick-add-card" style="margin-top: 24px; overflow: visible;">
            <div class="card-header" style="padding: 14px 20px;">
              <h3 class="card-title" style="font-size: 14px; font-weight: 600;">
                <i class="fa-solid fa-grip-vertical" style="margin-right: 8px; color: var(--text-muted);"></i>
                Quick Add
              </h3>
              <span style="font-size: 12px; color: var(--text-muted);">Drag to calendar</span>
            </div>
            <div class="card-body" style="padding: 16px 20px;">
              <div id="quick-add-toolbar" class="quick-add-grid">
                <div class="quick-add-item" draggable="true" data-event-type="appointment"
                     ondragstart="handleQuickAddDragStart(event, 'appointment', 'Appointment', '#f9cb00')"
                     ondragend="handleQuickAddDragEnd(event)"
                     style="--item-color: #f9cb00;">
                  <i class="fa-regular fa-calendar-check"></i>
                  <span>Appointment</span>
                </div>
                <div class="quick-add-item" draggable="true" data-event-type="consultation"
                     ondragstart="handleQuickAddDragStart(event, 'consultation', 'Consultation', '#ec4899')"
                     ondragend="handleQuickAddDragEnd(event)"
                     style="--item-color: #ec4899;">
                  <i class="fa-regular fa-comments"></i>
                  <span>Consultation</span>
                </div>
                <div class="quick-add-item" draggable="true" data-event-type="measurement"
                     ondragstart="handleQuickAddDragStart(event, 'measurement', 'Measurement', '#f59e0b')"
                     ondragend="handleQuickAddDragEnd(event)"
                     style="--item-color: #f59e0b;">
                  <i class="fa-solid fa-ruler-combined"></i>
                  <span>Measurement</span>
                </div>
                <div class="quick-add-item" draggable="true" data-event-type="installation"
                     ondragstart="handleQuickAddDragStart(event, 'installation', 'Installation', '#10b981')"
                     ondragend="handleQuickAddDragEnd(event)"
                     style="--item-color: #10b981;">
                  <i class="fa-solid fa-screwdriver-wrench"></i>
                  <span>Installation</span>
                </div>
                <div class="quick-add-item" draggable="true" data-event-type="meeting"
                     ondragstart="handleQuickAddDragStart(event, 'meeting', 'Meeting', '#8b5cf6')"
                     ondragend="handleQuickAddDragEnd(event)"
                     style="--item-color: #8b5cf6;">
                  <i class="fa-solid fa-users"></i>
                  <span>Meeting</span>
                </div>
                <div class="quick-add-item" draggable="true" data-event-type="follow_up"
                     ondragstart="handleQuickAddDragStart(event, 'follow_up', 'Follow-up', '#3b82f6')"
                     ondragend="handleQuickAddDragEnd(event)"
                     style="--item-color: #3b82f6;">
                  <i class="fa-solid fa-phone"></i>
                  <span>Follow-up</span>
                </div>
                <div class="quick-add-item" draggable="true" data-event-type="site_visit"
                     ondragstart="handleQuickAddDragStart(event, 'site_visit', 'Site Visit', '#14b8a6')"
                     ondragend="handleQuickAddDragEnd(event)"
                     style="--item-color: #14b8a6;">
                  <i class="fa-solid fa-location-dot"></i>
                  <span>Site Visit</span>
                </div>
                <div class="quick-add-item" draggable="true" data-event-type="delivery"
                     ondragstart="handleQuickAddDragStart(event, 'delivery', 'Delivery', '#06b6d4')"
                     ondragend="handleQuickAddDragEnd(event)"
                     style="--item-color: #06b6d4;">
                  <i class="fa-solid fa-truck"></i>
                  <span>Delivery</span>
                </div>
              </div>
              <p style="font-size: 11px; color: var(--text-muted); margin-top: 12px; margin-bottom: 0;">
                <i class="fa-solid fa-circle-info" style="margin-right: 6px;"></i>
                Drag to calendar or right-click events for quick actions
              </p>
            </div>
          </div>

          <!-- Upcoming Events -->
          <div class="card" style="margin-top: 20px;">
            <div class="card-header">
              <h3 class="card-title">Upcoming Events</h3>
            </div>
            <div class="card-body">
              <div id="upcoming-events-list">
                <div class="empty-state" style="padding: 30px;">
                  <p style="color: var(--text-muted);">No upcoming events scheduled</p>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Wallet Page (Admin Only) -->
        <section id="page-wallet" class="page-section">
          <!-- Balance Cards -->
          <div class="wallet-balance-grid">
            <div class="balance-card available">
              <div class="balance-label">Available Balance</div>
              <div class="balance-amount" id="available-balance">$0.00</div>
              <div class="balance-sub">Ready to withdraw</div>
            </div>
            <div class="balance-card pending">
              <div class="balance-label">Pending Balance</div>
              <div class="balance-amount" id="pending-balance">$0.00</div>
              <div class="balance-sub">Processing payments</div>
            </div>
            <div class="balance-card total">
              <div class="balance-label">Total Revenue</div>
              <div class="balance-amount" id="total-revenue">$0.00</div>
              <div class="balance-sub">All time</div>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="card" style="margin-bottom: 24px;">
            <div class="card-header">
              <h3 class="card-title">Quick Actions</h3>
            </div>
            <div class="card-body" style="display: flex; gap: 12px; flex-wrap: wrap;">
              <a href="https://dashboard.stripe.com" target="_blank" class="btn-modern primary">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>
                Open Stripe Dashboard
              </a>
              <button class="btn-modern secondary" onclick="loadWalletData()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
                Refresh
              </button>
            </div>
          </div>

          <!-- Recent Transactions -->
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Recent Transactions</h3>
            </div>
            <div class="card-body">
              <div id="transactions-list">
                <div class="spinner" style="margin: 40px auto;"></div>
              </div>
            </div>
          </div>

          <!-- Recent Payouts -->
          <div class="card" style="margin-top: 24px;">
            <div class="card-header">
              <h3 class="card-title">Payouts to Your Bank</h3>
            </div>
            <div class="card-body">
              <div id="payouts-list">
                <div class="spinner" style="margin: 40px auto;"></div>
              </div>
            </div>
          </div>

          <!-- Fees & Rates Disclosure -->
          <div class="card" style="margin-top: 24px;">
            <div class="card-header">
              <h3 class="card-title">Processing Fees & Rates</h3>
            </div>
            <div class="card-body">
              <div class="fees-grid">
                <div class="fee-item">
                  <div class="fee-header">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
                    <span>Credit/Debit Cards</span>
                  </div>
                  <div class="fee-rate">2.9% + $0.30</div>
                  <div class="fee-desc">Per successful transaction</div>
                </div>

                <div class="fee-item">
                  <div class="fee-header">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                    <span>Invoices (Card Payment)</span>
                  </div>
                  <div class="fee-rate">2.9% + $0.30</div>
                  <div class="fee-desc">When customer pays by card</div>
                </div>

                <div class="fee-item">
                  <div class="fee-header">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 14v3m4-3v3m4-3v3M3 21h18M3 10h18M3 7l9-4 9 4M4 10h16v11H4V10z"/></svg>
                    <span>ACH Bank Transfer</span>
                  </div>
                  <div class="fee-rate">0.8% (max $5)</div>
                  <div class="fee-desc">Direct bank payments</div>
                </div>

                <div class="fee-item">
                  <div class="fee-header">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    <span>Payouts to Bank</span>
                  </div>
                  <div class="fee-rate">Free</div>
                  <div class="fee-desc">Standard 2-day transfer</div>
                </div>

                <div class="fee-item">
                  <div class="fee-header">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                    <span>Instant Payouts</span>
                  </div>
                  <div class="fee-rate">1.5% (min $0.50)</div>
                  <div class="fee-desc">Funds in minutes to debit card</div>
                </div>

                <div class="fee-item">
                  <div class="fee-header">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                    <span>Vendor Payouts</span>
                  </div>
                  <div class="fee-rate">0.25% + $0.25</div>
                  <div class="fee-desc">Per transfer to vendor accounts</div>
                </div>
              </div>

              <div class="fee-note">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                <div>
                  <strong>How Vendor Payouts Work:</strong>
                  All customer payments are collected through Surprise Granite's Stripe account. Vendors receive payouts after their sales are processed, minus applicable platform and processing fees. Payouts are processed weekly or upon request.
                </div>
              </div>

              <div class="fee-note" style="margin-top: 12px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
                <div>
                  <strong>Secure Payments:</strong>
                  All transactions are processed securely through Stripe. We never store credit card numbers on our servers.
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Admin Users Page -->
        <section id="page-admin-users" class="page-section">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Manage Admin Users</h3>
            </div>
            <div class="card-body">
              <p style="color: var(--text-muted); margin-bottom: 20px;">Add or remove admin access for users. Super admins (joshb@surprisegranite.com, info@surprisegranite.com) always have access.</p>
              <div style="display: flex; gap: 12px; margin-bottom: 24px;">
                <input type="email" id="new-admin-email" placeholder="Enter email address" style="flex: 1; padding: 12px 16px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary); font-size: 14px;">
                <button class="btn-modern primary" onclick="addAdminUser()">Add Admin</button>
              </div>
              <div id="admin-users-list">
                <div class="spinner" style="margin: 20px auto;"></div>
              </div>
            </div>
          </div>
        </section>

        <!-- ==================== GOD MODE PAGES ==================== -->

        <!-- GOD MODE - Developer Tools Dashboard -->
        <section id="page-god-mode" class="page-section">
          <div class="page-header" style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(236, 72, 153, 0.2) 100%); border-radius: 16px; padding: 24px; margin-bottom: 24px; border: 1px solid rgba(139, 92, 246, 0.3);">
            <div style="display: flex; align-items: center; gap: 16px;">
              <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 28px;">âš¡</div>
              <div>
                <h1 class="page-title" style="color: #a855f7; margin: 0;">GOD MODE</h1>
                <p class="page-subtitle" style="margin: 4px 0 0; opacity: 0.8;">Super Admin Developer Tools - Full System Access</p>
              </div>
            </div>
          </div>

          <!-- Dashboard Switcher - All Views -->
          <div class="card" style="margin-bottom: 24px; background: linear-gradient(135deg, rgba(139, 92, 246, 0.05) 0%, rgba(236, 72, 153, 0.05) 100%); border: 1px solid rgba(139, 92, 246, 0.2);">
            <div class="card-header"><h3 class="card-title" style="color: #a855f7;">ðŸŽ›ï¸ Dashboard Switcher</h3></div>
            <div class="card-body">
              <p style="margin-bottom: 16px; color: var(--text-secondary); font-size: 14px;">Access all dashboard views across the platform</p>
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                <!-- Main Dashboards -->
                <a href="/account/" class="god-view-link" style="display: flex; align-items: center; gap: 12px; padding: 16px; background: var(--dark-elevated); border: 1px solid var(--border-color); border-radius: 12px; text-decoration: none; color: inherit; transition: all 0.2s;">
                  <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #f9cb00 0%, #cca600 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center;"><i class="fa-solid fa-house" style="color: #fff;"></i></div>
                  <div><div style="font-weight: 600;">Customer Account</div><div style="font-size: 12px; color: var(--text-muted);">/account/</div></div>
                </a>
                <a href="/account/pro-dashboard/" class="god-view-link" style="display: flex; align-items: center; gap: 12px; padding: 16px; background: var(--dark-elevated); border: 1px solid var(--border-color); border-radius: 12px; text-decoration: none; color: inherit; transition: all 0.2s;">
                  <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center;"><i class="fa-solid fa-briefcase" style="color: #fff;"></i></div>
                  <div><div style="font-weight: 600;">Pro Dashboard</div><div style="font-size: 12px; color: var(--text-muted);">/account/pro-dashboard/</div></div>
                </a>
                <a href="/distributor/dashboard/" class="god-view-link" style="display: flex; align-items: center; gap: 12px; padding: 16px; background: var(--dark-elevated); border: 1px solid var(--border-color); border-radius: 12px; text-decoration: none; color: inherit; transition: all 0.2s;">
                  <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center;"><i class="fa-solid fa-building" style="color: #fff;"></i></div>
                  <div><div style="font-weight: 600;">Distributor Portal</div><div style="font-size: 12px; color: var(--text-muted);">/distributor/dashboard/</div></div>
                </a>
                <a href="/distributor/signup/" class="god-view-link" style="display: flex; align-items: center; gap: 12px; padding: 16px; background: var(--dark-elevated); border: 1px solid var(--border-color); border-radius: 12px; text-decoration: none; color: inherit; transition: all 0.2s;">
                  <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center;"><i class="fa-solid fa-pen-to-square" style="color: #fff;"></i></div>
                  <div><div style="font-weight: 600;">Distributor Signup</div><div style="font-size: 12px; color: var(--text-muted);">/distributor/signup/</div></div>
                </a>
                <!-- Admin Dashboards -->
                <a href="/admin/products/" class="god-view-link" style="display: flex; align-items: center; gap: 12px; padding: 16px; background: var(--dark-elevated); border: 1px solid var(--border-color); border-radius: 12px; text-decoration: none; color: inherit; transition: all 0.2s;">
                  <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center;"><i class="fa-solid fa-box" style="color: #fff;"></i></div>
                  <div><div style="font-weight: 600;">Product Admin</div><div style="font-size: 12px; color: var(--text-muted);">/admin/products/</div></div>
                </a>
                <a href="/admin/orders/" class="god-view-link" style="display: flex; align-items: center; gap: 12px; padding: 16px; background: var(--dark-elevated); border: 1px solid var(--border-color); border-radius: 12px; text-decoration: none; color: inherit; transition: all 0.2s;">
                  <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center;"><i class="fa-solid fa-receipt" style="color: #fff;"></i></div>
                  <div><div style="font-weight: 600;">Order Admin</div><div style="font-size: 12px; color: var(--text-muted);">/admin/orders/</div></div>
                </a>
                <!-- Tools -->
                <a href="/tools/" class="god-view-link" style="display: flex; align-items: center; gap: 12px; padding: 16px; background: var(--dark-elevated); border: 1px solid var(--border-color); border-radius: 12px; text-decoration: none; color: inherit; transition: all 0.2s;">
                  <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center;"><i class="fa-solid fa-screwdriver-wrench" style="color: #fff;"></i></div>
                  <div><div style="font-weight: 600;">Tools Hub</div><div style="font-size: 12px; color: var(--text-muted);">/tools/</div></div>
                </a>
                <a href="/tools/room-designer/" class="god-view-link" style="display: flex; align-items: center; gap: 12px; padding: 16px; background: var(--dark-elevated); border: 1px solid var(--border-color); border-radius: 12px; text-decoration: none; color: inherit; transition: all 0.2s;">
                  <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #ec4899 0%, #db2777 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center;"><i class="fa-solid fa-palette" style="color: #fff;"></i></div>
                  <div><div style="font-weight: 600;">Room Designer</div><div style="font-size: 12px; color: var(--text-muted);">/tools/room-designer/</div></div>
                </a>
                <!-- Stone Yards -->
                <a href="/stone-yards/" class="god-view-link" style="display: flex; align-items: center; gap: 12px; padding: 16px; background: var(--dark-elevated); border: 1px solid var(--border-color); border-radius: 12px; text-decoration: none; color: inherit; transition: all 0.2s;">
                  <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #78716c 0%, #57534e 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center;"><i class="fa-solid fa-mountain" style="color: #fff;"></i></div>
                  <div><div style="font-weight: 600;">Stone Yards</div><div style="font-size: 12px; color: var(--text-muted);">/stone-yards/</div></div>
                </a>
                <!-- Auth -->
                <a href="/log-in/" class="god-view-link" style="display: flex; align-items: center; gap: 12px; padding: 16px; background: var(--dark-elevated); border: 1px solid var(--border-color); border-radius: 12px; text-decoration: none; color: inherit; transition: all 0.2s;">
                  <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #64748b 0%, #475569 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center;"><i class="fa-solid fa-lock" style="color: #fff;"></i></div>
                  <div><div style="font-weight: 600;">Login Page</div><div style="font-size: 12px; color: var(--text-muted);">/log-in/</div></div>
                </a>
                <a href="/sign-up/" class="god-view-link" style="display: flex; align-items: center; gap: 12px; padding: 16px; background: var(--dark-elevated); border: 1px solid var(--border-color); border-radius: 12px; text-decoration: none; color: inherit; transition: all 0.2s;">
                  <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center;"><i class="fa-solid fa-user-plus" style="color: #fff;"></i></div>
                  <div><div style="font-weight: 600;">Sign Up Page</div><div style="font-size: 12px; color: var(--text-muted);">/sign-up/</div></div>
                </a>
                <a href="/auth/callback/" class="god-view-link" style="display: flex; align-items: center; gap: 12px; padding: 16px; background: var(--dark-elevated); border: 1px solid var(--border-color); border-radius: 12px; text-decoration: none; color: inherit; transition: all 0.2s;">
                  <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center;"><i class="fa-solid fa-rotate" style="color: #fff;"></i></div>
                  <div><div style="font-weight: 600;">Auth Callback</div><div style="font-size: 12px; color: var(--text-muted);">/auth/callback/</div></div>
                </a>
              </div>
            </div>
          </div>

          <!-- System Health -->
          <div class="card" style="margin-bottom: 24px;">
            <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
              <h3 class="card-title">System Health</h3>
              <button class="btn-modern secondary" onclick="refreshSystemHealth()" style="padding: 8px 16px; font-size: 13px;">Refresh</button>
            </div>
            <div class="card-body">
              <div id="god-system-health" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                <div class="stat-card-mini" style="border-left: 3px solid var(--success);"><div class="stat-card-label">API Status</div><div class="stat-card-value" id="god-api-status" style="color: var(--success);">Checking...</div></div>
                <div class="stat-card-mini" style="border-left: 3px solid var(--success);"><div class="stat-card-label">Supabase</div><div class="stat-card-value" id="god-supabase-status" style="color: var(--success);">Checking...</div></div>
                <div class="stat-card-mini" style="border-left: 3px solid var(--success);"><div class="stat-card-label">Stripe</div><div class="stat-card-value" id="god-stripe-status" style="color: var(--success);">Checking...</div></div>
                <div class="stat-card-mini" style="border-left: 3px solid var(--accent);"><div class="stat-card-label">Total Users</div><div class="stat-card-value" id="god-total-users">-</div></div>
                <div class="stat-card-mini" style="border-left: 3px solid var(--accent);"><div class="stat-card-label">Active Subscribers</div><div class="stat-card-value" id="god-active-subs">-</div></div>
                <div class="stat-card-mini" style="border-left: 3px solid var(--accent);"><div class="stat-card-label">Distributors</div><div class="stat-card-value" id="god-total-distributors">-</div></div>
              </div>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="card" style="margin-bottom: 24px;">
            <div class="card-header"><h3 class="card-title">Quick Actions</h3></div>
            <div class="card-body">
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px;">
                <button class="btn-modern secondary" onclick="godClearCache()" style="display: flex; flex-direction: column; align-items: center; padding: 20px; height: auto;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg><span style="margin-top: 8px; font-size: 13px;">Clear Cache</span></button>
                <button class="btn-modern secondary" onclick="godSendTestEmail()" style="display: flex; flex-direction: column; align-items: center; padding: 20px; height: auto;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg><span style="margin-top: 8px; font-size: 13px;">Test Email</span></button>
                <button class="btn-modern secondary" onclick="godSyncShopify()" style="display: flex; flex-direction: column; align-items: center; padding: 20px; height: auto;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"/></svg><span style="margin-top: 8px; font-size: 13px;">Sync Shopify</span></button>
                <button class="btn-modern secondary" onclick="godBackupDatabase()" style="display: flex; flex-direction: column; align-items: center; padding: 20px; height: auto;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"/></svg><span style="margin-top: 8px; font-size: 13px;">Export Backup</span></button>
                <button class="btn-modern secondary" onclick="godToggleMaintenanceMode()" style="display: flex; flex-direction: column; align-items: center; padding: 20px; height: auto;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z"/></svg><span style="margin-top: 8px; font-size: 13px;">Maintenance Mode</span></button>
                <button class="btn-modern secondary" onclick="godReindexProducts()" style="display: flex; flex-direction: column; align-items: center; padding: 20px; height: auto;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/></svg><span style="margin-top: 8px; font-size: 13px;">Reindex Products</span></button>
              </div>
            </div>
          </div>

          <!-- Environment Info -->
          <div class="card">
            <div class="card-header"><h3 class="card-title">Environment</h3></div>
            <div class="card-body">
              <div id="god-environment-info" style="font-family: 'Monaco', 'Menlo', monospace; font-size: 13px; background: rgba(0,0,0,0.3); padding: 16px; border-radius: 8px; overflow-x: auto;">
                <div style="display: grid; grid-template-columns: 150px 1fr; gap: 8px;">
                  <span style="color: var(--text-muted);">Supabase URL:</span><span style="color: var(--accent);">https://ypeypgwsycxcagncgdur.supabase.co</span>
                  <span style="color: var(--text-muted);">API Base:</span><span style="color: var(--accent);" id="god-api-base">Loading...</span>
                  <span style="color: var(--text-muted);">User Agent:</span><span style="color: var(--text-secondary);" id="god-user-agent">Loading...</span>
                  <span style="color: var(--text-muted);">Session ID:</span><span style="color: var(--text-secondary);" id="god-session-id">Loading...</span>
                  <span style="color: var(--text-muted);">Auth Status:</span><span style="color: var(--success);" id="god-auth-status">Loading...</span>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- GOD MODE - Customer Hub (Unified User Management) -->
        <section id="page-god-users" class="page-section">
          <div class="page-header" style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 16px;">
            <div><h1 class="page-title" style="color: #a855f7;"><span style="margin-right: 8px;">ðŸ‘¥</span> Customer Hub</h1><p class="page-subtitle">Unified view of all users, customers, and leads across all platforms</p></div>
            <div style="display: flex; gap: 12px;"><button class="btn-modern secondary" onclick="godExportUsers()">Export CSV</button><button class="btn-modern primary" onclick="godRefreshUsers()">Refresh</button></div>
          </div>

          <!-- Summary Stats -->
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin: 24px 0;">
            <div class="stat-card-mini"><div class="stat-card-value" id="god-users-total">-</div><div class="stat-card-label">SG Users</div></div>
            <div class="stat-card-mini"><div class="stat-card-value" id="god-users-shopify" style="color: #96bf48;">-</div><div class="stat-card-label">Shopify Customers</div></div>
            <div class="stat-card-mini"><div class="stat-card-value" id="god-users-leads" style="color: var(--warning);">-</div><div class="stat-card-label">Leads</div></div>
            <div class="stat-card-mini"><div class="stat-card-value" id="god-users-pro" style="color: var(--accent);">-</div><div class="stat-card-label">Pro Users</div></div>
            <div class="stat-card-mini"><div class="stat-card-value" id="god-users-collaborators" style="color: var(--success);">-</div><div class="stat-card-label">Collaborators</div></div>
            <div class="stat-card-mini"><div class="stat-card-value" id="god-users-admins" style="color: #a855f7;">-</div><div class="stat-card-label">Admins</div></div>
          </div>

          <!-- Customer Hub Tabs -->
          <div class="tabs-modern" style="margin-bottom: 24px;">
            <button class="tab-modern active" onclick="godShowCustomerTab('all-users')">All Users</button>
            <button class="tab-modern" onclick="godShowCustomerTab('shopify')">Shopify Customers</button>
            <button class="tab-modern" onclick="godShowCustomerTab('leads')">Leads</button>
            <button class="tab-modern" onclick="godShowCustomerTab('pro')">Pro Users</button>
            <button class="tab-modern" onclick="godShowCustomerTab('collaborators')">Collaborators</button>
          </div>

          <!-- All Users Tab -->
          <div id="god-customer-tab-all-users" class="god-customer-tab">
            <div class="card" style="margin-bottom: 24px;">
              <div class="card-body">
                <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                  <div style="flex: 1; min-width: 250px; position: relative;"><svg style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-muted);" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input type="text" id="god-users-search" placeholder="Search by email, name, or ID..." style="width: 100%; padding: 12px 12px 12px 40px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary);" onkeyup="godSearchUsers()"></div>
                  <select id="god-users-role-filter" onchange="godFilterUsers()" style="padding: 12px 16px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary); min-width: 150px;"><option value="all">All Roles</option><option value="admin">Admin</option><option value="pro">Pro</option><option value="contractor">Contractor</option><option value="fabricator">Fabricator</option><option value="vendor">Vendor</option><option value="distributor">Distributor</option><option value="homeowner">Homeowner</option></select>
                  <select id="god-users-sub-filter" onchange="godFilterUsers()" style="padding: 12px 16px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary); min-width: 150px;"><option value="all">All Subscriptions</option><option value="active">Active</option><option value="inactive">Inactive</option><option value="cancelled">Cancelled</option></select>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="card-body" style="padding: 0; overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse; min-width: 800px;">
                  <thead><tr style="background: rgba(255,255,255,0.03); border-bottom: 1px solid var(--border-subtle);"><th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">User</th><th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Role</th><th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Subscription</th><th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Created</th><th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Last Active</th><th style="padding: 12px 16px; text-align: center; font-weight: 600; font-size: 13px; color: var(--text-muted);">Actions</th></tr></thead>
                  <tbody id="god-users-table-body"><tr><td colspan="6" style="padding: 40px; text-align: center; color: var(--text-muted);">Loading users...</td></tr></tbody>
                </table>
              </div>
              <div class="card-footer" style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-top: 1px solid var(--border-subtle);"><span id="god-users-count" style="font-size: 13px; color: var(--text-muted);">Showing 0 users</span><div style="display: flex; gap: 8px;"><button class="btn-modern secondary" onclick="godUsersPagePrev()" id="god-users-prev" disabled style="padding: 8px 12px; font-size: 13px;">Previous</button><button class="btn-modern secondary" onclick="godUsersPageNext()" id="god-users-next" style="padding: 8px 12px; font-size: 13px;">Next</button></div></div>
            </div>
          </div>

          <!-- Shopify Customers Tab -->
          <div id="god-customer-tab-shopify" class="god-customer-tab" style="display: none;">
            <div class="card" style="margin-bottom: 24px;">
              <div class="card-body">
                <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
                  <div style="flex: 1; min-width: 250px; position: relative;"><svg style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-muted);" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input type="text" id="god-shopify-search" placeholder="Search Shopify customers..." style="width: 100%; padding: 12px 12px 12px 40px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary);" onkeyup="godSearchShopifyCustomers()"></div>
                  <select id="god-shopify-filter" onchange="godFilterShopifyCustomers()" style="padding: 12px 16px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary); min-width: 150px;"><option value="all">All Customers</option><option value="with-orders">With Orders</option><option value="no-orders">No Orders</option><option value="marketing-opted">Marketing Opted-In</option></select>
                  <span style="padding: 8px 16px; background: #96bf48; color: #000; border-radius: 6px; font-size: 13px; font-weight: 600;">Shopify</span>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="card-body" style="padding: 0; overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse; min-width: 900px;">
                  <thead><tr style="background: rgba(255,255,255,0.03); border-bottom: 1px solid var(--border-subtle);"><th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Customer</th><th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Phone</th><th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Orders</th><th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Total Spent</th><th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Created</th><th style="padding: 12px 16px; text-align: center; font-weight: 600; font-size: 13px; color: var(--text-muted);">Actions</th></tr></thead>
                  <tbody id="god-shopify-table-body"><tr><td colspan="6" style="padding: 40px; text-align: center; color: var(--text-muted);">Loading Shopify customers...</td></tr></tbody>
                </table>
              </div>
              <div class="card-footer" style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-top: 1px solid var(--border-subtle);"><span id="god-shopify-count" style="font-size: 13px; color: var(--text-muted);">Showing 0 customers</span><div style="display: flex; gap: 8px;"><button class="btn-modern secondary" onclick="godShopifyPagePrev()" id="god-shopify-prev" disabled style="padding: 8px 12px; font-size: 13px;">Previous</button><button class="btn-modern secondary" onclick="godShopifyPageNext()" id="god-shopify-next" style="padding: 8px 12px; font-size: 13px;">Next</button></div></div>
            </div>
          </div>

          <!-- Leads Tab -->
          <div id="god-customer-tab-leads" class="god-customer-tab" style="display: none;">
            <div class="card" style="margin-bottom: 24px;">
              <div class="card-body">
                <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
                  <div style="flex: 1; min-width: 250px; position: relative;"><svg style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-muted);" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input type="text" id="god-leads-search" placeholder="Search leads..." style="width: 100%; padding: 12px 12px 12px 40px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary);" onkeyup="godSearchLeads()"></div>
                  <select id="god-leads-status" onchange="godFilterLeads()" style="padding: 12px 16px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary); min-width: 150px;"><option value="all">All Status</option><option value="new">New</option><option value="contacted">Contacted</option><option value="qualified">Qualified</option><option value="converted">Converted</option><option value="lost">Lost</option></select>
                  <select id="god-leads-source" onchange="godFilterLeads()" style="padding: 12px 16px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary); min-width: 150px;"><option value="all">All Sources</option><option value="website">Website</option><option value="referral">Referral</option><option value="google">Google</option><option value="facebook">Facebook</option></select>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="card-body" style="padding: 0; overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse; min-width: 900px;">
                  <thead><tr style="background: rgba(255,255,255,0.03); border-bottom: 1px solid var(--border-subtle);"><th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Lead</th><th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Phone</th><th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Status</th><th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Source</th><th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Created</th><th style="padding: 12px 16px; text-align: center; font-weight: 600; font-size: 13px; color: var(--text-muted);">Actions</th></tr></thead>
                  <tbody id="god-leads-table-body"><tr><td colspan="6" style="padding: 40px; text-align: center; color: var(--text-muted);">Loading leads...</td></tr></tbody>
                </table>
              </div>
              <div class="card-footer" style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-top: 1px solid var(--border-subtle);"><span id="god-leads-count" style="font-size: 13px; color: var(--text-muted);">Showing 0 leads</span><div style="display: flex; gap: 8px;"><button class="btn-modern secondary" onclick="godLeadsPagePrev()" id="god-leads-prev" disabled style="padding: 8px 12px; font-size: 13px;">Previous</button><button class="btn-modern secondary" onclick="godLeadsPageNext()" id="god-leads-next" style="padding: 8px 12px; font-size: 13px;">Next</button></div></div>
            </div>
          </div>

          <!-- Pro Users Tab -->
          <div id="god-customer-tab-pro" class="god-customer-tab" style="display: none;">
            <div class="card" style="margin-bottom: 24px;">
              <div class="card-body">
                <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
                  <div style="flex: 1; min-width: 250px; position: relative;"><svg style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-muted);" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input type="text" id="god-pro-search" placeholder="Search pro users..." style="width: 100%; padding: 12px 12px 12px 40px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary);" onkeyup="godSearchProUsers()"></div>
                  <select id="god-pro-filter" onchange="godFilterProUsers()" style="padding: 12px 16px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary); min-width: 150px;"><option value="all">All Pro Users</option><option value="active">Active Subscription</option><option value="cancelled">Cancelled</option><option value="trial">Trial</option></select>
                  <span style="padding: 8px 16px; background: var(--accent); color: #000; border-radius: 6px; font-size: 13px; font-weight: 600;">PRO</span>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="card-body" style="padding: 0; overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse; min-width: 900px;">
                  <thead><tr style="background: rgba(255,255,255,0.03); border-bottom: 1px solid var(--border-subtle);"><th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Pro User</th><th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Plan</th><th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Status</th><th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Started</th><th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Next Billing</th><th style="padding: 12px 16px; text-align: center; font-weight: 600; font-size: 13px; color: var(--text-muted);">Actions</th></tr></thead>
                  <tbody id="god-pro-table-body"><tr><td colspan="6" style="padding: 40px; text-align: center; color: var(--text-muted);">Loading pro users...</td></tr></tbody>
                </table>
              </div>
              <div class="card-footer" style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-top: 1px solid var(--border-subtle);"><span id="god-pro-count" style="font-size: 13px; color: var(--text-muted);">Showing 0 pro users</span><div style="display: flex; gap: 8px;"><button class="btn-modern secondary" onclick="godProPagePrev()" id="god-pro-prev" disabled style="padding: 8px 12px; font-size: 13px;">Previous</button><button class="btn-modern secondary" onclick="godProPageNext()" id="god-pro-next" style="padding: 8px 12px; font-size: 13px;">Next</button></div></div>
            </div>
          </div>

          <!-- Collaborators Tab -->
          <div id="god-customer-tab-collaborators" class="god-customer-tab" style="display: none;">
            <div class="card" style="margin-bottom: 24px;">
              <div class="card-body">
                <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
                  <div style="flex: 1; min-width: 250px; position: relative;"><svg style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-muted);" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input type="text" id="god-collaborators-search" placeholder="Search collaborators..." style="width: 100%; padding: 12px 12px 12px 40px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary);" onkeyup="godSearchCollaborators()"></div>
                  <select id="god-collaborators-filter" onchange="godFilterCollaborators()" style="padding: 12px 16px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary); min-width: 150px;"><option value="all">All Collaborators</option><option value="verified">Verified</option><option value="pending">Pending</option><option value="active">Active Jobs</option></select>
                  <span style="padding: 8px 16px; background: var(--success); color: #000; border-radius: 6px; font-size: 13px; font-weight: 600;">Contractor</span>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="card-body" style="padding: 0; overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse; min-width: 900px;">
                  <thead><tr style="background: rgba(255,255,255,0.03); border-bottom: 1px solid var(--border-subtle);"><th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Contractor</th><th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Company</th><th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Specialty</th><th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Status</th><th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Jobs</th><th style="padding: 12px 16px; text-align: center; font-weight: 600; font-size: 13px; color: var(--text-muted);">Actions</th></tr></thead>
                  <tbody id="god-collaborators-table-body"><tr><td colspan="6" style="padding: 40px; text-align: center; color: var(--text-muted);">Loading collaborators...</td></tr></tbody>
                </table>
              </div>
              <div class="card-footer" style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-top: 1px solid var(--border-subtle);"><span id="god-collaborators-count" style="font-size: 13px; color: var(--text-muted);">Showing 0 collaborators</span><div style="display: flex; gap: 8px;"><button class="btn-modern secondary" onclick="godCollaboratorsPagePrev()" id="god-collaborators-prev" disabled style="padding: 8px 12px; font-size: 13px;">Previous</button><button class="btn-modern secondary" onclick="godCollaboratorsPageNext()" id="god-collaborators-next" style="padding: 8px 12px; font-size: 13px;">Next</button></div></div>
            </div>
          </div>
        </section>

        <!-- GOD MODE - Marketplace Management -->
        <section id="page-god-marketplace" class="page-section">
          <div class="page-header" style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 16px;">
            <div><h1 class="page-title" style="color: #a855f7;"><span style="margin-right: 8px;">âš¡</span> Marketplace Management</h1><p class="page-subtitle">Manage distributors, listings, and marketplace settings</p></div>
            <button class="btn-modern primary" onclick="godRefreshMarketplace()">Refresh</button>
          </div>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; margin: 24px 0;">
            <div class="stat-card-mini"><div class="stat-card-value" id="god-mp-distributors">-</div><div class="stat-card-label">Distributors</div></div>
            <div class="stat-card-mini"><div class="stat-card-value" id="god-mp-listings" style="color: var(--accent);">-</div><div class="stat-card-label">Active Listings</div></div>
            <div class="stat-card-mini"><div class="stat-card-value" id="god-mp-slabs" style="color: var(--success);">-</div><div class="stat-card-label">Total Slabs</div></div>
            <div class="stat-card-mini"><div class="stat-card-value" id="god-mp-inquiries" style="color: var(--warning);">-</div><div class="stat-card-label">Pending Inquiries</div></div>
            <div class="stat-card-mini"><div class="stat-card-value" id="god-mp-revenue" style="color: #a855f7;">-</div><div class="stat-card-label">Monthly Revenue</div></div>
          </div>
          <div class="tabs-modern" style="margin-bottom: 24px;"><button class="tab-modern active" onclick="godShowMarketplaceTab('distributors')">Distributors</button><button class="tab-modern" onclick="godShowMarketplaceTab('listings')">Listings</button><button class="tab-modern" onclick="godShowMarketplaceTab('inquiries')">Inquiries</button><button class="tab-modern" onclick="godShowMarketplaceTab('subscriptions')">Subscriptions</button></div>
          <div id="god-mp-tab-distributors" class="god-mp-tab"><div class="card"><div class="card-header" style="display: flex; justify-content: space-between; align-items: center;"><h3 class="card-title">All Distributors</h3><input type="text" placeholder="Search distributors..." style="padding: 8px 12px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-subtle); border-radius: 6px; color: var(--text-primary); font-size: 13px;" onkeyup="godSearchDistributors(this.value)"></div><div class="card-body" style="padding: 0;"><div id="god-distributors-list" style="max-height: 500px; overflow-y: auto;"><div style="padding: 40px; text-align: center; color: var(--text-muted);">Loading distributors...</div></div></div></div></div>
          <div id="god-mp-tab-listings" class="god-mp-tab" style="display: none;"><div class="card"><div class="card-header"><h3 class="card-title">All Marketplace Listings</h3></div><div class="card-body" style="padding: 0;"><div id="god-listings-list" style="max-height: 500px; overflow-y: auto;"><div style="padding: 40px; text-align: center; color: var(--text-muted);">Loading listings...</div></div></div></div></div>
          <div id="god-mp-tab-inquiries" class="god-mp-tab" style="display: none;"><div class="card"><div class="card-header"><h3 class="card-title">Marketplace Inquiries</h3></div><div class="card-body" style="padding: 0;"><div id="god-inquiries-list" style="max-height: 500px; overflow-y: auto;"><div style="padding: 40px; text-align: center; color: var(--text-muted);">Loading inquiries...</div></div></div></div></div>
          <div id="god-mp-tab-subscriptions" class="god-mp-tab" style="display: none;"><div class="card"><div class="card-header"><h3 class="card-title">Distributor Subscriptions</h3></div><div class="card-body" style="padding: 0;"><div id="god-subscriptions-list" style="max-height: 500px; overflow-y: auto;"><div style="padding: 40px; text-align: center; color: var(--text-muted);">Loading subscriptions...</div></div></div></div></div>
        </section>

        <!-- GOD MODE - Database Tools -->
        <section id="page-god-database" class="page-section">
          <div class="page-header"><h1 class="page-title" style="color: #a855f7;"><span style="margin-right: 8px;">âš¡</span> Database Tools</h1><p class="page-subtitle">Direct database access and management</p></div>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px; margin: 24px 0;"><div class="stat-card-mini"><div class="stat-card-value" id="god-db-tables">-</div><div class="stat-card-label">Tables</div></div><div class="stat-card-mini"><div class="stat-card-value" id="god-db-rows">-</div><div class="stat-card-label">Total Rows</div></div><div class="stat-card-mini"><div class="stat-card-value" id="god-db-size">-</div><div class="stat-card-label">Database Size</div></div></div>
          <div class="card" style="margin-bottom: 24px;">
            <div class="card-header"><h3 class="card-title">SQL Query Runner</h3></div>
            <div class="card-body">
              <textarea id="god-sql-query" placeholder="SELECT * FROM sg_users LIMIT 10;" style="width: 100%; min-height: 120px; padding: 16px; background: rgba(0,0,0,0.3); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary); font-family: 'Monaco', 'Menlo', monospace; font-size: 13px; resize: vertical;"></textarea>
              <div style="display: flex; gap: 12px; margin-top: 12px;"><button class="btn-modern primary" onclick="godRunSqlQuery()">Run Query</button><button class="btn-modern secondary" onclick="godClearQueryResults()">Clear Results</button><select id="god-sql-preset" onchange="godLoadSqlPreset(this.value)" style="padding: 10px 16px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary);"><option value="">Load Preset Query...</option><option value="users">All Users (limit 100)</option><option value="admins">Admin Users</option><option value="distributors">All Distributors</option><option value="recent_orders">Recent Orders</option><option value="active_subs">Active Subscriptions</option><option value="table_sizes">Table Sizes</option></select></div>
              <div id="god-sql-results" style="margin-top: 16px; max-height: 400px; overflow: auto; display: none;"><pre style="background: rgba(0,0,0,0.3); padding: 16px; border-radius: 8px; font-size: 12px; margin: 0; white-space: pre-wrap;"></pre></div>
            </div>
          </div>
          <div class="card"><div class="card-header" style="display: flex; justify-content: space-between; align-items: center;"><h3 class="card-title">Table Browser</h3><select id="god-table-select" onchange="godBrowseTable(this.value)" style="padding: 10px 16px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary); min-width: 200px;"><option value="">Select a table...</option><option value="sg_users">sg_users</option><option value="customers">customers</option><option value="shopify_customers">shopify_customers</option><option value="shopify_orders">shopify_orders</option><option value="shopify_products">shopify_products</option><option value="distributor_profiles">distributor_profiles</option><option value="marketplace_listings">marketplace_listings</option><option value="jobs">jobs</option><option value="leads">leads</option><option value="estimates">estimates</option></select></div><div class="card-body" style="padding: 0;"><div id="god-table-browser" style="max-height: 400px; overflow: auto;"><div style="padding: 40px; text-align: center; color: var(--text-muted);">Select a table to browse</div></div></div></div>
        </section>

        <!-- GOD MODE - API Tester -->
        <section id="page-god-api" class="page-section">
          <div class="page-header"><h1 class="page-title" style="color: #a855f7;"><span style="margin-right: 8px;">âš¡</span> API Tester</h1><p class="page-subtitle">Test API endpoints and debug requests</p></div>
          <div class="card">
            <div class="card-body">
              <div style="display: grid; gap: 16px;">
                <div style="display: flex; gap: 12px;"><select id="god-api-method" style="padding: 12px 16px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary); min-width: 100px;"><option value="GET">GET</option><option value="POST">POST</option><option value="PATCH">PATCH</option><option value="DELETE">DELETE</option></select><input type="text" id="god-api-endpoint" placeholder="/api/endpoint" style="flex: 1; padding: 12px 16px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary);"><button class="btn-modern primary" onclick="godTestApiEndpoint()">Send Request</button></div>
                <div><label style="display: block; margin-bottom: 8px; font-size: 13px; color: var(--text-muted);">Request Body (JSON)</label><textarea id="god-api-body" placeholder='{"key": "value"}' style="width: 100%; min-height: 100px; padding: 12px; background: rgba(0,0,0,0.3); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary); font-family: 'Monaco', 'Menlo', monospace; font-size: 13px;"></textarea></div>
                <div style="display: flex; gap: 12px; flex-wrap: wrap;"><label style="display: flex; align-items: center; gap: 8px; font-size: 13px;"><input type="checkbox" id="god-api-auth" checked> Include Auth Token</label><select id="god-api-preset" onchange="godLoadApiPreset(this.value)" style="padding: 8px 12px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary); font-size: 13px;"><option value="">Load Preset...</option><option value="health">System Health</option><option value="users">Get Users</option><option value="products">Get Products</option><option value="orders">Get Orders</option><option value="stripe">Stripe Status</option><option value="distributors">Get Distributors</option></select></div>
              </div>
              <div id="god-api-response" style="margin-top: 24px; display: none;"><div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;"><h4 style="margin: 0; font-size: 14px; color: var(--text-muted);">Response</h4><div style="display: flex; gap: 8px; align-items: center;"><span id="god-api-status-code" style="padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;">-</span><span id="god-api-time" style="font-size: 12px; color: var(--text-muted);">-</span></div></div><pre id="god-api-response-body" style="background: rgba(0,0,0,0.3); padding: 16px; border-radius: 8px; font-size: 12px; margin: 0; max-height: 400px; overflow: auto; white-space: pre-wrap;"></pre></div>
            </div>
          </div>
        </section>

        <!-- GOD MODE - System Logs -->
        <section id="page-god-logs" class="page-section">
          <div class="page-header" style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 16px;"><div><h1 class="page-title" style="color: #a855f7;"><span style="margin-right: 8px;">âš¡</span> System Logs</h1><p class="page-subtitle">View and analyze system activity</p></div><div style="display: flex; gap: 12px;"><button class="btn-modern secondary" onclick="godExportLogs()">Export Logs</button><button class="btn-modern primary" onclick="godRefreshLogs()">Refresh</button></div></div>
          <div class="card" style="margin: 24px 0;"><div class="card-body"><div style="display: flex; gap: 12px; flex-wrap: wrap;"><select id="god-logs-type" onchange="godFilterLogs()" style="padding: 10px 16px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary);"><option value="all">All Types</option><option value="auth">Authentication</option><option value="api">API Requests</option><option value="error">Errors</option><option value="payment">Payments</option><option value="admin">Admin Actions</option></select><select id="god-logs-level" onchange="godFilterLogs()" style="padding: 10px 16px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary);"><option value="all">All Levels</option><option value="info">Info</option><option value="warn">Warning</option><option value="error">Error</option></select><input type="text" id="god-logs-search" placeholder="Search logs..." style="flex: 1; min-width: 200px; padding: 10px 16px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary);" onkeyup="godSearchLogs()"></div></div></div>
          <div class="card"><div class="card-body" style="padding: 0;"><div id="god-logs-container" style="max-height: 600px; overflow-y: auto; font-family: 'Monaco', 'Menlo', monospace; font-size: 12px;"><div style="padding: 40px; text-align: center; color: var(--text-muted);">Loading logs...</div></div></div></div>
        </section>

        <!-- GOD MODE - Analytics Dashboard -->
        <section id="page-god-analytics" class="page-section">
          <div class="page-header" style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 16px;">
            <div>
              <h1 class="page-title" style="color: #a855f7;"><span style="margin-right: 8px;">ðŸ“Š</span> Analytics Dashboard</h1>
              <p class="page-subtitle">Website traffic, user engagement, and performance metrics</p>
            </div>
            <div style="display: flex; gap: 12px; align-items: center;">
              <div id="god-ga-status" style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: rgba(255,255,255,0.05); border-radius: 8px; font-size: 13px;">
                <span id="god-ga-indicator" style="width: 8px; height: 8px; border-radius: 50%; background: var(--warning);"></span>
                <span id="god-ga-text">GA4 Not Connected</span>
              </div>
              <button id="god-ga-connect-btn" class="btn-modern secondary" onclick="godConnectGoogleAnalytics()" style="display: flex; align-items: center; gap: 8px;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                Connect GA4
              </button>
              <select id="god-analytics-range" onchange="godLoadAnalytics()" style="padding: 10px 16px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary);">
                <option value="7">Last 7 Days</option>
                <option value="30" selected>Last 30 Days</option>
                <option value="90">Last 90 Days</option>
              </select>
              <button class="btn-modern primary" onclick="godLoadAnalytics()">Refresh</button>
            </div>
          </div>

          <!-- Analytics Stats -->
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin: 24px 0;">
            <div class="stat-card-mini" style="border-left: 3px solid var(--accent);">
              <div class="stat-card-value" id="god-analytics-visitors">-</div>
              <div class="stat-card-label">Total Visitors</div>
            </div>
            <div class="stat-card-mini" style="border-left: 3px solid var(--success);">
              <div class="stat-card-value" id="god-analytics-pageviews">-</div>
              <div class="stat-card-label">Page Views</div>
            </div>
            <div class="stat-card-mini" style="border-left: 3px solid var(--info);">
              <div class="stat-card-value" id="god-analytics-sessions">-</div>
              <div class="stat-card-label">Sessions</div>
            </div>
            <div class="stat-card-mini" style="border-left: 3px solid #a855f7;">
              <div class="stat-card-value" id="god-analytics-bounce">-</div>
              <div class="stat-card-label">Bounce Rate</div>
            </div>
            <div class="stat-card-mini" style="border-left: 3px solid var(--warning);">
              <div class="stat-card-value" id="god-analytics-duration">-</div>
              <div class="stat-card-label">Avg. Duration</div>
            </div>
            <div class="stat-card-mini" style="border-left: 3px solid var(--success);">
              <div class="stat-card-value" id="god-analytics-conversions">-</div>
              <div class="stat-card-label">Conversions</div>
            </div>
          </div>

          <!-- Analytics Tabs -->
          <div class="tabs-modern" style="margin-bottom: 24px;">
            <button class="tab-modern active" onclick="godShowAnalyticsTab('overview')">Overview</button>
            <button class="tab-modern" onclick="godShowAnalyticsTab('traffic')">Traffic Sources</button>
            <button class="tab-modern" onclick="godShowAnalyticsTab('pages')">Top Pages</button>
            <button class="tab-modern" onclick="godShowAnalyticsTab('users')">User Activity</button>
            <button class="tab-modern" onclick="godShowAnalyticsTab('seo')">Search Console</button>
            <button class="tab-modern" onclick="godShowAnalyticsTab('gmb')">Google Business</button>
          </div>

          <!-- Overview Tab -->
          <div id="god-analytics-tab-overview" class="god-analytics-tab">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 24px;">
              <div class="card">
                <div class="card-header"><h3 class="card-title">Traffic Over Time</h3></div>
                <div class="card-body">
                  <div id="god-chart-traffic" style="height: 250px; display: flex; align-items: center; justify-content: center; color: var(--text-muted);">
                    <div style="text-align: center;">
                      <div style="font-size: 48px; margin-bottom: 12px;">ðŸ“ˆ</div>
                      <p>Connect Google Analytics to view traffic data</p>
                      <button class="btn-modern secondary" onclick="godConnectGoogleAnalytics()" style="margin-top: 12px;">Connect GA4</button>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card">
                <div class="card-header"><h3 class="card-title">Real-Time Visitors</h3></div>
                <div class="card-body">
                  <div id="god-realtime-visitors" style="text-align: center; padding: 20px;">
                    <div style="font-size: 64px; font-weight: 700; color: var(--success);" id="god-realtime-count">-</div>
                    <div style="color: var(--text-muted); margin-top: 8px;">Active users right now</div>
                    <div style="margin-top: 16px; display: flex; justify-content: center; gap: 24px;">
                      <div><span style="font-size: 24px; font-weight: 600;" id="god-realtime-desktop">-</span><br><span style="font-size: 12px; color: var(--text-muted);">Desktop</span></div>
                      <div><span style="font-size: 24px; font-weight: 600;" id="god-realtime-mobile">-</span><br><span style="font-size: 12px; color: var(--text-muted);">Mobile</span></div>
                      <div><span style="font-size: 24px; font-weight: 600;" id="god-realtime-tablet">-</span><br><span style="font-size: 12px; color: var(--text-muted);">Tablet</span></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Traffic Sources Tab -->
          <div id="god-analytics-tab-traffic" class="god-analytics-tab" style="display: none;">
            <div class="card">
              <div class="card-header"><h3 class="card-title">Traffic Sources</h3></div>
              <div class="card-body" style="padding: 0;">
                <div id="god-traffic-sources" style="max-height: 400px; overflow-y: auto;">
                  <div style="padding: 40px; text-align: center; color: var(--text-muted);">Loading traffic sources...</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Top Pages Tab -->
          <div id="god-analytics-tab-pages" class="god-analytics-tab" style="display: none;">
            <div class="card">
              <div class="card-header"><h3 class="card-title">Top Pages</h3></div>
              <div class="card-body" style="padding: 0;">
                <div id="god-top-pages" style="max-height: 400px; overflow-y: auto;">
                  <div style="padding: 40px; text-align: center; color: var(--text-muted);">Loading top pages...</div>
                </div>
              </div>
            </div>
          </div>

          <!-- User Activity Tab -->
          <div id="god-analytics-tab-users" class="god-analytics-tab" style="display: none;">
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">User Activity Log</h3>
                <button class="btn-modern secondary" onclick="godExportUserActivity()" style="padding: 8px 16px; font-size: 13px;">Export CSV</button>
              </div>
              <div class="card-body" style="padding: 0;">
                <div id="god-user-activity" style="max-height: 500px; overflow-y: auto;">
                  <div style="padding: 40px; text-align: center; color: var(--text-muted);">Loading user activity...</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Search Console Tab -->
          <div id="god-analytics-tab-seo" class="god-analytics-tab" style="display: none;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 24px;">
              <div class="stat-card-mini" style="border-left: 3px solid #4285f4;">
                <div class="stat-card-value" id="god-gsc-clicks">-</div>
                <div class="stat-card-label">Total Clicks</div>
              </div>
              <div class="stat-card-mini" style="border-left: 3px solid #34a853;">
                <div class="stat-card-value" id="god-gsc-impressions">-</div>
                <div class="stat-card-label">Impressions</div>
              </div>
              <div class="stat-card-mini" style="border-left: 3px solid #fbbc05;">
                <div class="stat-card-value" id="god-gsc-ctr">-</div>
                <div class="stat-card-label">CTR</div>
              </div>
              <div class="stat-card-mini" style="border-left: 3px solid #ea4335;">
                <div class="stat-card-value" id="god-gsc-position">-</div>
                <div class="stat-card-label">Avg Position</div>
              </div>
            </div>
            <div class="card">
              <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                <h3 class="card-title">Top Search Queries</h3>
                <button class="btn-modern secondary" onclick="godLoadSearchConsole()" style="padding: 6px 12px; font-size: 12px;">Refresh</button>
              </div>
              <div class="card-body" style="padding: 0;">
                <div id="god-gsc-queries" style="max-height: 400px; overflow-y: auto;">
                  <div style="padding: 40px; text-align: center; color: var(--text-muted);">Click "Connect GA4" to load Search Console data</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Google Business Profile Tab -->
          <div id="god-analytics-tab-gmb" class="god-analytics-tab" style="display: none;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 24px;">
              <div class="stat-card-mini" style="border-left: 3px solid #4285f4;">
                <div class="stat-card-value" id="god-gmb-views">-</div>
                <div class="stat-card-label">Profile Views</div>
              </div>
              <div class="stat-card-mini" style="border-left: 3px solid #34a853;">
                <div class="stat-card-value" id="god-gmb-searches">-</div>
                <div class="stat-card-label">Search Views</div>
              </div>
              <div class="stat-card-mini" style="border-left: 3px solid #fbbc05;">
                <div class="stat-card-value" id="god-gmb-calls">-</div>
                <div class="stat-card-label">Phone Calls</div>
              </div>
              <div class="stat-card-mini" style="border-left: 3px solid #ea4335;">
                <div class="stat-card-value" id="god-gmb-directions">-</div>
                <div class="stat-card-label">Direction Requests</div>
              </div>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 24px;">
              <div class="card">
                <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                  <h3 class="card-title">Recent Reviews</h3>
                  <button class="btn-modern secondary" onclick="godLoadGoogleBusiness()" style="padding: 6px 12px; font-size: 12px;">Refresh</button>
                </div>
                <div class="card-body" style="padding: 0;">
                  <div id="god-gmb-reviews" style="max-height: 400px; overflow-y: auto;">
                    <div style="padding: 40px; text-align: center; color: var(--text-muted);">Click "Connect GA4" to load Google Business data</div>
                  </div>
                </div>
              </div>
              <div class="card">
                <div class="card-header"><h3 class="card-title">Business Actions</h3></div>
                <div class="card-body">
                  <div id="god-gmb-actions" style="min-height: 200px;">
                    <div style="padding: 40px; text-align: center; color: var(--text-muted);">Loading business metrics...</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Bing Webmaster Tab (moved to after GMB) -->
          <div id="god-analytics-tab-bing" class="god-analytics-tab" style="display: none;">
            <div class="card">
              <div class="card-header"><h3 class="card-title">Bing Webmaster</h3></div>
              <div class="card-body">
                <div id="god-bing-data" style="text-align: center; padding: 20px;">
                  <div style="font-size: 48px; margin-bottom: 12px;">ðŸ…±ï¸</div>
                  <p style="color: var(--text-muted);">Connect Bing Webmaster Tools to view search data</p>
                  <a href="https://www.bing.com/webmasters" target="_blank" class="btn-modern secondary" style="margin-top: 12px;">Open Bing Webmaster</a>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- GOD MODE - Site Manager -->
        <section id="page-god-site" class="page-section">
          <div class="page-header">
            <h1 class="page-title" style="color: #a855f7;"><span style="margin-right: 8px;">ðŸŒ</span> Site Manager</h1>
            <p class="page-subtitle">Manage website content, SEO, and performance</p>
          </div>

          <!-- Site Stats -->
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 16px; margin: 24px 0;">
            <div class="stat-card-mini" style="border-left: 3px solid var(--success);"><div class="stat-card-value" id="god-site-status">Online</div><div class="stat-card-label">Site Status</div></div>
            <div class="stat-card-mini" style="border-left: 3px solid var(--info);"><div class="stat-card-value" id="god-site-pages">-</div><div class="stat-card-label">Total Pages</div></div>
            <div class="stat-card-mini" style="border-left: 3px solid var(--accent);"><div class="stat-card-value" id="god-site-images">-</div><div class="stat-card-label">Images</div></div>
            <div class="stat-card-mini" style="border-left: 3px solid #a855f7;"><div class="stat-card-value" id="god-site-lighthouse">-</div><div class="stat-card-label">Lighthouse Score</div></div>
          </div>

          <!-- Quick Links -->
          <div class="card" style="margin-bottom: 24px;">
            <div class="card-header"><h3 class="card-title">Quick Links</h3></div>
            <div class="card-body">
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                <a href="https://app.netlify.com/sites/surprise-granite-site/overview" target="_blank" class="btn-modern secondary" style="justify-content: flex-start;">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
                  Netlify Dashboard
                </a>
                <a href="https://github.com/SGK112/surprise-granite-site" target="_blank" class="btn-modern secondary" style="justify-content: flex-start;">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0020 4.77 5.07 5.07 0 0019.91 1S18.73.65 16 2.48a13.38 13.38 0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 005 4.77a5.44 5.44 0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 009 18.13V22"/></svg>
                  GitHub Repository
                </a>
                <a href="https://ypeypgwsycxcagncgdur.supabase.co" target="_blank" class="btn-modern secondary" style="justify-content: flex-start;">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7"/><ellipse cx="12" cy="7" rx="8" ry="4"/></svg>
                  Supabase Dashboard
                </a>
                <a href="https://dashboard.stripe.com" target="_blank" class="btn-modern secondary" style="justify-content: flex-start;">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 4H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2z"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
                  Stripe Dashboard
                </a>
                <a href="https://analytics.google.com" target="_blank" class="btn-modern secondary" style="justify-content: flex-start;">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
                  Google Analytics
                </a>
                <a href="https://search.google.com/search-console" target="_blank" class="btn-modern secondary" style="justify-content: flex-start;">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                  Search Console
                </a>
              </div>
            </div>
          </div>

          <!-- Site Actions -->
          <div class="card" style="margin-bottom: 24px;">
            <div class="card-header"><h3 class="card-title">Site Actions</h3></div>
            <div class="card-body">
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px;">
                <button class="btn-modern secondary" onclick="godClearSiteCache()" style="display: flex; flex-direction: column; align-items: center; padding: 20px; height: auto;">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
                  <span style="margin-top: 8px; font-size: 13px;">Clear All Caches</span>
                </button>
                <button class="btn-modern secondary" onclick="godTriggerDeploy()" style="display: flex; flex-direction: column; align-items: center; padding: 20px; height: auto;">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"/></svg>
                  <span style="margin-top: 8px; font-size: 13px;">Trigger Deploy</span>
                </button>
                <button class="btn-modern secondary" onclick="godCheckSitemap()" style="display: flex; flex-direction: column; align-items: center; padding: 20px; height: auto;">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14,2 14,8 20,8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
                  <span style="margin-top: 8px; font-size: 13px;">Check Sitemap</span>
                </button>
                <button class="btn-modern secondary" onclick="godRunLighthouse()" style="display: flex; flex-direction: column; align-items: center; padding: 20px; height: auto;">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
                  <span style="margin-top: 8px; font-size: 13px;">Run Lighthouse</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Sitemap Status -->
          <div class="card">
            <div class="card-header"><h3 class="card-title">Sitemap & Robots</h3></div>
            <div class="card-body">
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                <div>
                  <h4 style="margin-bottom: 12px; font-size: 14px; color: var(--text-muted);">sitemap.xml</h4>
                  <div id="god-sitemap-status" style="padding: 16px; background: rgba(0,0,0,0.2); border-radius: 8px; font-family: monospace; font-size: 12px;">
                    <a href="/sitemap.xml" target="_blank" style="color: var(--accent);">View Sitemap â†’</a>
                  </div>
                </div>
                <div>
                  <h4 style="margin-bottom: 12px; font-size: 14px; color: var(--text-muted);">robots.txt</h4>
                  <div id="god-robots-status" style="padding: 16px; background: rgba(0,0,0,0.2); border-radius: 8px; font-family: monospace; font-size: 12px;">
                    <a href="/robots.txt" target="_blank" style="color: var(--accent);">View Robots.txt â†’</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- GOD MODE - Configuration -->
        <section id="page-god-config" class="page-section">
          <div class="page-header">
            <h1 class="page-title" style="color: #a855f7;"><span style="margin-right: 8px;">âš™ï¸</span> Configuration</h1>
            <p class="page-subtitle">System configuration, API keys, and feature flags</p>
          </div>

          <!-- Integration Status -->
          <div class="card" style="margin-bottom: 24px;">
            <div class="card-header">
              <h3 class="card-title">Integration Status</h3>
              <button class="btn-modern secondary" onclick="godCheckIntegrations()" style="padding: 8px 16px; font-size: 13px;">Check All</button>
            </div>
            <div class="card-body">
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;" id="god-integrations-status">
                <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                  <div style="width: 12px; height: 12px; border-radius: 50%; background: var(--success);" id="god-int-supabase"></div>
                  <span>Supabase</span>
                </div>
                <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                  <div style="width: 12px; height: 12px; border-radius: 50%; background: var(--success);" id="god-int-stripe"></div>
                  <span>Stripe</span>
                </div>
                <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                  <div style="width: 12px; height: 12px; border-radius: 50%; background: var(--warning);" id="god-int-ga"></div>
                  <span>Google Analytics</span>
                </div>
                <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                  <div style="width: 12px; height: 12px; border-radius: 50%; background: var(--success);" id="god-int-shopify"></div>
                  <span>Shopify</span>
                </div>
                <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                  <div style="width: 12px; height: 12px; border-radius: 50%; background: var(--warning);" id="god-int-email"></div>
                  <span>Email (Nodemailer)</span>
                </div>
                <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                  <div style="width: 12px; height: 12px; border-radius: 50%; background: var(--success);" id="god-int-netlify"></div>
                  <span>Netlify</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Environment Variables (Masked) -->
          <div class="card" style="margin-bottom: 24px;">
            <div class="card-header"><h3 class="card-title">Environment Configuration</h3></div>
            <div class="card-body">
              <div style="display: grid; gap: 12px; font-family: 'Monaco', 'Menlo', monospace; font-size: 13px;">
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                  <span style="color: var(--text-muted);">SUPABASE_URL</span>
                  <span style="color: var(--accent);">https://ypeypgwsycxcagncgdur.supabase.co</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                  <span style="color: var(--text-muted);">SUPABASE_ANON_KEY</span>
                  <span style="color: var(--text-secondary);">eyJh...â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                  <span style="color: var(--text-muted);">STRIPE_PUBLISHABLE_KEY</span>
                  <span style="color: var(--text-secondary);">pk_live_...â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                  <span style="color: var(--text-muted);">API_BASE_URL</span>
                  <span style="color: var(--accent);" id="god-config-api-url">Loading...</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Feature Flags -->
          <div class="card" style="margin-bottom: 24px;">
            <div class="card-header"><h3 class="card-title">Feature Flags</h3></div>
            <div class="card-body">
              <div style="display: grid; gap: 12px;">
                <label style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px; cursor: pointer;">
                  <div>
                    <span style="font-weight: 500;">Maintenance Mode</span>
                    <p style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">Show maintenance page to visitors</p>
                  </div>
                  <input type="checkbox" id="god-flag-maintenance" onchange="godToggleFeature('maintenance', this.checked)" style="width: 20px; height: 20px; accent-color: var(--accent);">
                </label>
                <label style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px; cursor: pointer;">
                  <div>
                    <span style="font-weight: 500;">Debug Mode</span>
                    <p style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">Show debug info in console</p>
                  </div>
                  <input type="checkbox" id="god-flag-debug" onchange="godToggleFeature('debug', this.checked)" style="width: 20px; height: 20px; accent-color: var(--accent);">
                </label>
                <label style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px; cursor: pointer;">
                  <div>
                    <span style="font-weight: 500;">Beta Features</span>
                    <p style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">Enable experimental features</p>
                  </div>
                  <input type="checkbox" id="god-flag-beta" onchange="godToggleFeature('beta', this.checked)" style="width: 20px; height: 20px; accent-color: var(--accent);">
                </label>
                <label style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px; cursor: pointer;">
                  <div>
                    <span style="font-weight: 500;">AI Assistant</span>
                    <p style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">Enable AI-powered features</p>
                  </div>
                  <input type="checkbox" id="god-flag-ai" checked onchange="godToggleFeature('ai', this.checked)" style="width: 20px; height: 20px; accent-color: var(--accent);">
                </label>
              </div>
            </div>
          </div>

          <!-- Danger Zone -->
          <div class="card" style="border: 1px solid rgba(239, 68, 68, 0.3);">
            <div class="card-header" style="background: rgba(239, 68, 68, 0.1);"><h3 class="card-title" style="color: var(--error);">Danger Zone</h3></div>
            <div class="card-body">
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                <button class="btn-modern secondary" onclick="godPurgeAllData()" style="color: var(--error); border-color: rgba(239, 68, 68, 0.3);">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6"/></svg>
                  Purge Cache
                </button>
                <button class="btn-modern secondary" onclick="godResetAnalytics()" style="color: var(--error); border-color: rgba(239, 68, 68, 0.3);">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/></svg>
                  Reset Local Analytics
                </button>
              </div>
            </div>
          </div>
        </section>

        <!-- All Designs (God Mode) -->
        <section id="page-god-designs" class="page-section">
          <div class="page-header" style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 16px;">
            <div>
              <h1 class="page-title" style="color: #a855f7;"><span style="margin-right: 8px;">ðŸ </span> All Designs</h1>
              <p class="page-subtitle">View and manage all room designs across all users</p>
            </div>
            <div style="display: flex; gap: 12px;">
              <button class="btn-modern secondary" onclick="godExportDesigns()">Export CSV</button>
              <button class="btn-modern primary" onclick="godLoadDesigns()">Refresh</button>
            </div>
          </div>

          <!-- Summary Stats -->
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin: 24px 0;">
            <div class="stat-card-mini"><div class="stat-card-value" id="god-designs-total">-</div><div class="stat-card-label">Total Designs</div></div>
            <div class="stat-card-mini"><div class="stat-card-value" id="god-designs-shared" style="color: var(--success);">-</div><div class="stat-card-label">Shared</div></div>
            <div class="stat-card-mini"><div class="stat-card-value" id="god-designs-private" style="color: var(--text-muted);">-</div><div class="stat-card-label">Private</div></div>
            <div class="stat-card-mini"><div class="stat-card-value" id="god-designs-users" style="color: var(--accent);">-</div><div class="stat-card-label">Unique Users</div></div>
          </div>

          <!-- Search & Filters -->
          <div class="card" style="margin-bottom: 24px;">
            <div class="card-body">
              <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
                <div style="flex: 1; min-width: 250px; position: relative;">
                  <svg style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-muted);" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                  <input type="text" id="god-designs-search" placeholder="Search by design name or creator email..." style="width: 100%; padding: 12px 12px 12px 40px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary);" onkeyup="godSearchDesigns()">
                </div>
                <select id="god-designs-type-filter" onchange="godFilterDesignsType()" style="padding: 12px 16px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary); min-width: 150px;">
                  <option value="all">All Room Types</option>
                  <option value="kitchen">Kitchen</option>
                  <option value="bathroom">Bathroom</option>
                  <option value="laundry">Laundry</option>
                  <option value="outdoor">Outdoor</option>
                  <option value="other">Other</option>
                </select>
                <select id="god-designs-status-filter" onchange="godFilterDesignsStatus()" style="padding: 12px 16px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary); min-width: 150px;">
                  <option value="all">All Status</option>
                  <option value="shared">Shared</option>
                  <option value="private">Private</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Designs Table -->
          <div class="card">
            <div class="card-body" style="padding: 0; overflow-x: auto;">
              <table style="width: 100%; border-collapse: collapse; min-width: 900px;">
                <thead>
                  <tr style="background: rgba(255,255,255,0.03); border-bottom: 1px solid var(--border-subtle);">
                    <th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Design</th>
                    <th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Creator</th>
                    <th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Room Type</th>
                    <th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Elements</th>
                    <th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Quote Total</th>
                    <th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Status</th>
                    <th style="padding: 12px 16px; text-align: left; font-weight: 600; font-size: 13px; color: var(--text-muted);">Created</th>
                    <th style="padding: 12px 16px; text-align: center; font-weight: 600; font-size: 13px; color: var(--text-muted);">Actions</th>
                  </tr>
                </thead>
                <tbody id="god-designs-table-body">
                  <tr><td colspan="8" style="padding: 40px; text-align: center; color: var(--text-muted);">Loading designs...</td></tr>
                </tbody>
              </table>
            </div>
            <div class="card-footer" style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-top: 1px solid var(--border-subtle);">
              <span id="god-designs-count" style="font-size: 13px; color: var(--text-muted);">Showing 0 designs</span>
              <div style="display: flex; gap: 8px;">
                <button class="btn-modern secondary" onclick="godDesignsPagePrev()" id="god-designs-prev" disabled style="padding: 8px 12px; font-size: 13px;">Previous</button>
                <button class="btn-modern secondary" onclick="godDesignsPageNext()" id="god-designs-next" style="padding: 8px 12px; font-size: 13px;">Next</button>
              </div>
            </div>
          </div>
        </section>

        <!-- ==================== END GOD MODE PAGES ==================== -->

        <!-- Products Page -->
        <section id="page-products" class="page-section">
          <div class="page-header" style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 16px;">
            <div>
              <h1 class="page-title">Product Management</h1>
              <p class="page-subtitle">Manage your product catalog</p>
            </div>
            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
              <button class="btn-modern secondary" onclick="openImportModal()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                  <polyline points="17 8 12 3 7 8"/>
                  <line x1="12" y1="3" x2="12" y2="15"/>
                </svg>
                Import
              </button>
              <button class="btn-modern secondary" onclick="exportProductsCSV()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                  <polyline points="7 10 12 15 17 10"/>
                  <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                Export
              </button>
              <button class="btn-modern primary" onclick="openProductModal()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 4v16m8-8H4"/>
                </svg>
                Add Product
              </button>
            </div>
          </div>

          <!-- Products Stats -->
          <div class="stats-row" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-top: 24px; margin-bottom: 24px;">
            <div class="stat-card-mini">
              <div class="stat-card-value" id="stat-total-products">-</div>
              <div class="stat-card-label">Total Products</div>
            </div>
            <div class="stat-card-mini">
              <div class="stat-card-value" id="stat-active-products" style="color: var(--success);">-</div>
              <div class="stat-card-label">Active</div>
            </div>
            <div class="stat-card-mini">
              <div class="stat-card-value" id="stat-draft-products" style="color: var(--warning);">-</div>
              <div class="stat-card-label">Draft</div>
            </div>
            <div class="stat-card-mini">
              <div class="stat-card-value" id="stat-lowstock-products" style="color: var(--error);">-</div>
              <div class="stat-card-label">Low Stock</div>
            </div>
          </div>

          <!-- Search & Filters -->
          <div style="display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 200px; position: relative;">
              <svg style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-muted);" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
              </svg>
              <input type="text" id="products-search" placeholder="Search products by name, SKU, vendor..."
                style="width: 100%; padding: 12px 12px 12px 40px; background: var(--dark-elevated); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary); font-size: 14px;"
                aria-label="Search products">
            </div>
            <select id="products-vendor-filter" onchange="filterProductsList()"
              style="padding: 12px 16px; background: var(--dark-elevated); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary); font-size: 14px; min-width: 150px;"
              aria-label="Filter by vendor">
              <option value="">All Vendors</option>
            </select>
            <select id="products-type-filter" onchange="filterProductsList()"
              style="padding: 12px 16px; background: var(--dark-elevated); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary); font-size: 14px; min-width: 150px;"
              aria-label="Filter by product type">
              <option value="">All Types</option>
            </select>
          </div>

          <!-- Status Filters -->
          <div class="table-filters" style="margin-bottom: 20px;">
            <button class="filter-btn active" data-product-status="all" onclick="filterProductsByStatus('all')">All <span id="products-count-all" style="opacity: 0.7; margin-left: 4px;">0</span></button>
            <button class="filter-btn" data-product-status="active" onclick="filterProductsByStatus('active')">Active <span id="products-count-active" style="opacity: 0.7; margin-left: 4px;">0</span></button>
            <button class="filter-btn" data-product-status="draft" onclick="filterProductsByStatus('draft')">Draft <span id="products-count-draft" style="opacity: 0.7; margin-left: 4px;">0</span></button>
            <button class="filter-btn" data-product-status="discontinued" onclick="filterProductsByStatus('discontinued')">Discontinued <span id="products-count-discontinued" style="opacity: 0.7; margin-left: 4px;">0</span></button>
          </div>

          <!-- Bulk Actions -->
          <div id="products-bulk-actions" style="display: none; align-items: center; gap: 12px; padding: 12px 16px; background: var(--dark-elevated); border: 1px solid var(--gold-primary); border-radius: 10px; margin-bottom: 16px;">
            <span><strong id="products-selected-count" style="color: var(--gold-primary);">0</strong> selected</span>
            <button class="btn-modern small" style="padding: 6px 12px; font-size: 13px;" onclick="bulkUpdateProducts('active')">Set Active</button>
            <button class="btn-modern secondary small" style="padding: 6px 12px; font-size: 13px;" onclick="bulkUpdateProducts('draft')">Set Draft</button>
            <button class="btn-modern secondary small" style="padding: 6px 12px; font-size: 13px; color: var(--error);" onclick="bulkDeleteProducts()">Delete</button>
            <button class="btn-modern secondary small" style="padding: 6px 12px; font-size: 13px; margin-left: auto;" onclick="clearProductSelection()">Clear</button>
          </div>

          <!-- Products Loading State -->
          <div id="products-loading" class="loading-state">
            <div class="spinner"></div>
            <p>Loading products...</p>
          </div>

          <!-- Products Empty State -->
          <div id="products-empty" class="empty-state" style="display: none;">
            <div class="empty-icon">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
              </svg>
            </div>
            <h3>No Products Yet</h3>
            <p>Add your first product to get started.</p>
            <button class="btn-modern primary" onclick="openProductModal()">Add Product</button>
          </div>

          <!-- Products Table -->
          <div id="products-table-container" style="display: none; background: var(--dark-elevated); border: 1px solid var(--border-subtle); border-radius: 12px; overflow: hidden;">
            <div style="overflow-x: auto;">
              <table style="width: 100%; border-collapse: collapse; min-width: 800px;">
                <thead>
                  <tr style="background: var(--dark-surface);">
                    <th style="padding: 14px 16px; text-align: left; font-size: 12px; font-weight: 600; text-transform: uppercase; color: var(--text-muted); width: 40px;">
                      <input type="checkbox" id="products-select-all" onchange="toggleAllProducts()" style="accent-color: var(--gold-primary);">
                    </th>
                    <th style="padding: 14px 16px; text-align: left; font-size: 12px; font-weight: 600; text-transform: uppercase; color: var(--text-muted); width: 60px;">Image</th>
                    <th style="padding: 14px 16px; text-align: left; font-size: 12px; font-weight: 600; text-transform: uppercase; color: var(--text-muted);">Product</th>
                    <th style="padding: 14px 16px; text-align: left; font-size: 12px; font-weight: 600; text-transform: uppercase; color: var(--text-muted);">SKU</th>
                    <th style="padding: 14px 16px; text-align: left; font-size: 12px; font-weight: 600; text-transform: uppercase; color: var(--text-muted);">Price</th>
                    <th style="padding: 14px 16px; text-align: left; font-size: 12px; font-weight: 600; text-transform: uppercase; color: var(--text-muted);">Stock</th>
                    <th style="padding: 14px 16px; text-align: left; font-size: 12px; font-weight: 600; text-transform: uppercase; color: var(--text-muted);">Status</th>
                    <th style="padding: 14px 16px; text-align: left; font-size: 12px; font-weight: 600; text-transform: uppercase; color: var(--text-muted); width: 100px;">Actions</th>
                  </tr>
                </thead>
                <tbody id="products-table-body"></tbody>
              </table>
            </div>

            <!-- Pagination -->
            <div id="products-pagination" style="display: flex; justify-content: space-between; align-items: center; padding: 16px; border-top: 1px solid var(--border-subtle);">
              <div id="products-page-info" style="color: var(--text-muted); font-size: 14px;">Showing 1-50 of 0</div>
              <div style="display: flex; gap: 8px;">
                <button id="products-prev-btn" onclick="productsPagePrev()" class="btn-modern secondary" style="padding: 8px 16px;" disabled>Previous</button>
                <button id="products-next-btn" onclick="productsPageNext()" class="btn-modern secondary" style="padding: 8px 16px;">Next</button>
              </div>
            </div>
          </div>
        </section>

        <!-- Orders Page -->
        <section id="page-orders" class="page-section">
          <div class="page-header" style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 16px;">
            <div>
              <h1 class="page-title">Order History</h1>
              <p class="page-subtitle">View and manage all orders</p>
            </div>
            <button class="btn-modern secondary" onclick="exportOrdersCSV()">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
              </svg>
              Export CSV
            </button>
          </div>

          <!-- Orders Stats -->
          <div id="orders-stats" class="stats-row" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-top: 24px; margin-bottom: 24px;">
            <div class="stat-card-mini">
              <div class="stat-card-value" id="stat-total-orders">-</div>
              <div class="stat-card-label">Total Orders</div>
            </div>
            <div class="stat-card-mini">
              <div class="stat-card-value" id="stat-orders-revenue" style="color: var(--success);">-</div>
              <div class="stat-card-label">Revenue</div>
            </div>
            <div class="stat-card-mini">
              <div class="stat-card-value" id="stat-paid-orders" style="color: var(--info);">-</div>
              <div class="stat-card-label">Paid</div>
            </div>
            <div class="stat-card-mini">
              <div class="stat-card-value" id="stat-fulfilled-orders" style="color: var(--gold-primary);">-</div>
              <div class="stat-card-label">Fulfilled</div>
            </div>
          </div>

          <!-- Search & Filters -->
          <div style="display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 200px; position: relative;">
              <svg style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-muted);" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
              </svg>
              <input type="text" id="orders-search" placeholder="Search orders..."
                style="width: 100%; padding: 12px 12px 12px 40px; background: var(--dark-elevated); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary); font-size: 14px;"
                aria-label="Search orders">
            </div>
            <select id="orders-status-filter" onchange="filterOrders()"
              style="padding: 12px 16px; background: var(--dark-elevated); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary); font-size: 14px; min-width: 140px;"
              aria-label="Filter by payment status">
              <option value="">All Statuses</option>
              <option value="paid">Paid</option>
              <option value="pending">Pending</option>
              <option value="refunded">Refunded</option>
            </select>
            <select id="orders-fulfillment-filter" onchange="filterOrders()"
              style="padding: 12px 16px; background: var(--dark-elevated); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary); font-size: 14px; min-width: 140px;"
              aria-label="Filter by fulfillment status">
              <option value="">All Fulfillment</option>
              <option value="fulfilled">Fulfilled</option>
              <option value="unfulfilled">Unfulfilled</option>
              <option value="partial">Partial</option>
            </select>
          </div>

          <!-- Orders Loading State -->
          <div id="orders-loading" class="loading-state">
            <div class="spinner"></div>
            <p>Loading orders...</p>
          </div>

          <!-- Orders Empty State -->
          <div id="orders-empty" class="empty-state" style="display: none;">
            <div class="empty-icon">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
              </svg>
            </div>
            <h3>No Orders Yet</h3>
            <p>When you place orders, they'll appear here.</p>
            <a href="/shop/" class="btn-modern primary">Browse Products</a>
          </div>

          <!-- Orders List -->
          <div id="orders-list" class="orders-container" style="display: none;"></div>

          <!-- Pagination -->
          <div id="orders-pagination" style="display: none; justify-content: space-between; align-items: center; margin-top: 20px; padding: 16px; background: var(--dark-elevated); border-radius: 12px;">
            <div id="orders-page-info" style="color: var(--text-muted); font-size: 14px;">Showing 1-50 of 557</div>
            <div style="display: flex; gap: 8px;">
              <button id="orders-prev-btn" onclick="ordersPagePrev()" class="btn-modern secondary" style="padding: 8px 16px;" disabled>Previous</button>
              <button id="orders-next-btn" onclick="ordersPageNext()" class="btn-modern secondary" style="padding: 8px 16px;">Next</button>
            </div>
          </div>
        </section>

        <!-- Messages Page -->
        <section id="page-messages" class="page-section">
          <div class="page-header-modern">
            <div>
              <h1>Messages</h1>
              <p class="page-subtitle">Communicate with customers</p>
            </div>
            <button class="btn-modern primary" onclick="openNewMessageModal()">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
              New Message
            </button>
          </div>

          <div class="messages-container">
            <!-- Conversations List -->
            <div class="conversations-list">
              <!-- Mobile Toggle Header -->
              <div class="conversations-toggle" onclick="toggleConversationsList()" style="display: none;">
                <h4>
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
                  Conversations
                  <span id="conversations-count-badge" style="background: var(--gold); color: var(--dark); padding: 2px 8px; border-radius: 10px; font-size: 11px; font-weight: 600; margin-left: 8px;">0</span>
                </h4>
                <svg class="toggle-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg>
              </div>
              <div class="conversations-header">
                <input type="text" class="search-input-modern" id="conversation-search" placeholder="Search messages..." oninput="filterConversations(this.value)" aria-label="Search messages">
                <div class="filter-chips">
                  <button class="filter-chip active" data-filter="all" onclick="setNotificationFilter('all')">All</button>
                  <button class="filter-chip" data-filter="unread" onclick="setNotificationFilter('unread')">Unread</button>
                  <button class="filter-chip" data-filter="messages" onclick="setNotificationFilter('messages')">Messages</button>
                  <button class="filter-chip" data-filter="leads" onclick="setNotificationFilter('leads')">Leads</button>
                </div>
              </div>
              <div class="conversations-items" id="conversations-list">
                <div class="loading-state">
                  <div class="spinner-modern"></div>
                  <span>Loading conversations...</span>
                </div>
              </div>
            </div>

            <!-- Message Thread -->
            <div class="message-thread" id="message-thread">
              <div class="thread-header" id="thread-header" style="display: none;">
                <div class="thread-contact">
                  <div class="avatar-modern" id="thread-avatar">?</div>
                  <div class="thread-info">
                    <h3 id="thread-name">Select a conversation</h3>
                    <span class="thread-status" id="thread-status"></span>
                  </div>
                </div>
                <div class="thread-actions">
                  <button class="btn-icon" onclick="callCustomer()" title="Call">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg>
                  </button>
                  <button class="btn-icon" onclick="emailCustomer()" title="Email">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                  </button>
                  <button class="btn-icon" onclick="viewCustomerProfile()" title="View Profile">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                  </button>
                </div>
              </div>

              <div class="thread-messages" id="thread-messages">
                <div class="empty-thread">
                  <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1"><path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
                  <h3>Select a conversation</h3>
                  <p>Choose a customer from the list to view messages</p>
                </div>
              </div>

              <div class="message-input-area" id="message-input-area" style="display: none;">
                <div class="message-input-wrapper">
                  <button class="btn-icon attachment-btn" onclick="attachFile()" title="Attach file">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"/></svg>
                  </button>
                  <textarea id="message-input" class="message-input" placeholder="Type your message..." rows="1" onkeydown="handleMessageKeydown(event)"></textarea>
                  <button class="btn-modern primary send-btn" onclick="sendMessage()" id="send-message-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>
                  </button>
                </div>
                <div class="message-channel-selector">
                  <label class="channel-option">
                    <input type="radio" name="message-channel" value="in_app" checked>
                    <span>In-App</span>
                  </label>
                  <label class="channel-option">
                    <input type="radio" name="message-channel" value="email">
                    <span>Email</span>
                  </label>
                  <label class="channel-option">
                    <input type="radio" name="message-channel" value="sms">
                    <span>SMS</span>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>

      <!-- Mobile Floating Action Buttons -->
      <button class="fab-modern" id="fab-leads" onclick="openAddLeadModal()" style="display: none;" title="Add Lead">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>
      </button>
      <button class="fab-modern" id="fab-estimates" onclick="openCreateEstimateModal()" style="display: none;" title="New Estimate">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
      </button>
      <button class="fab-modern" id="fab-invoices" onclick="openInvoiceModal()" style="display: none;" title="New Invoice">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
      </button>
      <button class="fab-modern" id="fab-jobs" onclick="openNewJobModal()" style="display: none;" title="New Job">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
      </button>
      <button class="fab-modern" id="fab-customers" onclick="openAddCustomerModal()" style="display: none;" title="Add Customer">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
      </button>
    </main>

  </div>

  <!-- Lead Detail Modal - Modern Sheet Style -->
  <div class="modal-modern-overlay" id="lead-modal" onclick="if(event.target === this) closeLeadModal()">
    <div class="modal-modern" style="max-width: 500px;">
      <div class="modal-drag-handle"></div>
      <div class="modal-modern-header">
        <h2>Lead Details</h2>
        <button class="btn-icon" onclick="closeLeadModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="modal-modern-body" id="lead-details"></div>

      <!-- Linked Estimates Section -->
      <div class="detail-section" style="padding: 0 24px 16px;">
        <div class="detail-section-title">Linked Estimates</div>
        <div id="lead-estimates-list" class="list-modern">
          <div style="padding: 16px; color: var(--text-muted); font-size: 13px; text-align: center;">No estimates yet</div>
        </div>
      </div>

      <!-- Messages Section -->
      <div class="detail-section" style="padding: 0 24px 16px;">
        <div class="detail-section-title" style="display: flex; justify-content: space-between; align-items: center;">
          <span>ðŸ’¬ Messages & Comments</span>
          <span id="lead-unread-badge" style="display: none; background: var(--gold-primary); color: var(--dark-bg); padding: 2px 8px; border-radius: 10px; font-size: 11px; font-weight: 600;">0 new</span>
        </div>
        <div id="lead-messages-list" style="max-height: 200px; overflow-y: auto; margin-bottom: 12px;">
          <div style="padding: 16px; color: var(--text-muted); font-size: 13px; text-align: center;">No messages yet</div>
        </div>
        <div style="display: flex; gap: 8px;">
          <input type="text" id="lead-message-input" placeholder="Type a reply..." class="input-modern" style="flex: 1; padding: 10px 14px; font-size: 14px;">
          <button class="btn-modern primary" onclick="sendLeadReply()" style="padding: 10px 16px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>
          </button>
        </div>
      </div>

      <!-- Quick Actions Grid -->
      <div style="padding: 0 24px 16px;">
        <div class="detail-section-title">Status</div>
        <select class="input-modern select-modern" id="lead-status-select" onchange="updateLeadStatus()" style="margin-bottom: 16px;">
          <option value="new">New</option>
          <option value="contacted">Contacted</option>
          <option value="qualified">Qualified</option>
          <option value="quoted">Quoted</option>
          <option value="won">Won - Converted</option>
          <option value="lost">Lost</option>
        </select>

        <div class="detail-section-title">Actions</div>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
          <button class="btn-modern primary" onclick="scheduleWorkflowForLead()" style="grid-column: span 2; background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
            Schedule Project Workflow
          </button>
          <button class="btn-modern secondary" onclick="scheduleAppointmentForLead()" style="grid-column: span 2;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
            Quick Single Event
          </button>
          <button class="btn-modern secondary" onclick="convertLeadToCustomer()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>
            Add Customer
          </button>
          <button class="btn-modern secondary" onclick="createEstimateFromLead()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
            Create Estimate
          </button>
          <button class="btn-modern secondary" onclick="createDesignFromLead()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"/></svg>
            Create Design
          </button>
          <button class="btn-modern secondary" onclick="inviteLeadAsCollaborator()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>
            Invite to Project
          </button>
          <button class="btn-modern secondary" onclick="createProjectFromLead()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/></svg>
            Create Project
          </button>
          <button class="btn-modern secondary" onclick="sendInvoiceToLead()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/></svg>
            Send Invoice
          </button>
          <button class="btn-modern ghost" onclick="archiveLead()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"/></svg>
            Archive
          </button>
        </div>
      </div>

      <div class="modal-modern-footer">
        <button class="btn-modern danger" onclick="deleteLead()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
          Delete Lead
        </button>
      </div>
    </div>
  </div>

  <!-- Add New Lead Modal -->
  <div class="modal-overlay" id="add-lead-modal">
    <div class="modal" style="max-width: 600px;">
      <div class="modal-header">
        <h2 class="modal-title">Add New Lead</h2>
        <button class="modal-close" onclick="closeAddLeadModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <form id="add-lead-form" onsubmit="saveNewLead(event)">
        <div class="modal-body">
          <div class="form-row">
            <div class="form-group">
              <label>First Name *</label>
              <input type="text" id="new-lead-first-name" required placeholder="John"/>
            </div>
            <div class="form-group">
              <label>Last Name *</label>
              <input type="text" id="new-lead-last-name" required placeholder="Smith"/>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Email *</label>
              <input type="email" id="new-lead-email" required placeholder="john@example.com"/>
            </div>
            <div class="form-group">
              <label>Phone</label>
              <input type="tel" id="new-lead-phone" placeholder="(555) 123-4567"/>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Project Type</label>
              <select id="new-lead-project-type">
                <option value="">Select Type</option>
                <option value="kitchen">Kitchen Countertops</option>
                <option value="bathroom">Bathroom Vanity</option>
                <option value="flooring">Flooring</option>
                <option value="fireplace">Fireplace</option>
                <option value="outdoor">Outdoor Kitchen</option>
                <option value="commercial">Commercial</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="form-group">
              <label>ZIP Code</label>
              <input type="text" id="new-lead-zip" placeholder="85374" maxlength="5"/>
            </div>
          </div>

          <!-- Billing Address Section -->
          <div class="form-section" style="margin: 20px 0; padding: 16px; background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="#f9cb00" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
              </svg>
              <span style="font-size: 13px; font-weight: 600; color: #f9cb00; text-transform: uppercase; letter-spacing: 0.5px;">Billing Address</span>
            </div>
            <div class="form-row">
              <div class="form-group" style="flex: 2;">
                <label>Street Address</label>
                <input type="text" id="new-lead-billing-street" placeholder="123 Main St"/>
              </div>
              <div class="form-group" style="flex: 1;">
                <label>Unit/Apt</label>
                <input type="text" id="new-lead-billing-street2" placeholder="Apt 4B"/>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group" style="flex: 2;">
                <label>City</label>
                <input type="text" id="new-lead-billing-city" placeholder="Surprise"/>
              </div>
              <div class="form-group" style="flex: 1;">
                <label>State</label>
                <select id="new-lead-billing-state">
                  <option value="AZ" selected>AZ</option>
                  <option value="CA">CA</option>
                  <option value="CO">CO</option>
                  <option value="NV">NV</option>
                  <option value="NM">NM</option>
                  <option value="TX">TX</option>
                  <option value="UT">UT</option>
                </select>
              </div>
              <div class="form-group" style="flex: 1;">
                <label>ZIP</label>
                <input type="text" id="new-lead-billing-zip" placeholder="85374" maxlength="5"/>
              </div>
            </div>
          </div>

          <!-- Address Same Toggle -->
          <div class="form-group" style="margin: 16px 0; padding: 12px 16px; background: rgba(249,203,0,0.05); border: 1px solid rgba(249,203,0,0.2); border-radius: 8px;">
            <label style="display: flex; align-items: center; gap: 12px; cursor: pointer; margin: 0;">
              <input type="checkbox" id="new-lead-address-same" checked onchange="toggleNewLeadServiceAddress()" style="width: 18px; height: 18px; accent-color: #f9cb00;"/>
              <span style="font-size: 14px;">Service address is the same as billing address</span>
            </label>
          </div>

          <!-- Service Address Section (hidden by default) -->
          <div id="new-lead-service-address-section" style="display: none; margin: 20px 0; padding: 16px; background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="#f9cb00" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
              </svg>
              <span style="font-size: 13px; font-weight: 600; color: #f9cb00; text-transform: uppercase; letter-spacing: 0.5px;">Service Address</span>
            </div>
            <div class="form-row">
              <div class="form-group" style="flex: 2;">
                <label>Street Address</label>
                <input type="text" id="new-lead-service-street" placeholder="456 Project Ave"/>
              </div>
              <div class="form-group" style="flex: 1;">
                <label>Unit/Apt</label>
                <input type="text" id="new-lead-service-street2" placeholder=""/>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group" style="flex: 2;">
                <label>City</label>
                <input type="text" id="new-lead-service-city" placeholder="Surprise"/>
              </div>
              <div class="form-group" style="flex: 1;">
                <label>State</label>
                <select id="new-lead-service-state">
                  <option value="AZ" selected>AZ</option>
                  <option value="CA">CA</option>
                  <option value="CO">CO</option>
                  <option value="NV">NV</option>
                  <option value="NM">NM</option>
                  <option value="TX">TX</option>
                  <option value="UT">UT</option>
                </select>
              </div>
              <div class="form-group" style="flex: 1;">
                <label>ZIP</label>
                <input type="text" id="new-lead-service-zip" placeholder="85374" maxlength="5"/>
              </div>
            </div>
          </div>

          <!-- Appointment Scheduling Section -->
          <div class="form-section" style="margin: 20px 0; padding: 16px; background: rgba(34,197,94,0.05); border: 1px solid rgba(34,197,94,0.2); border-radius: 12px;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="#22c55e" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
              </svg>
              <span style="font-size: 13px; font-weight: 600; color: #22c55e; text-transform: uppercase; letter-spacing: 0.5px;">Schedule Appointment (Optional)</span>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Appointment Date</label>
                <input type="date" id="new-lead-appt-date" min="" style="color-scheme: dark;"/>
              </div>
              <div class="form-group">
                <label>Appointment Time</label>
                <select id="new-lead-appt-time">
                  <option value="">Select Time</option>
                  <option value="8:00 AM">8:00 AM</option>
                  <option value="9:00 AM">9:00 AM</option>
                  <option value="10:00 AM">10:00 AM</option>
                  <option value="11:00 AM">11:00 AM</option>
                  <option value="12:00 PM">12:00 PM</option>
                  <option value="1:00 PM">1:00 PM</option>
                  <option value="2:00 PM">2:00 PM</option>
                  <option value="3:00 PM">3:00 PM</option>
                  <option value="4:00 PM">4:00 PM</option>
                  <option value="5:00 PM">5:00 PM</option>
                </select>
              </div>
            </div>
            <div class="form-group" style="margin-top: 8px;">
              <label>Appointment Type</label>
              <select id="new-lead-appt-type">
                <option value="estimate">Free In-Home Estimate</option>
                <option value="measure">Measurement Visit</option>
                <option value="showroom">Showroom Visit</option>
                <option value="consultation">Design Consultation</option>
                <option value="installation">Installation</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Project Details / Notes</label>
            <textarea id="new-lead-message" rows="3" placeholder="Describe the project or add notes..."></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Lead Source</label>
              <select id="new-lead-source">
                <option value="phone">Phone Call</option>
                <option value="walk-in">Walk-in</option>
                <option value="referral">Referral</option>
                <option value="website">Website</option>
                <option value="social">Social Media</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="form-group">
              <label>Status</label>
              <select id="new-lead-status">
                <option value="new">New</option>
                <option value="contacted">Contacted</option>
                <option value="qualified">Qualified</option>
                <option value="quoted">Quoted</option>
                <option value="won">Won</option>
                <option value="lost">Lost</option>
                <option value="archived">Archived</option>
              </select>
            </div>
          </div>

          <!-- Welcome Email Toggle -->
          <div class="form-group" style="margin: 16px 0; padding: 12px 16px; background: rgba(59,130,246,0.05); border: 1px solid rgba(59,130,246,0.2); border-radius: 8px;">
            <label style="display: flex; align-items: center; gap: 12px; cursor: pointer; margin: 0;">
              <input type="checkbox" id="new-lead-send-email" checked style="width: 18px; height: 18px; accent-color: #3b82f6;"/>
              <div>
                <span style="font-size: 14px; font-weight: 500;">Send welcome email to lead</span>
                <p style="font-size: 12px; color: var(--text-muted); margin: 2px 0 0 0;">A friendly confirmation email will be sent automatically</p>
              </div>
            </label>
          </div>
        </div>
        <div class="modal-footer" style="display: flex; gap: 10px; flex-wrap: wrap;">
          <button type="button" class="btn-modern secondary" onclick="closeAddLeadModal()">Cancel</button>
          <button type="submit" class="btn-modern primary" id="save-lead-btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
            Save Lead
          </button>
          <button type="button" class="btn-modern" id="save-lead-estimate-btn" onclick="saveLeadAndCreateEstimate()" style="background: linear-gradient(135deg, #22c55e, #16a34a); min-width: 160px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
            Save â†’ Estimate
          </button>
          <button type="button" class="btn-modern" id="save-lead-invoice-btn" onclick="saveLeadAndCreateInvoice()" style="background: linear-gradient(135deg, #f9cb00, #cca600); color: #1a1a2e; min-width: 160px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
            Save â†’ Invoice
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Customer Detail Modal -->
  <div class="modal-overlay" id="customer-modal">
    <div class="modal" style="max-width: 900px;">
      <div class="modal-header">
        <h2 class="modal-title" id="customer-detail-modal-title">Customer Details</h2>
        <button class="modal-close" onclick="closeCustomerModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
        <!-- Customer Info Section -->
        <div id="customer-info" style="margin-bottom: 24px;"></div>

        <!-- Tabs -->
        <div class="customer-tabs" style="display: flex; gap: 8px; border-bottom: 1px solid var(--border-subtle); margin-bottom: 16px; flex-wrap: wrap;">
          <button class="tab-btn active" onclick="showCustomerTab('jobs')" data-tab="jobs">Jobs</button>
          <button class="tab-btn" onclick="showCustomerTab('estimates')" data-tab="estimates">Estimates</button>
          <button class="tab-btn" onclick="showCustomerTab('invoices')" data-tab="invoices">Invoices</button>
          <button class="tab-btn" onclick="showCustomerTab('favorites')" data-tab="favorites">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="margin-right: 4px;"><path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>
            Favorites
          </button>
          <button class="tab-btn" onclick="showCustomerTab('messages')" data-tab="messages">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="margin-right: 4px;"><path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
            Messages
          </button>
          <button class="tab-btn" onclick="showCustomerTab('notes')" data-tab="notes">Notes</button>
        </div>

        <!-- Tab Content -->
        <div id="customer-tab-content">
          <div class="empty-state">
            <div class="spinner"></div>
            <p>Loading...</p>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-modern secondary" onclick="editCustomer()">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
          Edit Customer
        </button>
        <button class="btn-modern primary" onclick="createJobForCustomer()">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
          New Job
        </button>
        <button class="btn-modern primary" onclick="createEstimateForCustomer()">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
          New Estimate
        </button>
        <button class="btn-modern secondary" onclick="scheduleAppointmentForCustomer()">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
          Schedule
        </button>
        <button class="btn-modern secondary" onclick="inviteCustomerToProject()">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>
          Invite to Project
        </button>
        <div style="flex: 1;"></div>
        <button class="btn-modern danger" onclick="deleteCustomer()" style="background: #dc2626;">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
          Delete
        </button>
      </div>
    </div>
  </div>

  <!-- Add/Edit Customer Modal -->
  <div class="modal-overlay" id="edit-customer-modal">
    <div class="modal" style="max-width: 600px;">
      <div class="modal-header">
        <h2 class="modal-title" id="edit-customer-title">Add Customer</h2>
        <button class="modal-close" onclick="closeEditCustomerModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <form id="edit-customer-form" onsubmit="saveCustomerForm(event)">
        <div class="modal-body">
          <div class="form-row">
            <div class="form-group">
              <label>Name *</label>
              <input type="text" id="customer-name" required placeholder="John Smith"/>
            </div>
            <div class="form-group">
              <label>Email</label>
              <input type="email" id="customer-email" placeholder="john@example.com"/>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Phone</label>
              <input type="tel" id="customer-phone" placeholder="(555) 123-4567"/>
            </div>
            <div class="form-group">
              <label>Source</label>
              <select id="customer-source">
                <option value="">Select Source</option>
                <option value="website">Website</option>
                <option value="referral">Referral</option>
                <option value="google">Google</option>
                <option value="walk-in">Walk-in</option>
                <option value="phone">Phone Call</option>
                <option value="social">Social Media</option>
                <option value="other">Other</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Address</label>
            <input type="text" id="customer-address" placeholder="123 Main Street"/>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>City</label>
              <input type="text" id="customer-city" placeholder="Surprise"/>
            </div>
            <div class="form-group" style="width: 100px;">
              <label>State</label>
              <input type="text" id="customer-state" placeholder="AZ" maxlength="2"/>
            </div>
            <div class="form-group" style="width: 120px;">
              <label>ZIP</label>
              <input type="text" id="customer-zip" placeholder="85374"/>
            </div>
          </div>

          <div class="form-group">
            <label>Notes</label>
            <textarea id="customer-notes" rows="3" placeholder="Additional notes about this customer..."></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-modern secondary" onclick="closeEditCustomerModal()">Cancel</button>
          <button type="submit" class="btn-modern primary" id="save-customer-btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
            Save Customer
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Product Modal -->
  <div class="modal-overlay" id="product-modal">
    <div class="modal" style="max-width: 700px;">
      <div class="modal-header">
        <h2 class="modal-title" id="product-modal-title">Add New Product</h2>
        <button class="modal-close" onclick="closeProductModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <form id="product-form" onsubmit="saveProduct(event)">
        <input type="hidden" id="product-id">
        <div class="modal-body">
          <div class="form-row">
            <div class="form-group">
              <label>Product Name *</label>
              <input type="text" id="product-name" required placeholder="e.g., Calacatta Gold Marble Slab"/>
            </div>
            <div class="form-group">
              <label>SKU</label>
              <input type="text" id="product-sku" placeholder="e.g., CAL-GOLD-001"/>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Vendor</label>
              <input type="text" id="product-vendor" placeholder="e.g., MSI, Daltile"/>
            </div>
            <div class="form-group">
              <label>Product Type</label>
              <select id="product-type">
                <option value="">Select Type</option>
                <option value="granite">Granite</option>
                <option value="marble">Marble</option>
                <option value="quartz">Quartz</option>
                <option value="quartzite">Quartzite</option>
                <option value="porcelain">Porcelain</option>
                <option value="soapstone">Soapstone</option>
                <option value="remnant">Remnant</option>
                <option value="tile">Tile</option>
                <option value="sink">Sink</option>
                <option value="faucet">Faucet</option>
                <option value="accessory">Accessory</option>
                <option value="other">Other</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Description</label>
            <textarea id="product-description" rows="3" placeholder="Describe your product..."></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Price ($) *</label>
              <input type="number" id="product-price" required min="0" step="0.01" placeholder="0.00"/>
            </div>
            <div class="form-group">
              <label>Compare at Price ($)</label>
              <input type="number" id="product-compare-price" min="0" step="0.01" placeholder="Original price"/>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Cost Price ($)</label>
              <input type="number" id="product-cost" min="0" step="0.01" placeholder="Your cost"/>
            </div>
            <div class="form-group">
              <label>Stock Quantity</label>
              <input type="number" id="product-stock" min="0" value="1" placeholder="1"/>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Status</label>
              <select id="product-status">
                <option value="draft">Draft</option>
                <option value="active">Active</option>
                <option value="discontinued">Discontinued</option>
                <option value="archived">Archived</option>
              </select>
            </div>
            <div class="form-group">
              <label style="display: flex; align-items: center; gap: 8px; margin-top: 28px;">
                <input type="checkbox" id="product-dropship" style="accent-color: var(--gold-primary); width: 18px; height: 18px;">
                Dropship Item
              </label>
            </div>
          </div>

          <div class="form-group" id="product-supplier-group" style="display: none;">
            <label>Supplier Name</label>
            <input type="text" id="product-supplier" placeholder="Supplier for dropship"/>
          </div>

          <div class="form-group">
            <label>Image URL</label>
            <input type="url" id="product-image-url" placeholder="https://example.com/image.jpg"/>
            <small style="color: var(--text-muted); font-size: 12px; margin-top: 4px; display: block;">
              Paste a direct link to your product image
            </small>
          </div>

          <div class="form-group">
            <label>Tags (comma separated)</label>
            <input type="text" id="product-tags" placeholder="e.g., sale, featured, new"/>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-modern secondary" onclick="closeProductModal()">Cancel</button>
          <button type="submit" class="btn-modern primary" id="product-save-btn">Save Product</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Import Products Modal -->
  <div class="modal-overlay" id="import-modal" onclick="if(event.target === this) closeImportModal()">
    <div class="modal" style="max-width: 800px;">
      <div class="modal-header">
        <h2 class="modal-title">Import Products</h2>
        <button class="modal-close" onclick="closeImportModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="modal-body">
        <!-- Step 1: File Upload -->
        <div id="import-step-1">
          <div style="border: 2px dashed var(--border-subtle); border-radius: 12px; padding: 40px; text-align: center; margin-bottom: 20px; transition: all 0.2s;" id="import-dropzone">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="color: var(--text-muted); margin-bottom: 16px;">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="17 8 12 3 7 8"/>
              <line x1="12" y1="3" x2="12" y2="15"/>
            </svg>
            <h3 style="margin-bottom: 8px;">Drop your file here</h3>
            <p style="color: var(--text-muted); margin-bottom: 16px;">or click to browse</p>
            <input type="file" id="import-file-input" accept=".csv,.pdf,.xlsx,.xls" style="display: none;" onchange="handleImportFile(this.files[0])">
            <button type="button" class="btn-modern secondary" onclick="document.getElementById('import-file-input').click()">
              Choose File
            </button>
            <p style="color: var(--text-muted); font-size: 13px; margin-top: 16px;">
              Supported formats: CSV, PDF, Excel (.xlsx, .xls)
            </p>
          </div>

          <div style="background: var(--dark-elevated); border-radius: 10px; padding: 16px;">
            <h4 style="margin-bottom: 12px; font-size: 14px;">Expected CSV Format</h4>
            <p style="color: var(--text-muted); font-size: 13px; margin-bottom: 12px;">
              Your CSV should have headers. Common column names will be auto-mapped:
            </p>
            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
              <span style="background: var(--dark-surface); padding: 4px 10px; border-radius: 6px; font-size: 12px; font-family: monospace;">name/title/product</span>
              <span style="background: var(--dark-surface); padding: 4px 10px; border-radius: 6px; font-size: 12px; font-family: monospace;">sku/item_number</span>
              <span style="background: var(--dark-surface); padding: 4px 10px; border-radius: 6px; font-size: 12px; font-family: monospace;">price/cost/retail</span>
              <span style="background: var(--dark-surface); padding: 4px 10px; border-radius: 6px; font-size: 12px; font-family: monospace;">vendor/supplier/brand</span>
              <span style="background: var(--dark-surface); padding: 4px 10px; border-radius: 6px; font-size: 12px; font-family: monospace;">quantity/stock/qty</span>
              <span style="background: var(--dark-surface); padding: 4px 10px; border-radius: 6px; font-size: 12px; font-family: monospace;">description/desc</span>
              <span style="background: var(--dark-surface); padding: 4px 10px; border-radius: 6px; font-size: 12px; font-family: monospace;">type/category</span>
              <span style="background: var(--dark-surface); padding: 4px 10px; border-radius: 6px; font-size: 12px; font-family: monospace;">image/image_url</span>
            </div>
          </div>
        </div>

        <!-- Step 2: Column Mapping -->
        <div id="import-step-2" style="display: none;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div>
              <h3 style="margin-bottom: 4px;">Map Columns</h3>
              <p style="color: var(--text-muted); font-size: 14px;" id="import-file-info">0 rows detected</p>
            </div>
            <button type="button" class="btn-modern secondary" onclick="resetImport()" style="padding: 8px 16px;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                <path d="M3 3v5h5"/>
              </svg>
              Start Over
            </button>
          </div>

          <div style="max-height: 300px; overflow-y: auto; background: var(--dark-elevated); border-radius: 10px; padding: 16px;">
            <div id="import-mapping-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;"></div>
          </div>

          <div style="margin-top: 20px; padding: 16px; background: var(--dark-elevated); border-radius: 10px;">
            <h4 style="margin-bottom: 12px; font-size: 14px;">Import Options</h4>
            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px; cursor: pointer;">
              <input type="checkbox" id="import-update-existing" style="accent-color: var(--gold-primary); width: 18px; height: 18px;">
              <span>Update existing products (match by SKU)</span>
            </label>
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
              <input type="checkbox" id="import-set-active" checked style="accent-color: var(--gold-primary); width: 18px; height: 18px;">
              <span>Set imported products as Active</span>
            </label>
          </div>

          <div style="margin-top: 20px;">
            <h4 style="margin-bottom: 12px; font-size: 14px;">Preview (first 5 rows)</h4>
            <div style="overflow-x: auto; background: var(--dark-elevated); border-radius: 10px;">
              <table id="import-preview-table" style="width: 100%; border-collapse: collapse; font-size: 13px;">
                <thead id="import-preview-head"></thead>
                <tbody id="import-preview-body"></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Step 3: Importing -->
        <div id="import-step-3" style="display: none; text-align: center; padding: 40px;">
          <div class="spinner" style="margin: 0 auto 20px;"></div>
          <h3 id="import-progress-title">Importing products...</h3>
          <p id="import-progress-text" style="color: var(--text-muted);">0 of 0 products imported</p>
          <div style="width: 100%; max-width: 400px; height: 8px; background: var(--dark-elevated); border-radius: 4px; margin: 20px auto; overflow: hidden;">
            <div id="import-progress-bar" style="width: 0%; height: 100%; background: var(--gold-primary); transition: width 0.3s;"></div>
          </div>
        </div>

        <!-- Step 4: Complete -->
        <div id="import-step-4" style="display: none; text-align: center; padding: 40px;">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="var(--success)" stroke-width="2" style="margin-bottom: 20px;">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
            <polyline points="22 4 12 14.01 9 11.01"/>
          </svg>
          <h3 style="margin-bottom: 8px;">Import Complete!</h3>
          <p id="import-complete-text" style="color: var(--text-muted); margin-bottom: 20px;">0 products imported successfully</p>
          <button type="button" class="btn-modern primary" onclick="closeImportModal()">Done</button>
        </div>
      </div>

      <div class="modal-footer" id="import-footer">
        <button type="button" class="btn-modern secondary" onclick="closeImportModal()">Cancel</button>
        <button type="button" class="btn-modern primary" id="import-btn" onclick="startImport()" disabled>
          Import Products
        </button>
      </div>
    </div>
  </div>

  <!-- Invoice Modal -->
  <div class="modal-overlay" id="invoice-modal">
    <div class="modal" style="max-width: 700px;">
      <div class="modal-header">
        <h2 class="modal-title">Create New Invoice</h2>
        <button class="modal-close" onclick="closeInvoiceModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <form id="invoice-form" onsubmit="createInvoice(event)">
        <input type="hidden" id="invoice-lead-id" value="">
        <div class="modal-body">
          <h4 style="margin-bottom: 16px; color: var(--text-secondary);">Customer Information</h4>
          <div class="form-row">
            <div class="form-group">
              <label>Customer Email *</label>
              <input type="email" id="invoice-email" required placeholder="customer@example.com"/>
            </div>
            <div class="form-group">
              <label>Customer Name</label>
              <input type="text" id="invoice-name" placeholder="John Smith"/>
            </div>
          </div>
          <div class="form-group">
            <label>Customer Phone</label>
            <input type="tel" id="invoice-phone" placeholder="(555) 123-4567"/>
          </div>

          <h4 style="margin: 24px 0 16px; color: var(--text-secondary);">Invoice Items</h4>
          <div id="invoice-items">
            <div class="invoice-item" data-index="0">
              <div class="form-row" style="align-items: flex-end;">
                <div class="form-group" style="flex: 3;">
                  <label>Description *</label>
                  <input type="text" class="item-description" required placeholder="e.g., Kitchen Countertop Installation"/>
                </div>
                <div class="form-group" style="flex: 1;">
                  <label>Qty</label>
                  <input type="number" class="item-qty" value="1" min="1"/>
                </div>
                <div class="form-group" style="flex: 1;">
                  <label>Amount ($) *</label>
                  <input type="number" class="item-amount" required min="0" step="0.01" placeholder="0.00"/>
                </div>
                <button type="button" class="btn-modern secondary" style="margin-bottom: 20px; padding: 10px;" onclick="removeInvoiceItem(this)">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                </button>
              </div>
            </div>
          </div>
          <button type="button" class="btn-modern secondary" onclick="addInvoiceItem()" style="margin-bottom: 20px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
            Add Line Item
          </button>

          <div class="form-row">
            <div class="form-group">
              <label>Due In (Days)</label>
              <select id="invoice-due-days">
                <option value="7">7 days</option>
                <option value="14">14 days</option>
                <option value="30" selected>30 days</option>
                <option value="60">60 days</option>
              </select>
            </div>
            <div class="form-group">
              <label>Invoice Total</label>
              <div style="font-size: 24px; font-weight: 700; color: var(--gold-primary); padding: 10px 0;" id="invoice-total">$0.00</div>
            </div>
          </div>

          <!-- Deposit Section -->
          <div style="background: var(--dark-elevated); border-radius: 12px; padding: 16px; margin: 20px 0; border: 1px solid var(--border-subtle);">
            <div style="display: flex; flex-wrap: wrap; gap: 16px; margin-bottom: 12px;">
              <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; font-weight: 600;">
                <input type="checkbox" id="invoice-require-deposit" onchange="toggleInvoiceDeposit()" style="width: 18px; height: 18px;">
                <span>Request Deposit</span>
              </label>
              <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; font-weight: 600;">
                <input type="checkbox" id="invoice-deposit-received" onchange="toggleDepositReceived()" style="width: 18px; height: 18px;">
                <span style="color: var(--success);">Deposit Already Received</span>
              </label>
            </div>

            <!-- Request Deposit Options -->
            <div id="invoice-deposit-options" style="display: none;">
              <div class="form-row" style="align-items: flex-end; gap: 12px;">
                <div class="form-group" style="flex: 1;">
                  <label>Deposit Type</label>
                  <select id="invoice-deposit-type" onchange="updateInvoiceDeposit()">
                    <option value="percent">Percentage</option>
                    <option value="fixed">Fixed Amount</option>
                  </select>
                </div>
                <div class="form-group" style="flex: 1;">
                  <label id="invoice-deposit-value-label">Deposit %</label>
                  <input type="number" id="invoice-deposit-value" value="50" min="0" max="100" step="1" onchange="updateInvoiceDeposit()" style="text-align: center;"/>
                </div>
                <div class="form-group" style="flex: 1;">
                  <label>Deposit Amount</label>
                  <div id="invoice-deposit-amount" style="font-size: 20px; font-weight: 700; color: var(--gold-primary); padding: 8px 0;">$0.00</div>
                </div>
              </div>
              <div style="display: flex; justify-content: space-between; padding: 12px; background: rgba(249, 203, 0, 0.1); border-radius: 8px; margin-top: 12px;">
                <div>
                  <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">Balance Due</div>
                  <div id="invoice-balance-due" style="font-size: 18px; font-weight: 600; color: var(--text-primary);">$0.00</div>
                </div>
                <div style="text-align: right;">
                  <div style="font-size: 11px; color: var(--text-muted);">Due after deposit</div>
                  <div style="font-size: 12px; color: var(--text-secondary);">Upon project completion</div>
                </div>
              </div>
            </div>

            <!-- Deposit Already Received Options -->
            <div id="invoice-deposit-received-options" style="display: none;">
              <div class="form-row" style="align-items: flex-end; gap: 12px;">
                <div class="form-group" style="flex: 1;">
                  <label>Amount Received ($)</label>
                  <input type="number" id="invoice-deposit-received-amount" min="0" step="0.01" placeholder="0.00" onchange="updateDepositReceived()" style="text-align: center;"/>
                </div>
                <div class="form-group" style="flex: 1;">
                  <label>Payment Method</label>
                  <select id="invoice-deposit-payment-method">
                    <option value="cash">Cash</option>
                    <option value="check">Check</option>
                    <option value="card">Card</option>
                    <option value="venmo">Venmo</option>
                    <option value="zelle">Zelle</option>
                    <option value="other">Other</option>
                  </select>
                </div>
              </div>
              <div style="display: flex; justify-content: space-between; padding: 12px; background: rgba(76, 175, 80, 0.15); border-radius: 8px; margin-top: 12px; border: 1px solid rgba(76, 175, 80, 0.3);">
                <div>
                  <div style="font-size: 11px; color: var(--success); text-transform: uppercase;">Deposit Received</div>
                  <div id="invoice-deposit-received-display" style="font-size: 20px; font-weight: 700; color: var(--success);">$0.00</div>
                </div>
                <div style="text-align: right;">
                  <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">Balance Remaining</div>
                  <div id="invoice-balance-remaining" style="font-size: 20px; font-weight: 700; color: var(--gold-primary);">$0.00</div>
                </div>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label>Email Template</label>
            <div class="template-selector">
              <label class="template-option">
                <input type="radio" name="invoice-template" value="classic" checked>
                <div class="template-preview classic-preview">
                  <div class="template-header-preview"></div>
                  <div class="template-body-preview"></div>
                  <span class="template-name">Classic</span>
                  <span class="template-desc">Professional & Clean</span>
                </div>
              </label>
              <label class="template-option">
                <input type="radio" name="invoice-template" value="modern">
                <div class="template-preview modern-preview">
                  <div class="template-header-preview"></div>
                  <div class="template-body-preview"></div>
                  <span class="template-name">Modern</span>
                  <span class="template-desc">Minimal & Elegant</span>
                </div>
              </label>
              <label class="template-option">
                <input type="radio" name="invoice-template" value="premium">
                <div class="template-preview premium-preview">
                  <div class="template-header-preview"></div>
                  <div class="template-body-preview"></div>
                  <span class="template-name">Premium</span>
                  <span class="template-desc">Luxury Dark Theme</span>
                </div>
              </label>
            </div>
          </div>

          <div class="form-group">
            <label>Notes (Optional)</label>
            <textarea id="invoice-notes" rows="2" placeholder="Add any additional notes for the customer..."></textarea>
          </div>

          <h4 style="margin: 24px 0 16px; color: var(--text-secondary);">Email Options</h4>
          <div class="form-group">
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
              <input type="checkbox" id="invoice-cc-me" checked style="width: 18px; height: 18px;">
              <span>Send me a copy (CC)</span>
            </label>
          </div>
          <div class="form-group">
            <label>Additional CC (Optional)</label>
            <input type="email" id="invoice-cc-other" placeholder="another@email.com"/>
          </div>
        </div>
        <div class="modal-footer" style="gap: 10px;">
          <button type="button" class="btn-modern secondary" onclick="closeInvoiceModal()">Cancel</button>
          <button type="button" class="btn-modern secondary" onclick="saveInvoiceDraft()" id="invoice-draft-btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/></svg>
            Save Draft
          </button>
          <button type="button" class="btn-modern primary" onclick="previewInvoice()" id="invoice-preview-btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
            Preview & Send
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Quick Pay Modal -->
  <div class="modal-overlay" id="quick-pay-modal">
    <div class="modal" style="max-width: 500px;">
      <div class="modal-header" style="background: linear-gradient(135deg, #8b5cf6, #6366f1);">
        <h2 class="modal-title" style="color: white;">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="margin-right: 8px;"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"/></svg>
          Quick Pay Link
        </h2>
        <button class="modal-close" onclick="closeQuickPayModal()" style="color: white;">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="modal-body">
        <!-- Form State -->
        <div id="quick-pay-form-state">
          <form id="quick-pay-form" onsubmit="return generateQuickPayLink(event)">
            <div class="form-group">
              <label>Customer Name *</label>
              <input type="text" id="qp-name" required placeholder="John Smith">
            </div>
            <div class="form-group">
              <label>Customer Email *</label>
              <input type="email" id="qp-email" required placeholder="customer@email.com">
            </div>
            <div class="form-group">
              <label>Customer Phone (for SMS)</label>
              <input type="tel" id="qp-phone" placeholder="(555) 123-4567">
            </div>
            <div class="form-group">
              <label>Amount ($) *</label>
              <input type="number" id="qp-amount" required min="1" step="0.01" placeholder="0.00">
            </div>
            <div class="form-group">
              <label>Description</label>
              <input type="text" id="qp-description" placeholder="e.g., Deposit for Kitchen Countertops">
            </div>
            <div class="modal-footer" style="padding: 0; margin-top: 20px;">
              <button type="button" class="btn-modern secondary" onclick="closeQuickPayModal()">Cancel</button>
              <button type="submit" class="btn-modern primary" id="qp-generate-btn" style="background: linear-gradient(135deg, #8b5cf6, #6366f1);">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/></svg>
                Generate Link
              </button>
            </div>
          </form>
        </div>

        <!-- Result State (hidden initially) -->
        <div id="quick-pay-result-state" style="display: none;">
          <div style="text-align: center; padding: 20px 0;">
            <div style="background: #f0fdf4; border: 2px solid #22c55e; border-radius: 12px; padding: 16px; margin-bottom: 20px;">
              <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="none" viewBox="0 0 24 24" stroke="#22c55e" stroke-width="2" style="margin-bottom: 8px;"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              <h3 style="color: #166534; margin: 0;">Payment Link Created!</h3>
            </div>

            <div style="margin-bottom: 24px;">
              <p style="margin: 0 0 8px; color: var(--text-muted); font-size: 13px;">For: <strong id="qp-result-name"></strong></p>
              <p style="margin: 0; font-size: 28px; font-weight: 700; color: var(--gold-primary);" id="qp-result-amount"></p>
            </div>

            <!-- QR Code -->
            <div id="qp-qr-container" style="background: white; padding: 20px; border-radius: 12px; display: inline-block; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
              <img id="qp-qr-code" src="" alt="Payment QR Code" style="width: 180px; height: 180px;">
              <p style="margin: 12px 0 0; font-size: 11px; color: #666;">Scan to pay</p>
            </div>

            <!-- Payment Link -->
            <div style="background: var(--dark-surface); border-radius: 8px; padding: 12px; margin-bottom: 20px;">
              <input type="text" id="qp-link-display" readonly style="width: 100%; background: transparent; border: none; color: var(--text-primary); font-size: 12px; text-align: center;">
            </div>

            <!-- Action Buttons -->
            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
              <button class="btn-modern secondary" onclick="copyQuickPayLink()" style="flex: 1;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
                Copy Link
              </button>
              <button class="btn-modern secondary" onclick="sendQuickPayEmail()" style="flex: 1;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                Send Email
              </button>
              <button class="btn-modern secondary" onclick="sendQuickPaySMS()" style="flex: 1;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
                Send SMS
              </button>
            </div>

            <div style="margin-top: 20px;">
              <button class="btn-modern primary" onclick="resetQuickPayModal()" style="background: linear-gradient(135deg, #8b5cf6, #6366f1);">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
                Create Another
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Template Preview Modal -->
  <div class="modal-overlay" id="template-preview-modal">
    <div class="modal" style="max-width: 1200px; max-height: 90vh;">
      <div class="modal-header">
        <h2 class="modal-title">Invoice Email Templates</h2>
        <button class="modal-close" onclick="closeTemplatePreview()">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="modal-body" style="padding: 0; overflow: hidden;">
        <div class="template-tabs">
          <button class="template-tab active" data-template="classic" onclick="showTemplatePreview('classic')">
            <span class="tab-icon">ðŸ“„</span>
            <span class="tab-label">Classic</span>
            <span class="tab-desc">Professional & Clean</span>
          </button>
          <button class="template-tab" data-template="modern" onclick="showTemplatePreview('modern')">
            <span class="tab-icon">âœ¨</span>
            <span class="tab-label">Modern</span>
            <span class="tab-desc">Minimal & Elegant</span>
          </button>
          <button class="template-tab" data-template="premium" onclick="showTemplatePreview('premium')">
            <span class="tab-icon">ðŸ‘‘</span>
            <span class="tab-label">Premium</span>
            <span class="tab-desc">Luxury Dark Theme</span>
          </button>
        </div>
        <div class="template-preview-container">
          <div class="template-preview-frame" id="template-frame-classic" style="display: block;">
            <iframe id="preview-iframe-classic" srcdoc=""></iframe>
          </div>
          <div class="template-preview-frame" id="template-frame-modern" style="display: none;">
            <iframe id="preview-iframe-modern" srcdoc=""></iframe>
          </div>
          <div class="template-preview-frame" id="template-frame-premium" style="display: none;">
            <iframe id="preview-iframe-premium" srcdoc=""></iframe>
          </div>
        </div>
      </div>
      <div class="modal-footer" style="justify-content: space-between;">
        <p style="color: var(--text-muted); font-size: 13px; margin: 0;">Select a template when creating an invoice</p>
        <button class="btn-modern primary" onclick="closeTemplatePreview(); openInvoiceModal();">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
          Create New Invoice
        </button>
      </div>
    </div>
  </div>

  <!-- Create Listing Modal -->
  <div id="create-listing-modal" class="modal-overlay" onclick="if(event.target === this) closeCreateListingModal()">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Create Listing</h2>
        <button class="modal-close" onclick="closeCreateListingModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="modal-body">
        <form id="create-listing-form" onsubmit="return handleCreateListing(event)">
          <!-- Category Selection -->
          <div class="form-section">
            <div class="form-section-title">What are you listing?</div>
            <div class="listing-category-grid" id="listing-category-grid">
              <div class="listing-category-option selected" data-category="countertops" onclick="selectListingCategory('countertops')">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><rect x="3" y="8" width="18" height="4" rx="1"/><path d="M5 12v6M19 12v6M8 8V5a1 1 0 011-1h6a1 1 0 011 1v3"/></svg>
                <span>Countertops</span>
                <small>Granite, Marble, Quartz</small>
              </div>
              <div class="listing-category-option" data-category="tile" onclick="selectListingCategory('tile')">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="8" height="8" rx="1"/><rect x="13" y="3" width="8" height="8" rx="1"/><rect x="3" y="13" width="8" height="8" rx="1"/><rect x="13" y="13" width="8" height="8" rx="1"/></svg>
                <span>Tile</span>
                <small>Ceramic, Porcelain, Natural</small>
              </div>
              <div class="listing-category-option" data-category="flooring" onclick="selectListingCategory('flooring')">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path d="M3 21h18M3 21V8l4-4h10l4 4v13M7 21v-8h10v8M7 13h10"/></svg>
                <span>Flooring</span>
                <small>Hardwood, LVP, Laminate</small>
              </div>
              <div class="listing-category-option" data-category="cabinets" onclick="selectListingCategory('cabinets')">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><rect x="3" y="4" width="18" height="16" rx="2"/><line x1="12" y1="4" x2="12" y2="20"/><line x1="3" y1="12" x2="21" y2="12"/><circle cx="8" cy="8" r="1"/><circle cx="16" cy="8" r="1"/><circle cx="8" cy="16" r="1"/><circle cx="16" cy="16" r="1"/></svg>
                <span>Cabinets</span>
                <small>Kitchen, Bath, Storage</small>
              </div>
              <div class="listing-category-option" data-category="supplies" onclick="selectListingCategory('supplies')">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/></svg>
                <span>Supplies</span>
                <small>Tools, Adhesives, Sealers</small>
              </div>
              <div class="listing-category-option" data-category="other" onclick="selectListingCategory('other')">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="9"/><path d="M12 8v4M12 16h.01"/></svg>
                <span>Other</span>
                <small>Fixtures, Hardware, etc.</small>
              </div>
            </div>
            <input type="hidden" id="listing-category" value="countertops">
          </div>

          <!-- Product Selection (dynamic based on category) -->
          <div class="form-section" id="product-selection-section">
            <div class="form-section-title" id="product-selection-title">Select Product</div>
            <div class="form-group stone-autocomplete">
              <label id="product-search-label">Search our catalog (optional)</label>
              <input type="text" id="listing-stone-search" placeholder="Start typing product name..." autocomplete="off">
              <div id="stone-autocomplete-results" class="stone-autocomplete-results"></div>
              <input type="hidden" id="listing-stone-slug">
              <input type="hidden" id="listing-stone-name">
              <input type="hidden" id="listing-material-type">
              <input type="hidden" id="listing-brand">
              <input type="hidden" id="listing-color">
            </div>
            <p style="font-size: 12px; color: var(--text-muted); margin-top: 8px;">Link to our catalog so buyers can see the full product details, or skip to create a custom listing.</p>
            <div id="selected-stone-preview" style="display: none; margin-top: 12px; padding: 12px; background: var(--dark-elevated); border-radius: 8px;">
              <div style="display: flex; align-items: center; gap: 12px;">
                <img id="selected-stone-img" src="" style="width: 60px; height: 60px; border-radius: 8px; object-fit: cover;">
                <div>
                  <div id="selected-stone-name" style="font-weight: 600; color: var(--text-primary);"></div>
                  <div id="selected-stone-meta" style="font-size: 12px; color: var(--text-muted);"></div>
                </div>
                <button type="button" onclick="clearSelectedStone()" style="margin-left: auto; background: none; border: none; color: var(--error); cursor: pointer;">Clear</button>
              </div>
            </div>
          </div>

          <!-- Listing Details -->
          <div class="form-section">
            <div class="form-section-title">Listing Details</div>
            <div class="form-group">
              <label>Title *</label>
              <input type="text" id="listing-title" placeholder="e.g., Calacatta Gold Remnant 24x36, White Subway Tile 200 sqft" required>
            </div>
            <div class="form-group">
              <label>Description</label>
              <textarea id="listing-description" rows="3" placeholder="Describe your item - condition, origin, why selling, any defects, etc."></textarea>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Condition</label>
                <select id="listing-condition">
                  <option value="new">New / Unused</option>
                  <option value="remnant">Remnant / Leftover</option>
                  <option value="overstock">Overstock</option>
                  <option value="used">Used / Reclaimed</option>
                  <option value="refurbished">Refurbished</option>
                </select>
              </div>
              <div class="form-group">
                <label>Brand (optional)</label>
                <input type="text" id="listing-brand-input" placeholder="e.g., MSI, Daltile, Shaw">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Dimensions / Size</label>
                <input type="text" id="listing-dimensions" placeholder="e.g., 24x36 in, 200 sqft, 10x20 cm">
              </div>
              <div class="form-group" id="thickness-group">
                <label>Thickness</label>
                <select id="listing-thickness">
                  <option value="">Select...</option>
                  <option value="2cm">2cm (3/4")</option>
                  <option value="3cm">3cm (1 1/4")</option>
                  <option value="1cm">1cm (3/8")</option>
                  <option value="other">Other</option>
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Quantity</label>
                <input type="number" id="listing-quantity" value="1" min="1">
              </div>
              <div class="form-group">
                <label>Price ($)</label>
                <div style="display: flex; gap: 8px; align-items: center;">
                  <input type="number" id="listing-price" placeholder="0.00" step="0.01" min="0" style="flex: 1;">
                  <label style="display: flex; align-items: center; gap: 6px; font-size: 12px; white-space: nowrap;">
                    <input type="checkbox" id="listing-price-contact" onchange="togglePriceField()">
                    Contact for price
                  </label>
                </div>
              </div>
            </div>
          </div>

          <!-- Images -->
          <div class="form-section">
            <div class="form-section-title">Images (up to 4)</div>

            <!-- Image Upload Area -->
            <div class="image-upload-section">
              <div class="image-upload-grid" id="image-upload-grid">
                <!-- Image Slot 1 -->
                <div class="image-upload-slot" id="image-slot-1" onclick="triggerImageUpload(1)">
                  <input type="file" id="image-file-1" accept="image/*" capture="environment" style="display: none;" onchange="handleImageUpload(1, this)">
                  <input type="hidden" id="listing-image-1">
                  <div class="upload-placeholder" id="upload-placeholder-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                      <path stroke-linecap="round" stroke-linejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                    <span>Add Photo</span>
                  </div>
                  <img id="image-preview-1" class="upload-preview" src="" style="display: none;">
                  <button type="button" class="remove-image-btn" id="remove-btn-1" onclick="removeImage(event, 1)" style="display: none;">&times;</button>
                  <div class="upload-progress" id="upload-progress-1" style="display: none;">
                    <div class="upload-progress-bar" id="upload-bar-1"></div>
                  </div>
                </div>

                <!-- Image Slot 2 -->
                <div class="image-upload-slot" id="image-slot-2" onclick="triggerImageUpload(2)">
                  <input type="file" id="image-file-2" accept="image/*" capture="environment" style="display: none;" onchange="handleImageUpload(2, this)">
                  <input type="hidden" id="listing-image-2">
                  <div class="upload-placeholder" id="upload-placeholder-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
                    </svg>
                  </div>
                  <img id="image-preview-2" class="upload-preview" src="" style="display: none;">
                  <button type="button" class="remove-image-btn" id="remove-btn-2" onclick="removeImage(event, 2)" style="display: none;">&times;</button>
                  <div class="upload-progress" id="upload-progress-2" style="display: none;">
                    <div class="upload-progress-bar" id="upload-bar-2"></div>
                  </div>
                </div>

                <!-- Image Slot 3 -->
                <div class="image-upload-slot" id="image-slot-3" onclick="triggerImageUpload(3)">
                  <input type="file" id="image-file-3" accept="image/*" capture="environment" style="display: none;" onchange="handleImageUpload(3, this)">
                  <input type="hidden" id="listing-image-3">
                  <div class="upload-placeholder" id="upload-placeholder-3">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
                    </svg>
                  </div>
                  <img id="image-preview-3" class="upload-preview" src="" style="display: none;">
                  <button type="button" class="remove-image-btn" id="remove-btn-3" onclick="removeImage(event, 3)" style="display: none;">&times;</button>
                  <div class="upload-progress" id="upload-progress-3" style="display: none;">
                    <div class="upload-progress-bar" id="upload-bar-3"></div>
                  </div>
                </div>

                <!-- Image Slot 4 -->
                <div class="image-upload-slot" id="image-slot-4" onclick="triggerImageUpload(4)">
                  <input type="file" id="image-file-4" accept="image/*" capture="environment" style="display: none;" onchange="handleImageUpload(4, this)">
                  <input type="hidden" id="listing-image-4">
                  <div class="upload-placeholder" id="upload-placeholder-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
                    </svg>
                  </div>
                  <img id="image-preview-4" class="upload-preview" src="" style="display: none;">
                  <button type="button" class="remove-image-btn" id="remove-btn-4" onclick="removeImage(event, 4)" style="display: none;">&times;</button>
                  <div class="upload-progress" id="upload-progress-4" style="display: none;">
                    <div class="upload-progress-bar" id="upload-bar-4"></div>
                  </div>
                </div>
              </div>
              <p style="font-size: 12px; color: var(--text-muted); margin-top: 12px; text-align: center;">
                Tap to take a photo or upload from your gallery. First image will be the main photo.
              </p>
            </div>
          </div>

          <!-- Location -->
          <div class="form-section">
            <div class="form-section-title">Location</div>
            <div class="form-row">
              <div class="form-group">
                <label>City</label>
                <input type="text" id="listing-city" placeholder="Phoenix">
              </div>
              <div class="form-group">
                <label>State</label>
                <select id="listing-state">
                  <option value="">Select State...</option>
                  <option value="AZ">Arizona</option>
                  <option value="CA">California</option>
                  <option value="CO">Colorado</option>
                  <option value="NV">Nevada</option>
                  <option value="NM">New Mexico</option>
                  <option value="TX">Texas</option>
                  <option value="UT">Utah</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label>ZIP Code</label>
              <input type="text" id="listing-zip" placeholder="85374" maxlength="10">
            </div>
          </div>

          <!-- Contact Preferences -->
          <div class="form-section">
            <div class="form-section-title">Contact Preferences</div>
            <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 16px;">How should interested buyers contact you?</p>

            <div class="contact-pref-item" style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; cursor: pointer;" onclick="document.getElementById('listing-show-email').click()">
              <input type="checkbox" id="listing-show-email" style="width: 20px; height: 20px; accent-color: #f9cb00; cursor: pointer;">
              <span style="font-size: 14px; color: #ccc; text-transform: none;">Show my email address</span>
            </div>

            <div class="contact-pref-item" style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; cursor: pointer;" onclick="document.getElementById('listing-show-phone').click()">
              <input type="checkbox" id="listing-show-phone" style="width: 20px; height: 20px; accent-color: #f9cb00; cursor: pointer;">
              <span style="font-size: 14px; color: #ccc; text-transform: none;">Show my phone number</span>
            </div>

            <div class="contact-pref-item" style="display: flex; align-items: center; gap: 12px; cursor: pointer;" onclick="document.getElementById('listing-contact-form').click()">
              <input type="checkbox" id="listing-contact-form" checked style="width: 20px; height: 20px; accent-color: #f9cb00; cursor: pointer;">
              <span style="font-size: 14px; color: #ccc; text-transform: none;">Allow contact through inquiry form</span>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-modern secondary" onclick="closeCreateListingModal()">Cancel</button>
        <button type="submit" form="create-listing-form" class="btn-modern primary" id="submit-listing-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
          Create Listing
        </button>
      </div>
    </div>
  </div>

  <!-- Create Estimate Modal - Professional Estimating System -->
  <div id="create-estimate-modal" class="modal-overlay" onclick="if(event.target === this) closeCreateEstimateModal()">
    <div class="modal" style="max-width: 1100px; max-height: 95vh; overflow-y: auto;">
      <!-- Professional Header -->
      <div class="modal-header" style="background: linear-gradient(135deg, rgba(249,203,0,0.15), rgba(249,203,0,0.05)); border-bottom: 2px solid var(--gold-primary); padding: 20px 24px;">
        <div style="display: flex; align-items: center; gap: 16px;">
          <div style="width: 50px; height: 50px; background: var(--gold-primary); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="#1a1a1a" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
          </div>
          <div>
            <h2 class="modal-title" style="margin: 0; font-size: 22px;">Professional Estimate</h2>
            <div style="display: flex; align-items: center; gap: 16px; margin-top: 4px;">
              <span style="font-size: 13px; color: var(--text-muted);">Estimate #: <strong id="estimate-number-display" style="color: var(--gold-primary);">Loading...</strong></span>
              <span style="font-size: 13px; color: var(--text-muted);">Date: <strong id="estimate-date-display" style="color: #fff;"></strong></span>
            </div>
          </div>
        </div>
        <button class="modal-close" onclick="closeCreateEstimateModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>

      <div class="modal-body" style="padding: 0;">
        <form id="create-estimate-form" onsubmit="return handleCreateEstimate(event)">
          <!-- Two Column Layout for Customer & Project -->
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0; border-bottom: 1px solid var(--border-subtle);">
            <!-- Customer Information -->
            <div class="form-section" style="padding: 20px 24px; border-right: 1px solid var(--border-subtle); margin: 0;">
              <div class="form-section-title" style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="var(--gold-primary)" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                Customer Information
              </div>
              <div class="form-group" style="margin-bottom: 12px;">
                <label style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;">Customer Name *</label>
                <input type="text" id="estimate-customer-name" required placeholder="John Smith" style="font-size: 15px;">
              </div>
              <div class="form-row" style="gap: 12px; margin-bottom: 12px;">
                <div class="form-group" style="margin-bottom: 0;">
                  <label style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Email</label>
                  <input type="email" id="estimate-customer-email" placeholder="customer@email.com">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                  <label style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Phone</label>
                  <input type="tel" id="estimate-customer-phone" placeholder="(602) 555-1234">
                </div>
              </div>
              <div class="form-group" style="margin-bottom: 12px;">
                <label style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Project Address</label>
                <input type="text" id="estimate-customer-address" placeholder="123 Main St">
              </div>
              <div class="form-row" style="gap: 12px;">
                <div class="form-group" style="flex: 2; margin-bottom: 0;">
                  <label style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">City</label>
                  <input type="text" id="estimate-customer-city" placeholder="Phoenix">
                </div>
                <div class="form-group" style="flex: 1; margin-bottom: 0;">
                  <label style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">State</label>
                  <input type="text" id="estimate-customer-state" placeholder="AZ" value="AZ">
                </div>
                <div class="form-group" style="flex: 1; margin-bottom: 0;">
                  <label style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">ZIP</label>
                  <input type="text" id="estimate-customer-zip" placeholder="85001">
                </div>
              </div>
            </div>

            <!-- Project Details -->
            <div class="form-section" style="padding: 20px 24px; margin: 0;">
              <div class="form-section-title" style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="var(--gold-primary)" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                Project Details
              </div>
              <div class="form-group" style="margin-bottom: 12px;">
                <label style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Project Name</label>
                <input type="text" id="estimate-project-name" placeholder="Kitchen Countertop Installation" style="font-size: 15px;">
              </div>
              <div class="form-row" style="gap: 12px; margin-bottom: 12px;">
                <div class="form-group" style="margin-bottom: 0;">
                  <label style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Project Type</label>
                  <select id="estimate-project-type">
                    <option value="countertops">Countertops</option>
                    <option value="tile">Tile Installation</option>
                    <option value="flooring">Flooring</option>
                    <option value="bathroom">Bathroom Remodel</option>
                    <option value="kitchen">Kitchen Remodel</option>
                    <option value="custom">Custom Project</option>
                  </select>
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                  <label style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Valid For (Days)</label>
                  <select id="estimate-valid-days" onchange="updateEstimateValidDate()">
                    <option value="15">15 Days</option>
                    <option value="30" selected>30 Days</option>
                    <option value="45">45 Days</option>
                    <option value="60">60 Days</option>
                    <option value="90">90 Days</option>
                  </select>
                </div>
              </div>
              <div class="form-group" style="margin-bottom: 0;">
                <label style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Scope of Work</label>
                <textarea id="estimate-project-desc" rows="3" placeholder="Describe the project scope, including measurements, materials, and work to be performed..." style="resize: vertical;"></textarea>
              </div>
              <input type="hidden" id="estimate-valid-until">
            </div>
          </div>

          <!-- Line Items Section with Categories -->
          <div class="form-section" style="padding: 20px 24px; margin: 0; border-bottom: 1px solid var(--border-subtle);">
            <div class="form-section-title" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
              <div style="display: flex; align-items: center; gap: 8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="var(--gold-primary)" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/></svg>
                Items & Services
              </div>
              <div style="display: flex; gap: 8px;">
                <button type="button" class="btn-modern secondary small" onclick="openCatalogPicker()" style="font-size: 12px;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>
                  From Catalog
                </button>
                <div class="dropdown" style="position: relative;">
                  <button type="button" class="btn-modern primary small" onclick="toggleAddItemMenu()" style="font-size: 12px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
                    Add Item
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg>
                  </button>
                  <div id="add-item-menu" class="dropdown-menu" style="display: none; position: absolute; right: 0; top: 100%; margin-top: 4px; background: var(--bg-secondary); border: 1px solid var(--border-subtle); border-radius: 8px; min-width: 180px; z-index: 100; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                    <button type="button" onclick="addEstimateLineItem('material')" style="width: 100%; padding: 10px 14px; text-align: left; background: none; border: none; color: #fff; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px;" onmouseover="this.style.background='rgba(255,255,255,0.05)'" onmouseout="this.style.background='none'">
                      <span style="width: 8px; height: 8px; border-radius: 50%; background: #3b82f6;"></span>
                      Material
                    </button>
                    <button type="button" onclick="addEstimateLineItem('labor')" style="width: 100%; padding: 10px 14px; text-align: left; background: none; border: none; color: #fff; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px;" onmouseover="this.style.background='rgba(255,255,255,0.05)'" onmouseout="this.style.background='none'">
                      <span style="width: 8px; height: 8px; border-radius: 50%; background: #22c55e;"></span>
                      Labor
                    </button>
                    <button type="button" onclick="addEstimateLineItem('service')" style="width: 100%; padding: 10px 14px; text-align: left; background: none; border: none; color: #fff; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px;" onmouseover="this.style.background='rgba(255,255,255,0.05)'" onmouseout="this.style.background='none'">
                      <span style="width: 8px; height: 8px; border-radius: 50%; background: #a855f7;"></span>
                      Service/Fee
                    </button>
                    <div style="border-top: 1px solid var(--border-subtle); margin: 4px 0;"></div>
                    <button type="button" onclick="addEstimateLineItem('other')" style="width: 100%; padding: 10px 14px; text-align: left; background: none; border: none; color: #fff; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px;" onmouseover="this.style.background='rgba(255,255,255,0.05)'" onmouseout="this.style.background='none'">
                      <span style="width: 8px; height: 8px; border-radius: 50%; background: #6b7280;"></span>
                      Other
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Line Items Table Header -->
            <div style="display: grid; grid-template-columns: 30px 2fr 90px 70px 85px 85px 70px 90px 36px; gap: 6px; padding: 8px 12px; background: rgba(255,255,255,0.03); border-radius: 8px 8px 0 0; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-muted); font-weight: 600;">
              <span></span>
              <span>Description</span>
              <span>Unit</span>
              <span style="text-align: center;">Qty</span>
              <span style="text-align: right; color: rgba(59,130,246,0.8);" title="Your cost (internal only)">Cost</span>
              <span style="text-align: right;">Price</span>
              <span style="text-align: center; color: rgba(59,130,246,0.8);" title="Margin % (internal only)">Margin</span>
              <span style="text-align: right;">Total</span>
              <span></span>
            </div>

            <div id="estimate-line-items" style="min-height: 60px; border: 1px solid var(--border-subtle); border-top: none; border-radius: 0 0 8px 8px; background: rgba(0,0,0,0.15);">
              <!-- Line items will be added here -->
              <div id="empty-line-items-msg" style="padding: 30px; text-align: center; color: var(--text-muted); font-size: 13px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1" style="margin-bottom: 8px; opacity: 0.5;"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
                <br>No items added yet. Click "Add Item" or "From Catalog" to begin.
              </div>
            </div>

            <!-- Hidden Template -->
            <div class="line-item-template" style="display: none;">
              <div class="estimate-line-item" data-category="material" style="display: grid; grid-template-columns: 30px 2fr 90px 70px 85px 85px 70px 90px 36px; gap: 6px; align-items: start; padding: 12px; border-bottom: 1px solid var(--border-subtle);">
                <div class="category-indicator" style="display: flex; align-items: center; justify-content: center; padding-top: 8px;">
                  <span class="category-dot" style="width: 10px; height: 10px; border-radius: 50%; background: #3b82f6;" title="Material"></span>
                </div>
                <div>
                  <input type="text" class="item-name" placeholder="Item name" style="width: 100%; margin-bottom: 4px; font-weight: 500;">
                  <input type="text" class="item-desc" placeholder="Description or specifications" style="width: 100%; font-size: 12px; opacity: 0.7; padding: 6px 10px;">
                </div>
                <select class="item-unit" style="height: 38px;">
                  <option value="sqft">Sq Ft</option>
                  <option value="lnft">Ln Ft</option>
                  <option value="each">Each</option>
                  <option value="slab">Slab</option>
                  <option value="hour">Hour</option>
                  <option value="day">Day</option>
                  <option value="job">Flat Rate</option>
                </select>
                <input type="number" class="item-qty" placeholder="Qty" value="1" min="0" step="0.01" style="text-align: center;">
                <input type="number" class="item-cost" placeholder="Cost" value="" min="0" step="0.01" style="text-align: right; background: rgba(59,130,246,0.1); border-color: rgba(59,130,246,0.3);" title="Your cost (internal only)">
                <input type="number" class="item-price" placeholder="Price" value="0" min="0" step="0.01" style="text-align: right;">
                <div class="item-margin" style="text-align: center; padding: 10px 4px; font-size: 12px; color: var(--text-muted); background: rgba(0,0,0,0.2); border-radius: 4px;" title="Margin % (internal only)">--%</div>
                <div class="item-total" style="text-align: right; padding: 10px 0; font-weight: 600; color: var(--gold-primary); font-size: 14px;">$0.00</div>
                <button type="button" class="btn-remove-item" onclick="removeEstimateLineItem(this)" style="background: none; border: none; color: #6b7280; cursor: pointer; padding: 8px; transition: color 0.2s;" onmouseover="this.style.color='#ef4444'" onmouseout="this.style.color='#6b7280'">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                </button>
                <input type="hidden" class="item-category" value="material">
              </div>
            </div>
          </div>

          <!-- Totals & Payment Section -->
          <div style="display: grid; grid-template-columns: 1fr 400px; gap: 0; border-bottom: 1px solid var(--border-subtle);">
            <!-- Left: Notes Section -->
            <div class="form-section" style="padding: 20px 24px; margin: 0; border-right: 1px solid var(--border-subtle);">
              <div class="form-section-title" style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="var(--gold-primary)" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                Notes & Inclusions
              </div>
              <div class="form-group" style="margin-bottom: 12px;">
                <label style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">This Estimate Includes</label>
                <textarea id="estimate-inclusions" rows="3" placeholder="- All materials as specified above&#10;- Professional installation&#10;- Cleanup and debris removal&#10;- 1-year workmanship warranty" style="font-size: 13px;"></textarea>
              </div>
              <div class="form-group" style="margin-bottom: 12px;">
                <label style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">This Estimate Does NOT Include</label>
                <textarea id="estimate-exclusions" rows="2" placeholder="- Plumbing/electrical modifications&#10;- Structural changes&#10;- Permits (if required)" style="font-size: 13px;"></textarea>
              </div>
              <div class="form-group" style="margin-bottom: 0;">
                <label style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Additional Notes</label>
                <textarea id="estimate-notes" rows="2" placeholder="Any additional notes for the customer..." style="font-size: 13px;"></textarea>
              </div>
            </div>

            <!-- Right: Totals -->
            <div class="form-section" style="padding: 20px 24px; margin: 0; background: rgba(0,0,0,0.15);">
              <div class="form-section-title" style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="var(--gold-primary)" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                Pricing Summary
              </div>
              <div class="estimate-totals" style="display: flex; flex-direction: column; gap: 10px;">
                <!-- Margin Summary (Internal Only) -->
                <div id="margin-summary" style="margin-bottom: 12px; padding: 12px; background: rgba(59,130,246,0.08); border: 1px solid rgba(59,130,246,0.2); border-radius: 8px;">
                  <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 10px; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; color: rgba(59,130,246,0.9); font-weight: 600;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                    Internal Only - Not shown to customer
                  </div>
                  <div style="display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 6px;">
                    <span style="color: var(--text-muted);">Your Cost</span>
                    <span id="estimate-total-cost" style="font-weight: 500;">$0.00</span>
                  </div>
                  <div style="display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 6px;">
                    <span style="color: var(--text-muted);">Gross Profit</span>
                    <span id="estimate-total-profit" style="font-weight: 600; color: #22c55e;">$0.00</span>
                  </div>
                  <div style="display: flex; justify-content: space-between; font-size: 14px; padding-top: 8px; border-top: 1px solid rgba(59,130,246,0.2);">
                    <span style="font-weight: 600; color: rgba(59,130,246,0.9);">Margin</span>
                    <span id="estimate-total-margin" style="font-weight: 700; color: #22c55e;">--%</span>
                  </div>
                </div>

                <!-- Category Subtotals -->
                <div id="category-subtotals" style="margin-bottom: 8px; padding-bottom: 12px; border-bottom: 1px solid var(--border-subtle);">
                  <div class="category-subtotal" data-category="material" style="display: flex; justify-content: space-between; font-size: 13px; color: var(--text-muted); margin-bottom: 4px;">
                    <span style="display: flex; align-items: center; gap: 6px;"><span style="width: 6px; height: 6px; border-radius: 50%; background: #3b82f6;"></span>Materials</span>
                    <span id="subtotal-material">$0.00</span>
                  </div>
                  <div class="category-subtotal" data-category="labor" style="display: flex; justify-content: space-between; font-size: 13px; color: var(--text-muted); margin-bottom: 4px;">
                    <span style="display: flex; align-items: center; gap: 6px;"><span style="width: 6px; height: 6px; border-radius: 50%; background: #22c55e;"></span>Labor</span>
                    <span id="subtotal-labor">$0.00</span>
                  </div>
                  <div class="category-subtotal" data-category="service" style="display: flex; justify-content: space-between; font-size: 13px; color: var(--text-muted); margin-bottom: 4px;">
                    <span style="display: flex; align-items: center; gap: 6px;"><span style="width: 6px; height: 6px; border-radius: 50%; background: #a855f7;"></span>Services/Fees</span>
                    <span id="subtotal-service">$0.00</span>
                  </div>
                </div>

                <div style="display: flex; justify-content: space-between; padding: 6px 0;">
                  <span>Subtotal</span>
                  <span id="estimate-subtotal" style="font-weight: 500;">$0.00</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <div style="display: flex; align-items: center; gap: 6px;">
                    <span>Tax</span>
                    <input type="number" id="estimate-tax-rate" value="0" min="0" max="100" step="0.01" style="width: 55px; text-align: center; padding: 4px; font-size: 12px;">
                    <span style="font-size: 12px;">%</span>
                  </div>
                  <span id="estimate-tax-amount">$0.00</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <div style="display: flex; align-items: center; gap: 6px;">
                    <span>Discount</span>
                    <input type="number" id="estimate-discount-value" value="0" min="0" step="0.01" style="width: 55px; text-align: center; padding: 4px; font-size: 12px;">
                    <select id="estimate-discount-type" style="padding: 4px; font-size: 12px;">
                      <option value="amount">$</option>
                      <option value="percent">%</option>
                    </select>
                  </div>
                  <span id="estimate-discount-amount" style="color: #22c55e;">-$0.00</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 14px 0; border-top: 2px solid var(--gold-primary); margin-top: 8px; font-size: 20px; font-weight: 700;">
                  <span>TOTAL</span>
                  <span id="estimate-total" style="color: var(--gold-primary);">$0.00</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Payment Schedule Section -->
          <div class="form-section" style="padding: 20px 24px; margin: 0; border-bottom: 1px solid var(--border-subtle);">
            <div class="form-section-title" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
              <div style="display: flex; align-items: center; gap: 8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="var(--gold-primary)" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
                Payment Schedule
              </div>
              <select id="payment-schedule-type" onchange="updatePaymentSchedule()" style="padding: 6px 12px; font-size: 13px;">
                <option value="deposit-balance">Deposit + Balance</option>
                <option value="three-part">3-Part Payment</option>
                <option value="due-on-completion">Due on Completion</option>
                <option value="custom">Custom Schedule</option>
              </select>
            </div>

            <div id="payment-schedule-container">
              <!-- Default: Deposit + Balance -->
              <div class="payment-schedule-items" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                <div style="padding: 16px; background: rgba(249, 203, 0, 0.1); border: 1px solid rgba(249, 203, 0, 0.3); border-radius: 10px;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <span style="font-weight: 600; font-size: 14px;">1. Deposit Required</span>
                    <div style="display: flex; align-items: center; gap: 6px;">
                      <input type="number" id="estimate-deposit-percent" value="50" min="0" max="100" style="width: 50px; text-align: center; padding: 4px; font-size: 13px;" onchange="updateEstimateTotals()">
                      <span style="font-size: 13px;">%</span>
                    </div>
                  </div>
                  <div style="font-size: 13px; color: var(--text-muted); margin-bottom: 4px;">Due upon approval</div>
                  <div id="estimate-deposit-amount" style="font-size: 22px; font-weight: 700; color: var(--gold-primary);">$0.00</div>
                </div>
                <div style="padding: 16px; background: rgba(255,255,255,0.03); border: 1px solid var(--border-subtle); border-radius: 10px;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <span style="font-weight: 600; font-size: 14px;">2. Balance Due</span>
                    <span id="estimate-balance-percent" style="font-size: 13px; color: var(--text-muted);">50%</span>
                  </div>
                  <div style="font-size: 13px; color: var(--text-muted); margin-bottom: 4px;">Due upon completion</div>
                  <div id="estimate-balance-amount" style="font-size: 22px; font-weight: 700;">$0.00</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Terms & Conditions Section -->
          <div class="form-section" style="padding: 20px 24px; margin: 0;">
            <div class="form-section-title" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
              <div style="display: flex; align-items: center; gap: 8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="var(--gold-primary)" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
                Terms & Conditions
              </div>
              <button type="button" class="btn-modern secondary small" onclick="loadTermsTemplate()" style="font-size: 12px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
                Load Default Terms
              </button>
            </div>
            <div class="form-row" style="gap: 16px; margin-bottom: 16px;">
              <div class="form-group" style="margin-bottom: 0;">
                <label style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Warranty</label>
                <input type="text" id="estimate-warranty" placeholder="1 year workmanship warranty">
              </div>
              <div class="form-group" style="margin-bottom: 0;">
                <label style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Estimated Timeline</label>
                <input type="text" id="estimate-timeline" placeholder="2-3 weeks from approval">
              </div>
            </div>
            <div class="form-group" style="margin-bottom: 12px;">
              <label style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Terms & Conditions</label>
              <textarea id="estimate-terms" rows="4" placeholder="Enter your standard terms and conditions..." style="font-size: 13px;"></textarea>
            </div>
            <div class="form-group" style="margin-bottom: 0; padding: 12px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.2);">
              <label style="font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; color: #93c5fd;">Internal Notes (Not shown to customer)</label>
              <textarea id="estimate-internal-notes" rows="2" placeholder="Private notes for your records..." style="font-size: 13px; background: transparent;"></textarea>
            </div>
          </div>
        </form>
      </div>

      <!-- Footer with Actions -->
      <div class="modal-footer" style="padding: 16px 24px; background: var(--bg-secondary); border-top: 1px solid var(--border-subtle); display: flex; justify-content: space-between; align-items: center;">
        <div style="display: flex; align-items: center; gap: 12px;">
          <button type="button" class="btn-modern secondary" onclick="closeCreateEstimateModal()">Cancel</button>
          <button type="button" class="btn-modern secondary" onclick="previewEstimate()" style="display: flex; align-items: center; gap: 6px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
            Preview
          </button>
        </div>
        <div style="display: flex; align-items: center; gap: 12px;">
          <button type="button" class="btn-modern secondary" onclick="saveEstimateDraft()" style="display: flex; align-items: center; gap: 6px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/></svg>
            Save Draft
          </button>
          <button type="submit" form="create-estimate-form" class="btn-modern primary" style="display: flex; align-items: center; gap: 6px; padding: 10px 20px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>
            Create & Send Estimate
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Business Settings Modal -->
  <div id="business-settings-modal" class="modal-overlay" onclick="if(event.target === this) closeBusinessSettings()">
    <div class="modal" style="max-width: 700px; max-height: 90vh; overflow-y: auto;">
      <div class="modal-header">
        <h2 class="modal-title">Business Settings</h2>
        <button class="modal-close" onclick="closeBusinessSettings()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="modal-body">
        <form id="business-settings-form" onsubmit="return saveBusinessSettings(event)">
          <!-- Logo Upload Section -->
          <div class="form-section">
            <div class="form-section-title">Company Logo</div>
            <div style="display: flex; align-items: center; gap: 24px;">
              <div id="logo-preview" style="width: 120px; height: 120px; background: var(--dark-elevated); border: 2px dashed var(--border-subtle); border-radius: 12px; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                <span id="logo-placeholder" style="color: var(--text-muted); font-size: 12px; text-align: center; padding: 10px;">No logo<br>uploaded</span>
                <img id="logo-image" src="" alt="Company Logo" style="display: none; max-width: 100%; max-height: 100%; object-fit: contain;">
              </div>
              <div style="flex: 1;">
                <input type="file" id="logo-upload" accept="image/*" style="display: none;" onchange="handleLogoUpload(event)">
                <button type="button" class="btn-modern secondary" onclick="document.getElementById('logo-upload').click()" style="margin-bottom: 8px;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
                  Upload Logo
                </button>
                <button type="button" class="btn-modern secondary" onclick="removeLogo()" id="remove-logo-btn" style="display: none; margin-left: 8px;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                  Remove
                </button>
                <p style="font-size: 12px; color: var(--text-muted); margin-top: 8px;">Recommended: Square image, 200x200px or larger. PNG or JPG.</p>
                <input type="hidden" id="biz-logo-url" value="">
              </div>
            </div>
          </div>

          <div class="form-section">
            <div class="form-section-title">Company Information</div>
            <div class="form-group">
              <label>Company Name</label>
              <input type="text" id="biz-company-name" placeholder="Your Company Name">
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Phone</label>
                <input type="tel" id="biz-phone" placeholder="(602) 555-1234">
              </div>
              <div class="form-group">
                <label>Email</label>
                <input type="email" id="biz-email" placeholder="info@company.com">
              </div>
            </div>
            <div class="form-group">
              <label>Address</label>
              <input type="text" id="biz-address" placeholder="123 Main St">
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>City</label>
                <input type="text" id="biz-city" placeholder="Phoenix">
              </div>
              <div class="form-group" style="flex: 0.5;">
                <label>State</label>
                <input type="text" id="biz-state" placeholder="AZ">
              </div>
              <div class="form-group" style="flex: 0.5;">
                <label>ZIP</label>
                <input type="text" id="biz-zip" placeholder="85001">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>License Number</label>
                <input type="text" id="biz-license" placeholder="ROC #123456">
              </div>
              <div class="form-group">
                <label>Website</label>
                <input type="url" id="biz-website" placeholder="https://yoursite.com">
              </div>
            </div>
          </div>

          <div class="form-section">
            <div class="form-section-title">Default Settings</div>
            <div class="form-row">
              <div class="form-group">
                <label>Default Tax Rate (%)</label>
                <input type="number" id="biz-tax-rate" value="0" min="0" max="100" step="0.01">
              </div>
              <div class="form-group">
                <label>Default Deposit (%)</label>
                <input type="number" id="biz-deposit" value="50" min="0" max="100">
              </div>
            </div>
            <div class="form-group">
              <label>Default Payment Terms</label>
              <input type="text" id="biz-payment-terms" placeholder="50% deposit, balance due upon completion">
            </div>
            <div class="form-group">
              <label>Default Warranty</label>
              <input type="text" id="biz-warranty" placeholder="1 year workmanship warranty">
            </div>
          </div>

          <div class="form-section">
            <div class="form-section-title">Numbering</div>
            <div class="form-row">
              <div class="form-group">
                <label>Estimate Prefix</label>
                <input type="text" id="biz-estimate-prefix" value="EST-" maxlength="10">
              </div>
              <div class="form-group">
                <label>Invoice Prefix</label>
                <input type="text" id="biz-invoice-prefix" value="INV-" maxlength="10">
              </div>
            </div>
          </div>

          <div class="form-section">
            <div class="form-section-title">Terms & Conditions</div>
            <div class="form-group">
              <label>Default Terms & Conditions for Estimates</label>
              <textarea id="biz-estimate-terms" rows="4" placeholder="Enter your standard terms and conditions..."></textarea>
            </div>
          </div>

          <div class="form-section">
            <div class="form-section-title">Integrations</div>
            <div style="display: flex; align-items: center; justify-content: space-between; padding: 16px; background: var(--dark-elevated); border-radius: 12px; border: 1px solid var(--border-subtle);">
              <div style="display: flex; align-items: center; gap: 12px;">
                <div style="width: 40px; height: 40px; background: #2CA01C; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
                </div>
                <div>
                  <div style="font-weight: 600; color: var(--text-primary);">QuickBooks Online</div>
                  <div id="qbo-status-text" style="font-size: 13px; color: var(--text-muted);">Sync invoices & estimates</div>
                </div>
              </div>
              <div id="qbo-connect-section">
                <button type="button" class="btn-modern primary" onclick="connectQuickBooks()" id="qbo-connect-btn">
                  Connect QuickBooks
                </button>
                <button type="button" class="btn-modern secondary" onclick="disconnectQuickBooks()" id="qbo-disconnect-btn" style="display: none;">
                  Disconnect
                </button>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-modern secondary" onclick="closeBusinessSettings()">Cancel</button>
        <button type="submit" form="business-settings-form" class="btn-modern primary">Save Settings</button>
      </div>
    </div>
  </div>

  <!-- New Job Modal -->
  <div id="new-job-modal" class="modal-overlay" onclick="if(event.target === this) closeNewJobModal()">
    <div class="modal" style="max-width: 700px; max-height: 90vh; overflow-y: auto;">
      <div class="modal-header">
        <h2 class="modal-title">Create New Job</h2>
        <button class="modal-close" onclick="closeNewJobModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <form id="new-job-form" onsubmit="createJob(event)">
        <div class="modal-body">
          <div class="form-section">
            <div class="form-section-title">Customer Information</div>
            <div class="form-group">
              <label>Select Existing Customer or Create New</label>
              <select id="job-customer-select" onchange="toggleNewCustomerFields()">
                <option value="">-- Select Customer --</option>
                <option value="new">+ Add New Customer</option>
              </select>
            </div>
            <div id="new-customer-fields" style="display: none;">
              <div class="form-row">
                <div class="form-group">
                  <label>Customer Name *</label>
                  <input type="text" id="job-customer-name" placeholder="John Smith">
                </div>
                <div class="form-group">
                  <label>Email</label>
                  <input type="email" id="job-customer-email" placeholder="john@example.com">
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Phone</label>
                  <input type="tel" id="job-customer-phone" placeholder="(555) 123-4567">
                </div>
                <div class="form-group">
                  <label>Address</label>
                  <input type="text" id="job-customer-address" placeholder="123 Main St">
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>City</label>
                  <input type="text" id="job-customer-city" placeholder="Phoenix">
                </div>
                <div class="form-group" style="flex: 0.5;">
                  <label>State</label>
                  <input type="text" id="job-customer-state" placeholder="AZ" maxlength="2">
                </div>
                <div class="form-group" style="flex: 0.5;">
                  <label>ZIP</label>
                  <input type="text" id="job-customer-zip" placeholder="85001">
                </div>
              </div>
            </div>
          </div>

          <div class="form-section">
            <div class="form-section-title">Job Details</div>
            <div class="form-group">
              <label>Job Title / Description *</label>
              <input type="text" id="job-title" required placeholder="Kitchen Countertop Installation">
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Job Type</label>
                <select id="job-type">
                  <option value="installation">Installation</option>
                  <option value="fabrication">Fabrication</option>
                  <option value="repair">Repair</option>
                  <option value="template">Template/Measure</option>
                  <option value="other">Other</option>
                </select>
              </div>
              <div class="form-group">
                <label>Priority</label>
                <select id="job-priority">
                  <option value="normal">Normal</option>
                  <option value="high">High</option>
                  <option value="urgent">Urgent</option>
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Total Amount ($)</label>
                <input type="number" id="job-total" step="0.01" min="0" placeholder="0.00">
              </div>
              <div class="form-group">
                <label>Deposit Received ($)</label>
                <input type="number" id="job-deposit" step="0.01" min="0" placeholder="0.00">
              </div>
            </div>
            <div class="form-group">
              <label>Notes</label>
              <textarea id="job-notes" rows="3" placeholder="Special instructions, material details, etc."></textarea>
            </div>
          </div>

          <div class="form-section">
            <div class="form-section-title">Schedule (Optional)</div>
            <div class="form-row">
              <div class="form-group">
                <label>Scheduled Date</label>
                <input type="date" id="job-scheduled-date">
              </div>
              <div class="form-group">
                <label>Scheduled Time</label>
                <input type="time" id="job-scheduled-time">
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-modern secondary" onclick="closeNewJobModal()">Cancel</button>
          <button type="submit" class="btn-modern primary">Create Job</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Quick Schedule Modal (Calendar) -->
  <div id="quick-schedule-modal" class="modal-overlay" onclick="if(event.target === this) closeQuickScheduleModal()">
    <div class="modal" style="max-width: 500px;">
      <div class="modal-header">
        <h2 class="modal-title">Quick Schedule</h2>
        <button class="modal-close" onclick="closeQuickScheduleModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <form id="quick-schedule-form" onsubmit="submitQuickSchedule(event)">
        <div class="modal-body">
          <div class="form-group">
            <label>Event Type</label>
            <select id="schedule-event-type" class="input-modern" required onchange="toggleScheduleFields()">
              <option value="job">Job/Installation</option>
              <option value="measure">Field Measure</option>
              <option value="consultation">Consultation</option>
              <option value="followup">Follow-up</option>
            </select>
          </div>

          <div class="form-group">
            <label>Select Job (Optional)</label>
            <select id="schedule-job-select" class="input-modern">
              <option value="">-- Create New or Select Existing --</option>
            </select>
          </div>

          <div id="schedule-new-job-fields">
            <div class="form-group">
              <label>Customer *</label>
              <select id="schedule-customer-select" class="input-modern">
                <option value="">-- Select Customer --</option>
              </select>
            </div>
            <div class="form-group">
              <label>Description *</label>
              <input type="text" id="schedule-description" class="input-modern" placeholder="Kitchen countertop install" required>
            </div>
          </div>

          <div class="form-row-modern">
            <div class="form-group">
              <label>Date *</label>
              <input type="date" id="schedule-date" class="input-modern" required>
            </div>
            <div class="form-group">
              <label>Time</label>
              <select id="schedule-time" class="input-modern">
                <option value="">All Day</option>
                <option value="07:00">7:00 AM</option>
                <option value="08:00">8:00 AM</option>
                <option value="09:00">9:00 AM</option>
                <option value="10:00">10:00 AM</option>
                <option value="11:00">11:00 AM</option>
                <option value="12:00">12:00 PM</option>
                <option value="13:00">1:00 PM</option>
                <option value="14:00">2:00 PM</option>
                <option value="15:00">3:00 PM</option>
                <option value="16:00">4:00 PM</option>
                <option value="17:00">5:00 PM</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Duration</label>
            <select id="schedule-duration" class="input-modern">
              <option value="1">1 hour</option>
              <option value="2" selected>2 hours</option>
              <option value="3">3 hours</option>
              <option value="4">4 hours (Half Day)</option>
              <option value="8">8 hours (Full Day)</option>
            </select>
          </div>

          <div class="form-group">
            <label>Notes</label>
            <textarea id="schedule-notes" class="input-modern" rows="2" placeholder="Access code, special instructions..."></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-modern secondary" onclick="closeQuickScheduleModal()">Cancel</button>
          <button type="submit" class="btn-modern primary">Schedule</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Day Events Modal (Calendar) -->
  <div id="day-events-modal" class="modal-overlay" onclick="if(event.target === this) closeDayEventsModal()">
    <div class="modal" style="max-width: 450px;">
      <div class="modal-header">
        <h2 class="modal-title" id="day-events-title">Events for January 1</h2>
        <button class="modal-close" onclick="closeDayEventsModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="modal-body" id="day-events-content">
        <!-- Events will be rendered here -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-modern primary" onclick="openQuickScheduleForDate()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
          Add Event
        </button>
      </div>
    </div>
  </div>

  <!-- Calendar Event Modal (Simplified) -->
  <div id="calendar-event-modal" class="modal-overlay" onclick="if(event.target === this) closeCalendarEventModal()">
    <div class="modal" style="max-width: 500px;">
      <div class="modal-header">
        <h2 class="modal-title" id="calendar-event-modal-title">New Event</h2>
        <button class="modal-close" onclick="closeCalendarEventModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <form id="calendar-event-form" onsubmit="submitCalendarEventSimple(event)">
        <input type="hidden" id="cal-event-id" value="" />
        <input type="hidden" id="cal-event-lead" value="" />
        <input type="hidden" id="cal-event-customer" value="" />
        <input type="hidden" id="cal-event-job" value="" />
        <input type="hidden" id="cal-event-project" value="" />
        <div class="modal-body" style="padding: 16px;">
          <!-- Title -->
          <div class="form-group" style="margin-bottom: 12px;">
            <label style="font-size: 13px; margin-bottom: 4px;">Title *</label>
            <input type="text" id="cal-event-title" class="input-modern" required placeholder="Event title" />
          </div>

          <!-- Type & Date/Time Row -->
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
            <div class="form-group" style="margin-bottom: 0;">
              <label style="font-size: 13px; margin-bottom: 4px;">Type</label>
              <select id="cal-event-type" class="input-modern">
                <option value="appointment">Appointment</option>
                <option value="consultation">Consultation</option>
                <option value="measurement">Measurement</option>
                <option value="template">Template</option>
                <option value="fabrication">Fabrication</option>
                <option value="installation">Installation</option>
                <option value="plumbing_disconnect">Plumbing Disconnect</option>
                <option value="plumbing_reconnect">Plumbing Reconnect</option>
                <option value="sealer_application">Sealer Application</option>
                <option value="walk_through">Walk-Through</option>
                <option value="final_inspection">Final Inspection</option>
                <option value="delivery">Delivery</option>
                <option value="site_visit">Site Visit</option>
                <option value="meeting">Meeting</option>
                <option value="follow_up">Follow-up</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="form-group" style="margin-bottom: 0;">
              <label style="font-size: 13px; margin-bottom: 4px;">Date *</label>
              <input type="date" id="cal-event-start-date" class="input-modern" required />
            </div>
          </div>

          <!-- Time Row -->
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
            <div class="form-group" style="margin-bottom: 0;">
              <label style="font-size: 13px; margin-bottom: 4px;">Start Time</label>
              <input type="time" id="cal-event-start-time" class="input-modern" value="09:00" />
            </div>
            <div class="form-group" style="margin-bottom: 0;">
              <label style="font-size: 13px; margin-bottom: 4px;">End Time</label>
              <input type="time" id="cal-event-end-time" class="input-modern" value="10:00" />
            </div>
          </div>
          <input type="hidden" id="cal-event-end-date" value="" />
          <input type="hidden" id="cal-event-status" value="scheduled" />

          <!-- Meeting Format -->
          <div class="form-group" style="margin-bottom: 12px;">
            <label style="font-size: 13px; margin-bottom: 4px;">Meeting Format</label>
            <select id="cal-event-meeting-format" class="input-modern">
              <option value="in_person">In Person</option>
              <option value="phone_call">Phone Call</option>
              <option value="video_call">Video Call</option>
              <option value="conference_call">Conference Call</option>
            </select>
          </div>

          <!-- Contact (optional) - Searchable -->
          <div class="form-group" style="margin-bottom: 12px; position: relative;">
            <label style="font-size: 13px; margin-bottom: 4px;">Contact</label>
            <input type="hidden" id="cal-event-contact-type" value="" />
            <input type="hidden" id="cal-event-contact-id" value="" />
            <!-- Selected contact chip (shown when contact is selected) -->
            <div id="cal-event-contact-chip" style="display: none; padding: 8px 12px; background: var(--gold-primary)22; border: 1px solid var(--gold-primary); border-radius: 8px; margin-bottom: 8px;">
              <div style="display: flex; align-items: center; justify-content: space-between;">
                <div>
                  <span id="cal-event-contact-chip-name" style="font-weight: 600; color: var(--text-primary);"></span>
                  <span id="cal-event-contact-chip-badge" style="font-size: 10px; padding: 2px 6px; border-radius: 10px; background: var(--gold-primary); color: #000; margin-left: 6px;"></span>
                </div>
                <button type="button" onclick="clearCalEventContact()" style="background: none; border: none; color: var(--text-muted); cursor: pointer; padding: 2px 6px; font-size: 16px;">&times;</button>
              </div>
            </div>
            <!-- Search input -->
            <input type="text" id="cal-event-contact-search" class="input-modern" placeholder="Search leads, customers, contractors..." oninput="searchCalEventContacts(this.value)" onfocus="searchCalEventContacts(this.value)" />
            <!-- Suggestions dropdown -->
            <div id="cal-event-contact-suggestions" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: var(--dark-elevated); border: 1px solid var(--border-color); border-radius: 8px; max-height: 200px; overflow-y: auto; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.3);"></div>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
            <div class="form-group" style="margin-bottom: 0;">
              <label style="font-size: 13px; margin-bottom: 4px;">Email</label>
              <input type="email" id="cal-event-contact-email" class="input-modern" placeholder="email@example.com" />
            </div>
            <div class="form-group" style="margin-bottom: 0;">
              <label style="font-size: 13px; margin-bottom: 4px;">Phone</label>
              <input type="tel" id="cal-event-contact-phone" class="input-modern" placeholder="(555) 123-4567" />
            </div>
          </div>

          <!-- Location / Meeting Details (Dynamic based on meeting format) -->
          <div id="cal-event-location-section" class="form-group" style="margin-bottom: 12px;">
            <!-- In Person Location -->
            <div id="location-in-person" style="display: block;">
              <label style="font-size: 13px; margin-bottom: 8px; display: block;">Location</label>
              <div style="display: flex; flex-direction: column; gap: 8px;">
                <!-- Contact address option (only shown when contact has address) -->
                <div id="contact-address-option" style="display: none;">
                  <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 10px 12px; background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 8px; margin-bottom: 8px;">
                    <input type="checkbox" id="use-contact-address" style="accent-color: #10b981;" onchange="handleUseContactAddress()" />
                    <i class="fa-solid fa-location-dot" style="color: #10b981;"></i>
                    <span style="flex: 1;">
                      <span style="font-size: 12px; color: var(--text-muted); display: block;">Use contact address:</span>
                      <span id="contact-address-text" style="font-size: 13px; color: var(--text-primary);"></span>
                    </span>
                  </label>
                </div>
                <!-- Manual location input with autocomplete -->
                <input type="text" id="cal-event-location" class="input-modern" placeholder="Enter address or location" />
                <!-- Map preview (shows when address is selected) -->
                <div id="location-map-preview" style="display: none; margin-top: 10px; border-radius: 8px; overflow: hidden; border: 1px solid var(--border-color);">
                  <div id="location-map" style="height: 150px; width: 100%; background: var(--dark-tertiary);"></div>
                  <div id="location-map-info" style="padding: 8px 12px; background: var(--dark-elevated); font-size: 12px; color: var(--text-muted); display: flex; align-items: center; gap: 8px;">
                    <i class="fa-solid fa-location-dot" style="color: var(--gold-primary);"></i>
                    <span id="location-map-address"></span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Phone Call Details -->
            <div id="location-phone-call" style="display: none;">
              <label style="font-size: 13px; margin-bottom: 8px; display: block;">Phone Call Details</label>
              <div style="padding: 12px; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 8px;">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                  <i class="fa-solid fa-phone" style="color: #3b82f6; font-size: 16px;"></i>
                  <span style="font-size: 13px; color: var(--text-muted);">Call will be made to:</span>
                </div>
                <div id="phone-call-number" style="font-size: 16px; font-weight: 600; color: var(--text-primary); padding-left: 26px;">
                  <span id="phone-call-display">No phone number set</span>
                </div>
                <input type="hidden" id="cal-event-location-phone" value="" />
              </div>
            </div>

            <!-- Video Call Details -->
            <div id="location-video-call" style="display: none;">
              <label style="font-size: 13px; margin-bottom: 8px; display: block;">Video Call Details</label>
              <div style="display: flex; flex-direction: column; gap: 8px;">
                <select id="cal-event-video-platform" class="input-modern" onchange="handleVideoPlatformChange()">
                  <option value="">Select platform...</option>
                  <option value="zoom">Zoom</option>
                  <option value="google_meet">Google Meet</option>
                  <option value="teams">Microsoft Teams</option>
                  <option value="facetime">FaceTime</option>
                  <option value="other">Other</option>
                </select>
                <input type="text" id="cal-event-video-link" class="input-modern" placeholder="Meeting link (optional)" />
              </div>
            </div>

            <!-- Conference Call Details -->
            <div id="location-conference-call" style="display: none;">
              <label style="font-size: 13px; margin-bottom: 8px; display: block;">Conference Call Details</label>
              <div style="display: flex; flex-direction: column; gap: 8px;">
                <input type="text" id="cal-event-conference-number" class="input-modern" placeholder="Dial-in number" />
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                  <input type="text" id="cal-event-conference-code" class="input-modern" placeholder="Access code" />
                  <input type="text" id="cal-event-conference-pin" class="input-modern" placeholder="PIN (optional)" />
                </div>
              </div>
            </div>
          </div>

          <!-- Notes -->
          <div class="form-group" style="margin-bottom: 12px;">
            <label style="font-size: 13px; margin-bottom: 4px;">Notes</label>
            <textarea id="cal-event-description" class="input-modern" rows="2" placeholder="Additional details..." style="resize: none;"></textarea>
          </div>

          <!-- Event Participants (Enhanced Group Events) -->
          <div class="form-group" style="margin-bottom: 12px;">
            <label style="font-size: 13px; margin-bottom: 8px; display: flex; align-items: center; justify-content: space-between;">
              <span>Participants</span>
              <span style="font-size: 11px; color: var(--text-muted); font-weight: normal;" id="participant-count">0 added</span>
            </label>

            <!-- Participant chips container -->
            <div id="event-participants-chips" style="display: flex; flex-wrap: wrap; gap: 6px; min-height: 36px; padding: 8px; background: var(--dark-tertiary); border-radius: 8px; border: 1px solid var(--border-color); margin-bottom: 10px;">
              <span style="color: var(--text-muted); font-size: 12px; padding: 4px 0;" id="no-participants-msg">No participants added</span>
            </div>

            <!-- Quick-add buttons -->
            <div style="display: flex; gap: 8px; margin-bottom: 10px; flex-wrap: wrap;">
              <button type="button" class="btn-modern ghost" style="flex: 1; min-width: 140px; padding: 8px 12px; font-size: 12px;" onclick="openParticipantPicker()">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="vertical-align: -2px; margin-right: 4px;"><path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                My Network
              </button>
              <button type="button" class="btn-modern ghost" style="flex: 1; min-width: 140px; padding: 8px 12px; font-size: 12px;" onclick="addProjectTeamToEvent()" id="add-project-team-btn" disabled>
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="vertical-align: -2px; margin-right: 4px;"><path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                Project Team
              </button>
              <button type="button" class="btn-modern ghost" style="flex: 1; min-width: 140px; padding: 8px 12px; font-size: 12px;" onclick="toggleManualParticipantForm()">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="vertical-align: -2px; margin-right: 4px;"><path stroke-linecap="round" stroke-linejoin="round" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>
                Add Manual
              </button>
            </div>

            <!-- Manual participant form (hidden by default) -->
            <div id="manual-participant-form" style="display: none; background: var(--dark-elevated); padding: 12px; border-radius: 8px; border: 1px solid var(--border-color); margin-bottom: 10px;">
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px;">
                <input type="text" id="manual-participant-name" placeholder="Name *" class="input-modern" style="font-size: 13px; padding: 8px 10px;" />
                <select id="manual-participant-role" class="input-modern" style="font-size: 13px; padding: 8px 10px;">
                  <option value="customer">Customer</option>
                  <option value="contractor">Contractor</option>
                  <option value="fabricator">Fabricator</option>
                  <option value="installer">Installer</option>
                  <option value="plumber">Plumber</option>
                  <option value="designer">Designer</option>
                  <option value="other">Other</option>
                </select>
              </div>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px;">
                <input type="email" id="manual-participant-email" placeholder="Email" class="input-modern" style="font-size: 13px; padding: 8px 10px;" />
                <input type="tel" id="manual-participant-phone" placeholder="Phone" class="input-modern" style="font-size: 13px; padding: 8px 10px;" />
              </div>
              <div style="display: flex; gap: 8px; justify-content: flex-end;">
                <button type="button" class="btn-modern ghost" style="padding: 6px 12px; font-size: 12px;" onclick="toggleManualParticipantForm()">Cancel</button>
                <button type="button" class="btn-modern primary" style="padding: 6px 12px; font-size: 12px;" onclick="addManualParticipant()">Add Participant</button>
              </div>
            </div>

            <!-- Hidden input for legacy contractors (still used for compatibility) -->
            <select id="cal-event-contractors" class="input-modern" multiple style="display: none;">
            </select>
          </div>

          <!-- Link to Project -->
          <div class="form-group" style="margin-bottom: 0;">
            <label style="font-size: 13px; margin-bottom: 4px;">Link to Project</label>
            <select id="cal-event-project-select" class="input-modern">
              <option value="">-- None --</option>
            </select>
          </div>
        </div>
        <div class="modal-footer" style="padding: 12px 16px;">
          <button type="button" class="btn-modern ghost" onclick="closeCalendarEventModal()">Cancel</button>
          <button type="submit" class="btn-modern primary" id="save-calendar-event-btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
            Save Event
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Multi-Event Workflow Scheduling Modal -->
  <div id="workflow-schedule-modal" class="modal-overlay" onclick="if(event.target === this) closeWorkflowScheduleModal()">
    <div class="modal" style="max-width: 700px;">
      <div class="modal-header" style="background: linear-gradient(135deg, var(--primary) 0%, var(--primary-hover) 100%);">
        <h2 class="modal-title" style="color: #fff;">
          <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="vertical-align: -4px; margin-right: 8px;"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
          Schedule Project Workflow
        </h2>
        <button class="modal-close" onclick="closeWorkflowScheduleModal()" style="color: #fff;">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <form id="workflow-schedule-form" onsubmit="submitWorkflowSchedule(event)">
        <input type="hidden" id="workflow-lead-id" value="" />
        <div class="modal-body" style="padding: 20px; max-height: 65vh; overflow-y: auto;">

          <!-- Customer Info Summary -->
          <div id="workflow-customer-info" style="background: var(--dark-tertiary); border-radius: 10px; padding: 14px; margin-bottom: 20px; border: 1px solid var(--border-color);">
            <div style="display: flex; align-items: center; gap: 12px;">
              <div style="width: 44px; height: 44px; background: linear-gradient(135deg, var(--primary), var(--accent)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; color: #fff; font-weight: 600;" id="workflow-customer-avatar">?</div>
              <div style="flex: 1;">
                <div style="font-weight: 600; font-size: 15px; color: var(--text-primary);" id="workflow-customer-name">Customer Name</div>
                <div style="font-size: 13px; color: var(--text-muted);" id="workflow-customer-details">email@example.com â€¢ (555) 123-4567</div>
                <div style="font-size: 12px; color: var(--text-muted); margin-top: 2px;" id="workflow-customer-address">123 Main St, City, ST</div>
              </div>
            </div>
          </div>

          <!-- Event Type Selection -->
          <div style="margin-bottom: 20px;">
            <label style="font-size: 14px; font-weight: 600; margin-bottom: 10px; display: block; color: var(--text-primary);">Select Events to Schedule</label>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
              <label class="workflow-event-toggle" style="display: flex; align-items: center; gap: 10px; padding: 12px; background: var(--dark-elevated); border: 2px solid var(--border-color); border-radius: 10px; cursor: pointer; transition: all 0.2s;">
                <input type="checkbox" id="workflow-include-template" checked style="width: 18px; height: 18px; accent-color: var(--primary);">
                <div>
                  <div style="font-weight: 500; font-size: 14px; color: var(--text-primary);">ðŸ“ Template/Measure</div>
                  <div style="font-size: 11px; color: var(--text-muted);">On-site measurement</div>
                </div>
              </label>
              <label class="workflow-event-toggle" style="display: flex; align-items: center; gap: 10px; padding: 12px; background: var(--dark-elevated); border: 2px solid var(--border-color); border-radius: 10px; cursor: pointer; transition: all 0.2s;">
                <input type="checkbox" id="workflow-include-demo" style="width: 18px; height: 18px; accent-color: var(--primary);">
                <div>
                  <div style="font-weight: 500; font-size: 14px; color: var(--text-primary);">ðŸ”¨ Demo/Tear-out</div>
                  <div style="font-size: 11px; color: var(--text-muted);">Remove existing counters</div>
                </div>
              </label>
              <label class="workflow-event-toggle" style="display: flex; align-items: center; gap: 10px; padding: 12px; background: var(--dark-elevated); border: 2px solid var(--border-color); border-radius: 10px; cursor: pointer; transition: all 0.2s;">
                <input type="checkbox" id="workflow-include-fabrication" checked style="width: 18px; height: 18px; accent-color: var(--primary);">
                <div>
                  <div style="font-weight: 500; font-size: 14px; color: var(--text-primary);">âš™ï¸ Fabrication</div>
                  <div style="font-size: 11px; color: var(--text-muted);">Cut & polish at shop</div>
                </div>
              </label>
              <label class="workflow-event-toggle" style="display: flex; align-items: center; gap: 10px; padding: 12px; background: var(--dark-elevated); border: 2px solid var(--border-color); border-radius: 10px; cursor: pointer; transition: all 0.2s;">
                <input type="checkbox" id="workflow-include-installation" checked style="width: 18px; height: 18px; accent-color: var(--primary);">
                <div>
                  <div style="font-weight: 500; font-size: 14px; color: var(--text-primary);">ðŸ”§ Installation</div>
                  <div style="font-size: 11px; color: var(--text-muted);">Install at customer site</div>
                </div>
              </label>
              <label class="workflow-event-toggle" style="display: flex; align-items: center; gap: 10px; padding: 12px; background: var(--dark-elevated); border: 2px solid var(--border-color); border-radius: 10px; cursor: pointer; transition: all 0.2s;">
                <input type="checkbox" id="workflow-include-plumbing" style="width: 18px; height: 18px; accent-color: var(--primary);">
                <div>
                  <div style="font-weight: 500; font-size: 14px; color: var(--text-primary);">ðŸš¿ Plumbing</div>
                  <div style="font-size: 11px; color: var(--text-muted);">Disconnect & reconnect</div>
                </div>
              </label>
              <label class="workflow-event-toggle" style="display: flex; align-items: center; gap: 10px; padding: 12px; background: var(--dark-elevated); border: 2px solid var(--border-color); border-radius: 10px; cursor: pointer; transition: all 0.2s;">
                <input type="checkbox" id="workflow-include-sealer" style="width: 18px; height: 18px; accent-color: var(--primary);">
                <div>
                  <div style="font-weight: 500; font-size: 14px; color: var(--text-primary);">ðŸ’§ Sealer Application</div>
                  <div style="font-size: 11px; color: var(--text-muted);">Apply protective sealer</div>
                </div>
              </label>
            </div>
          </div>

          <!-- Dates Section -->
          <div style="margin-bottom: 20px;">
            <label style="font-size: 14px; font-weight: 600; margin-bottom: 10px; display: block; color: var(--text-primary);">Schedule Dates</label>
            <div id="workflow-dates-container" style="display: flex; flex-direction: column; gap: 12px;">
              <!-- Dynamic date inputs will be inserted here -->
            </div>
          </div>

          <!-- Participants Section -->
          <div style="margin-bottom: 16px;">
            <label style="font-size: 14px; font-weight: 600; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; color: var(--text-primary);">
              <span>Invite Participants</span>
              <span style="font-size: 12px; font-weight: normal; color: var(--text-muted);" id="workflow-participant-count">0 selected</span>
            </label>

            <!-- Homeowner (auto-added) -->
            <div id="workflow-homeowner-participant" style="display: flex; align-items: center; gap: 10px; padding: 10px 12px; background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 8px; margin-bottom: 10px;">
              <input type="checkbox" id="workflow-invite-homeowner" checked style="width: 16px; height: 16px; accent-color: #22c55e;">
              <div style="flex: 1;">
                <div style="font-weight: 500; font-size: 13px; color: var(--text-primary);">ðŸ‘¤ Homeowner</div>
                <div style="font-size: 11px; color: var(--text-muted);" id="workflow-homeowner-email">customer@email.com</div>
              </div>
              <span style="font-size: 10px; padding: 2px 8px; background: #22c55e; color: #fff; border-radius: 4px;">Customer</span>
            </div>

            <!-- Contractor Selection -->
            <div style="background: var(--dark-tertiary); border-radius: 8px; padding: 12px; border: 1px solid var(--border-color);">
              <div style="font-size: 13px; font-weight: 500; margin-bottom: 8px; color: var(--text-secondary);">Add Contractors</div>
              <div id="workflow-contractors-list" style="max-height: 180px; overflow-y: auto; display: flex; flex-direction: column; gap: 6px;">
                <div style="text-align: center; padding: 16px; color: var(--text-muted); font-size: 12px;">Loading contractors...</div>
              </div>
            </div>
          </div>

          <!-- Notification Options -->
          <div style="background: var(--dark-elevated); border-radius: 8px; padding: 14px; border: 1px solid var(--border-color);">
            <label style="font-size: 13px; font-weight: 500; margin-bottom: 10px; display: block; color: var(--text-secondary);">Notification Options</label>
            <div style="display: flex; flex-wrap: wrap; gap: 16px;">
              <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                <input type="checkbox" id="workflow-send-email" checked style="width: 16px; height: 16px; accent-color: var(--primary);">
                <span style="font-size: 13px; color: var(--text-primary);">ðŸ“§ Send email invites</span>
              </label>
              <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                <input type="checkbox" id="workflow-send-sms" style="width: 16px; height: 16px; accent-color: var(--primary);">
                <span style="font-size: 13px; color: var(--text-primary);">ðŸ“± Send SMS reminders</span>
              </label>
              <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                <input type="checkbox" id="workflow-add-calendar" checked style="width: 16px; height: 16px; accent-color: var(--primary);">
                <span style="font-size: 13px; color: var(--text-primary);">ðŸ“… Add to calendar</span>
              </label>
            </div>
          </div>

          <!-- Notes -->
          <div style="margin-top: 16px;">
            <label style="font-size: 13px; margin-bottom: 4px; display: block; color: var(--text-secondary);">Notes for all events</label>
            <textarea id="workflow-notes" class="input-modern" rows="2" placeholder="Special instructions, access codes, etc..." style="resize: none;"></textarea>
          </div>
        </div>

        <div class="modal-footer" style="padding: 16px 20px; border-top: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
          <div style="font-size: 12px; color: var(--text-muted);">
            <span id="workflow-event-summary">3 events will be created</span>
          </div>
          <div style="display: flex; gap: 10px;">
            <button type="button" class="btn-modern ghost" onclick="closeWorkflowScheduleModal()">Cancel</button>
            <button type="submit" class="btn-modern primary" id="workflow-submit-btn">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="vertical-align: -3px; margin-right: 6px;"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
              Schedule & Send Invites
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- =============================================
       LEAD/CUSTOMER PROFILE PANEL (Slide-over) - ENHANCED
       ============================================= -->
  <div id="profile-panel-overlay" class="profile-panel-overlay" onclick="if(event.target === this) closeProfilePanel()">
    <div class="profile-panel">
      <!-- Enhanced Header -->
      <div class="profile-panel-header">
        <div class="profile-header-top">
          <div class="profile-header-actions">
            <button class="profile-header-btn" onclick="copyProfileLink()" title="Copy link">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
            </button>
            <button class="profile-header-btn" onclick="printProfile()" title="Print">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9V2h12v7"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>
            </button>
          </div>
          <button class="profile-header-btn close" onclick="closeProfilePanel()" title="Close">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
          </button>
        </div>
        <div class="profile-header-main">
          <div class="profile-avatar" id="profile-avatar">
            JD
            <div class="profile-avatar-badge" id="profile-avatar-badge" style="display: none;">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M5 13l4 4L19 7"/></svg>
            </div>
          </div>
          <div class="profile-header-info">
            <div class="profile-name" id="panel-profile-name">John Doe</div>
            <div class="profile-meta">
              <span class="profile-meta-item" id="panel-profile-email">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                <a href="#" id="panel-profile-email-link">email@example.com</a>
              </span>
              <span class="profile-meta-item" id="panel-profile-phone">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
                <a href="#" id="panel-profile-phone-link">(555) 123-4567</a>
              </span>
            </div>
            <div class="profile-badges">
              <span class="profile-status-badge new" id="profile-status">New Lead</span>
              <span class="profile-tag" id="profile-source-tag" style="display: none;">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>
                <span id="profile-source-text">Website</span>
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Stats Bar -->
      <div class="profile-stats-bar">
        <div class="profile-stat">
          <div class="profile-stat-value" id="profile-stat-days">0</div>
          <div class="profile-stat-label">Days in Pipeline</div>
        </div>
        <div class="profile-stat">
          <div class="profile-stat-value highlight" id="profile-stat-value">$0</div>
          <div class="profile-stat-label">Est. Value</div>
        </div>
        <div class="profile-stat">
          <div class="profile-stat-value" id="profile-stat-appointments">0</div>
          <div class="profile-stat-label">Appointments</div>
        </div>
        <div class="profile-stat">
          <div class="profile-stat-value" id="profile-stat-messages">0</div>
          <div class="profile-stat-label">Messages</div>
        </div>
      </div>

      <!-- Enhanced Tabs with Icons -->
      <div class="profile-tabs">
        <button class="profile-tab active" data-tab="overview" onclick="switchProfileTab('overview')">
          <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
          Overview
        </button>
        <button class="profile-tab" data-tab="appointments" onclick="switchProfileTab('appointments')">
          <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
          Appointments
          <span class="tab-badge muted" id="tab-badge-appointments">0</span>
        </button>
        <button class="profile-tab" data-tab="notes" onclick="switchProfileTab('notes')">
          <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
          Notes
          <span class="tab-badge muted" id="tab-badge-notes">0</span>
        </button>
        <button class="profile-tab" data-tab="attachments" onclick="switchProfileTab('attachments')">
          <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/></svg>
          Files
          <span class="tab-badge muted" id="tab-badge-files">0</span>
        </button>
        <button class="profile-tab" data-tab="messages" onclick="switchProfileTab('messages')">
          <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
          Messages
          <span class="tab-badge muted" id="tab-badge-messages">0</span>
        </button>
        <button class="profile-tab" data-tab="estimates" onclick="switchProfileTab('estimates')">
          <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/><path d="M16 13H8"/><path d="M16 17H8"/><path d="M10 9H8"/></svg>
          Estimates
          <span class="tab-badge" id="tab-badge-estimates" style="background: var(--gold-primary); color: #1a1a2e;">0</span>
        </button>
        <button class="profile-tab" data-tab="invoices" onclick="switchProfileTab('invoices')">
          <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
          Invoices
          <span class="tab-badge" id="tab-badge-invoices" style="background: #10b981; color: white;">0</span>
        </button>
        <button class="profile-tab" data-tab="activity" onclick="switchProfileTab('activity')">
          <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
          Activity
        </button>
      </div>

      <!-- Content -->
      <div class="profile-content">
        <!-- Overview Tab -->
        <div id="profile-tab-overview" class="profile-tab-content">
          <!-- Contact Information -->
          <div class="profile-section">
            <div class="profile-section-header">
              <div class="profile-section-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                Contact Information
              </div>
            </div>
            <div class="profile-info-grid">
              <div class="profile-info-item clickable" onclick="copyToClipboard(document.getElementById('profile-detail-email').textContent, 'Email copied')">
                <div class="profile-info-label">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                  Email
                </div>
                <div class="profile-info-value" id="profile-detail-email">â€”</div>
              </div>
              <div class="profile-info-item clickable" onclick="copyToClipboard(document.getElementById('profile-detail-phone').textContent, 'Phone copied')">
                <div class="profile-info-label">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72"/></svg>
                  Phone
                </div>
                <div class="profile-info-value" id="profile-detail-phone">â€”</div>
              </div>
              <div class="profile-info-item" style="grid-column: span 2;">
                <div class="profile-info-label">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
                  Address
                </div>
                <div id="profile-address-container">
                  <a href="#" id="profile-detail-address-link" target="_blank" class="profile-info-value" style="color: #3b82f6; text-decoration: none; display: block;">
                    <span id="profile-detail-address">â€”</span>
                  </a>
                  <div id="profile-address-actions" style="display: none; margin-top: 8px; display: flex; gap: 8px;">
                    <button onclick="openDirectionsFromProfile()" class="btn-modern ghost" style="font-size: 11px; padding: 6px 10px; flex: 1;">
                      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/></svg>
                      Directions
                    </button>
                    <button onclick="shareEnRouteFromProfile()" class="btn-modern primary" style="font-size: 11px; padding: 6px 10px; flex: 1;">
                      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                      En Route
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Project Details -->
          <div class="profile-section">
            <div class="profile-section-header">
              <div class="profile-section-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
                Project Details
              </div>
            </div>
            <div class="profile-info-grid">
              <div class="profile-info-item">
                <div class="profile-info-label">Project Type</div>
                <div class="profile-info-value" id="profile-detail-project-type">â€”</div>
              </div>
              <div class="profile-info-item">
                <div class="profile-info-label">Budget Range</div>
                <div class="profile-info-value" id="profile-detail-budget">â€”</div>
              </div>
              <div class="profile-info-item">
                <div class="profile-info-label">Timeline</div>
                <div class="profile-info-value" id="profile-detail-timeline">â€”</div>
              </div>
              <div class="profile-info-item">
                <div class="profile-info-label">Lead Source</div>
                <div class="profile-info-value" id="profile-detail-source">â€”</div>
              </div>
            </div>
          </div>

          <!-- Original Message -->
          <div class="profile-section" id="profile-message-section" style="display: none;">
            <div class="profile-section-header">
              <div class="profile-section-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                Original Message
              </div>
            </div>
            <div class="profile-info-item" style="background: var(--dark-elevated); border-left: 3px solid var(--primary);">
              <div class="profile-info-value" id="profile-detail-message" style="font-style: italic; color: var(--text-secondary); white-space: pre-wrap;">â€”</div>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="profile-section">
            <div class="profile-section-header">
              <div class="profile-section-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
                Quick Actions
              </div>
            </div>
            <div class="profile-quick-actions">
              <button class="profile-quick-action" onclick="openJobSchedulerFromProfile()">
                <div class="action-icon gold">
                  <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                </div>
                <div class="action-text">
                  <div class="action-title">Schedule Job</div>
                  <div class="action-desc">Plan phases & send invites</div>
                </div>
              </button>
              <button class="profile-quick-action" onclick="createEstimateFromProfile()">
                <div class="action-icon blue">
                  <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
                </div>
                <div class="action-text">
                  <div class="action-title">Create Estimate</div>
                  <div class="action-desc">Generate a quote</div>
                </div>
              </button>
              <button class="profile-quick-action" onclick="sendMessageFromProfile()">
                <div class="action-icon green">
                  <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                </div>
                <div class="action-text">
                  <div class="action-title">Send Email</div>
                  <div class="action-desc">Contact customer</div>
                </div>
              </button>
              <button class="profile-quick-action" onclick="openPortalFromProfile()">
                <div class="action-icon purple">
                  <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
                </div>
                <div class="action-text">
                  <div class="action-title">Customer Portal</div>
                  <div class="action-desc">View their portal</div>
                </div>
              </button>
              <button class="profile-quick-action" onclick="archiveLeadFromProfile()" id="archive-lead-btn">
                <div class="action-icon" style="background: rgba(107, 114, 128, 0.15);">
                  <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#6b7280" stroke-width="2"><polyline points="21 8 21 21 3 21 3 8"/><rect x="1" y="3" width="22" height="5"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
                </div>
                <div class="action-text">
                  <div class="action-title" id="archive-btn-title">Archive Lead</div>
                  <div class="action-desc" id="archive-btn-desc">Hide from active list</div>
                </div>
              </button>
            </div>
          </div>
        </div>

        <!-- Appointments Tab -->
        <div id="profile-tab-appointments" class="profile-tab-content" style="display: none;">
          <div class="profile-section-header" style="margin-bottom: 16px;">
            <div class="profile-section-title">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
              Scheduled Appointments
            </div>
            <button class="btn-modern primary" onclick="openJobSchedulerFromProfile()" style="padding: 8px 16px; font-size: 13px;">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>
              Schedule
            </button>
          </div>
          <div id="profile-appointments-list">
            <div style="text-align: center; padding: 60px 40px; color: var(--text-muted);">
              <div style="width: 80px; height: 80px; margin: 0 auto 20px; background: linear-gradient(135deg, rgba(249,203,0,0.1), rgba(249,203,0,0.05)); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="1.5"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
              </div>
              <div style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px;">No Appointments Yet</div>
              <div style="font-size: 13px; max-width: 280px; margin: 0 auto;">Click "Schedule" to plan job phases like templating, fabrication, and installation</div>
            </div>
          </div>
        </div>

        <!-- Notes Tab -->
        <div id="profile-tab-notes" class="profile-tab-content" style="display: none;">
          <div class="profile-section-header" style="margin-bottom: 16px;">
            <div class="profile-section-title">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
              Notes
            </div>
            <button class="btn-modern primary" onclick="addNewNote()" style="padding: 8px 16px; font-size: 13px;">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>
              Add Note
            </button>
          </div>
          <div id="profile-notes-input" style="display: none; margin-bottom: 20px; background: var(--dark-surface); padding: 16px; border-radius: 12px; border: 1px solid var(--primary);">
            <textarea id="new-note-text" class="input-modern" rows="4" placeholder="Type your note here..." style="margin-bottom: 12px; resize: none;"></textarea>
            <div style="display: flex; gap: 8px; justify-content: flex-end;">
              <button class="btn-modern ghost" onclick="cancelNewNote()">Cancel</button>
              <button class="btn-modern primary" onclick="saveNewNote()">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 13l4 4L19 7"/></svg>
                Save Note
              </button>
            </div>
          </div>
          <div id="profile-notes-list">
            <div style="text-align: center; padding: 60px 40px; color: var(--text-muted);">
              <div style="width: 80px; height: 80px; margin: 0 auto 20px; background: linear-gradient(135deg, rgba(59,130,246,0.1), rgba(59,130,246,0.05)); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="1.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
              </div>
              <div style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px;">No Notes Yet</div>
              <div style="font-size: 13px;">Add notes to track important details about this lead</div>
            </div>
          </div>
        </div>

        <!-- Attachments Tab -->
        <div id="profile-tab-attachments" class="profile-tab-content" style="display: none;">
          <div class="profile-section-header" style="margin-bottom: 16px;">
            <div class="profile-section-title">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/></svg>
              Files & Attachments
            </div>
            <button class="btn-modern primary" onclick="uploadAttachment()" style="padding: 8px 16px; font-size: 13px;">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"/></svg>
              Upload
            </button>
          </div>
          <div id="profile-attachments-list">
            <div style="text-align: center; padding: 60px 40px; color: var(--text-muted);">
              <div style="width: 80px; height: 80px; margin: 0 auto 20px; background: linear-gradient(135deg, rgba(139,92,246,0.1), rgba(139,92,246,0.05)); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="#8b5cf6" stroke-width="1.5"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/></svg>
              </div>
              <div style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px;">No Files Attached</div>
              <div style="font-size: 13px;">Upload photos, contracts, or other documents</div>
            </div>
          </div>
        </div>

        <!-- Messages Tab -->
        <div id="profile-tab-messages" class="profile-tab-content" style="display: none;">
          <div class="profile-section-header" style="margin-bottom: 16px;">
            <div class="profile-section-title">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
              Messages
            </div>
            <button class="btn-modern primary" onclick="composeMessage()" style="padding: 8px 16px; font-size: 13px;">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>
              Compose
            </button>
          </div>
          <div id="profile-messages-list">
            <div style="text-align: center; padding: 60px 40px; color: var(--text-muted);">
              <div style="width: 80px; height: 80px; margin: 0 auto 20px; background: linear-gradient(135deg, rgba(34,197,94,0.1), rgba(34,197,94,0.05)); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="1.5"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
              </div>
              <div style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px;">No Messages Yet</div>
              <div style="font-size: 13px;">Send an email to start the conversation</div>
            </div>
          </div>
        </div>

        <!-- Estimates Tab -->
        <div id="profile-tab-estimates" class="profile-tab-content" style="display: none;">
          <div class="profile-section-header" style="margin-bottom: 16px; display: flex; justify-content: space-between; align-items: center;">
            <div class="profile-section-title">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg>
              Estimates
            </div>
            <button class="btn-modern primary" style="font-size: 12px; padding: 6px 12px;" onclick="createEstimateFromProfile()">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
              New Estimate
            </button>
          </div>
          <div id="profile-estimates-list">
            <div style="text-align: center; padding: 60px 40px; color: var(--text-muted);">
              <div style="width: 80px; height: 80px; margin: 0 auto 20px; background: linear-gradient(135deg, rgba(249,203,0,0.1), rgba(249,203,0,0.05)); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="#f9cb00" stroke-width="1.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg>
              </div>
              <div style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px;">No Estimates Yet</div>
              <div style="font-size: 13px;">Create an estimate to send a quote to this lead</div>
            </div>
          </div>
        </div>

        <!-- Invoices Tab -->
        <div id="profile-tab-invoices" class="profile-tab-content" style="display: none;">
          <div class="profile-section-header" style="margin-bottom: 16px; display: flex; justify-content: space-between; align-items: center;">
            <div class="profile-section-title">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
              Invoices
            </div>
            <button class="btn-modern primary" style="font-size: 12px; padding: 6px 12px;" onclick="createInvoiceFromProfile()">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
              New Invoice
            </button>
          </div>
          <div id="profile-invoices-list">
            <div style="text-align: center; padding: 60px 40px; color: var(--text-muted);">
              <div style="width: 80px; height: 80px; margin: 0 auto 20px; background: linear-gradient(135deg, rgba(16,185,129,0.1), rgba(16,185,129,0.05)); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="1.5"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
              </div>
              <div style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px;">No Invoices Yet</div>
              <div style="font-size: 13px;">Create an invoice after converting an estimate</div>
            </div>
          </div>
        </div>

        <!-- Activity Tab -->
        <div id="profile-tab-activity" class="profile-tab-content" style="display: none;">
          <div class="profile-section-header" style="margin-bottom: 16px;">
            <div class="profile-section-title">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
              Activity Timeline
            </div>
          </div>
          <div id="profile-activity-list">
            <div style="text-align: center; padding: 60px 40px; color: var(--text-muted);">
              <div style="width: 80px; height: 80px; margin: 0 auto 20px; background: linear-gradient(135deg, rgba(6,182,212,0.1), rgba(6,182,212,0.05)); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="#06b6d4" stroke-width="1.5"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
              </div>
              <div style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px;">No Activity Yet</div>
              <div style="font-size: 13px;">Activity will appear as you interact with this lead</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer Actions -->
      <div class="profile-actions">
        <button class="btn-modern secondary" onclick="editProfileRecord()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
          Edit Details
        </button>
        <button class="btn-modern primary" onclick="openJobSchedulerFromProfile()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
          Schedule Job
        </button>
      </div>
    </div>
  </div>

  <!-- =============================================
       JOB PHASE SCHEDULER (Full Page) - ENHANCED
       ============================================= -->
  <div id="job-scheduler-panel" class="job-scheduler-panel">
    <!-- Enhanced Header -->
    <div class="job-scheduler-header">
      <h1>
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
        Job Phase Scheduler
      </h1>
      <div class="scheduler-header-right">
        <div class="scheduler-customer-badge">
          <div class="avatar" id="scheduler-avatar">JD</div>
          <span class="name" id="scheduler-customer-name">Customer Name</span>
        </div>
        <button class="job-scheduler-close" onclick="closeJobScheduler()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
        </button>
      </div>
    </div>

    <!-- Body -->
    <div class="job-scheduler-body">
      <!-- Left Sidebar: Customer Info & Settings -->
      <div class="job-scheduler-sidebar">
        <!-- Customer Info -->
        <div class="profile-section">
          <div class="profile-section-title" style="margin-bottom: 16px;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            Customer Info
          </div>
          <div class="scheduler-info-card">
            <div class="label">Name</div>
            <div class="value" id="scheduler-detail-name">â€”</div>
          </div>
          <div class="scheduler-info-card">
            <div class="label">Address</div>
            <div class="value" id="scheduler-detail-address">â€”</div>
          </div>
          <div class="scheduler-info-card">
            <div class="label">Phone</div>
            <div class="value" id="scheduler-detail-phone">â€”</div>
          </div>
        </div>

        <!-- Backward Scheduling -->
        <div class="profile-section">
          <div class="profile-section-title" style="margin-bottom: 16px;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
            Backward Scheduling
          </div>
          <div class="scheduler-date-input">
            <label>Installation Date</label>
            <input type="date" id="scheduler-install-date" class="input-modern" onchange="recalculatePhases()">
            <p style="font-size: 11px; color: var(--text-muted); margin-top: 10px; margin-bottom: 0;">Set the install date and we'll calculate all other phases backward automatically.</p>
          </div>
        </div>

        <!-- Lead Times -->
        <div class="profile-section">
          <div class="profile-section-title" style="margin-bottom: 16px;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/></svg>
            Lead Times (Days)
          </div>
          <div class="scheduler-lead-time">
            <label>Fab to Install</label>
            <input type="number" id="lead-time-fab" value="3" min="1" max="14" class="input-modern" onchange="recalculatePhases()">
          </div>
          <div class="scheduler-lead-time">
            <label>Template to Fab</label>
            <input type="number" id="lead-time-template" value="5" min="1" max="14" class="input-modern" onchange="recalculatePhases()">
          </div>
        </div>

        <!-- Notifications -->
        <div class="profile-section">
          <div class="profile-section-title" style="margin-bottom: 16px;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
            Notifications
          </div>
          <label class="scheduler-notification">
            <input type="checkbox" id="scheduler-notify-customer" checked>
            <span>Email customer invites</span>
          </label>
          <label class="scheduler-notification">
            <input type="checkbox" id="scheduler-notify-contractors" checked>
            <span>Email contractor invites</span>
          </label>
          <label class="scheduler-notification">
            <input type="checkbox" id="scheduler-sms">
            <span>SMS reminders (24hr before)</span>
          </label>
        </div>
      </div>

      <!-- Main: Phase Cards -->
      <div class="job-scheduler-main">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
          <div>
            <h2 style="margin: 0 0 4px; font-size: 20px; font-weight: 700; color: var(--text-primary);">Job Phases</h2>
            <p style="margin: 0; font-size: 13px; color: var(--text-muted);">Enable phases and set dates for the project workflow</p>
          </div>
          <div style="display: flex; gap: 10px;">
            <button class="btn-modern ghost" onclick="resetPhases()">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
              Reset
            </button>
            <button class="btn-modern primary" onclick="saveJobPhases()" style="padding: 12px 24px;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
              Save & Send Invites
            </button>
          </div>
        </div>

        <div id="job-phases-container">
          <!-- Phase cards will be rendered here -->
        </div>

        <!-- Add Phase Button -->
        <button class="btn-modern ghost" style="width: 100%; padding: 18px; border: 2px dashed var(--border-subtle); margin-top: 16px; transition: all 0.2s;" onclick="showAddPhaseOptions()" onmouseover="this.style.borderColor='var(--primary)'" onmouseout="this.style.borderColor='var(--border-subtle)'">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>
          Add Custom Phase
        </button>
      </div>

      <!-- Right Sidebar: Timeline Preview -->
      <div class="job-scheduler-timeline">
        <div class="profile-section-title" style="margin-bottom: 20px;">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
          Timeline Preview
        </div>
        <div id="scheduler-timeline-preview">
          <!-- Timeline items will be rendered here -->
          <div style="text-align: center; padding: 30px 0; color: var(--text-muted);">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" style="opacity: 0.4; margin-bottom: 10px;"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
            <div style="font-size: 13px;">Enable phases to see timeline</div>
          </div>
        </div>

        <div style="margin-top: 28px; padding-top: 20px; border-top: 1px solid var(--border-subtle);">
          <div class="profile-section-title" style="margin-bottom: 16px;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
            Assigned Contractors
          </div>
          <div id="scheduler-contractors-list">
            <button class="btn-modern ghost" style="width: 100%; font-size: 13px; padding: 14px;" onclick="openContractorPicker()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg>
              Add Contractor
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Calendar Event Detail Modal -->
  <div id="calendar-event-detail-modal" class="modal-overlay" onclick="if(event.target === this) closeCalendarEventDetailModal()">
    <div class="modal" style="max-width: 550px;">
      <div class="modal-header">
        <h2 class="modal-title" id="event-detail-title">Event Details</h2>
        <button class="modal-close" onclick="closeCalendarEventDetailModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="modal-body" id="event-detail-content">
        <div style="text-align: center; padding: 40px;"><div class="spinner"></div></div>
      </div>
      <div class="modal-footer" id="event-detail-actions">
        <button type="button" class="btn-modern secondary" onclick="closeCalendarEventDetailModal()">Close</button>
      </div>
    </div>
  </div>

  <!-- Participant Picker Modal -->
  <div class="modal-overlay" id="participant-picker-modal" onclick="if(event.target === this) closeParticipantPicker()">
    <div class="modal" style="max-width: 480px;">
      <div class="modal-header">
        <h2 class="modal-title">Add from My Network</h2>
        <button class="modal-close" onclick="closeParticipantPicker()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="modal-body" style="padding: 16px;">
        <input type="text" id="participant-search" class="input-modern" placeholder="Search by name, email, or role..." oninput="filterParticipantPicker(this.value)" style="margin-bottom: 12px;" />
        <div id="participant-picker-list" style="max-height: 300px; overflow-y: auto;">
          <div style="text-align: center; padding: 20px; color: var(--text-muted);">Loading network...</div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-modern ghost" onclick="closeParticipantPicker()">Cancel</button>
        <button type="button" class="btn-modern primary" onclick="confirmSelectedParticipants()">
          Add Selected (<span id="selected-participants-count">0</span>)
        </button>
      </div>
    </div>
  </div>

  <!-- Simple Invite Modal -->
  <div class="modal-overlay" id="invite-to-network-modal" onclick="if(event.target === this) closeInviteToNetworkModal()">
    <div class="modal" style="max-width: 420px;">
      <div class="modal-header" style="border-bottom: none; padding-bottom: 0;">
        <h2 class="modal-title" style="font-size: 22px;">Invite Someone</h2>
        <button class="modal-close" onclick="closeInviteToNetworkModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="modal-body" style="padding-top: 8px;">
        <p style="color: var(--text-muted); font-size: 14px; margin-bottom: 20px; line-height: 1.5;">
          Send them a link to create their free account. They'll be able to collaborate with you, check messages, and use all the tools.
        </p>
        <form id="invite-network-form" onsubmit="return sendNetworkInvite(event)">
          <div class="form-group" style="margin-bottom: 16px;">
            <label style="font-size: 13px; font-weight: 600;">Their Name</label>
            <input type="text" id="network-invite-name" required placeholder="John Smith" class="input-modern" maxlength="200" style="font-size: 16px; padding: 14px;" />
          </div>
          <div class="form-group" style="margin-bottom: 16px;">
            <label style="font-size: 13px; font-weight: 600;">Email or Phone</label>
            <input type="text" id="network-invite-contact" placeholder="john@email.com or (555) 123-4567" class="input-modern" style="font-size: 16px; padding: 14px;" />
            <span style="font-size: 11px; color: var(--text-muted);">We'll send them an invite link</span>
          </div>
          <div class="form-group" style="margin-bottom: 20px;">
            <label style="font-size: 13px; font-weight: 600;">They are a...</label>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 8px;">
              <label class="role-option" style="display: flex; align-items: center; gap: 10px; padding: 12px; background: var(--dark-elevated); border: 2px solid var(--border-subtle); border-radius: 10px; cursor: pointer; transition: all 0.15s;">
                <input type="radio" name="invite-role" value="contractor" style="display: none;">
                <span style="font-size: 20px;">ðŸ”¨</span>
                <span style="font-size: 14px;">Contractor</span>
              </label>
              <label class="role-option" style="display: flex; align-items: center; gap: 10px; padding: 12px; background: var(--dark-elevated); border: 2px solid var(--border-subtle); border-radius: 10px; cursor: pointer; transition: all 0.15s;">
                <input type="radio" name="invite-role" value="fabricator" style="display: none;">
                <span style="font-size: 20px;">âš™ï¸</span>
                <span style="font-size: 14px;">Fabricator</span>
              </label>
              <label class="role-option" style="display: flex; align-items: center; gap: 10px; padding: 12px; background: var(--dark-elevated); border: 2px solid var(--border-subtle); border-radius: 10px; cursor: pointer; transition: all 0.15s;">
                <input type="radio" name="invite-role" value="installer" style="display: none;">
                <span style="font-size: 20px;">ðŸ› ï¸</span>
                <span style="font-size: 14px;">Installer</span>
              </label>
              <label class="role-option" style="display: flex; align-items: center; gap: 10px; padding: 12px; background: var(--dark-elevated); border: 2px solid var(--border-subtle); border-radius: 10px; cursor: pointer; transition: all 0.15s;">
                <input type="radio" name="invite-role" value="designer" style="display: none;">
                <span style="font-size: 20px;">ðŸŽ¨</span>
                <span style="font-size: 14px;">Designer</span>
              </label>
              <label class="role-option" style="display: flex; align-items: center; gap: 10px; padding: 12px; background: var(--dark-elevated); border: 2px solid var(--border-subtle); border-radius: 10px; cursor: pointer; transition: all 0.15s;">
                <input type="radio" name="invite-role" value="partner" style="display: none;">
                <span style="font-size: 20px;">ðŸ¤</span>
                <span style="font-size: 14px;">Trade Partner</span>
              </label>
              <label class="role-option" style="display: flex; align-items: center; gap: 10px; padding: 12px; background: var(--dark-elevated); border: 2px solid var(--border-subtle); border-radius: 10px; cursor: pointer; transition: all 0.15s;">
                <input type="radio" name="invite-role" value="vendor" style="display: none;">
                <span style="font-size: 20px;">ðŸ“¦</span>
                <span style="font-size: 14px;">Vendor</span>
              </label>
            </div>
          </div>
          <button type="submit" class="btn-modern primary" id="send-network-invite-btn" style="width: 100%; padding: 16px; font-size: 16px; font-weight: 600;">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="margin-right: 10px;"><path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>
            Send Invite
          </button>
        </form>
      </div>
    </div>
  </div>
  <style>
    .role-option:has(input:checked) {
      border-color: var(--gold-primary) !important;
      background: rgba(249, 203, 0, 0.1) !important;
    }
    .role-option:hover {
      border-color: var(--gold-primary);
    }
  </style>

  <!-- Assign to Project Modal -->
  <div class="modal-overlay" id="assign-to-project-modal" onclick="if(event.target === this) closeAssignToProjectModal()">
    <div class="modal" style="max-width: 450px;">
      <div class="modal-header">
        <h2 class="modal-title">Assign to Project</h2>
        <button class="modal-close" onclick="closeAssignToProjectModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="modal-body">
        <p style="color: var(--text-muted); font-size: 13px; margin-bottom: 16px;">
          Assign <strong id="assign-collaborator-name"></strong> to a project.
        </p>
        <form id="assign-project-form" onsubmit="return submitAssignToProject(event)">
          <input type="hidden" id="assign-collaborator-id" />
          <div class="form-group">
            <label>Select Project *</label>
            <select id="assign-project-select" required class="input-modern">
              <option value="">Loading projects...</option>
            </select>
          </div>
          <div class="form-group">
            <label>Access Level</label>
            <select id="assign-access-level" class="input-modern">
              <option value="read">Read Only</option>
              <option value="write">Read & Write</option>
              <option value="admin">Admin</option>
            </select>
          </div>
          <button type="submit" class="btn-modern primary" style="width: 100%;">
            Assign to Project
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Collaborator Chat Modal -->
  <div class="modal-overlay" id="collaborator-chat-modal" onclick="if(event.target === this) closeCollaboratorChat()">
    <div class="modal" style="max-width: 500px; height: 70vh; display: flex; flex-direction: column;">
      <div class="modal-header" style="flex-shrink: 0;">
        <div style="display: flex; align-items: center; gap: 12px;">
          <div style="width: 40px; height: 40px; background: var(--gold-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; color: #1a1a2e;" id="chat-collaborator-avatar">?</div>
          <div>
            <h2 class="modal-title" id="chat-collaborator-name" style="margin: 0;">Chat</h2>
            <div style="font-size: 12px; color: var(--text-muted);" id="chat-collaborator-email"></div>
          </div>
        </div>
        <button class="modal-close" onclick="closeCollaboratorChat()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="modal-body" style="flex: 1; overflow-y: auto; padding: 16px; display: flex; flex-direction: column;">
        <div id="collaborator-chat-messages" style="flex: 1; overflow-y: auto; margin-bottom: 16px;">
          <div style="text-align: center; padding: 40px; color: var(--text-muted);">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1" style="margin-bottom: 12px; opacity: 0.5;"><path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
            <p>Start a conversation</p>
          </div>
        </div>
      </div>
      <div style="padding: 16px; border-top: 1px solid var(--border-subtle); flex-shrink: 0;">
        <input type="hidden" id="chat-collaborator-id" />
        <div style="display: flex; gap: 8px;">
          <textarea id="collaborator-message-input" class="input-modern" placeholder="Type a message..." rows="2" style="flex: 1; resize: none;" onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); sendCollaboratorMessage(); }"></textarea>
          <button class="btn-modern primary" onclick="sendCollaboratorMessage()" style="padding: 12px 16px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>
          </button>
        </div>
        <div style="display: flex; gap: 8px; margin-top: 8px;">
          <label style="display: flex; align-items: center; gap: 4px; font-size: 12px; color: var(--text-muted); cursor: pointer;">
            <input type="radio" name="collab-msg-channel" value="in_app" checked style="margin: 0;"> In-App
          </label>
          <label style="display: flex; align-items: center; gap: 4px; font-size: 12px; color: var(--text-muted); cursor: pointer;">
            <input type="radio" name="collab-msg-channel" value="email" style="margin: 0;"> Email
          </label>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Assign Team Member Modal (from Project to Network) -->
  <div class="modal-overlay" id="quick-assign-modal" onclick="if(event.target === this) closeQuickAssignModal()">
    <div class="modal" style="max-width: 500px;">
      <div class="modal-header">
        <h2 class="modal-title">Assign Team Member</h2>
        <button class="modal-close" onclick="closeQuickAssignModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="modal-body" style="padding: 16px;">
        <input type="hidden" id="quick-assign-project-id" />
        <p style="color: var(--text-muted); font-size: 13px; margin-bottom: 16px;">
          Select a collaborator from your network to add to this project's team.
        </p>

        <!-- Search -->
        <input type="text" id="quick-assign-search" class="input-modern" placeholder="Search by name, role, or company..." oninput="filterQuickAssignList(this.value)" style="margin-bottom: 12px;" />

        <!-- Collaborator List -->
        <div id="quick-assign-list" style="max-height: 280px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 8px;">
          <div style="text-align: center; padding: 20px; color: var(--text-muted);">Loading network...</div>
        </div>

        <!-- Role Selection -->
        <div style="margin-top: 16px;">
          <label style="font-size: 13px; font-weight: 600; display: block; margin-bottom: 8px;">Assign as Role</label>
          <div style="display: flex; flex-wrap: wrap; gap: 8px;">
            <label class="role-chip" style="display: inline-flex; align-items: center; gap: 6px; padding: 8px 14px; background: var(--dark-tertiary); border: 2px solid var(--border-color); border-radius: 20px; cursor: pointer; transition: all 0.2s;">
              <input type="radio" name="quick-assign-role" value="contractor" checked style="display: none;" />
              <span>ðŸ”¨ Contractor</span>
            </label>
            <label class="role-chip" style="display: inline-flex; align-items: center; gap: 6px; padding: 8px 14px; background: var(--dark-tertiary); border: 2px solid var(--border-color); border-radius: 20px; cursor: pointer; transition: all 0.2s;">
              <input type="radio" name="quick-assign-role" value="fabricator" style="display: none;" />
              <span>âš™ï¸ Fabricator</span>
            </label>
            <label class="role-chip" style="display: inline-flex; align-items: center; gap: 6px; padding: 8px 14px; background: var(--dark-tertiary); border: 2px solid var(--border-color); border-radius: 20px; cursor: pointer; transition: all 0.2s;">
              <input type="radio" name="quick-assign-role" value="installer" style="display: none;" />
              <span>ðŸ› ï¸ Installer</span>
            </label>
            <label class="role-chip" style="display: inline-flex; align-items: center; gap: 6px; padding: 8px 14px; background: var(--dark-tertiary); border: 2px solid var(--border-color); border-radius: 20px; cursor: pointer; transition: all 0.2s;">
              <input type="radio" name="quick-assign-role" value="plumber" style="display: none;" />
              <span>ðŸ”§ Plumber</span>
            </label>
            <label class="role-chip" style="display: inline-flex; align-items: center; gap: 6px; padding: 8px 14px; background: var(--dark-tertiary); border: 2px solid var(--border-color); border-radius: 20px; cursor: pointer; transition: all 0.2s;">
              <input type="radio" name="quick-assign-role" value="measurer" style="display: none;" />
              <span>ðŸ“ Measurer</span>
            </label>
            <label class="role-chip" style="display: inline-flex; align-items: center; gap: 6px; padding: 8px 14px; background: var(--dark-tertiary); border: 2px solid var(--border-color); border-radius: 20px; cursor: pointer; transition: all 0.2s;">
              <input type="radio" name="quick-assign-role" value="designer" style="display: none;" />
              <span>ðŸŽ¨ Designer</span>
            </label>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-modern ghost" onclick="closeQuickAssignModal()">Cancel</button>
        <button type="button" class="btn-modern primary" id="quick-assign-btn" onclick="confirmQuickAssign()" disabled>
          Assign Selected
        </button>
      </div>
    </div>
  </div>
  <style>
    .role-chip:has(input:checked) {
      border-color: var(--gold-primary) !important;
      background: rgba(249, 203, 0, 0.15) !important;
    }
    .role-chip:hover {
      border-color: var(--gold-primary);
    }
    .quick-assign-item.selected {
      background: var(--gold-primary)11 !important;
      border-left: 3px solid var(--gold-primary);
    }
  </style>

  <!-- Job Detail Modal -->
  <div id="job-detail-modal" class="modal-overlay" onclick="if(event.target === this) closeJobDetailModal()">
    <div class="modal" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
      <div class="modal-header">
        <h2 class="modal-title">Job Details - <span id="job-detail-number">JOB-0001</span></h2>
        <button class="modal-close" onclick="closeJobDetailModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="modal-body">
        <!-- Job Status Bar -->
        <div style="display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap;">
          <select id="job-detail-status" onchange="updateJobStatus()" style="padding: 8px 16px; border-radius: 8px; background: var(--dark-elevated); border: 1px solid var(--border-subtle); color: var(--text-primary);">
            <option value="new">New</option>
            <option value="reviewing">Reviewing</option>
            <option value="material_ordered">Material Ordered</option>
            <option value="material_received">Material Received</option>
            <option value="assigned">Assigned</option>
            <option value="scheduled">Scheduled</option>
            <option value="measured">Measured</option>
            <option value="in_production">In Production</option>
            <option value="ready">Ready</option>
            <option value="installing">Installing</option>
            <option value="completed">Completed</option>
            <option value="on_hold">On Hold</option>
            <option value="cancelled">Cancelled</option>
          </select>
          <button class="btn-modern primary small" onclick="scheduleForCurrentJob()">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
            Schedule
          </button>
          <button class="btn-modern secondary small" onclick="sendCustomerUpdate()">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
            Email Customer
          </button>
          <button class="btn-modern secondary small" onclick="openAssignCollaboratorModal()">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>
            Assign Collaborator
          </button>
          <button class="btn-modern secondary small" onclick="inviteCollaboratorForJob()" title="Invite someone to collaborate on this job">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/></svg>
            Invite Collaborator
          </button>
          <button class="btn-modern secondary small" onclick="orderMaterials()">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/></svg>
            Order Materials
          </button>
        </div>

        <!-- Two Column Layout -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
          <!-- Left Column - Customer & Job Info -->
          <div>
            <div class="form-section">
              <div class="form-section-title" style="display: flex; justify-content: space-between; align-items: center;">
                Customer
                <div style="display: flex; gap: 6px;">
                  <button class="btn-modern secondary small" onclick="inviteCustomerAsCollaborator()" title="Invite customer to collaborate">
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>
                    Invite
                  </button>
                  <button class="btn-modern secondary small" onclick="sendCustomerPortalLink()" title="Send portal access link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/></svg>
                    Portal
                  </button>
                </div>
              </div>
              <div id="job-detail-customer" style="padding: 12px; background: var(--dark-elevated); border-radius: 8px;">
                <div style="font-weight: 600;" id="job-customer-name-display">Loading...</div>
                <div style="font-size: 13px; color: var(--text-muted);" id="job-customer-email-display"></div>
                <div style="font-size: 13px; color: var(--text-muted);" id="job-customer-phone-display"></div>
                <div style="font-size: 13px; color: var(--text-muted); margin-top: 4px;" id="job-customer-address-display"></div>
              </div>
            </div>

            <div class="form-section">
              <div class="form-section-title">Job Info</div>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                <div>
                  <label style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">Type</label>
                  <div id="job-detail-type" style="font-weight: 500;">Installation</div>
                </div>
                <div>
                  <label style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">Priority</label>
                  <div id="job-detail-priority" style="font-weight: 500;">Normal</div>
                </div>
                <div>
                  <label style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">Total</label>
                  <div id="job-detail-total" style="font-weight: 600; color: var(--gold-primary);">$0.00</div>
                </div>
                <div>
                  <label style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">Balance Due</label>
                  <div id="job-detail-balance" style="font-weight: 600;">$0.00</div>
                </div>
              </div>
              <div style="margin-top: 12px;">
                <label style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">Notes</label>
                <div id="job-detail-notes" style="font-size: 14px; color: var(--text-secondary);">-</div>
              </div>
            </div>

            <div class="form-section">
              <div class="form-section-title">Schedule</div>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                <div>
                  <label style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">Field Measure</label>
                  <input type="datetime-local" id="job-field-measure-date" onchange="updateJobSchedule('field_measure_date')"
                         style="width: 100%; padding: 8px; border-radius: 6px; background: var(--dark-elevated); border: 1px solid var(--border-subtle); color: var(--text-primary); font-size: 13px;">
                </div>
                <div>
                  <label style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">Install Date</label>
                  <input type="datetime-local" id="job-install-date" onchange="updateJobSchedule('install_date')"
                         style="width: 100%; padding: 8px; border-radius: 6px; background: var(--dark-elevated); border: 1px solid var(--border-subtle); color: var(--text-primary); font-size: 13px;">
                </div>
              </div>
            </div>

            <div class="form-section">
              <div class="form-section-title" style="display: flex; justify-content: space-between; align-items: center;">
                Team & Collaborators
                <div style="display: flex; gap: 6px;">
                  <button class="btn-modern secondary small" onclick="inviteCollaboratorForJob()" title="Invite collaborator">
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/></svg>
                    Invite
                  </button>
                  <button class="btn-modern secondary small" onclick="openAssignCollaboratorModal()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
                    Add
                  </button>
                </div>
              </div>
              <div id="job-collaborators-list" style="min-height: 60px;">
                <div style="color: var(--text-muted); font-size: 13px;">No collaborators assigned yet.</div>
              </div>
            </div>
          </div>

          <!-- Right Column - Files & Timeline -->
          <div>
            <div class="form-section">
              <div class="form-section-title" style="display: flex; justify-content: space-between; align-items: center;">
                Files & Drawings
                <label class="btn-modern secondary small" style="cursor: pointer;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
                  Upload
                  <input type="file" id="job-file-upload" multiple accept="image/*,.pdf,.dxf,.dwg" style="display: none;" onchange="uploadJobFiles(event)">
                </label>
              </div>
              <div id="job-files-list" style="min-height: 100px; max-height: 300px; overflow-y: auto;">
                <div style="color: var(--text-muted); font-size: 13px; text-align: center; padding: 20px;">
                  No files uploaded yet.<br>
                  <span style="font-size: 12px;">Drop files here or click Upload</span>
                </div>
              </div>
            </div>

            <div class="form-section">
              <div class="form-section-title">Activity Timeline</div>
              <div id="job-timeline" style="max-height: 200px; overflow-y: auto;">
                <div style="color: var(--text-muted); font-size: 13px;">No activity yet.</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-modern secondary" onclick="closeJobDetailModal()">Close</button>
        <button type="button" class="btn-modern primary" onclick="saveJobChanges()">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Customers Modal -->
  <div id="customers-modal" class="modal-overlay" onclick="if(event.target === this) closeCustomersModal()">
    <div class="modal" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
      <div class="modal-header">
        <h2 class="modal-title">Customer Database</h2>
        <button class="modal-close" onclick="closeCustomersModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="modal-body">
        <div style="display: flex; justify-content: space-between; margin-bottom: 20px; flex-wrap: wrap; gap: 12px;">
          <input type="text" id="customer-search" placeholder="Search customers..." style="flex: 1; max-width: 300px; padding: 8px 12px; border-radius: 8px; background: var(--dark-elevated); border: 1px solid var(--border-subtle); color: var(--text-primary);" oninput="searchCustomers()">
          <button class="btn-modern primary small" onclick="openAddCustomerModal()">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
            Add Customer
          </button>
        </div>
        <div id="customers-list-modal">
          <div class="spinner" style="margin: 40px auto;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Add/Edit Customer Modal -->
  <div id="add-customer-modal" class="modal-overlay" onclick="if(event.target === this) closeAddCustomerModal()">
    <div class="modal" style="max-width: 600px;">
      <div class="modal-header">
        <h2 class="modal-title" id="add-customer-modal-title">Add New Customer</h2>
        <button class="modal-close" onclick="closeAddCustomerModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <form id="add-customer-form" onsubmit="saveCustomer(event)">
        <input type="hidden" id="edit-customer-id">
        <div class="modal-body">
          <div class="form-row">
            <div class="form-group">
              <label>Name *</label>
              <input type="text" id="cust-name" required placeholder="John Smith">
            </div>
            <div class="form-group">
              <label>Email</label>
              <input type="email" id="cust-email" placeholder="john@email.com">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Phone</label>
              <input type="tel" id="cust-phone" placeholder="(555) 123-4567">
            </div>
            <div class="form-group">
              <label>Company</label>
              <input type="text" id="cust-company" placeholder="Optional">
            </div>
          </div>
          <div class="form-group">
            <label>Address</label>
            <input type="text" id="cust-address" placeholder="123 Main St">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>City</label>
              <input type="text" id="cust-city" placeholder="Phoenix">
            </div>
            <div class="form-group" style="max-width: 80px;">
              <label>State</label>
              <input type="text" id="cust-state" value="AZ" maxlength="2">
            </div>
            <div class="form-group" style="max-width: 100px;">
              <label>ZIP</label>
              <input type="text" id="cust-zip" placeholder="85001">
            </div>
          </div>
          <div class="form-group">
            <label>Notes</label>
            <textarea id="cust-notes" rows="2" placeholder="Internal notes about this customer..."></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-modern secondary" onclick="closeAddCustomerModal()">Cancel</button>
          <button type="submit" class="btn-modern primary">Save Customer</button>
        </div>
      </form>
    </div>
  </div>

  <!-- New Contractor Modal -->
  <div id="new-collaborator-modal" class="modal-overlay" onclick="if(event.target === this) closeNewCollaboratorModal()">
    <div class="modal" style="max-width: 600px;">
      <div class="modal-header">
        <h2 class="modal-title">Add Collaborator</h2>
        <button class="modal-close" onclick="closeNewCollaboratorModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <form id="new-contractor-form" onsubmit="createContractor(event)">
        <div class="modal-body">
          <div class="form-row">
            <div class="form-group">
              <label>Name *</label>
              <input type="text" id="contractor-name" required placeholder="John's Fabrication">
            </div>
            <div class="form-group">
              <label>Type *</label>
              <select id="contractor-type" required>
                <option value="fabricator">Fabricator</option>
                <option value="installer">Installer</option>
                <option value="plumber">Plumber</option>
                <option value="electrician">Electrician</option>
                <option value="template">Template Tech</option>
                <option value="other">Other</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Email</label>
              <input type="email" id="contractor-email" placeholder="john@fabrication.com">
            </div>
            <div class="form-group">
              <label>Phone</label>
              <input type="tel" id="contractor-phone" placeholder="(555) 123-4567">
            </div>
          </div>
          <div class="form-group">
            <label>Company / Business Name</label>
            <input type="text" id="contractor-company" placeholder="ABC Stoneworks LLC">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Hourly Rate ($)</label>
              <input type="number" id="contractor-rate" step="0.01" min="0" placeholder="75.00">
            </div>
            <div class="form-group">
              <label>License #</label>
              <input type="text" id="contractor-license" placeholder="ROC #123456">
            </div>
          </div>
          <div class="form-group">
            <label>Notes</label>
            <textarea id="contractor-notes" rows="2" placeholder="Specialties, availability, etc."></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-modern secondary" onclick="closeNewCollaboratorModal()">Cancel</button>
          <button type="submit" class="btn-modern primary">Add Collaborator</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Invite Contractor Modal -->
  <div id="invite-collaborator-modal" class="modal-overlay" onclick="if(event.target === this) closeInviteCollaboratorModal()">
    <div class="modal" style="max-width: 450px;">
      <div class="modal-header">
        <h2 class="modal-title">Invite to Network</h2>
        <button class="modal-close" onclick="closeInviteCollaboratorModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>

      <!-- Quick Share Link Section -->
      <div class="modal-body" style="border-bottom: 1px solid var(--border-color); padding-bottom: 20px;">
        <div style="text-align: center; margin-bottom: 16px;">
          <span style="font-size: 14px; font-weight: 600; color: var(--text-primary);">Share your invite link or QR code</span>
        </div>

        <!-- QR Code Display -->
        <div id="invite-qr-container" style="text-align: center; margin-bottom: 16px; display: none;">
          <div id="invite-qr-code" style="display: inline-block; padding: 12px; background: white; border-radius: 8px;"></div>
          <div style="font-size: 11px; color: var(--text-muted); margin-top: 8px;">Scan to join your contractor network</div>
        </div>

        <div style="display: flex; gap: 8px;">
          <input type="text" id="quick-share-link" readonly style="flex: 1; background: var(--bg-tertiary); color: var(--text-primary); font-size: 13px; padding: 10px 12px; border: 1px solid var(--border-color); border-radius: 8px;" placeholder="Click Generate to create invite link...">
          <button type="button" class="btn-modern primary" id="copy-link-btn" onclick="generateAndCopyShareLink()" style="white-space: nowrap;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/></svg>
            Generate Link
          </button>
        </div>
      </div>

      <div style="text-align: center; padding: 12px 0; color: var(--text-muted); font-size: 12px;">or send a direct email invite</div>

      <form id="invite-contractor-form" onsubmit="sendContractorInvitation(event)">
        <div class="modal-body" style="padding-top: 0;">
          <div class="form-group">
            <label>Email Address</label>
            <input type="email" id="invite-contractor-email" required placeholder="email@example.com">
          </div>
          <div class="form-group">
            <label>Message (Optional)</label>
            <textarea id="invite-contractor-message" rows="2" placeholder="Add a personal note..."></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-modern secondary" onclick="closeInviteCollaboratorModal()">Cancel</button>
          <button type="submit" class="btn-modern primary" id="send-invite-btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
            Send Invite
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Contractor Profile/Detail Modal -->
  <div id="contractor-profile-modal" class="modal-overlay" onclick="if(event.target === this) closeContractorProfileModal()">
    <div class="modal" style="max-width: 700px; max-height: 90vh; overflow-y: auto;">
      <div class="modal-header">
        <h2 class="modal-title">Collaborator Profile</h2>
        <button class="modal-close" onclick="closeContractorProfileModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="modal-body">
        <!-- Trust Score Badge -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding: 16px; background: var(--dark-surface); border-radius: 12px;">
          <div>
            <div style="font-size: 20px; font-weight: 700;" id="contractor-profile-name">Contractor Name</div>
            <div style="font-size: 13px; color: var(--text-muted);" id="contractor-profile-company">Company Name</div>
          </div>
          <div style="text-align: center;">
            <div class="trust-score-badge" id="contractor-trust-badge">
              <span class="trust-score-value" id="contractor-trust-score">0</span>
              <span class="trust-score-label">Trust Score</span>
            </div>
          </div>
        </div>

        <!-- Invite Link Section -->
        <div class="form-section">
          <div class="form-section-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="margin-right: 8px;"><path stroke-linecap="round" stroke-linejoin="round" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/></svg>
            Invite to Join Platform
          </div>
          <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 16px;">
            Share this link or QR code so the contractor can claim their profile, upload documents, and build their trust score.
          </p>
          <div style="display: flex; gap: 12px; align-items: stretch;">
            <div style="flex: 1;">
              <div style="display: flex; gap: 8px;">
                <input type="text" id="contractor-invite-link" readonly
                       style="flex: 1; padding: 10px 12px; background: var(--dark-elevated); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-primary); font-size: 12px;"
                       value="Generating link...">
                <button class="btn-modern secondary" onclick="copyInviteLink()" title="Copy Link">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
                </button>
              </div>
              <div style="display: flex; gap: 8px; margin-top: 12px;">
                <button class="btn-modern secondary small" onclick="sendInviteEmail()" style="flex: 1;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                  Email Invite
                </button>
                <button class="btn-modern secondary small" onclick="sendInviteSMS()" style="flex: 1;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
                  Text Invite
                </button>
              </div>
              <div style="margin-top: 12px; display: flex; gap: 8px;">
                <button class="btn-modern primary small" onclick="inviteContractorAsCollaborator()" style="flex: 1;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                  Collaborator
                </button>
                <button class="btn-modern secondary small" onclick="assignContractorToProject(currentContractorId)" style="flex: 1;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/></svg>
                  Assign to Project
                </button>
              </div>
            </div>
            <div style="width: 100px; height: 100px; background: white; border-radius: 8px; display: flex; align-items: center; justify-content: center;" id="contractor-qr-code">
              <div style="color: #333; font-size: 10px; text-align: center;">QR Code</div>
            </div>
          </div>
        </div>

        <!-- Verification Checklist -->
        <div class="form-section">
          <div class="form-section-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="margin-right: 8px;"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
            Verification Status
          </div>
          <div id="contractor-verification-checklist" style="display: grid; gap: 8px;">
            <!-- Checklist items will be rendered here -->
          </div>
        </div>

        <!-- Documents Section -->
        <div class="form-section">
          <div class="form-section-title" style="display: flex; justify-content: space-between; align-items: center;">
            <span>
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="margin-right: 8px;"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
              Documents
            </span>
            <label class="btn-modern secondary small" style="cursor: pointer;">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
              Upload
              <input type="file" id="contractor-doc-upload" accept=".pdf,.jpg,.jpeg,.png" style="display: none;" onchange="uploadContractorDocument(event)">
            </label>
          </div>
          <div id="contractor-documents-list" style="min-height: 60px;">
            <div style="color: var(--text-muted); font-size: 13px; text-align: center; padding: 20px;">
              No documents uploaded yet
            </div>
          </div>
        </div>

        <!-- Contact Info -->
        <div class="form-section">
          <div class="form-section-title">Contact Information</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
            <div>
              <label style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">Email</label>
              <div id="contractor-profile-email" style="font-size: 14px;">-</div>
            </div>
            <div>
              <label style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">Phone</label>
              <div id="contractor-profile-phone" style="font-size: 14px;">-</div>
            </div>
            <div>
              <label style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">Type</label>
              <div id="contractor-profile-type" style="font-size: 14px;">-</div>
            </div>
            <div>
              <label style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">License #</label>
              <div id="contractor-profile-license" style="font-size: 14px;">-</div>
            </div>
          </div>
        </div>

        <!-- Job History -->
        <div class="form-section">
          <div class="form-section-title">Job History</div>
          <div id="contractor-job-history" style="max-height: 150px; overflow-y: auto;">
            <div style="color: var(--text-muted); font-size: 13px;">No jobs assigned yet</div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-modern secondary" onclick="closeContractorProfileModal()">Close</button>
        <button type="button" class="btn-modern primary" onclick="editContractorDetails()">Edit Details</button>
      </div>
    </div>
  </div>

  <!-- Assign Collaborator Modal -->
  <div id="assign-collaborator-modal" class="modal-overlay" onclick="if(event.target === this) closeAssignCollaboratorModal()">
    <div class="modal" style="max-width: 550px;">
      <div class="modal-header">
        <h2 class="modal-title">Assign Collaborator to Job</h2>
        <button class="modal-close" onclick="closeAssignCollaboratorModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <form id="assign-contractor-form" onsubmit="assignContractor(event)">
        <div class="modal-body">
          <!-- Existing Contractor Selection -->
          <div id="select-existing-contractor">
            <div class="form-group">
              <label>Select Contractor *</label>
              <select id="assign-contractor-select" onchange="toggleNewContractorInAssign()">
                <option value="">-- Select Contractor --</option>
                <option value="__new__">+ Add New Contractor</option>
              </select>
            </div>
          </div>

          <!-- New Contractor Form (hidden by default) -->
          <div id="new-contractor-inline" style="display: none; padding: 16px; background: var(--dark-surface); border-radius: 8px; margin-bottom: 16px; border: 1px solid var(--gold-primary);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
              <span style="font-weight: 600; color: var(--gold-primary);">New Contractor Details</span>
              <button type="button" class="btn-modern secondary small" onclick="cancelNewContractorInline()" style="padding: 4px 8px; font-size: 11px;">Cancel</button>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Name *</label>
                <input type="text" id="inline-contractor-name" placeholder="John Smith">
              </div>
              <div class="form-group">
                <label>Company</label>
                <input type="text" id="inline-contractor-company" placeholder="ABC Stoneworks">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Email</label>
                <input type="email" id="inline-contractor-email" placeholder="john@example.com">
              </div>
              <div class="form-group">
                <label>Phone</label>
                <input type="tel" id="inline-contractor-phone" placeholder="(555) 123-4567">
              </div>
            </div>
          </div>

          <div class="form-group">
            <label>Role on this Job</label>
            <select id="assign-contractor-role">
              <option value="fabricator">Fabricator</option>
              <option value="installer">Installer</option>
              <option value="plumber">Plumber</option>
              <option value="electrician">Electrician</option>
              <option value="template">Template Tech</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label>Amount to Pay ($)</label>
            <input type="number" id="assign-contractor-amount" step="0.01" min="0" placeholder="0.00">
          </div>
          <div class="form-group">
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
              <input type="checkbox" id="assign-contractor-notify" checked style="width: 18px; height: 18px;">
              Send email invitation to contractor
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-modern secondary" onclick="closeAssignCollaboratorModal()">Cancel</button>
          <button type="submit" class="btn-modern primary">Assign Collaborator</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Service Catalog Modal -->
  <div id="service-catalog-modal" class="modal-overlay" onclick="if(event.target === this) closeServiceCatalog()">
    <div class="modal" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
      <div class="modal-header">
        <h2 class="modal-title">Service & Material Catalog</h2>
        <button class="modal-close" onclick="closeServiceCatalog()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="modal-body">
        <p style="color: var(--text-muted); margin-bottom: 20px;">Create reusable services and materials for quick estimate creation.</p>

        <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
          <div class="table-filters">
            <button class="filter-btn active" onclick="filterCatalog('all')">All</button>
            <button class="filter-btn" onclick="filterCatalog('material')">Materials</button>
            <button class="filter-btn" onclick="filterCatalog('service')">Services</button>
            <button class="filter-btn" onclick="filterCatalog('labor')">Labor</button>
          </div>
          <button class="btn-modern primary small" onclick="openAddCatalogItem()">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
            Add Item
          </button>
        </div>

        <div id="service-catalog-list">
          <div class="empty-state" style="padding: 40px;">
            <p style="color: var(--text-muted);">No catalog items yet. Add your first service or material.</p>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-modern secondary" onclick="closeServiceCatalog()">Close</button>
      </div>
    </div>
  </div>

  <!-- Add Catalog Item Modal -->
  <div id="add-catalog-item-modal" class="modal-overlay" onclick="if(event.target === this) closeAddCatalogItem()" style="z-index: 10001;">
    <div class="modal" style="max-width: 500px;">
      <div class="modal-header">
        <h2 class="modal-title">Add Catalog Item</h2>
        <button class="modal-close" onclick="closeAddCatalogItem()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="modal-body">
        <form id="add-catalog-item-form" onsubmit="return saveCatalogItem(event)">
          <div class="form-group">
            <label>Item Name *</label>
            <input type="text" id="catalog-item-name" required placeholder="e.g., Granite Installation">
          </div>
          <div class="form-group">
            <label>Description</label>
            <input type="text" id="catalog-item-desc" placeholder="Brief description">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Category</label>
              <select id="catalog-item-category">
                <option value="service">Service</option>
                <option value="material">Material</option>
                <option value="labor">Labor</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="form-group">
              <label>Unit Type</label>
              <select id="catalog-item-unit">
                <option value="each">Each</option>
                <option value="sqft">Sq Ft</option>
                <option value="lnft">Ln Ft</option>
                <option value="hour">Hour</option>
                <option value="day">Day</option>
                <option value="job">Job</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Unit Price ($) *</label>
              <input type="number" id="catalog-item-price" required min="0" step="0.01" placeholder="0.00">
            </div>
            <div class="form-group">
              <label>Your Cost ($)</label>
              <input type="number" id="catalog-item-cost" min="0" step="0.01" placeholder="0.00">
            </div>
          </div>
          <input type="hidden" id="catalog-item-id">
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-modern secondary" onclick="closeAddCatalogItem()">Cancel</button>
        <button type="submit" form="add-catalog-item-form" class="btn-modern primary">Save Item</button>
      </div>
    </div>
  </div>

  <!-- Accept Invite Modal -->
  <div class="modal-overlay" id="accept-invite-modal" onclick="if(event.target === this) closeAcceptInviteModal()">
    <div class="modal" style="max-width: 480px;">
      <div class="modal-header">
        <h2 class="modal-title">Collaboration Invitation</h2>
        <button class="modal-close" onclick="closeAcceptInviteModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="modal-body" id="accept-invite-body">
        <div style="text-align: center; padding: 20px 0;">
          <div class="spinner" style="margin: 0 auto;"></div>
          <p style="margin-top: 12px; color: var(--text-muted);">Loading invitation...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Invite to Project Modal -->
  <div class="modal-overlay" id="invite-to-project-modal" onclick="if(event.target === this) closeInviteToProjectModal()">
    <div class="modal" style="max-width: 520px;">
      <div class="modal-header">
        <h2 class="modal-title">Invite Collaborator</h2>
        <button class="modal-close" onclick="closeInviteToProjectModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="modal-body">
        <form id="invite-collaborator-form" onsubmit="return sendCollaborationInvite(event)">
          <input type="hidden" id="invite-project-id" />
          <div class="form-group" id="invite-project-selector" style="display: none;">
            <label>Project *</label>
            <select id="invite-project-select" required onchange="onInviteProjectSelected()">
              <option value="">Select a Project</option>
            </select>
          </div>
          <div id="inline-create-project-form" style="display: none; background: var(--dark-elevated); border: 1px solid var(--dark-border); border-radius: 10px; padding: 16px; margin-bottom: 16px;">
            <div style="font-size: 13px; font-weight: 600; color: var(--gold-primary); margin-bottom: 12px;">Create New Project</div>
            <div class="form-group" style="margin-bottom: 10px;">
              <input type="text" id="inline-project-name" placeholder="Project Name *" maxlength="200" style="width: 100%;" />
            </div>
            <div class="form-group" style="margin-bottom: 10px;">
              <input type="text" id="inline-project-customer" placeholder="Customer Name *" maxlength="200" style="width: 100%;" />
            </div>
            <div class="form-group" style="margin-bottom: 12px;">
              <input type="text" id="inline-project-description" placeholder="Description (optional)" maxlength="2000" style="width: 100%;" />
            </div>
            <div style="display: flex; gap: 10px;">
              <button type="button" class="btn-modern secondary" onclick="cancelInlineProjectCreate()" style="flex: 1; font-size: 12px; padding: 8px;">Cancel</button>
              <button type="button" class="btn-modern primary" onclick="submitInlineProjectCreate()" id="inline-create-project-btn" style="flex: 1; font-size: 12px; padding: 8px;">Create & Select</button>
            </div>
          </div>
          <div class="form-group">
            <label>Email Address *</label>
            <input type="email" id="invite-email" required placeholder="colleague@example.com" />
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Role *</label>
              <select id="invite-role" required>
                <option value="">Select Role</option>
                <option value="designer">Designer</option>
                <option value="fabricator">Fabricator</option>
                <option value="contractor">Contractor</option>
                <option value="installer">Installer</option>
                <option value="viewer">Viewer</option>
              </select>
            </div>
            <div class="form-group">
              <label>Access Level</label>
              <select id="invite-access-level">
                <option value="read">Read Only</option>
                <option value="write">Read &amp; Write</option>
                <option value="admin">Admin</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label>Notes (optional)</label>
            <input type="text" id="invite-notes" placeholder="e.g., Please review kitchen layout" maxlength="500" />
          </div>
          <button type="submit" class="btn-modern primary" id="send-project-invite-btn" style="width: 100%;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="margin-right: 6px;"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
            Send Invitation
          </button>
        </form>
        <div id="pending-invitations-section" style="margin-top: 24px; display: none;">
          <div style="font-size: 13px; font-weight: 600; color: var(--text-secondary); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Pending Invitations</div>
          <div id="pending-invitations-list"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Start Design Handoff Modal -->
  <div class="modal-overlay" id="start-handoff-modal" onclick="if(event.target === this) closeStartHandoffModal()">
    <div class="modal" style="max-width: 520px;">
      <div class="modal-header">
        <h2 class="modal-title">Start Design Handoff</h2>
        <button class="modal-close" onclick="closeStartHandoffModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="modal-body">
        <p style="color: var(--text-muted); margin-bottom: 16px; font-size: 13px;">Hand off your design to a fabricator and track the entire fabrication-to-installation pipeline.</p>
        <form id="start-handoff-form" onsubmit="return submitStartHandoff(event)">
          <input type="hidden" id="handoff-design-id" />
          <div class="form-group">
            <label>Select Project *</label>
            <select id="handoff-project-select" required>
              <option value="">Loading projects...</option>
            </select>
          </div>
          <div class="form-group">
            <label>Handoff Title *</label>
            <input type="text" id="handoff-title" required placeholder="e.g., Kitchen Countertop Fabrication" maxlength="200" />
          </div>
          <div class="form-group">
            <label>Description</label>
            <textarea id="handoff-description" placeholder="Describe what needs to be fabricated and installed..." maxlength="2000" rows="3" style="resize: vertical;"></textarea>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Assign Fabricator</label>
              <select id="handoff-fabricator">
                <option value="">None (assign later)</option>
              </select>
            </div>
            <div class="form-group">
              <label>Assign Collaborator/Installer</label>
              <select id="handoff-contractor">
                <option value="">None (assign later)</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label>Notes</label>
            <input type="text" id="handoff-notes" placeholder="Special instructions for fabrication or installation..." maxlength="2000" />
          </div>
          <button type="submit" class="btn-modern primary" id="submit-handoff-btn" style="width: 100%;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="margin-right: 6px;"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>
            Start Handoff
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Handoff Detail/Tracker Modal -->
  <div class="modal-overlay" id="handoff-detail-modal" onclick="if(event.target === this) closeHandoffDetailModal()">
    <div class="modal" style="max-width: 640px;">
      <div class="modal-header">
        <h2 class="modal-title" id="handoff-detail-title">Design Handoff</h2>
        <button class="modal-close" onclick="closeHandoffDetailModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="modal-body" id="handoff-detail-content">
        <div style="text-align: center; padding: 40px;"><div class="spinner"></div><p style="color: var(--text-muted); margin-top: 12px;">Loading handoff...</p></div>
      </div>
    </div>
  </div>

  <!-- Create/Edit Project Modal -->
  <div class="modal-overlay" id="project-modal" onclick="if(event.target === this) closeProjectModal()">
    <div class="modal" style="max-width: 680px;">
      <div class="modal-header">
        <h2 class="modal-title" id="project-modal-title">New Project</h2>
        <button class="modal-close" onclick="closeProjectModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
        <form id="project-form" onsubmit="return saveProject(event)">
          <input type="hidden" id="project-edit-id" />
          <input type="hidden" id="proj-lead-id" />
          <input type="hidden" id="proj-customer-id" />

          <!-- Source Selector (New Projects Only) -->
          <div id="project-source-selector" style="margin-bottom: 20px;">
            <div style="font-size: 13px; font-weight: 600; color: var(--text-secondary); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Create From</div>
            <div style="display: flex; gap: 8px; margin-bottom: 16px;">
              <button type="button" class="source-tab active" onclick="selectProjectSource('manual')" id="source-tab-manual" style="flex: 1; padding: 10px 16px; border: 2px solid var(--gold-primary); background: var(--gold-primary); color: var(--dark-primary); border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="vertical-align: -3px; margin-right: 4px;"><path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                Manual
              </button>
              <button type="button" class="source-tab" onclick="selectProjectSource('lead')" id="source-tab-lead" style="flex: 1; padding: 10px 16px; border: 2px solid var(--border-color); background: transparent; color: var(--text-primary); border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="vertical-align: -3px; margin-right: 4px;"><path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
                From Lead
              </button>
              <button type="button" class="source-tab" onclick="selectProjectSource('customer')" id="source-tab-customer" style="flex: 1; padding: 10px 16px; border: 2px solid var(--border-color); background: transparent; color: var(--text-primary); border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="vertical-align: -3px; margin-right: 4px;"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                From Customer
              </button>
            </div>

            <!-- Lead Selector -->
            <div id="lead-selector-container" style="display: none; margin-bottom: 16px;">
              <div class="form-group" style="margin-bottom: 0;">
                <label>Select Lead</label>
                <div style="position: relative;">
                  <input type="text" id="lead-search-input" placeholder="Search leads by name, email, or phone..." style="padding-right: 32px;" oninput="filterLeadsForProject(this.value)" onfocus="showLeadDropdown()" />
                  <div id="lead-dropdown" class="search-dropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; max-height: 200px; overflow-y: auto; background: var(--dark-secondary); border: 1px solid var(--border-color); border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 100;">
                    <div class="dropdown-loading" style="padding: 16px; text-align: center; color: var(--text-secondary);">Loading leads...</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Customer Selector -->
            <div id="customer-selector-container" style="display: none; margin-bottom: 16px;">
              <div class="form-group" style="margin-bottom: 0;">
                <label>Select Customer</label>
                <div style="position: relative;">
                  <input type="text" id="customer-search-input" placeholder="Search customers by name, email, or phone..." style="padding-right: 32px;" oninput="filterCustomersForProject(this.value)" onfocus="showCustomerDropdown()" />
                  <div id="customer-dropdown" class="search-dropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; max-height: 200px; overflow-y: auto; background: var(--dark-secondary); border: 1px solid var(--border-color); border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 100;">
                    <div class="dropdown-loading" style="padding: 16px; text-align: center; color: var(--text-secondary);">Loading customers...</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div style="font-size: 13px; font-weight: 600; color: var(--text-secondary); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Project Details</div>
          <div class="form-group">
            <label>Project Name *</label>
            <input type="text" id="proj-name" required maxlength="200" placeholder="e.g., Kitchen Countertops - Smith Residence" />
          </div>
          <div class="form-group">
            <label>Description</label>
            <textarea id="proj-description" rows="2" maxlength="2000" placeholder="Brief project description..."></textarea>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Status</label>
              <select id="proj-status">
                <option value="lead">Lead</option>
                <option value="approved">Approved</option>
                <option value="scheduled">Scheduled</option>
                <option value="in_progress">In Progress</option>
                <option value="completed">Completed</option>
                <option value="on_hold">On Hold</option>
                <option value="cancelled">Cancelled</option>
              </select>
            </div>
            <div class="form-group">
              <label>Priority</label>
              <select id="proj-priority">
                <option value="low">Low</option>
                <option value="medium" selected>Medium</option>
                <option value="high">High</option>
                <option value="urgent">Urgent</option>
              </select>
            </div>
          </div>

          <div style="font-size: 13px; font-weight: 600; color: var(--text-secondary); margin: 20px 0 12px; text-transform: uppercase; letter-spacing: 0.5px;">Customer Information</div>
          <div class="form-group">
            <label>Customer Name *</label>
            <input type="text" id="proj-customer-name" required maxlength="200" placeholder="Full name" />
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Email</label>
              <input type="email" id="proj-customer-email" maxlength="254" placeholder="email@example.com" />
            </div>
            <div class="form-group">
              <label>Phone</label>
              <input type="tel" id="proj-customer-phone" maxlength="20" placeholder="(555) 123-4567" />
            </div>
          </div>
          <div class="form-group">
            <label>Address</label>
            <input type="text" id="proj-address" maxlength="500" placeholder="Street address" />
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>City</label>
              <input type="text" id="proj-city" maxlength="100" placeholder="City" />
            </div>
            <div class="form-group" style="max-width: 80px;">
              <label>State</label>
              <input type="text" id="proj-state" maxlength="2" placeholder="AZ" />
            </div>
            <div class="form-group" style="max-width: 120px;">
              <label>ZIP</label>
              <input type="text" id="proj-zip" maxlength="20" placeholder="85374" />
            </div>
          </div>

          <div style="font-size: 13px; font-weight: 600; color: var(--text-secondary); margin: 20px 0 12px; text-transform: uppercase; letter-spacing: 0.5px;">Financials & Schedule</div>
          <div class="form-row">
            <div class="form-group">
              <label>Value ($)</label>
              <input type="number" id="proj-value" step="0.01" min="0" placeholder="0.00" />
            </div>
            <div class="form-group">
              <label>Cost ($)</label>
              <input type="number" id="proj-cost" step="0.01" min="0" placeholder="0.00" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Start Date</label>
              <input type="date" id="proj-start-date" />
            </div>
            <div class="form-group">
              <label>End Date</label>
              <input type="date" id="proj-end-date" />
            </div>
            <div class="form-group">
              <label>Est. Duration (days)</label>
              <input type="number" id="proj-duration" min="0" placeholder="0" />
            </div>
          </div>

          <div style="font-size: 13px; font-weight: 600; color: var(--text-secondary); margin: 20px 0 12px; text-transform: uppercase; letter-spacing: 0.5px;">Notes</div>
          <div class="form-group">
            <label>Internal Notes</label>
            <textarea id="proj-notes" rows="2" maxlength="5000" placeholder="Internal notes (not visible to customer)..."></textarea>
          </div>
          <div class="form-group">
            <label>Customer Notes</label>
            <textarea id="proj-customer-notes" rows="2" maxlength="5000" placeholder="Notes visible to customer..."></textarea>
          </div>

          <button type="submit" class="btn-modern primary" id="save-project-btn" style="width: 100%; margin-top: 16px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
            Save Project
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Project Detail Modal -->
  <div class="modal-overlay" id="project-detail-modal" onclick="if(event.target === this) closeProjectDetail()">
    <div class="modal" style="max-width: 720px;">
      <div class="modal-header">
        <h2 class="modal-title" id="project-detail-title">Project Details</h2>
        <button class="modal-close" onclick="closeProjectDetail()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="modal-body" id="project-detail-body" style="max-height: 70vh; overflow-y: auto;">
        <div class="spinner" style="margin: 40px auto;"></div>
      </div>
    </div>
  </div>

  <!-- Payment Request Modal -->
  <div id="payment-request-modal" class="payment-modal" style="display: none;" onclick="if(event.target === this) closePaymentModal()">
    <div class="payment-modal-content">
      <div class="payment-modal-header">
        <h3>Send Payment Request</h3>
        <button class="payment-modal-close" onclick="closePaymentModal()">&times;</button>
      </div>
      <div class="payment-modal-body">
        <div class="payment-modal-info">
          <p><strong>To:</strong> <span id="payment-recipient-name"></span></p>
          <p><strong>Email:</strong> <span id="payment-recipient-email"></span></p>
        </div>
        <form id="payment-request-form" onsubmit="return sendPaymentRequest(event)">
          <input type="hidden" id="payment-inquiry-id">
          <input type="hidden" id="payment-customer-email">
          <input type="hidden" id="payment-customer-name">
          <div class="form-group">
            <label>Amount ($)</label>
            <input type="number" id="payment-amount" step="0.01" min="1" required placeholder="500.00">
          </div>
          <div class="form-group">
            <label>Description</label>
            <input type="text" id="payment-description" required placeholder="Stone remnant - Calacatta Gold 24x36">
          </div>
          <div class="form-group">
            <label>Note to Customer (optional)</label>
            <textarea id="payment-note" rows="3" placeholder="Thank you for your interest! Here's the payment link for your purchase..."></textarea>
          </div>
        </form>
      </div>
      <div class="payment-modal-footer">
        <button type="button" class="btn-modern secondary" onclick="closePaymentModal()">Cancel</button>
        <button type="submit" form="payment-request-form" class="btn-modern primary" id="send-payment-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          Send Payment Link
        </button>
      </div>
    </div>
  </div>

  <script src="/js/account/main.js?v=20260210"></script>
<script src="/js/user-tracking.js"></script>
<script src="/js/site-search.js"></script>

<!-- Remodely.ai Integration -->
<script src="/remodely-platform/config/tenants.js"></script>
<script>
  // Initialize Remodely tenant integration
  document.addEventListener('DOMContentLoaded', function() {
    if (window.REMODELY_TENANTS) {
      const tenant = window.REMODELY_TENANTS.initializeTenant();
      console.log('Remodely tenant initialized:', tenant.name);
    }
  });
</script>

<!-- Pro-Customer Referral Tracking -->
<script src="/js/referral-tracking.js?v=20260118"></script>

<!-- Mobile Bottom Navigation -->
<nav class="mobile-bottom-nav" id="mobileBottomNav">
  <div class="mobile-nav-tabs">
    <button class="mobile-nav-tab active" data-page="dashboard" onclick="showPage('dashboard'); setActiveTab(this);">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
      <span>Home</span>
    </button>
    <button class="mobile-nav-tab" data-page="favorites" onclick="showPage('favorites'); setActiveTab(this);">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>
      <span>Favorites</span>
      <span class="mobile-nav-badge" id="mobile-favorites-count" data-count="0">0</span>
    </button>
    <button class="mobile-nav-tab" data-page="tools" onclick="showPage('tools'); setActiveTab(this);">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>
      <span>Tools</span>
    </button>
    <button class="mobile-nav-tab" onclick="toggleMobileDrawer()">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
      <span>More</span>
    </button>
  </div>
</nav>

<!-- Mobile Drawer Overlay -->
<div class="mobile-drawer-overlay" id="mobileDrawerOverlay" onclick="closeMobileDrawer()"></div>

<!-- Mobile More Drawer -->
<div class="mobile-more-drawer" id="mobileMoreDrawer">
  <div class="drawer-handle"></div>
  <div class="drawer-header">
    <div class="drawer-user-info">
      <div class="drawer-avatar" id="drawer-avatar">SG</div>
      <div>
        <div class="drawer-user-name" id="drawer-user-name">User</div>
        <div class="drawer-user-role" id="drawer-user-role">Account</div>
      </div>
    </div>
  </div>
  <div class="drawer-menu">
    <div class="drawer-menu-section">
      <div class="drawer-menu-section-title">My Account</div>
      <button class="drawer-menu-item" onclick="showPage('profile'); closeMobileDrawer();">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
        Profile
      </button>
      <button class="drawer-menu-item" onclick="showPage('my-designs'); closeMobileDrawer();">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
        My Designs
        <span class="menu-badge" id="drawer-designs-count">0</span>
      </button>
      <button class="drawer-menu-item" onclick="showPage('listings'); closeMobileDrawer();">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>
        My Listings
        <span class="menu-badge" id="drawer-listings-count">0</span>
      </button>
      <a class="drawer-menu-item" href="/cart/">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
        Shopping Cart
        <span class="menu-badge" id="drawer-cart-count">0</span>
      </a>
    </div>
    <div class="drawer-menu-section" id="drawer-sales-section" style="display: none;">
      <div class="drawer-menu-section-title">Sales</div>
      <button class="drawer-menu-item" onclick="showPage('leads'); closeMobileDrawer();">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>
        Leads
        <span class="menu-badge" id="drawer-leads-count">0</span>
      </button>
      <button class="drawer-menu-item" onclick="showPage('customers'); closeMobileDrawer();">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
        Customers
      </button>
      <button class="drawer-menu-item" onclick="showPage('calendar'); closeMobileDrawer();">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
        Calendar
      </button>
    </div>
    <div class="drawer-menu-section">
      <div class="drawer-menu-section-title">Quick Links</div>
      <a class="drawer-menu-item" href="/marketplace/">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/></svg>
        Marketplace
      </a>
      <a class="drawer-menu-item" href="/get-a-free-estimate/">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
        Get Free Estimate
      </a>
      <a class="drawer-menu-item" href="/contact-us/">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
        Contact Us
      </a>
    </div>
  </div>
  <div class="drawer-footer">
    <button class="drawer-logout-btn" onclick="signOut()">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
      Sign Out
    </button>
  </div>
</div>

<script>
// Mobile Bottom Navigation Functions
function toggleMobileDrawer() {
  const drawer = document.getElementById('mobileMoreDrawer');
  const overlay = document.getElementById('mobileDrawerOverlay');
  drawer.classList.toggle('open');
  overlay.classList.toggle('active');
  document.body.classList.toggle('drawer-open');
}

function closeMobileDrawer() {
  const drawer = document.getElementById('mobileMoreDrawer');
  const overlay = document.getElementById('mobileDrawerOverlay');
  drawer.classList.remove('open');
  overlay.classList.remove('active');
  document.body.classList.remove('drawer-open');
}

function setActiveTab(btn) {
  document.querySelectorAll('.mobile-nav-tab').forEach(tab => tab.classList.remove('active'));
  btn.classList.add('active');
}

// Update drawer user info
function updateMobileDrawerUser(user, role) {
  const avatar = document.getElementById('drawer-avatar');
  const name = document.getElementById('drawer-user-name');
  const roleEl = document.getElementById('drawer-user-role');

  if (user) {
    const initials = (user.user_metadata?.name || user.email || 'U').substring(0, 2).toUpperCase();
    if (avatar) avatar.textContent = initials;
    if (name) name.textContent = user.user_metadata?.name || user.email?.split('@')[0] || 'User';
    if (roleEl) roleEl.textContent = role || 'Account';
  }

  // Show/hide sales section based on role
  const salesSection = document.getElementById('drawer-sales-section');
  if (salesSection) {
    const showSales = ['admin', 'pro', 'contractor', 'fabricator', 'vendor', 'distributor'].includes(role);
    salesSection.style.display = showSales ? 'block' : 'none';
  }
}

// Sync badge counts to mobile nav
function syncMobileBadges() {
  const favCount = document.getElementById('favorites-count');
  const mobileFavCount = document.getElementById('mobile-favorites-count');
  if (favCount && mobileFavCount) {
    const count = favCount.dataset.count || '0';
    mobileFavCount.textContent = count;
    mobileFavCount.dataset.count = count;
  }

  // Sync drawer badges
  const drawerDesigns = document.getElementById('drawer-designs-count');
  const designsCount = document.getElementById('designs-count');
  if (drawerDesigns && designsCount) {
    drawerDesigns.textContent = designsCount.dataset.count || '0';
  }

  const drawerListings = document.getElementById('drawer-listings-count');
  const listingsCount = document.getElementById('listings-count');
  if (drawerListings && listingsCount) {
    drawerListings.textContent = listingsCount.dataset.count || '0';
  }

  const drawerLeads = document.getElementById('drawer-leads-count');
  const leadsCount = document.getElementById('leads-count');
  if (drawerLeads && leadsCount) {
    drawerLeads.textContent = leadsCount.dataset.count || '0';
  }

  const drawerCart = document.getElementById('drawer-cart-count');
  const cartCount = document.getElementById('account-cart-count');
  if (drawerCart && cartCount) {
    drawerCart.textContent = cartCount.dataset.count || '0';
  }
}

// Call sync when badges update
const originalUpdateBadge = window.updateBadgeCount;
if (originalUpdateBadge) {
  window.updateBadgeCount = function(...args) {
    originalUpdateBadge.apply(this, args);
    syncMobileBadges();
  };
}

// Initialize mobile nav on load
document.addEventListener('DOMContentLoaded', function() {
  syncMobileBadges();

  // Update active tab based on current page
  const currentPage = window.location.hash.slice(1) || 'dashboard';
  const tabs = document.querySelectorAll('.mobile-nav-tab[data-page]');
  tabs.forEach(tab => {
    tab.classList.toggle('active', tab.dataset.page === currentPage);
  });
});
</script>

</body>
</html>
